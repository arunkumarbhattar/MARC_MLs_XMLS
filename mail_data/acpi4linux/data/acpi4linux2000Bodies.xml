<?xml version="1.0" encoding="utf-8"?>
<emails><email><emailId>20000119170942</emailId><senderName>"Stephan Betken"</senderName><senderEmail>tobias-stephan@gmx.de</senderEmail><timestampReceived>2000-01-19 17:09:42-0400</timestampReceived><subject>[Acpi] (no subject)</subject><body>

[Attachment #3 (text/html)]

&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"&gt;
&lt;HTML&gt;&lt;HEAD&gt;
&lt;META content="text/html; charset=iso-8859-1" http-equiv=Content-Type&gt;
&lt;META content="MSHTML 5.00.2722.2800" name=GENERATOR&gt;
&lt;STYLE&gt;&lt;/STYLE&gt;
&lt;/HEAD&gt;
&lt;BODY bgColor=#ffffff&gt;
&lt;DIV&gt;Â &lt;/DIV&gt;&lt;/BODY&gt;&lt;/HTML&gt;


</body></email><email><emailId>20000205035235</emailId><senderName>Roberto Jung Drebes</senderName><senderEmail>drebes@inf.ufrgs.br</senderEmail><timestampReceived>2000-02-05 03:52:35-0400</timestampReceived><subject>[Acpi] (no subject)</subject><body>

Hello there,

I have a problem with my portable, which I believe only ACPI could help me with. 

The problem is that my Armada 1700 notebook, which has a ACPI BIOS, has also a Infrared port.
This port is a SMC IrCC, which is part of a SMC FDC37C95xFR Ultra IO controller. This IO chip
also supports ACPI, and this seems to be my problem.

Here is what happens:

The regular PnP BIOS reports the IR port as a generic SIR (up to 115200 bps) port. SIR ports
works just like regular serial ports, that is, it only takes a IO address and IRQ as
resources, and so the BIOS PnP just allows me to select this resources. The way it is, Linux
sees the port at 0x3e8, and IRQ , which is shared with ttyS0 when it boots. No problem here.

When I enable ACPI, the system stops detecting a generic SIR port, and starts detecting the
port as a SMC IrCC. I've seen it starts using *SMCF010 instead of the generic PnP ID.

The problem is that if I want to use the port at higher speeds, I am expected to use other IO
address, and a DMA (only available when the port is detected as the SMC IrCC). But when the
system is turned on, it is set to use DMA 0, IO 0x100. But the address 0x100 is also used by
some mainboard resources (Windows 98 reports them as ACPI mainboard resources).

So what happens? using Windows 98, it will reconfigure it (through ACPI I guess) the port to
use 0x110 automagically, but I don't know how could I do that in Linux.

Is there a program that could reconfigure enumerated devices? I've checked the ACPI
specification, but I found that very confusing. 

I know the ACPI support is rather primitive right now and wonder if that
could be done in a user space utility.

This tests with device enumeration were done in Windows 98 (regular PnP BIOS vs ACPI enabled). 
Other devices also changed IDs when ACPI was enabled, like serial and parallel ports.

I've tried with the latest 2.3 kernel, and it could detect that my system has ACPI. I could
then grep the SMCF010 ID in the tables.

Can someone share some light with me?

Thanks in advance,

--
Roberto Jung Drebes &lt;drebes@inf.ufrgs.br&gt;
Porto Alegre, RS - Brasil
http://www.inf.ufrgs.br/~drebes/

</body></email><email><emailId>20000206104411</emailId><senderName>"Yuki Ogawa"</senderName><senderEmail>y-ogawa@dvpj.sony.co.jp</senderEmail><timestampReceived>2000-02-06 10:44:11-0400</timestampReceived><subject>Re: [Acpi] (no subject)</subject><body>

In case of resource conflicting, ACPI OS should be a resource arbitator.

get possible resources from _PRS,
and find free resources which can be used with the device, (This may be most dificcult point)
the set appropriate resource by _SRS method.
then make sure that resource setting is correctly done by _CRS.


I'm sorry but I don't know current kernel or user space utility supports
dynamic resource allocation.

----- Original Message ----- 
&gt;From : "Roberto Jung Drebes" &lt;drebes@inf.ufrgs.br&gt;
To : &lt;acpi@phobos.fachschaften.tu-muenchen.de&gt;
Date : 2000/2/5
Subject : [Acpi] (no subject)


&gt; 
&gt; Hello there,
&gt; 
&gt; I have a problem with my portable, which I believe only ACPI could help me with. 
&gt; 
&gt; The problem is that my Armada 1700 notebook, which has a ACPI BIOS, has also a Infrared port.
&gt; This port is a SMC IrCC, which is part of a SMC FDC37C95xFR Ultra IO controller. This IO chip
&gt; also supports ACPI, and this seems to be my problem.
&gt; 
&gt; Here is what happens:
&gt; 
&gt; The regular PnP BIOS reports the IR port as a generic SIR (up to 115200 bps) port. SIR ports
&gt; works just like regular serial ports, that is, it only takes a IO address and IRQ as
&gt; resources, and so the BIOS PnP just allows me to select this resources. The way it is, Linux
&gt; sees the port at 0x3e8, and IRQ , which is shared with ttyS0 when it boots. No problem here.
&gt; 
&gt; When I enable ACPI, the system stops detecting a generic SIR port, and starts detecting the
&gt; port as a SMC IrCC. I've seen it starts using *SMCF010 instead of the generic PnP ID.
&gt; 
&gt; The problem is that if I want to use the port at higher speeds, I am expected to use other IO
&gt; address, and a DMA (only available when the port is detected as the SMC IrCC). But when the
&gt; system is turned on, it is set to use DMA 0, IO 0x100. But the address 0x100 is also used by
&gt; some mainboard resources (Windows 98 reports them as ACPI mainboard resources).
&gt; 
&gt; So what happens? using Windows 98, it will reconfigure it (through ACPI I guess) the port to
&gt; use 0x110 automagically, but I don't know how could I do that in Linux.
&gt; 
&gt; Is there a program that could reconfigure enumerated devices? I've checked the ACPI
&gt; specification, but I found that very confusing. 
&gt; 
&gt; I know the ACPI support is rather primitive right now and wonder if that
&gt; could be done in a user space utility.
&gt; 
&gt; This tests with device enumeration were done in Windows 98 (regular PnP BIOS vs ACPI enabled). 
&gt; Other devices also changed IDs when ACPI was enabled, like serial and parallel ports.
&gt; 
&gt; I've tried with the latest 2.3 kernel, and it could detect that my system has ACPI. I could
&gt; then grep the SMCF010 ID in the tables.
&gt; 
&gt; Can someone share some light with me?
&gt; 
&gt; Thanks in advance,
&gt; 
&gt; --
&gt; Roberto Jung Drebes &lt;drebes@inf.ufrgs.br&gt;
&gt; Porto Alegre, RS - Brasil
&gt; http://www.inf.ufrgs.br/~drebes/
&gt; 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; 

</body></email><email><emailId>20000211204959</emailId><senderName>Sean Furey</senderName><senderEmail>local.linux.acpi@furey.freeserve.co.uk</senderEmail><timestampReceived>2000-02-11 20:49:59-0400</timestampReceived><subject>[Acpi] (no subject)</subject><body>

Hi All!

I'm kindof new to this ACPI stuff, I'll admit that I only really was interested
due to the attraction of power off.

I'm running 2.2.14.  I grabbed one of the older patches for 2.2.11 from the
website, as it was the latest one against the 2.2 kernels.  With a bit of
hand-tweaking I adapted it (2.2.14 had a few #includes added).

Would this simple tweaking be enough to fit one of the more recent patches
which are diffed against the 2.3 kernels?  Or are the 2.3 kernels sufficiently
different from 2.2 at this stage to make it practical?

Also, I would be interested in making a patch against 2.2.14 available (even if
it was the older one that I am using).  Given that I have a 'pure' 2.2.14
kernel source in one directory and a patched 'pure' source in another, what
command can I use to make this patch?

Thanks in advance

-- 
Sean Furey
sean@furey.freeserve.co.uk

</body></email><email><emailId>20000418162059</emailId><senderName>"Jeong Hwan Park"</senderName><senderEmail>jhpark@brainzsquare.com</senderEmail><timestampReceived>2000-04-18 16:20:59-0400</timestampReceived><subject>[Acpi] (no subject)</subject><body>

I am sorry for my multiple broken email due to incorrect character set. :)


I have a linux server which has dual PIII-550 and intel L440GX+ M/B built in intel \
82559 ethernet controller.

I have installed 2.3.99-pre5 for ACPI.
I run the "acpid -d" in prompt.
I can shutdown the server and power off without pushing the power button.

Everything is ok but I can't wake the system with wake-on-lan.

When I use 2.2.14 kernel, I have no problem to wake up the system with wake-on-lan.

How can I catch two rabbits?

Best regards,

Jeong Hwan Park

BrainzSquare
http://www.brainzsquare.com
Tel. 82-42-823-9050
Fax. 82-42-823-9060


</body></email><email><emailId>20000418172644</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-18 17:26:44-0400</timestampReceived><subject>Re: [Acpi] (no subject)</subject><body>

--- Jeong Hwan Park &lt;jhpark@brainzsquare.com&gt; wrote:

&gt; I have a linux server which has dual PIII-550 and
&gt; intel L440GX+ M/B built in intel 82559 ethernet
&gt; controller.
&gt; 
&gt; I have installed 2.3.99-pre5 for ACPI.
&gt; I run the "acpid -d" in prompt.
&gt; I can shutdown the server and power off without
&gt; pushing the power button.
&gt; 
&gt; Everything is ok but I can't wake the system with
&gt; wake-on-lan.

Right, wake-on-lan is not currently implemented.
There is a fair amount of work still to do to get
that working, so it might be a while.

&gt; When I use 2.2.14 kernel, I have no problem to wake
&gt; up the system with wake-on-lan.

I would be very surprised if you are seeing
wake-on-lan working on 2.2.14.  There is a patch
that adds some ACPI support to a 2.2.x kernel but
it only provides power-off and power button support.
And AFAIK the ethernet driver side of wake-on-lan
is totally absent from 2.2.x

-Andy


__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com

</body></email><email><emailId>20000419005456</emailId><senderName>Art Boulatov</senderName><senderEmail>aboulato@soros.ksu.ru</senderEmail><timestampReceived>2000-04-19 00:54:56-0400</timestampReceived><subject>Re: [Acpi] (no subject)</subject><body>

Andy Henroid wrote:
&gt; 
&gt; --- Jeong Hwan Park &lt;jhpark@brainzsquare.com&gt; wrote:
&gt; 
&gt; &gt; I have a linux server which has dual PIII-550 and
&gt; &gt; intel L440GX+ M/B built in intel 82559 ethernet
&gt; &gt; controller.
&gt; &gt;
&gt; &gt; I have installed 2.3.99-pre5 for ACPI.
&gt; &gt; I run the "acpid -d" in prompt.
&gt; &gt; I can shutdown the server and power off without
&gt; &gt; pushing the power button.
&gt; &gt;
&gt; &gt; Everything is ok but I can't wake the system with
&gt; &gt; wake-on-lan.
&gt; 
&gt; Right, wake-on-lan is not currently implemented.
&gt; There is a fair amount of work still to do to get
&gt; that working, so it might be a while.

So is there currently any way to make use of wake-on-lan?
Any early-development implementations to try?

linux-2.3.99-pre* 
IBM PC 300GL 6561/320
10/100 EtherJet PCI Adapter with WOL

&gt; 
&gt; &gt; When I use 2.2.14 kernel, I have no problem to wake
&gt; &gt; up the system with wake-on-lan.
&gt; 
&gt; I would be very surprised if you are seeing
&gt; wake-on-lan working on 2.2.14.  There is a patch
&gt; that adds some ACPI support to a 2.2.x kernel but
&gt; it only provides power-off and power button support.
&gt; And AFAIK the ethernet driver side of wake-on-lan
&gt; is totally absent from 2.2.x
&gt; 
&gt; -Andy
&gt; 
&gt; __________________________________________________
&gt; Do You Yahoo!?
&gt; Send online invitations with Yahoo! Invites.
&gt; http://invites.yahoo.com
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000419013630</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-19 01:36:30-0400</timestampReceived><subject>Re: [Acpi] (no subject)</subject><body>

--- Art Boulatov &lt;aboulato@soros.ksu.ru&gt; wrote:

&gt; So is there currently any way to make use of
&gt; wake-on-lan? Any early-development implementations
&gt; to try?

No, sorry, there isn't even alpha WOL support
right now.  The first step to WOL is ACPI suspend
and resume support on Linux and that is not yet
complete.  The gating factor is completion and
debug of the AML interpreter (currently contained
in acpid).  Once that is solid, suspend/resume
and WOL will soon follow.

I try to get new ACPI code out to the Linux
community as soon as it is available, so there
really is no early development tree.  Keep
watching the ACPI4Linux mailing list for progress
updates.

-Andy



__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com

</body></email><email><emailId>20000419031257</emailId><senderName>"Jeong Hwan Park"</senderName><senderEmail>jhpark@brainzsquare.com</senderEmail><timestampReceived>2000-04-19 03:12:57-0400</timestampReceived><subject>Re: [Acpi] (no subject)</subject><body>

Does your message mean that I couldn't wake up the system with WOL in the current ACPI4Linux?

Without ACPI, I can wake up the system!

Can I change the same system status with no ACPI when I shutdown with ACPI?


----- Original Message ----- 
From: "Andy Henroid" &lt;andy_henroid@yahoo.com&gt;
To: "Art Boulatov" &lt;aboulato@soros.ksu.ru&gt;
Cc: &lt;acpi@phobos.fachschaften.tu-muenchen.de&gt;
Sent: Wednesday, April 19, 2000 10:36 AM
Subject: Re: [Acpi] (no subject)


&gt; --- Art Boulatov &lt;aboulato@soros.ksu.ru&gt; wrote:
&gt; 
&gt; &gt; So is there currently any way to make use of
&gt; &gt; wake-on-lan? Any early-development implementations
&gt; &gt; to try?
&gt; 
&gt; No, sorry, there isn't even alpha WOL support
&gt; right now.  The first step to WOL is ACPI suspend
&gt; and resume support on Linux and that is not yet
&gt; complete.  The gating factor is completion and
&gt; debug of the AML interpreter (currently contained
&gt; in acpid).  Once that is solid, suspend/resume
&gt; and WOL will soon follow.
&gt; 
&gt; I try to get new ACPI code out to the Linux
&gt; community as soon as it is available, so there
&gt; really is no early development tree.  Keep
&gt; watching the ACPI4Linux mailing list for progress
&gt; updates.
&gt; 
&gt; -Andy
&gt; 
&gt; 
&gt; 
&gt; __________________________________________________
&gt; Do You Yahoo!?
&gt; Send online invitations with Yahoo! Invites.
&gt; http://invites.yahoo.com
&gt; 
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; 
&gt; 

</body></email><email><emailId>20000126215917</emailId><senderName>root</senderName><senderEmail>root@phobos.fachschaften.tu-muenchen.de</senderEmail><timestampReceived>2000-01-26 21:59:17-0400</timestampReceived><subject>[Acpi] Test</subject><body>

[This message was never distributed. It only shows up in the archive]

</body></email><email><emailId>20000113232116</emailId><senderName>Sven Kirmess</senderName><senderEmail>sven.kirmess@gmx.net</senderEmail><timestampReceived>2000-01-13 23:21:16-0400</timestampReceived><subject>[Acpi] [Fwd: Power off handling.]</subject><body>

Hi Andy

   I found this patch on the Linux kernel ML. In case, you've missed
it, I post it here. Any comments about that peace of code (I haven't
tried it yet)?


Sven


-------- Original Message --------
Subject: Power off handling.
Date: Tue, 11 Jan 2000 03:37:02 GMT
From: David Woodhouse &lt;dwmw2@infradead.org&gt;
Organization: Internet mailing list
To: torvalds@transmeta.com
CC: linux-kernel@vger.rutgers.edu
Newsgroups: fa.linux.kernel

This patch uses a notifier chain to register a list of functions which
ought 
to be able to power the machine down, and provides a generic 
machine_power_off() routine which calls them in turn until one of them 
succeeds.

This means that when both acpi and apm are present on a machine, it
can 
attempt both ways to power down.

It removes the unnecessary sysrq_power_off pointer, and sysrq-o now
calls 
machine_power_off instead.

Index: arch/alpha/kernel/process.c
===================================================================
RCS file: /cvs/linux/arch/alpha/kernel/process.c,v
retrieving revision 1.3.2.6
diff -u -r1.3.2.6 process.c
--- arch/alpha/kernel/process.c	1999/12/17 17:22:28	1.3.2.6
+++ arch/alpha/kernel/process.c	2000/01/10 15:37:55
@@ -173,7 +173,7 @@
 }
 
 void
-machine_power_off(void)
+alpha_power_off(void)
 {
 	common_shutdown(LINUX_REBOOT_CMD_POWER_OFF, NULL);
 }
Index: arch/alpha/kernel/setup.c
===================================================================
RCS file: /cvs/linux/arch/alpha/kernel/setup.c,v
retrieving revision 1.2.2.5
diff -u -r1.2.2.5 setup.c
--- arch/alpha/kernel/setup.c	1999/12/17 17:22:28	1.2.2.5
+++ arch/alpha/kernel/setup.c	2000/01/10 15:37:56
@@ -29,6 +29,7 @@
 #include &lt;linux/string.h&gt;
 #include &lt;linux/ioport.h&gt;
 #include &lt;linux/bootmem.h&gt;
+#include &lt;linux/notifier.h&gt;
 
 #ifdef CONFIG_RTC
 #include &lt;linux/timex.h&gt;
@@ -96,7 +97,14 @@
 	orig_video_points: 16
 };
 
+extern void alpha_power_off(void);
 
+static struct notifier_block alpha_poweroff_block = {
+  alpha_power_off,
+  NULL,
+  0
+};
+
 /*
  * Declare all of the machine vectors.
  */
@@ -505,6 +513,8 @@
 #ifdef __SMP__
 	setup_smp();
 #endif
+
+	register_poweroff_handler(Î±_poweroff_block);
 }
 
 static char sys_unknown[] = "Unknown";
Index: arch/arm/kernel/process.c
===================================================================
RCS file: /cvs/linux/arch/arm/kernel/process.c,v
retrieving revision 1.2.2.6
diff -u -r1.2.2.6 process.c
--- arch/arm/kernel/process.c	1999/12/17 17:22:29	1.2.2.6
+++ arch/arm/kernel/process.c	2000/01/10 15:37:56
@@ -112,10 +112,6 @@
 {
 }
 
-void machine_power_off(void)
-{
-}
-
 void show_regs(struct pt_regs * regs)
 {
 	unsigned long flags;
Index: arch/i386/kernel/acpi.c
===================================================================
RCS file: /cvs/linux/arch/i386/kernel/Attic/acpi.c,v
retrieving revision 1.1.2.3
diff -u -r1.1.2.3 acpi.c
--- arch/i386/kernel/acpi.c	2000/01/09 16:38:12	1.1.2.3
+++ arch/i386/kernel/acpi.c	2000/01/10 15:37:56
@@ -40,6 +40,7 @@
 #include &lt;linux/sysctl.h&gt;
 #include &lt;linux/delay.h&gt;
 #include &lt;linux/acpi.h&gt;
+#include &lt;linux/notifier.h&gt;
 
 /*
  * Defines for 2.2.x
@@ -886,6 +887,13 @@
 	acpi_enter_sx(ACPI_S5);
 }
 
+static struct notifier_block acpi_power_off_handler_block =
+{
+	acpi_power_off_handler,
+	NULL,
+	0
+};
+
 /*
  * Claim ACPI I/O ports
  */
@@ -1211,9 +1219,8 @@
 	pid = kernel_thread(acpi_control_thread,
 			    NULL,
 			    CLONE_FS | CLONE_FILES | CLONE_SIGHAND);
-
-	acpi_power_off = acpi_power_off_handler;
 
+	register_poweroff_handler(&amp;acpi_power_off_handler_block);
 	acpi_active = 1;
 
 	/*
@@ -1238,7 +1245,7 @@
 static void __exit acpi_exit(void)
 {
 	acpi_idle = NULL;
-	acpi_power_off = NULL;
+	unregister_poweroff_handler(&amp;acpi_power_off_handler_block);
 
 	unregister_sysctl_table(acpi_sysctl);
 	acpi_disable(acpi_facp);
Index: arch/i386/kernel/apm.c
===================================================================
RCS file: /cvs/linux/arch/i386/kernel/apm.c,v
retrieving revision 1.1.1.5.2.14
diff -u -r1.1.1.5.2.14 apm.c
--- arch/i386/kernel/apm.c	2000/01/09 16:28:52	1.1.1.5.2.14
+++ arch/i386/kernel/apm.c	2000/01/10 15:37:56
@@ -145,6 +145,7 @@
 #include &lt;linux/apm_bios.h&gt;
 #include &lt;linux/init.h&gt;
 #include &lt;linux/sched.h&gt;
+#include &lt;linux/notifier.h&gt;
 
 #include &lt;asm/system.h&gt;
 #include &lt;asm/uaccess.h&gt;
@@ -161,9 +162,6 @@
 extern unsigned long get_cmos_time(void);
 extern void machine_real_restart(unsigned char *, int);
 
-#ifdef CONFIG_MAGIC_SYSRQ
-extern void (*sysrq_power_off)(void);
-#endif
 #if defined(CONFIG_APM_DISPLAY_BLANK) &amp;&amp; defined(CONFIG_VT)
 extern int (*console_blank_hook)(int);
 #endif
@@ -557,7 +555,7 @@
 }
 #endif
 
-static void apm_power_off(void)
+static void apm_power_off_handler(void)
 {
 	/*
 	 * smp_hack == 2 means that we would have enabled APM support
@@ -586,6 +584,13 @@
 	}
 }
 
+static struct notifier_block apm_power_off_handler_block =
+{
+	apm_power_off_handler,
+	NULL,
+	0
+};
+
 #ifdef CONFIG_APM_DO_ENABLE
 static int __init apm_enable_power_management(void)
 {
@@ -1373,10 +1378,8 @@
 
 	/* Install our power off handler.. */
 	if (power_off_enabled)
-		acpi_power_off = apm_power_off;
-#ifdef CONFIG_MAGIC_SYSRQ
-	sysrq_power_off = apm_power_off;
-#endif
+		register_poweroff_handler(&amp;apm_power_off_handler_block);
+
 #if defined(CONFIG_APM_DISPLAY_BLANK) &amp;&amp; defined(CONFIG_VT)
 	console_blank_hook = apm_console_blank;
 #endif
@@ -1491,13 +1494,6 @@
 		APM_INIT_ERROR_RETURN;
 	}
 
-#ifdef CONFIG_ACPI
-	if (acpi_active) {
-		printk(KERN_NOTICE "apm: overridden by ACPI.\n");
-		APM_INIT_ERROR_RETURN;
-	}
-#endif
-
 	/*
 	 * Set up a segment that references the real mode segment 0x40
 	 * that extends up to the end of page zero (that we have reserved).
@@ -1544,11 +1540,24 @@
 #ifdef CONFIG_SMP
 	if (smp_num_cpus &gt; 1) {
 		printk(KERN_NOTICE "apm: disabled - APM is not SMP safe.\n");
-		if (smp_hack)
+		if (smp_hack) {
 			smp_hack = 2;
+			register_poweroff_handler(&amp;apm_power_off_handler_block);
+		}
 		APM_INIT_ERROR_RETURN;
 	}
 #endif
+#ifdef CONFIG_ACPI
+	if (acpi_active) {
+		printk(KERN_NOTICE "apm: overridden by ACPI.\n");
+
+		/* Let the poweroff handler remain - sometimes the ACPI 
+		 * one doesn't work */
+		register_poweroff_handler(&amp;apm_power_off_handler_block);
+		APM_INIT_ERROR_RETURN;
+	}
+#endif
+
 
 	create_proc_info_entry("apm", 0, 0, apm_get_info);
 
Index: arch/i386/kernel/i386_ksyms.c
===================================================================
RCS file: /cvs/linux/arch/i386/kernel/i386_ksyms.c,v
retrieving revision 1.2.2.10
diff -u -r1.2.2.10 i386_ksyms.c
--- arch/i386/kernel/i386_ksyms.c	2000/01/09 16:28:52	1.2.2.10
+++ arch/i386/kernel/i386_ksyms.c	2000/01/10 15:37:56
@@ -50,7 +50,6 @@
 EXPORT_SYMBOL(disable_irq_nosync);
 EXPORT_SYMBOL(kernel_thread);
 EXPORT_SYMBOL(acpi_idle);
-EXPORT_SYMBOL(acpi_power_off);
 
 EXPORT_SYMBOL_NOVERS(__down_failed);
 EXPORT_SYMBOL_NOVERS(__down_failed_interruptible);
Index: arch/i386/kernel/process.c
===================================================================
RCS file: /cvs/linux/arch/i386/kernel/process.c,v
retrieving revision 1.2.2.10
diff -u -r1.2.2.10 process.c
--- arch/i386/kernel/process.c	2000/01/05 17:07:37	1.2.2.10
+++ arch/i386/kernel/process.c	2000/01/10 15:37:56
@@ -64,11 +64,6 @@
 void (*acpi_idle)(void) = NULL;
 
 /*
- * Power off function, if any
- */
-void (*acpi_power_off)(void) = NULL;
-
-/*
  * We use this if we don't have any better
  * idle routine..
  */
@@ -325,13 +320,6 @@
 void machine_halt(void)
 {
 }
-
-void machine_power_off(void)
-{
-	if (acpi_power_off)
-		acpi_power_off();
-}
-
 
 void show_regs(struct pt_regs * regs)
 {
Index: arch/m68k/kernel/process.c
===================================================================
RCS file: /cvs/linux/arch/m68k/kernel/process.c,v
retrieving revision 1.3.2.4
diff -u -r1.3.2.4 process.c
--- arch/m68k/kernel/process.c	1999/11/12 15:30:37	1.3.2.4
+++ arch/m68k/kernel/process.c	2000/01/10 15:37:57
@@ -100,13 +100,6 @@
 	for (;;);
 }
 
-void machine_power_off(void)
-{
-	if (mach_power_off)
-		mach_power_off();
-	for (;;);
-}
-
 void show_regs(struct pt_regs * regs)
 {
 	printk("\n");
Index: arch/m68k/kernel/setup.c
===================================================================
RCS file: /cvs/linux/arch/m68k/kernel/setup.c,v
retrieving revision 1.2.2.3
diff -u -r1.2.2.3 setup.c
--- arch/m68k/kernel/setup.c	1999/10/07 15:59:13	1.2.2.3
+++ arch/m68k/kernel/setup.c	2000/01/10 15:37:57
@@ -78,7 +78,6 @@
 int (*mach_set_clock_mmss) (unsigned long) = NULL;
 void (*mach_reset)( void );
 void (*mach_halt)( void ) = NULL;
-void (*mach_power_off)( void ) = NULL;
 long mach_max_dma_address = 0x00ffffff; /* default set to the lower
16MB */
 #if defined(CONFIG_AMIGA_FLOPPY) || defined(CONFIG_ATARI_FLOPPY) ||
defined(CONFIG_BLK_DEV_FD)
 void (*mach_floppy_setup) (char *, int *) __initdata = NULL;
Index: arch/m68k/mac/config.c
===================================================================
RCS file: /cvs/linux/arch/m68k/mac/config.c,v
retrieving revision 1.1.1.9.2.2
diff -u -r1.1.1.9.2.2 config.c
--- arch/m68k/mac/config.c	1999/10/07 15:59:13	1.1.1.9.2.2
+++ arch/m68k/mac/config.c	2000/01/10 15:37:57
@@ -17,6 +17,7 @@
 #include &lt;linux/tty.h&gt;
 #include &lt;linux/console.h&gt;
 #include &lt;linux/interrupt.h&gt;
+#include &lt;linux/notifier.h&gt;
 /* keyb */
 #include &lt;linux/random.h&gt;
 #include &lt;linux/delay.h&gt;
@@ -105,6 +106,13 @@
 extern void adb_poweroff(void);
 extern void adb_hwreset(void);
 
+static struct notifier_block mac_poweroff_block = {
+	mac_poweroff,
+	NULL,
+	0
+};
+
+
 /* pram functions */
 extern __u32 via_read_time(void);
 extern void via_write_time(__u32);
@@ -423,7 +431,7 @@
 #endif
     mach_reset           = mac_reset;
     mach_halt            = mac_poweroff;
-    mach_power_off       = mac_poweroff;
+    register_poweroff_handler(&amp;mac_poweroff_block);
     conswitchp	         = &amp;dummy_con;
     mach_max_dma_address = 0xffffffff;
 #if 0
Index: arch/mips/baget/setup.c
===================================================================
RCS file: /cvs/linux/arch/mips/baget/setup.c,v
retrieving revision 1.3.2.2
diff -u -r1.3.2.2 setup.c
--- arch/mips/baget/setup.c	1999/10/07 15:43:09	1.3.2.2
+++ arch/mips/baget/setup.c	2000/01/10 15:37:58
@@ -474,7 +474,13 @@
 extern void baget_machine_restart(char *command);
 extern void baget_machine_halt(void);
 extern void baget_machine_power_off(void);
- 
+
+static struct notifier_struct baget_poweroff_block = {
+  baget_machine_power_off,
+  NULL,
+  0
+};
+
 void __init baget_setup(void)
 {
 	printk("BT23/63-201n found.\n");
@@ -485,7 +491,7 @@
 
         _machine_restart   = baget_machine_restart;
         _machine_halt      = baget_machine_halt;
-        _machine_power_off = baget_machine_power_off;
+        register_poweroff_handler(&amp;baget_poweroff_block);
 
 	vac_init();
 	vic_init();
Index: arch/mips/dec/setup.c
===================================================================
RCS file: /cvs/linux/arch/mips/dec/setup.c,v
retrieving revision 1.3.2.2
diff -u -r1.3.2.2 setup.c
--- arch/mips/dec/setup.c	1999/10/07 15:43:09	1.3.2.2
+++ arch/mips/dec/setup.c	2000/01/10 15:37:58
@@ -14,6 +14,7 @@
 #include &lt;asm/mipsregs.h&gt;
 #include &lt;asm/bootinfo.h&gt;
 #include &lt;linux/init.h&gt;
+#include &lt;linux/notifier.h&gt;
 #include &lt;asm/irq.h&gt;
 #include &lt;asm/reboot.h&gt;
 
@@ -50,6 +51,12 @@
 extern void dec_machine_halt(void);
 extern void dec_machine_power_off(void);
 
+static struct notifier_struct dec_poweroff_block = {
+  dec_machine_power_off,
+  NULL,
+  0
+};
+
 extern void wbflush_setup(void);
 
 extern struct rtc_ops dec_rtc_ops;
@@ -121,7 +128,7 @@
 
     _machine_restart = dec_machine_restart;
     _machine_halt = dec_machine_halt;
-    _machine_power_off = dec_machine_power_off;
+    register_poweroff_handler(&amp;dec_poweroff_block);
 
     rtc_ops = &amp;dec_rtc_ops;
 }
Index: arch/mips/jazz/setup.c
===================================================================
RCS file: /cvs/linux/arch/mips/jazz/setup.c,v
retrieving revision 1.1.1.3.2.2
diff -u -r1.1.1.3.2.2 setup.c
--- arch/mips/jazz/setup.c	1999/10/07 15:43:09	1.1.1.3.2.2
+++ arch/mips/jazz/setup.c	2000/01/10 15:37:58
@@ -17,6 +17,7 @@
 #include &lt;linux/mm.h&gt;
 #include &lt;linux/console.h&gt;
 #include &lt;linux/fb.h&gt;
+#include &lt;linux/notifier.h&gt;
 #include &lt;linux/mc146818rtc.h&gt;
 #include &lt;asm/bootinfo.h&gt;
 #include &lt;asm/keyboard.h&gt;
@@ -44,6 +45,12 @@
 extern void jazz_machine_halt(void);
 extern void jazz_machine_power_off(void);
 
+static struct notifier_struct jazz_poweroff_block = {
+  jazz_machine_power_off,
+  NULL,
+  0
+};
+
 extern struct ide_ops std_ide_ops;
 extern struct rtc_ops jazz_rtc_ops;
 extern struct kbd_ops jazz_kbd_ops;
@@ -97,7 +104,7 @@
 
 	_machine_restart = jazz_machine_restart;
 	_machine_halt = jazz_machine_halt;
-	_machine_power_off = jazz_machine_power_off;
+	register_poweroff_handler(&amp;jazz_poweroff_block);
 
 #ifdef CONFIG_BLK_DEV_IDE
 	ide_ops = &amp;std_ide_ops;
Index: arch/mips/kernel/reset.c
===================================================================
RCS file: /cvs/linux/arch/mips/kernel/reset.c,v
retrieving revision 1.1.1.1
diff -u -r1.1.1.1 reset.c
--- arch/mips/kernel/reset.c	1998/10/28 21:24:22	1.1.1.1
+++ arch/mips/kernel/reset.c	2000/01/10 15:37:58
@@ -23,8 +23,3 @@
 {
 	_machine_halt();
 }
-
-void machine_power_off(void)
-{
-	_machine_power_off();
-}
Index: arch/mips/sni/setup.c
===================================================================
RCS file: /cvs/linux/arch/mips/sni/setup.c,v
retrieving revision 1.1.1.3.2.3
diff -u -r1.1.1.3.2.3 setup.c
--- arch/mips/sni/setup.c	1999/10/11 12:13:09	1.1.1.3.2.3
+++ arch/mips/sni/setup.c	2000/01/10 15:37:58
@@ -21,6 +21,7 @@
 #include &lt;linux/console.h&gt;
 #include &lt;linux/fb.h&gt;
 #include &lt;linux/pc_keyb.h&gt;
+#include &lt;linux/notifier.h&gt;
 
 #include &lt;asm/bcache.h&gt;
 #include &lt;asm/bootinfo.h&gt;
@@ -48,6 +49,12 @@
 extern void sni_machine_halt(void);
 extern void sni_machine_power_off(void);
 
+static struct notifier_struct sni_poweroff_block = {
+  sni_machine_power_off,
+  NULL,
+  0
+};
+
 extern struct ide_ops std_ide_ops;
 extern struct rtc_ops std_rtc_ops;
 extern struct kbd_ops std_kbd_ops;
@@ -154,7 +161,7 @@
 
 	_machine_restart = sni_machine_restart;
 	_machine_halt = sni_machine_halt;
-	_machine_power_off = sni_machine_power_off;
+	register_poweroff_handler(&amp;sni_poweroff_block);
 
 	aux_device_present = 0xaa;
 
Index: arch/ppc/kernel/apus_setup.c
===================================================================
RCS file: /cvs/linux/arch/ppc/kernel/apus_setup.c,v
retrieving revision 1.2.2.6
diff -u -r1.2.2.6 apus_setup.c
--- arch/ppc/kernel/apus_setup.c	1999/11/09 09:52:44	1.2.2.6
+++ arch/ppc/kernel/apus_setup.c	2000/01/10 15:37:59
@@ -640,12 +640,6 @@
 }
 
 void
-apus_power_off(void)
-{
-	for (;;);
-}
-
-void
 apus_halt(void)
 {
    apus_restart(NULL);
@@ -962,7 +956,6 @@
 	ppc_md.init           = NULL;
 
 	ppc_md.restart        = apus_restart;
-	ppc_md.power_off      = apus_power_off;
 	ppc_md.halt           = apus_halt;
 
 	ppc_md.time_init      = NULL;
Index: arch/ppc/kernel/chrp_setup.c
===================================================================
RCS file: /cvs/linux/arch/ppc/kernel/chrp_setup.c,v
retrieving revision 1.2.2.11
diff -u -r1.2.2.11 chrp_setup.c
--- arch/ppc/kernel/chrp_setup.c	2000/01/05 17:25:10	1.2.2.11
+++ arch/ppc/kernel/chrp_setup.c	2000/01/10 15:37:59
@@ -36,6 +36,7 @@
 #include &lt;linux/module.h&gt;
 #include &lt;linux/delay.h&gt;
 #include &lt;linux/ide.h&gt;
+#include &lt;linux/notifier.h&gt;
 
 #include &lt;asm/mmu.h&gt;
 #include &lt;asm/processor.h&gt;
@@ -332,9 +333,14 @@
 	/* allow power on only with power button press */
 	printk("RTAS power-off returned %d\n",
 	       call_rtas("power-off", 2, 1, NULL,0xffffffff,0xffffffff));
-	for (;;);
 }
 
+static struct notifier_block chrp_poweroff_block = {
+  chrp_power_off,
+  NULL,
+  0
+};
+
 void
 chrp_halt(void)
 {
@@ -566,7 +572,7 @@
 	ppc_md.init           = chrp_init2;
 
 	ppc_md.restart        = chrp_restart;
-	ppc_md.power_off      = chrp_power_off;
+	register_poweroff_handler(&amp;chrp_poweroff_block);
 	ppc_md.halt           = chrp_halt;
 
 	ppc_md.time_init      = chrp_time_init;
Index: arch/ppc/kernel/gemini_setup.c
===================================================================
RCS file: /cvs/linux/arch/ppc/kernel/gemini_setup.c,v
retrieving revision 1.1.2.9
diff -u -r1.1.2.9 gemini_setup.c
--- arch/ppc/kernel/gemini_setup.c	2000/01/05 17:25:10	1.1.2.9
+++ arch/ppc/kernel/gemini_setup.c	2000/01/10 15:37:59
@@ -314,12 +314,6 @@
 }
 
 void
-gemini_power_off(void)
-{
-	for(;;);
-}
-
-void
 gemini_halt(void)
 {
 	gemini_restart(NULL);
@@ -550,7 +544,6 @@
 	ppc_md.init = NULL;
 
 	ppc_md.restart = gemini_restart;
-	ppc_md.power_off = gemini_power_off;
 	ppc_md.halt = gemini_halt;
 
 	ppc_md.time_init = gemini_time_init;
Index: arch/ppc/kernel/m8xx_setup.c
===================================================================
RCS file: /cvs/linux/arch/ppc/kernel/Attic/m8xx_setup.c,v
retrieving revision 1.1.2.3
diff -u -r1.1.2.3 m8xx_setup.c
--- arch/ppc/kernel/m8xx_setup.c	2000/01/05 17:25:10	1.1.2.3
+++ arch/ppc/kernel/m8xx_setup.c	2000/01/10 15:37:59
@@ -34,6 +34,7 @@
 #include &lt;linux/ioport.h&gt;
 #include &lt;linux/ide.h&gt;
 #include &lt;linux/bootmem.h&gt;
+#include &lt;linux/notifier.h&gt;
 
 #include &lt;asm/mmu.h&gt;
 #include &lt;asm/processor.h&gt;
@@ -237,17 +238,16 @@
 }
 
 void
-m8xx_power_off(void)
-{
-   m8xx_restart(NULL);
-}
-
-void
 m8xx_halt(void)
 {
    m8xx_restart(NULL);
 }
 
+static struct notifier_block m8xx_poweroff_block = {
+  m8xx_halt,
+  NULL,
+  0
+};
 
 int m8xx_setup_residual(char *buffer)
 {
@@ -477,7 +477,7 @@
 	ppc_md.init           = NULL;
 
 	ppc_md.restart        = m8xx_restart;
-	ppc_md.power_off      = m8xx_power_off;
+	register_poweroff_handler(&amp;m8xx_poweroff_block);
 	ppc_md.halt           = m8xx_halt;
 
 	ppc_md.time_init      = NULL;
Index: arch/ppc/kernel/oak_setup.c
===================================================================
RCS file: /cvs/linux/arch/ppc/kernel/Attic/oak_setup.c,v
retrieving revision 1.1.2.1
diff -u -r1.1.2.1 oak_setup.c
--- arch/ppc/kernel/oak_setup.c	1999/12/17 17:22:30	1.1.2.1
+++ arch/ppc/kernel/oak_setup.c	2000/01/10 15:37:59
@@ -55,7 +55,6 @@
 	ppc_md.init		 = NULL;
 
 	ppc_md.restart		 = NULL;
-	ppc_md.power_off	 = NULL;
 	ppc_md.halt		 = NULL;
 
 	ppc_md.time_init	 = NULL;
Index: arch/ppc/kernel/pmac_setup.c
===================================================================
RCS file: /cvs/linux/arch/ppc/kernel/pmac_setup.c,v
retrieving revision 1.2.2.11
diff -u -r1.2.2.11 pmac_setup.c
--- arch/ppc/kernel/pmac_setup.c	2000/01/09 16:38:13	1.2.2.11
+++ arch/ppc/kernel/pmac_setup.c	2000/01/10 15:37:59
@@ -46,6 +46,7 @@
 #include &lt;linux/adb.h&gt;
 #include &lt;linux/cuda.h&gt;
 #include &lt;linux/pmu.h&gt;
+#include &lt;linux/notifier.h&gt;
 
 #include &lt;asm/init.h&gt;
 #include &lt;asm/prom.h&gt;
@@ -521,6 +522,12 @@
 	}
 }
 
+static struct notifier_block pmac_poweroff_block = {
+  pmac_power_off,
+  NULL,
+  0
+};
+
 void
 pmac_halt(void)
 {
@@ -627,7 +634,7 @@
 	ppc_md.init           = pmac_init2;
 
 	ppc_md.restart        = pmac_restart;
-	ppc_md.power_off      = pmac_power_off;
+	register_poweroff_handler(&amp;pmac_poweroff_block);
 	ppc_md.halt           = pmac_halt;
 
 	ppc_md.time_init      = NULL;
Index: arch/ppc/kernel/prep_setup.c
===================================================================
RCS file: /cvs/linux/arch/ppc/kernel/prep_setup.c,v
retrieving revision 1.2.2.10
diff -u -r1.2.2.10 prep_setup.c
--- arch/ppc/kernel/prep_setup.c	2000/01/05 17:25:10	1.2.2.10
+++ arch/ppc/kernel/prep_setup.c	2000/01/10 15:37:59
@@ -34,6 +34,7 @@
 #include &lt;linux/pci.h&gt;
 #include &lt;linux/openpic.h&gt;
 #include &lt;linux/ide.h&gt;
+#include &lt;linux/notifier.h&gt;
 
 #include &lt;asm/init.h&gt;
 #include &lt;asm/mmu.h&gt;
@@ -555,6 +556,12 @@
 	prep_halt();
 }
 
+static struct notifier_block prep_poweroff_block = {
+  prep_power_off,
+  NULL,
+  0
+};
+
 int __prep
 prep_setup_residual(char *buffer)
 {
@@ -770,7 +777,7 @@
 	ppc_md.init           = NULL;
 
 	ppc_md.restart        = prep_restart;
-	ppc_md.power_off      = prep_power_off;
+	register_poweroff_handler(&amp;prep_poweroff_block);
 	ppc_md.halt           = prep_halt;
 
 	ppc_md.time_init      = NULL;
Index: arch/ppc/kernel/setup.c
===================================================================
RCS file: /cvs/linux/arch/ppc/kernel/setup.c,v
retrieving revision 1.2.2.13
diff -u -r1.2.2.13 setup.c
--- arch/ppc/kernel/setup.c	1999/12/17 17:22:30	1.2.2.13
+++ arch/ppc/kernel/setup.c	2000/01/10 15:37:59
@@ -149,11 +149,6 @@
 	ppc_md.restart(cmd);
 }
   
-void machine_power_off(void)
-{
-	ppc_md.power_off();
-}
-  
 void machine_halt(void)
 {
 	ppc_md.halt();
Index: arch/sh/kernel/process.c
===================================================================
RCS file: /cvs/linux/arch/sh/kernel/Attic/process.c,v
retrieving revision 1.1.2.4
diff -u -r1.1.2.4 process.c
--- arch/sh/kernel/process.c	1999/11/09 09:52:45	1.1.2.4
+++ arch/sh/kernel/process.c	2000/01/10 15:38:00
@@ -90,10 +90,6 @@
 {
 }
 
-void machine_power_off(void)
-{
-}
-
 void show_regs(struct pt_regs * regs)
 {
 	printk("\n");
Index: arch/sparc/kernel/process.c
===================================================================
RCS file: /cvs/linux/arch/sparc/kernel/process.c,v
retrieving revision 1.3.2.5
diff -u -r1.3.2.5 process.c
--- arch/sparc/kernel/process.c	2000/01/05 17:36:13	1.3.2.5
+++ arch/sparc/kernel/process.c	2000/01/10 15:38:00
@@ -166,7 +166,7 @@
 	panic("Reboot failed!");
 }
 
-void machine_power_off(void)
+void sparc_power_off(void)
 {
 #ifdef CONFIG_SUN_AUXIO
 	if (auxio_power_register)
Index: arch/sparc/kernel/setup.c
===================================================================
RCS file: /cvs/linux/arch/sparc/kernel/setup.c,v
retrieving revision 1.2.2.5
diff -u -r1.2.2.5 setup.c
--- arch/sparc/kernel/setup.c	2000/01/05 17:25:10	1.2.2.5
+++ arch/sparc/kernel/setup.c	2000/01/10 15:38:00
@@ -27,6 +27,7 @@
 #include &lt;linux/interrupt.h&gt;
 #include &lt;linux/console.h&gt;
 #include &lt;linux/spinlock.h&gt;
+#include &lt;linux/notifier.h&gt;
 
 #include &lt;asm/segment.h&gt;
 #include &lt;asm/system.h&gt;
@@ -57,6 +58,14 @@
 	16                      /* orig-video-points */
 };
 
+extern void sparc_power_off(void);
+
+static struct notifier_block sparc_poweroff_block = {
+  sparc_power_off,
+  NULL,
+  0
+};
+
 unsigned int phys_bytes_of_ram, end_of_phys_memory;
 
 /* Typing sync at the prom prompt calls the function pointed to by
@@ -491,6 +500,8 @@
 
 	if (serial_console)
 		conswitchp = NULL;
+
+	register_poweroff_handler(&amp;sparc_poweroff_block);
 }
 
 asmlinkage int sys_ioperm(unsigned long from, unsigned long num, int
on)
Index: arch/sparc64/kernel/power.c
===================================================================
RCS file: /cvs/linux/arch/sparc64/kernel/power.c,v
retrieving revision 1.1.2.3
diff -u -r1.1.2.3 power.c
--- arch/sparc64/kernel/power.c	2000/01/05 17:25:11	1.1.2.3
+++ arch/sparc64/kernel/power.c	2000/01/10 15:38:00
@@ -35,7 +35,7 @@
 
 extern void machine_halt(void);
 
-void machine_power_off(void)
+void sparc64_power_off(void)
 {
 #ifdef CONFIG_PCI
 	if (power_reg != 0UL) {
Index: arch/sparc64/kernel/setup.c
===================================================================
RCS file: /cvs/linux/arch/sparc64/kernel/setup.c,v
retrieving revision 1.2.2.4
diff -u -r1.2.2.4 setup.c
--- arch/sparc64/kernel/setup.c	2000/01/05 17:25:11	1.2.2.4
+++ arch/sparc64/kernel/setup.c	2000/01/10 15:38:01
@@ -27,6 +27,7 @@
 #include &lt;linux/init.h&gt;
 #include &lt;linux/inet.h&gt;
 #include &lt;linux/console.h&gt;
+#include &lt;linux/notifier.h&gt;
 
 #include &lt;asm/segment.h&gt;
 #include &lt;asm/system.h&gt;
@@ -56,6 +57,14 @@
 	16                      /* orig-video-points */
 };
 
+extern void sparc64_power_off(void);
+
+static struct notifier_block sparc64_poweroff_block = {
+  sparc64_power_off,
+  NULL,
+  0
+};
+
 /* Typing sync at the prom prompt calls the function pointed to by
  * the sync callback which I set to the following function.
  * This should sync all filesystems and return, for now it just
@@ -587,6 +596,8 @@
 #endif
 	if (serial_console)
 		conswitchp = NULL;
+
+	register_poweroff_handler(&amp;sparc64_poweroff_block);
 }
 
 asmlinkage int sys_ioperm(unsigned long from, unsigned long num, int
on)
Index: drivers/char/sysrq.c
===================================================================
RCS file: /cvs/linux/drivers/char/sysrq.c,v
retrieving revision 1.1.1.6.2.2
diff -u -r1.1.1.6.2.2 sysrq.c
--- drivers/char/sysrq.c	1999/11/09 09:52:47	1.1.1.6.2.2
+++ drivers/char/sysrq.c	2000/01/10 15:38:01
@@ -29,9 +29,6 @@
 extern int console_loglevel;
 extern struct vfsmount *vfsmntlist;
 
-/* Machine specific power off function */
-void (*sysrq_power_off)(void) = NULL;
-
 /* Send a signal to all user processes */
 
 static void send_sig_all(int sig, int even_init)
@@ -88,10 +85,8 @@
 		machine_restart(NULL);
 		break;
 	case 'o':					    /* O -- power off */
-		if (sysrq_power_off) {
-			printk("Power off\n");
-			sysrq_power_off();
-		}
+		printk("Power off\n");
+		machine_power_off();
 		break;
 	case 's':					    /* S -- emergency sync */
 		printk("Emergency Sync\n");
Index: include/linux/acpi.h
===================================================================
RCS file: /cvs/linux/include/linux/Attic/acpi.h,v
retrieving revision 1.1.2.11
diff -u -r1.1.2.11 acpi.h
--- include/linux/acpi.h	2000/01/09 16:28:56	1.1.2.11
+++ include/linux/acpi.h	2000/01/10 15:38:09
@@ -191,7 +191,6 @@
 #endif /* CONFIG_ACPI */
 
 extern void (*acpi_idle)(void);
-extern void (*acpi_power_off)(void);
 
 #endif /* __KERNEL__ */
 
Index: include/linux/reboot.h
===================================================================
RCS file: /cvs/linux/include/linux/reboot.h,v
retrieving revision 1.1.1.1
diff -u -r1.1.1.1 reboot.h
--- include/linux/reboot.h	1998/10/28 21:23:47	1.1.1.1
+++ include/linux/reboot.h	2000/01/10 15:38:10
@@ -37,6 +37,9 @@
 extern struct notifier_block *reboot_notifier_list;
 extern int register_reboot_notifier(struct notifier_block *);
 extern int unregister_reboot_notifier(struct notifier_block *);
+extern struct notifier_block *poweroff_handler_list;
+extern int register_poweroff_handler(struct notifier_block *);
+extern int unregister_poweroff_handler(struct notifier_block *);
 
 
 /*
Index: kernel/sys.c
===================================================================
RCS file: /cvs/linux/kernel/sys.c,v
retrieving revision 1.1.1.6.2.6
diff -u -r1.1.1.6.2.6 sys.c
--- kernel/sys.c	1999/11/09 09:12:14	1.1.1.6.2.6
+++ kernel/sys.c	2000/01/10 15:38:14
@@ -30,6 +30,7 @@
  */
 
 struct notifier_block *reboot_notifier_list = NULL;
+struct notifier_block *poweroff_handler_list = NULL;
 
 int register_reboot_notifier(struct notifier_block * nb)
 {
@@ -41,6 +42,16 @@
 	return notifier_chain_unregister(&amp;reboot_notifier_list, nb);
 }
 
+int register_poweroff_handler(struct notifier_block * nb)
+{
+	return notifier_chain_register(&amp;poweroff_handler_list, nb);
+}
+
+int unregister_poweroff_handler(struct notifier_block * nb)
+{
+	return notifier_chain_unregister(&amp;poweroff_handler_list, nb);
+}
+
 asmlinkage long sys_ni_syscall(void)
 {
 	return -ENOSYS;
@@ -228,7 +239,11 @@
 	} else
 		kill_proc(1, SIGINT, 1);
 }
-	
+
+void machine_power_off(void)
+{
+	notifier_call_chain(&amp;poweroff_handler_list, 0, NULL);
+}	
 
 /*
  * Unprivileged users may change the real gid to the effective gid

</body></email><email><emailId>20000204045749</emailId><senderName>Francois Menard List Account</senderName><senderEmail>fm-listproc@fmmo.ca</senderEmail><timestampReceived>2000-02-04 04:57:49-0400</timestampReceived><subject>[Acpi] ACPI woes</subject><body>


How can I do same than apm -s with ACPI ?

How do I make ACPI free the IRQ that it wants to use ?

-=Francois=-

</body></email><email><emailId>20000301094130</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-03-01 09:41:30-0400</timestampReceived><subject>[Acpi] Re: APM_power_off</subject><body>

--- Daniel.Egger@suse.de wrote:

&gt;  BUT: Is there a way to test the correctness other
&gt; than that strange win tool everyone in the world is
&gt; reffering too?

Nope, not other than trying it and sending me
a bug report if your system has a broken ACPI
implementation.  There are obviously still plenty
of broken implementations post 1/1/1999

&gt;  And: How can I use ACPI in real life at the moment?
&gt; It seems to like like it's just a playground for
&gt; developers but on the other side if it's enabled in
&gt; the kernel APM automatically gets overridden, so
&gt; laptop users would be rather silly to activate ACPI
&gt; at the moment because the system will empty the
&gt; battery really fast.

Actually, if you are running acpid, you'll get
a fair amount of power savings from ACPI C-states
(low power when the system is idle, like an
improved "hlt")  So, no, you definitely will not
be draining the battery any faster than if you
were using APM.

The issue with ACPI support right now is that
you don't get battery status or suspend
capability.  The former is fairly easy to do
and is coming along soon in acpid.  The later
requires signficant changes to drivers and
probably the kernel and is going to take a bit.

-Andy

__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000607203441</emailId><senderName></senderName><senderEmail>root</senderEmail><timestampReceived>2000-06-07 20:34:41-0400</timestampReceived><subject>[Acpi] ACPI and linux-2.4.0-test1-ac6</subject><body>

I've successfully compiled the acpid (both release and CVS).
&gt;From what my kernel tells, my board is acpi-capable:
&lt;6&gt;ACPI: found VIA Technologies, Inc. VT82C586B ACPI at 0x4000

But when trying to start the acpid I just get:
---------------------------------------------------
Jun  7 22:15:43 shea acpid: started
Jun  7 22:15:43 shea acpid: ACPI Subsystem version [Jun  7 2000]
Jun  7 22:15:43 shea acpid: FACP loaded from /proc/sys/acpi/
Jun  7 22:15:43 shea acpid:  tbutils-0240:
Jun  7 22:15:43 shea acpid: *** Error: Invalid ACPI table checksum
Jun  7 22:15:43 shea acpid: nsapinam-0058:
Jun  7 22:15:43 shea acpid: DSDT is not in memory
Jun  7 22:15:43 shea acpid: OsdBreakpoint: Fatal error encountered
Jun  7 22:15:43 shea acpid: cannot load ACPI namespace
---------------------------------------------------

acpid -d doesn't give any more info :(

Has somebody success with this kernel?
Or have I to wait for a newer demon?


Rene Mueller

</body></email><email><emailId>20000711184552</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-07-11 18:45:52-0400</timestampReceived><subject>[Acpi] ACPI changes</subject><body>

As many of you have already noticed, a lot of ACPI
code (the entire interpreter) has been included in
the latest development kernel (2.4.0-test3) as
experimental.

I have been scrambling for a bit to put together
this patch for Linus but didn't reasonably expect
him to accept it on the first go.  Well, he did
and it's there now.

This means there will be fairly big changes on
the way for acpid.  Namely, 95% of the code will
go away and acpid will basically just be handling
ACPI events (ie. power/sleep button) for now.
Also, the interface to the ACPI driver in
/proc/sys/acpi/ has changed a bit.

So, for now, if you use the latest development
kernel and turn on the ACPI interpreter, don't use
acpid (until I update it).  I apologize for the
temporary pain, but this change may mean that
many systems that have been having problems with
power-off and sleep may begin to work soon.

Longer-term, the interpreter in the kernel will allow
us to do a lot of things that couldn't be done
with the user-space interpreter such as deeper
sleep (eg. suspend-to-disk) and system initialization
and configuration (eg. boot IA-64 systems without
the current boot loader hack)  There will also not
be nearly as much reliance on acpid moving forward,
which is good in that it cleans up a lot of the
interface ugliness that is there now.  Thermal and
battery, for example, will be able to be handled
entirely from within the kernel.

I will get that updated acpid out soon.  As always,
keep playing with the code and forward bug reports
to me and to the mailing list.

Thanks,
Andy


__________________________________________________
Do You Yahoo!?
Get Yahoo! Mail =96 Free email you can access from anywhere!
http://mail.yahoo.com/

</body></email><email><emailId>20000301095806</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-03-01 09:58:06-0400</timestampReceived><subject>[Acpi] Re: APM_power_off</subject><body>

--- Jeff Garzik &lt;jgarzik@mandrakesoft.com&gt; wrote:
&gt;
&gt;&gt;         Kernel says on bootup: ACPI: found PIIX4 at
0x4000
&gt; &gt; 
&gt; &gt;         acpid: started
&gt; &gt;         acpid: FACP @ 0x012d3400
&gt; &gt;         acpid: DSDT @ 0x00000000
&gt; &gt;         acpid: cannot map FACP
&gt; 
&gt; Ok you have basic ACPI system support but since ACPI
&gt; is disabled there isn't much other knowledge about
&gt; your system that can be gleaned.
&gt; 
&gt; This just makes me itch to write a "native" power
&gt; management driver for PIIX4, and do things
&gt; properly. :/

Actually, you can't really do much direct to
the chipset.  C-states and events, that's about
it.  No S-states (suspend), no device specific
stuff, no battery, no thermal, etc.  If you
recall, Linus started out doing a PIIX4-specific
driver some time ago and that code ended up being
merged into the current ACPI driver.

-Andy

__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000301100112</emailId><senderName></senderName><senderEmail>daniel.egger</senderEmail><timestampReceived>2000-03-01 10:01:12-0400</timestampReceived><subject>[Acpi] Re: APM_power_off</subject><body>

On  1 Mar, Andy Henroid wrote:

&gt;&gt;  BUT: Is there a way to test the correctness other
&gt;&gt; than that strange win tool everyone in the world is
&gt;&gt; reffering too?
 
&gt; Nope, not other than trying it and sending me
&gt; a bug report if your system has a broken ACPI
&gt; implementation.  There are obviously still plenty
&gt; of broken implementations post 1/1/1999

 Well, it seems to work, but I don't think this is an accurate
 test. How do I identify a broken ACPI implementation?
 
&gt; Actually, if you are running acpid, you'll get
&gt; a fair amount of power savings from ACPI C-states
&gt; (low power when the system is idle, like an
&gt; improved "hlt")  So, no, you definitely will not
&gt; be draining the battery any faster than if you
&gt; were using APM.

 An Mobile P-II even drains the battery a fair lot if
 halting the CPU. I'd like to have "suspend to ram",
 "suspend to disk", controlling the backlight of the LCD
 (if nothing or apmd is running it'll turn at least off 
 after the timeout time set in BIOS and when the notebook
 is shut. When running acpid I get nothing!), intelligent
 harddisk management and more...

&gt; The issue with ACPI support right now is that
&gt; you don't get battery status or suspend
&gt; capability.

 Yes. It's always nice not to know how much time/battery
 is left. (Of course the notebook has a special function to
 show the percentage of battery left, but it's uncomfortable
 to activate it every 10 minutes and the turn it off again to
 have the keyboard back again.)

&gt; The former is fairly easy to do
&gt; and is coming along soon in acpid.  The later
&gt; requires signficant changes to drivers and
&gt; probably the kernel and is going to take a bit.

 I'm waiting and using APM in the meantime since there's
 no way to get them both....

-- 

Servus,
       Daniel

</body></email><email><emailId>20000301192612</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-03-01 19:26:12-0400</timestampReceived><subject>[Acpi] Re: APM_power_off</subject><body>

--- Daniel.Egger@suse.de wrote:

&gt;  Well, it seems to work, but I don't think this is
&gt;  an accurate test. How do I identify a broken ACPI
&gt;  implementation?

You can verify that C-states work by running acpid
and looking for "ACPI Cx works" in the kernel log.
(Note, this is if your system has ACPI tables,
otherwise you need to fill in C-state latency
values for /proc/sys/acpi/p_lvlX_lat.  Sorry,
this should probably go in the documentation
somewhere)

A working S5 is verified by running acpid and
do "shutdown -h now".  Does you system power-off?
If not, S5 is not supported (check syslog) or
S5 is broken.  (This will not work at all unless
you have ACPI tables)

You can verify that ACPI events work by running
acpid and pressing the power button.  Does the
system start to shutdown?

I'll add a section to the ACPI documentation
("Do I have a working ACPI implementation?")
describing all of this.

-Andy

__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000801110021</emailId><senderName>"Jeong Hwan Park"</senderName><senderEmail>jhpark@brainzsquare.com</senderEmail><timestampReceived>2000-08-01 11:00:21-0400</timestampReceived><subject>[Acpi] ACPI: S5 failed</subject><body>

DQpJIGhhdmUgYSBQM0ItRiBNL0IgbWFkZSBmcm9tIEFTVVMuDQpJIGhhdmUgaW5zdGFsbGVkIFJl
ZGhhdCA2LjIgYW5kIHRoZXJlIGlzIG5vIHByb2JsZW0gdG8gcG93ZXIgb2ZmIHdoZW4gSSBzaHV0
IGRvd24gbXkgbGludXggYm94Lg0KDQpUb2RheSwgSSB1cGdyYWRlZCBrZXJuZWwgdG8gMi40LjAt
dGVzdDUgYW5kIGVuYWJsZWQgdGhlIGV4cGVyaW1lbnRhbCBBQ1BJIGludGVycHJldGVyIG9wdGlv
bi4NCkkgdHJpZWQgdG8gcHJlc3MgcG93ZXIgc3dpdGNoIHRvIHNodXRkb3duIG15IGxpbnV4IGJv
eCBhbmQgSSBzYXcgbm9ybWFsIHNodXRkb3duIHByb2NlZHVyZSAoanVzdCBsaWtlIHVubW91bnRp
bmcgZmlsZSBzeXN0ZW0gYW5kIGV0Yy4pDQpCdXQgaXQgZG9lc24ndCBwb3dlciBvZmYuIEl0IGdh
dmUgbWUgYmVsb3cgbWVzc2FnZS4NCg0KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0NClRoZSBzeXN0ZW0gaXMgaGFsdGVkDQpQb3dlciBkb3duLg0KQUNQSTogUzUgZmFpbGVk
DQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCg0KV2hhdCdzIHRoZSBw
cm9ibGVtPw0KSSBnb3QgdGhlIG1lc3NhZ2VzIGluIGJvb3Qgc2VxdWVuY2UuDQoNCi0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCkFDUEk6c3VwcG9ydCBmb3Vu
ZA0KQUNQSTpQQkxLIDEgQCAweGU0MTA6Ng0KQUNQSTpDMiBzdXBwb3J0ZWQNCkFDUEk6NyB0aHJv
dHRsaW5nIHN0YXRlcw0KQUNQSTpTMSBzdXBwb3J0ZWQNCkFDUEk6UzUgc3VwcG9ydGVkDQpBQ1BJ
IEMyIHdvcmtzDQpBQ1BJIEMzIHdvcmtzDQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLQ0KDQpXaG91bGQgeW91IHBsZWFzZSBleHBsYWluIHRoaXMgcHJv
YmxlbT8NCg0KDQoNCg0K



_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000401142331</emailId><senderName>Jon Evans</senderName><senderEmail>jon.evans@pobox.com</senderEmail><timestampReceived>2000-04-01 14:23:31-0400</timestampReceived><subject>[Acpi] 2.3.99-pre4-2 no go with Abit BP6</subject><body>

Hi,

I'm running an Abit BP6 dual Celeron 400 (not clocked) with the latest
devel BIOS, rev QQ.  ACPI doesn't work for me, excerpt from syslog:

Apr  1 09:35:56 evansoft acpid: started
Apr  1 09:35:56 evansoft acpid: FACP loaded from /proc/sys/acpi/
Apr  1 09:35:56 evansoft acpid: DSDT loaded from /proc/sys/acpi/
Apr  1 09:35:56 evansoft acpid: S0 not supported
Apr  1 09:35:56 evansoft acpid: S1 not supported
Apr  1 09:35:56 evansoft acpid: S2 not supported
Apr  1 09:35:56 evansoft acpid: S3 not supported
Apr  1 09:35:56 evansoft acpid: S4 not supported
Apr  1 09:35:56 evansoft acpid: S5 not supported
Apr  1 09:35:56 evansoft acpid: no processor block

I append pmtools debugging output.

I compiled acpid with debugging enabled, I can post the output from that
as well if it helps anyone (13.5k gzipped).

If I can do anything to fix this I'd love some pointers as to which bits
of the code to concentrate on.

BTW acpid seems to work fine on my office PC (power off key turns into a
shutdown key) but I don't know if it's possible to check things like HLT
on idle.  Is there any output I can enable that shows me that acpid is
doing more than just monitoring the power button? :-)

Thanks,

Jon.

Debug stuff follows:

I get the following output from acpidmp FACP | acpitbl :

Signature:        FACP
Length:           116
Revision:         0x01
Checksum:         0x34
OEMID:            ABIT
OEM Table ID:     AWRDACPI
OEM Revision:     0x42302e31
Creator ID:       AWRD
Creator Revision: 0x00000000
FIRMWARE_CTRL:    0x07ff0000
DSDT:             0x07ff30c0
INT_MODEL:        0x00
SCI_INT:          9
SMI_CMD:          0x000000b2
ACPI_ENABLE:      0xa1
ACPI_DISABLE:     0xa0
S4BIOS_REQ:       0xa4
PM1a_EVT_BLK:     0x00004000
PM1b_EVT_BLK:     0x00000000
PM1a_CNT_BLK:     0x00004040
PM1b_CNT_BLK:     0x00000000
PM2_CNT_BLK:      0x00000000
PM_TMR_BLK:       0x00004008
GPE0_BLK:         0x0000400c
GPE1_BLK:         0x00000000
PM1_EVT_LEN:      4
PM1_CNT_LEN:      2
PM2_CNT_LEN:      0
PM_TM_LEN:        4
GPE0_BLK_LEN:     4
GPE1_BLK_LEN:     0
GPE1_BASE:        0
P_LVL2_LAT:       90
P_LVL3_LAT:       900
FLUSH_SIZE:       0
FLUSH_STRIDE:     0
DUTY_OFFSET:      1
DUTY_WIDTH:       1
DAY_ALRM:         0x0d
MON_ALRM:         0x00
CENTURY:          0x00
Flags:            0x00000000

and I get the following output from acpidmp DSDT | acpidisasm :

00000000: Scope _PR_
00000007:   Processor CPU_
00000014:     0x00
00000015:     0x00000000
00000019:     0x00
0000001a:   Processor CPU1
00000027:     0x01
00000028:     0x00000000
0000002c:     0x00
0000002d: Name _S0_
00000033:   Package
00000035:     0x04
00000036:     0x05
00000038:     0x05
0000003a:     0x05
0000003c:     0x05
0000003e: Name _S1_
00000044:   Package
00000046:     0x04
00000047:     0x04
00000049:     0x04
0000004b:     0x04
0000004d:     0x04
0000004f: Name _S4_
00000055:   Package
00000057:     0x04
00000058:     ZeroOp
00000059:     ZeroOp
0000005a:     ZeroOp
0000005b:     ZeroOp
0000005c: Name _S5_
00000062:   Package
00000064:     0x04
00000065:     ZeroOp
00000066:     ZeroOp
00000067:     ZeroOp
00000068:     ZeroOp
00000069: OpRegion DEBG
00000070:   0x01
00000071:   0x80
00000073:   0x01
00000075: Field DEBG
0000007d:   0x01
0000007e:   NamedField DBG1
00000083: OpRegion EXTM
00000089:   0x00
0000008a:   0x000ff830
0000008f:   0x10
00000091: Field EXTM
00000098:   0x02
00000099:   NamedField ROM1
0000009e:   NamedField RMS1
000000a3:   NamedField ROM2
000000a8:   NamedField RMS2
000000ad:   NamedField ROM3
000000b2:   NamedField RMS3
000000b7:   NamedField AMEM
000000bc: OpRegion VGAM
000000c2:   0x00
000000c3:   0x000c0002
000000c8:   0x01
000000ca: Field VGAM
000000d1:   0x01
000000d2:   NamedField VGA1
000000d7: OpRegion SMIC
000000de:   0x01
000000df:   0xb2
000000e1:   0x01
000000e3: Field SMIC
000000eb:   0x01
000000ec:   NamedField SCP_
000000f1: OpRegion TRAP
000000f8:   0x01
000000f9:   0x402f
000000fc:   0x01
000000fe: Field TRAP
00000106:   0x01
00000107:   ReservedField
00000109:   NamedField TR13
0000010e: OpRegion GBLE
00000115:   0x01
00000116:   0x4021
00000119:   0x01
0000011b: Field GBLE
00000123:   0x01
00000124:   NamedField ESMI
00000129: Name CMDB
0000012e:   Buffer
00000130:     0x08
00000132: CreateByteField
00000133:   CMDB (00000129)
00000137:   0x00
00000139:   BYT0
0000013d: CreateByteField
0000013e:   CMDB (00000129)
00000142:   0x01
00000144:   BYT1
00000148: CreateByteField
00000149:   CMDB (00000129)
0000014d:   0x02
0000014f:   BYT2
00000153: CreateByteField
00000154:   CMDB (00000129)
00000158:   0x03
0000015a:   BYT3
0000015e: CreateByteField
0000015f:   CMDB (00000129)
00000163:   0x04
00000165:   BYT4
00000169: CreateByteField
0000016a:   CMDB (00000129)
0000016e:   0x05
00000170:   BYT5
00000174: CreateByteField
00000175:   CMDB (00000129)
00000179:   0x06
0000017b:   BYT6
0000017f: CreateByteField
00000180:   CMDB (00000129)
00000184:   0x07
00000186:   BYT7
0000018a: Name IDEB
0000018f:   Buffer
00000191:     0x38
00000193: CreateField
00000195:   IDEB (0000018a)
00000199:   0x00
0000019b:   0x38
0000019d:   CMD0
000001a1: CreateField
000001a3:   IDEB (0000018a)
000001a7:   0x38
000001a9:   0x38
000001ab:   CMD1
000001af: CreateField
000001b1:   IDEB (0000018a)
000001b5:   0x70
000001b7:   0x38
000001b9:   CMD2
000001bd: CreateField
000001bf:   IDEB (0000018a)
000001c3:   0xa8
000001c5:   0x38
000001c7:   CMD3
000001cb: CreateField
000001cd:   IDEB (0000018a)
000001d1:   0xe0
000001d3:   0x38
000001d5:   CMD4
000001d9: CreateField
000001db:   IDEB (0000018a)
000001df:   0x0118
000001e2:   0x38
000001e4:   CMD5
000001e8: CreateField
000001ea:   IDEB (0000018a)
000001ee:   0x0150
000001f1:   0x38
000001f3:   CMD6
000001f7: CreateField
000001f9:   IDEB (0000018a)
000001fd:   0x0188
00000200:   0x38
00000202:   CMD7
00000206: OpRegion APMP
0000020c:   0x01
0000020d:   0xb2
0000020f:   0x02
00000211: Field APMP
00000218:   0x01
00000219:   NamedField APMC
0000021e:   NamedField APMD
00000223: OpRegion ELCR
00000229:   0x01
0000022a:   0x04d0
0000022d:   0x02
0000022f: Field ELCR
00000236:   0x01
00000237:   NamedField ELC1
0000023c:   NamedField ELC2
00000241: OpRegion GPOB
00000247:   0x01
00000248:   0x4034
0000024b:   0x04
0000024d: Field GPOB
00000255:   0x01
00000256:   NamedField GP00
0000025b:   NamedField GP01
00000260:   NamedField GP02
00000265:   NamedField GP03
0000026a:   NamedField GP04
0000026f:   NamedField GP05
00000274:   NamedField GP06
00000279:   NamedField GP07
0000027e:   NamedField GP08
00000283:   NamedField GP09
00000288:   NamedField GP0A
0000028d:   NamedField GP0B
00000292:   NamedField GP0C
00000297:   NamedField GP0D
0000029c:   NamedField GP0E
000002a1:   NamedField GP0F
000002a6:   NamedField GP10
000002ab:   NamedField GP11
000002b0:   NamedField GP12
000002b5:   NamedField GP13
000002ba:   NamedField GP14
000002bf:   NamedField GP15
000002c4:   NamedField GP16
000002c9:   NamedField GP17
000002ce:   NamedField GP18
000002d3:   NamedField GP19
000002d8:   NamedField GP1A
000002dd:   NamedField GP1B
000002e2:   NamedField GP1C
000002e7:   NamedField GP1D
000002ec:   NamedField GP1E
000002f1:   NamedField GP1F
000002f6: Name OSFL
000002fb:   0x01
000002fd: Method STRC
00000304:   0x02
00000305:   If
00000307:     LNotEqual
00000309:       SizeOf
0000030a:         Arg0
0000030b:       SizeOf
0000030c:         Arg1
0000030d:     Return
0000030e:       0x00
00000310:   Add
00000311:     SizeOf
00000312:       Arg0
00000313:     0x01
00000315:     Local0
00000316:   Name BUF0
0000031b:     Buffer
0000031d:       Local0
0000031e:   Name BUF1
00000323:     Buffer
00000325:       Local0
00000326:   Store
00000327:     Arg0
00000328:     BUF0 (00000316)
0000032c:   Store
0000032d:     Arg1
0000032e:     BUF1 (0000031e)
00000332:   While
00000334:     Local0
00000335:     Decrement
00000336:       Local0
00000337:     If
00000339:       LNotEqual
0000033b:         DerefOf
0000033c:           Index
0000033d:             BUF0 (00000316)
00000341:             Local0
00000342:             &lt;NULL&gt;
00000343:         DerefOf
00000344:           Index
00000345:             BUF1 (0000031e)
00000349:             Local0
0000034a:             &lt;NULL&gt;
0000034b:       Return
0000034c:         ZeroOp
0000034d:   Return
0000034e:     OneOp
0000034f: OpRegion RTCM
00000355:   0x01
00000356:   0x70
00000358:   0x02
0000035a: Field RTCM
00000361:   0x01
00000362:   NamedField CMIN
00000367:   NamedField CMDA
0000036c: IndexField CMIN
00000373:   CMDA (00000367)
00000377:   0x01
00000378:   ReservedField
0000037b:   NamedField SHUT
00000380: OpRegion GRAM
00000387:   0x00
00000388:   0x0400
0000038b:   0x0100
0000038e: Field GRAM
00000396:   0x01
00000397:   ReservedField
0000039a:   NamedField FLG0
0000039f:   ReservedField
000003a2:   NamedField SFLG
000003a7: OpRegion INFO
000003ad:   0x00
000003ae:   0x000ff840
000003b3:   0x01
000003b5: Field INFO
000003bc:   0x01
000003bd:   NamedField KBDI
000003c2:   NamedField RTCW
000003c7:   NamedField PS2F
000003cc:   NamedField IRFL
000003d1:   NamedField DISE
000003d6:   NamedField SSHU
000003db: OpRegion BEEP
000003e1:   0x01
000003e2:   0x61
000003e4:   0x01
000003e6: Field BEEP
000003ed:   0x01
000003ee:   NamedField S1B_
000003f3: OpRegion CONT
000003f9:   0x01
000003fa:   0x40
000003fc:   0x04
000003fe: Field CONT
00000405:   0x01
00000406:   NamedField CNT0
0000040b:   NamedField CNT1
00000410:   NamedField CNT2
00000415:   NamedField CTRL
0000041a: Method SPKR
00000421:   0x01
00000422:   Store
00000423:     S1B_ (000003ee)
00000427:     Local0
00000428:   Store
00000429:     0xb6
0000042b:     CTRL (00000415)
0000042f:   Store
00000430:     0x55
00000432:     CNT2 (00000410)
00000436:   Store
00000437:     0x03
00000439:     CNT2 (00000410)
0000043d:   Store
0000043e:     Arg0
0000043f:     Local2
00000440:   While
00000442:     LGreater
00000443:       Local2
00000444:       0x00
00000446:     Or
00000447:       S1B_ (000003ee)
0000044b:       0x03
0000044d:       S1B_ (000003ee)
00000451:     Store
00000452:       0x5fff
00000455:       Local3
00000456:     While
00000458:       LGreater
00000459:         Local3
0000045a:         0x00
0000045c:       Decrement
0000045d:         Local3
0000045e:     And
0000045f:       S1B_ (000003ee)
00000463:       0xfc
00000465:       S1B_ (000003ee)
00000469:     Store
0000046a:       0x0eff
0000046d:       Local3
0000046e:     While
00000470:       LGreater
00000471:         Local3
00000472:         0x00
00000474:       Decrement
00000475:         Local3
00000476:     Decrement
00000477:       Local2
00000478:   Store
00000479:     Local0
0000047a:     S1B_ (000003ee)

</body></email><email><emailId>20000430051523</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-04-30 05:15:23-0400</timestampReceived><subject>[Acpi] Re: [RFC] Getting rid of useless daemons</subject><body>

On Sat, 29 Apr 2000, Cesar Eduardo Barros wrote:

&gt; acpid (as far as I know at least) is like apmd but also parses the
&gt; ACPI tables (easy to do within a boot script, at the same spot acpid
&gt; would be loaded).

acpid does more than table parsing, so it cannot be easily replaced by a
"boot script". Most of its functionality (table parsing, AML code
execution) will move into the kernel later on, as future systems will
depend on that for hardware enumeration, but for now having a separate
daemon eases development.

I'm currently moving the rest of acpid's functionality, mainly system
policy decisions, into a separate daemon, which will be comparable to
apmd.

The power management policy daemons (apmd and the soon-to-come acpipold)
are not part of the kernel in my opinion, since the subsystem will work
without this daemon, so I'm against including them in the kernel.

   Simon

-- 
PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

</body></email><email><emailId>20000430140417</emailId><senderName>Cesar Eduardo Barros</senderName><senderEmail>cesarb@web4u.com.br</senderEmail><timestampReceived>2000-04-30 14:04:17-0400</timestampReceived><subject>[Acpi] Re: [RFC] Getting rid of useless daemons</subject><body>

On Sun, Apr 30, 2000 at 07:15:23AM +0200, Simon Richter wrote:
&gt; On Sat, 29 Apr 2000, Cesar Eduardo Barros wrote:
&gt; 
&gt; &gt; acpid (as far as I know at least) is like apmd but also parses the
&gt; &gt; ACPI tables (easy to do within a boot script, at the same spot acpid
&gt; &gt; would be loaded).
&gt; 
&gt; The power management policy daemons (apmd and the soon-to-come acpipold)
&gt; are not part of the kernel in my opinion, since the subsystem will work
&gt; without this daemon, so I'm against including them in the kernel.
&gt; 

I'm against including them in the kernel too. I'm for replacing them by
programs called from userspace like modprobe.

-- 
Cesar Eduardo Barros
cesarb@web4u.com.br
cesarb@dcc.ufrj.br

</body></email><email><emailId>20000430170801</emailId><senderName>Jeff Garzik</senderName><senderEmail>jgarzik@mandrakesoft.com</senderEmail><timestampReceived>2000-04-30 17:08:01-0400</timestampReceived><subject>[Acpi] Re: [RFC] Getting rid of useless daemons</subject><body>

Simon Richter wrote:
&gt; 
&gt; On Sat, 29 Apr 2000, Cesar Eduardo Barros wrote:
&gt; 
&gt; &gt; acpid (as far as I know at least) is like apmd but also parses the
&gt; &gt; ACPI tables (easy to do within a boot script, at the same spot acpid
&gt; &gt; would be loaded).
&gt; 
&gt; acpid does more than table parsing, so it cannot be easily replaced by a
&gt; "boot script". Most of its functionality (table parsing, AML code
&gt; execution) will move into the kernel later on, as future systems will
&gt; depend on that for hardware enumeration, but for now having a separate
&gt; daemon eases development.

After having re-read the ACPI spec a few days ago, I agree that more
ACPI stuff is gonna wind up in the kernel.  We don't want to have to
bounce back to userspace just to parse tables which tell us key things
like APIC or CPU info.

(fwiw here is a kernel traffic reference for ACPI: 
http://kt.linuxcare.com/kernel-traffic/kt19991004_37.epl#1 )

Parsing tables is way different from parsing AML.  Why does there need
to be an AML parser in the kernel?  It seems like Andy adequate
responded to your list of drawbacks at the above link, so I hope you
mind my request for a clarification of the issue.

Thanks,

	Jeff




-- 
Jeff Garzik              | Nothing cures insomnia like the
Building 1024            | realization that it's time to get up.
MandrakeSoft, Inc.       |        -- random fortune

</body></email><email><emailId>20000501155528</emailId><senderName>"Therien, Guy"</senderName><senderEmail>guy.therien@intel.com</senderEmail><timestampReceived>2000-05-01 15:55:28-0400</timestampReceived><subject>RE: [Acpi] Re: [RFC] Getting rid of useless daemons</subject><body>

In order for any OS to work correctly (provide all the benefit of OSPM/ACPI
using acpi define interfaces), OSPM must be resident very early and very
late. OSPM is a term we use to describe all software that touches ACPI
define interfaces whether they be configuration or power management.

1. The AML interpreter (AMLI) is required in a number of cases. It is needed
to get interrupt routing so it must be around very early or the loader must
be able to get this info.

2. AMLI is required to parse the names space to perform motherboard device
initialization and configuration including all PCI root bridges, keyboard,
mouse, embedded controllers etc.. Some systems will need GPEs to enumerate
and so that support must be available during config time.

3. In general OSPM requires access address spaces like memory, PCI, PCI
config, the SCI interrupt, and ACPI defined "fixed" hardware.

4. To transition into the sleeping state, the system should shut down all
applications then run a control method or two and then hit the sleep type
and sleep enable registers. This can become tricky if OSPM itself is an
application. Upon wake, OSPM must perform configuration and power mgt tasks
before applications are re-enabled (awoken).

It is for these reasons and others that every OS that has implemented or is
implementing OSPM/ACPI has put the support in the OS kernel. While Linux of
course is not every OS, there is merit to the choice. 

Guy

P.S. The AMLI itself is currently around 70K code and data and has been
shrinking overtime as it has been optimized.

-----Original Message-----
From: Jeff Garzik [mailto:jgarzik@mandrakesoft.com]
Sent: Sunday, April 30, 2000 10:08 AM
To: Simon Richter
Cc: Cesar Eduardo Barros; linux-kernel@vger.rutgers.edu;
acpi@phobos.fachschaften.tu-muenchen.de
Subject: [Acpi] Re: [RFC] Getting rid of useless daemons


Simon Richter wrote:
&gt; 
&gt; On Sat, 29 Apr 2000, Cesar Eduardo Barros wrote:
&gt; 
&gt; &gt; acpid (as far as I know at least) is like apmd but also parses the
&gt; &gt; ACPI tables (easy to do within a boot script, at the same spot acpid
&gt; &gt; would be loaded).
&gt; 
&gt; acpid does more than table parsing, so it cannot be easily replaced by a
&gt; "boot script". Most of its functionality (table parsing, AML code
&gt; execution) will move into the kernel later on, as future systems will
&gt; depend on that for hardware enumeration, but for now having a separate
&gt; daemon eases development.

After having re-read the ACPI spec a few days ago, I agree that more
ACPI stuff is gonna wind up in the kernel.  We don't want to have to
bounce back to userspace just to parse tables which tell us key things
like APIC or CPU info.

(fwiw here is a kernel traffic reference for ACPI: 
http://kt.linuxcare.com/kernel-traffic/kt19991004_37.epl#1 )

Parsing tables is way different from parsing AML.  Why does there need
to be an AML parser in the kernel?  It seems like Andy adequate
responded to your list of drawbacks at the above link, so I hope you
mind my request for a clarification of the issue.

Thanks,

	Jeff




-- 
Jeff Garzik              | Nothing cures insomnia like the
Building 1024            | realization that it's time to get up.
MandrakeSoft, Inc.       |        -- random fortune


_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000401161536</emailId><senderName>"Crispin Flowerday"</senderName><senderEmail>cehf2@cam.ac.uk</senderEmail><timestampReceived>2000-04-01 16:15:36-0400</timestampReceived><subject>Re: [Acpi] 2.3.99-pre4-2 no go with Abit BP6</subject><body>

ditto with me with ABIT BH6,

however if I

echo 1 &gt; /proc/sys/acpi/s5_[whatever]

then it turns off on shutdown. My dsdt | acpidisasm is pretty much the same,
however I will ens it if you need it Andy?

Crispin
----- Original Message -----
From: Jon Evans &lt;jon.evans@pobox.com&gt;
To: acpi &lt;acpi@phobos.fachschaften.tu-muenchen.de&gt;
Sent: Saturday, April 01, 2000 3:23 PM
Subject: [Acpi] 2.3.99-pre4-2 no go with Abit BP6


&gt; Hi,
&gt;
&gt; I'm running an Abit BP6 dual Celeron 400 (not clocked) with the latest
&gt; devel BIOS, rev QQ.  ACPI doesn't work for me, excerpt from syslog:
&gt;
&gt; Apr  1 09:35:56 evansoft acpid: started
&gt; Apr  1 09:35:56 evansoft acpid: FACP loaded from /proc/sys/acpi/
&gt; Apr  1 09:35:56 evansoft acpid: DSDT loaded from /proc/sys/acpi/
&gt; Apr  1 09:35:56 evansoft acpid: S0 not supported
&gt; Apr  1 09:35:56 evansoft acpid: S1 not supported
&gt; Apr  1 09:35:56 evansoft acpid: S2 not supported
&gt; Apr  1 09:35:56 evansoft acpid: S3 not supported
&gt; Apr  1 09:35:56 evansoft acpid: S4 not supported
&gt; Apr  1 09:35:56 evansoft acpid: S5 not supported
&gt; Apr  1 09:35:56 evansoft acpid: no processor block
&gt;
&gt; I append pmtools debugging output.
&gt;
&gt; I compiled acpid with debugging enabled, I can post the output from that
&gt; as well if it helps anyone (13.5k gzipped).
&gt;
&gt; If I can do anything to fix this I'd love some pointers as to which bits
&gt; of the code to concentrate on.
&gt;
&gt; BTW acpid seems to work fine on my office PC (power off key turns into a
&gt; shutdown key) but I don't know if it's possible to check things like HLT
&gt; on idle.  Is there any output I can enable that shows me that acpid is
&gt; doing more than just monitoring the power button? :-)
&gt;
&gt; Thanks,
&gt;
&gt; Jon.
&gt;
&gt; Debug stuff follows:
&gt;
&gt; I get the following output from acpidmp FACP | acpitbl :
&gt;
&gt; Signature:        FACP
&gt; Length:           116
&gt; Revision:         0x01
&gt; Checksum:         0x34
&gt; OEMID:            ABIT
&gt; OEM Table ID:     AWRDACPI
&gt; OEM Revision:     0x42302e31
&gt; Creator ID:       AWRD
&gt; Creator Revision: 0x00000000
&gt; FIRMWARE_CTRL:    0x07ff0000
&gt; DSDT:             0x07ff30c0
&gt; INT_MODEL:        0x00
&gt; SCI_INT:          9
&gt; SMI_CMD:          0x000000b2
&gt; ACPI_ENABLE:      0xa1
&gt; ACPI_DISABLE:     0xa0
&gt; S4BIOS_REQ:       0xa4
&gt; PM1a_EVT_BLK:     0x00004000
&gt; PM1b_EVT_BLK:     0x00000000
&gt; PM1a_CNT_BLK:     0x00004040
&gt; PM1b_CNT_BLK:     0x00000000
&gt; PM2_CNT_BLK:      0x00000000
&gt; PM_TMR_BLK:       0x00004008
&gt; GPE0_BLK:         0x0000400c
&gt; GPE1_BLK:         0x00000000
&gt; PM1_EVT_LEN:      4
&gt; PM1_CNT_LEN:      2
&gt; PM2_CNT_LEN:      0
&gt; PM_TM_LEN:        4
&gt; GPE0_BLK_LEN:     4
&gt; GPE1_BLK_LEN:     0
&gt; GPE1_BASE:        0
&gt; P_LVL2_LAT:       90
&gt; P_LVL3_LAT:       900
&gt; FLUSH_SIZE:       0
&gt; FLUSH_STRIDE:     0
&gt; DUTY_OFFSET:      1
&gt; DUTY_WIDTH:       1
&gt; DAY_ALRM:         0x0d
&gt; MON_ALRM:         0x00
&gt; CENTURY:          0x00
&gt; Flags:            0x00000000
&gt;
&gt; and I get the following output from acpidmp DSDT | acpidisasm :
&gt;
&gt; 00000000: Scope _PR_
&gt; 00000007:   Processor CPU_
&gt; 00000014:     0x00
&gt; 00000015:     0x00000000
&gt; 00000019:     0x00
&gt; 0000001a:   Processor CPU1
&gt; 00000027:     0x01
&gt; 00000028:     0x00000000
&gt; 0000002c:     0x00
&gt; 0000002d: Name _S0_
&gt; 00000033:   Package
&gt; 00000035:     0x04
&gt; 00000036:     0x05
&gt; 00000038:     0x05
&gt; 0000003a:     0x05
&gt; 0000003c:     0x05
&gt; 0000003e: Name _S1_
&gt; 00000044:   Package
&gt; 00000046:     0x04
&gt; 00000047:     0x04
&gt; 00000049:     0x04
&gt; 0000004b:     0x04
&gt; 0000004d:     0x04
&gt; 0000004f: Name _S4_
&gt; 00000055:   Package
&gt; 00000057:     0x04
&gt; 00000058:     ZeroOp
&gt; 00000059:     ZeroOp
&gt; 0000005a:     ZeroOp
&gt; 0000005b:     ZeroOp
&gt; 0000005c: Name _S5_
&gt; 00000062:   Package
&gt; 00000064:     0x04
&gt; 00000065:     ZeroOp
&gt; 00000066:     ZeroOp
&gt; 00000067:     ZeroOp
&gt; 00000068:     ZeroOp
&gt; 00000069: OpRegion DEBG
&gt; 00000070:   0x01
&gt; 00000071:   0x80
&gt; 00000073:   0x01
&gt; 00000075: Field DEBG
&gt; 0000007d:   0x01
&gt; 0000007e:   NamedField DBG1
&gt; 00000083: OpRegion EXTM
&gt; 00000089:   0x00
&gt; 0000008a:   0x000ff830
&gt; 0000008f:   0x10
&gt; 00000091: Field EXTM
&gt; 00000098:   0x02
&gt; 00000099:   NamedField ROM1
&gt; 0000009e:   NamedField RMS1
&gt; 000000a3:   NamedField ROM2
&gt; 000000a8:   NamedField RMS2
&gt; 000000ad:   NamedField ROM3
&gt; 000000b2:   NamedField RMS3
&gt; 000000b7:   NamedField AMEM
&gt; 000000bc: OpRegion VGAM
&gt; 000000c2:   0x00
&gt; 000000c3:   0x000c0002
&gt; 000000c8:   0x01
&gt; 000000ca: Field VGAM
&gt; 000000d1:   0x01
&gt; 000000d2:   NamedField VGA1
&gt; 000000d7: OpRegion SMIC
&gt; 000000de:   0x01
&gt; 000000df:   0xb2
&gt; 000000e1:   0x01
&gt; 000000e3: Field SMIC
&gt; 000000eb:   0x01
&gt; 000000ec:   NamedField SCP_
&gt; 000000f1: OpRegion TRAP
&gt; 000000f8:   0x01
&gt; 000000f9:   0x402f
&gt; 000000fc:   0x01
&gt; 000000fe: Field TRAP
&gt; 00000106:   0x01
&gt; 00000107:   ReservedField
&gt; 00000109:   NamedField TR13
&gt; 0000010e: OpRegion GBLE
&gt; 00000115:   0x01
&gt; 00000116:   0x4021
&gt; 00000119:   0x01
&gt; 0000011b: Field GBLE
&gt; 00000123:   0x01
&gt; 00000124:   NamedField ESMI
&gt; 00000129: Name CMDB
&gt; 0000012e:   Buffer
&gt; 00000130:     0x08
&gt; 00000132: CreateByteField
&gt; 00000133:   CMDB (00000129)
&gt; 00000137:   0x00
&gt; 00000139:   BYT0
&gt; 0000013d: CreateByteField
&gt; 0000013e:   CMDB (00000129)
&gt; 00000142:   0x01
&gt; 00000144:   BYT1
&gt; 00000148: CreateByteField
&gt; 00000149:   CMDB (00000129)
&gt; 0000014d:   0x02
&gt; 0000014f:   BYT2
&gt; 00000153: CreateByteField
&gt; 00000154:   CMDB (00000129)
&gt; 00000158:   0x03
&gt; 0000015a:   BYT3
&gt; 0000015e: CreateByteField
&gt; 0000015f:   CMDB (00000129)
&gt; 00000163:   0x04
&gt; 00000165:   BYT4
&gt; 00000169: CreateByteField
&gt; 0000016a:   CMDB (00000129)
&gt; 0000016e:   0x05
&gt; 00000170:   BYT5
&gt; 00000174: CreateByteField
&gt; 00000175:   CMDB (00000129)
&gt; 00000179:   0x06
&gt; 0000017b:   BYT6
&gt; 0000017f: CreateByteField
&gt; 00000180:   CMDB (00000129)
&gt; 00000184:   0x07
&gt; 00000186:   BYT7
&gt; 0000018a: Name IDEB
&gt; 0000018f:   Buffer
&gt; 00000191:     0x38
&gt; 00000193: CreateField
&gt; 00000195:   IDEB (0000018a)
&gt; 00000199:   0x00
&gt; 0000019b:   0x38
&gt; 0000019d:   CMD0
&gt; 000001a1: CreateField
&gt; 000001a3:   IDEB (0000018a)
&gt; 000001a7:   0x38
&gt; 000001a9:   0x38
&gt; 000001ab:   CMD1
&gt; 000001af: CreateField
&gt; 000001b1:   IDEB (0000018a)
&gt; 000001b5:   0x70
&gt; 000001b7:   0x38
&gt; 000001b9:   CMD2
&gt; 000001bd: CreateField
&gt; 000001bf:   IDEB (0000018a)
&gt; 000001c3:   0xa8
&gt; 000001c5:   0x38
&gt; 000001c7:   CMD3
&gt; 000001cb: CreateField
&gt; 000001cd:   IDEB (0000018a)
&gt; 000001d1:   0xe0
&gt; 000001d3:   0x38
&gt; 000001d5:   CMD4
&gt; 000001d9: CreateField
&gt; 000001db:   IDEB (0000018a)
&gt; 000001df:   0x0118
&gt; 000001e2:   0x38
&gt; 000001e4:   CMD5
&gt; 000001e8: CreateField
&gt; 000001ea:   IDEB (0000018a)
&gt; 000001ee:   0x0150
&gt; 000001f1:   0x38
&gt; 000001f3:   CMD6
&gt; 000001f7: CreateField
&gt; 000001f9:   IDEB (0000018a)
&gt; 000001fd:   0x0188
&gt; 00000200:   0x38
&gt; 00000202:   CMD7
&gt; 00000206: OpRegion APMP
&gt; 0000020c:   0x01
&gt; 0000020d:   0xb2
&gt; 0000020f:   0x02
&gt; 00000211: Field APMP
&gt; 00000218:   0x01
&gt; 00000219:   NamedField APMC
&gt; 0000021e:   NamedField APMD
&gt; 00000223: OpRegion ELCR
&gt; 00000229:   0x01
&gt; 0000022a:   0x04d0
&gt; 0000022d:   0x02
&gt; 0000022f: Field ELCR
&gt; 00000236:   0x01
&gt; 00000237:   NamedField ELC1
&gt; 0000023c:   NamedField ELC2
&gt; 00000241: OpRegion GPOB
&gt; 00000247:   0x01
&gt; 00000248:   0x4034
&gt; 0000024b:   0x04
&gt; 0000024d: Field GPOB
&gt; 00000255:   0x01
&gt; 00000256:   NamedField GP00
&gt; 0000025b:   NamedField GP01
&gt; 00000260:   NamedField GP02
&gt; 00000265:   NamedField GP03
&gt; 0000026a:   NamedField GP04
&gt; 0000026f:   NamedField GP05
&gt; 00000274:   NamedField GP06
&gt; 00000279:   NamedField GP07
&gt; 0000027e:   NamedField GP08
&gt; 00000283:   NamedField GP09
&gt; 00000288:   NamedField GP0A
&gt; 0000028d:   NamedField GP0B
&gt; 00000292:   NamedField GP0C
&gt; 00000297:   NamedField GP0D
&gt; 0000029c:   NamedField GP0E
&gt; 000002a1:   NamedField GP0F
&gt; 000002a6:   NamedField GP10
&gt; 000002ab:   NamedField GP11
&gt; 000002b0:   NamedField GP12
&gt; 000002b5:   NamedField GP13
&gt; 000002ba:   NamedField GP14
&gt; 000002bf:   NamedField GP15
&gt; 000002c4:   NamedField GP16
&gt; 000002c9:   NamedField GP17
&gt; 000002ce:   NamedField GP18
&gt; 000002d3:   NamedField GP19
&gt; 000002d8:   NamedField GP1A
&gt; 000002dd:   NamedField GP1B
&gt; 000002e2:   NamedField GP1C
&gt; 000002e7:   NamedField GP1D
&gt; 000002ec:   NamedField GP1E
&gt; 000002f1:   NamedField GP1F
&gt; 000002f6: Name OSFL
&gt; 000002fb:   0x01
&gt; 000002fd: Method STRC
&gt; 00000304:   0x02
&gt; 00000305:   If
&gt; 00000307:     LNotEqual
&gt; 00000309:       SizeOf
&gt; 0000030a:         Arg0
&gt; 0000030b:       SizeOf
&gt; 0000030c:         Arg1
&gt; 0000030d:     Return
&gt; 0000030e:       0x00
&gt; 00000310:   Add
&gt; 00000311:     SizeOf
&gt; 00000312:       Arg0
&gt; 00000313:     0x01
&gt; 00000315:     Local0
&gt; 00000316:   Name BUF0
&gt; 0000031b:     Buffer
&gt; 0000031d:       Local0
&gt; 0000031e:   Name BUF1
&gt; 00000323:     Buffer
&gt; 00000325:       Local0
&gt; 00000326:   Store
&gt; 00000327:     Arg0
&gt; 00000328:     BUF0 (00000316)
&gt; 0000032c:   Store
&gt; 0000032d:     Arg1
&gt; 0000032e:     BUF1 (0000031e)
&gt; 00000332:   While
&gt; 00000334:     Local0
&gt; 00000335:     Decrement
&gt; 00000336:       Local0
&gt; 00000337:     If
&gt; 00000339:       LNotEqual
&gt; 0000033b:         DerefOf
&gt; 0000033c:           Index
&gt; 0000033d:             BUF0 (00000316)
&gt; 00000341:             Local0
&gt; 00000342:             &lt;NULL&gt;
&gt; 00000343:         DerefOf
&gt; 00000344:           Index
&gt; 00000345:             BUF1 (0000031e)
&gt; 00000349:             Local0
&gt; 0000034a:             &lt;NULL&gt;
&gt; 0000034b:       Return
&gt; 0000034c:         ZeroOp
&gt; 0000034d:   Return
&gt; 0000034e:     OneOp
&gt; 0000034f: OpRegion RTCM
&gt; 00000355:   0x01
&gt; 00000356:   0x70
&gt; 00000358:   0x02
&gt; 0000035a: Field RTCM
&gt; 00000361:   0x01
&gt; 00000362:   NamedField CMIN
&gt; 00000367:   NamedField CMDA
&gt; 0000036c: IndexField CMIN
&gt; 00000373:   CMDA (00000367)
&gt; 00000377:   0x01
&gt; 00000378:   ReservedField
&gt; 0000037b:   NamedField SHUT
&gt; 00000380: OpRegion GRAM
&gt; 00000387:   0x00
&gt; 00000388:   0x0400
&gt; 0000038b:   0x0100
&gt; 0000038e: Field GRAM
&gt; 00000396:   0x01
&gt; 00000397:   ReservedField
&gt; 0000039a:   NamedField FLG0
&gt; 0000039f:   ReservedField
&gt; 000003a2:   NamedField SFLG
&gt; 000003a7: OpRegion INFO
&gt; 000003ad:   0x00
&gt; 000003ae:   0x000ff840
&gt; 000003b3:   0x01
&gt; 000003b5: Field INFO
&gt; 000003bc:   0x01
&gt; 000003bd:   NamedField KBDI
&gt; 000003c2:   NamedField RTCW
&gt; 000003c7:   NamedField PS2F
&gt; 000003cc:   NamedField IRFL
&gt; 000003d1:   NamedField DISE
&gt; 000003d6:   NamedField SSHU
&gt; 000003db: OpRegion BEEP
&gt; 000003e1:   0x01
&gt; 000003e2:   0x61
&gt; 000003e4:   0x01
&gt; 000003e6: Field BEEP
&gt; 000003ed:   0x01
&gt; 000003ee:   NamedField S1B_
&gt; 000003f3: OpRegion CONT
&gt; 000003f9:   0x01
&gt; 000003fa:   0x40
&gt; 000003fc:   0x04
&gt; 000003fe: Field CONT
&gt; 00000405:   0x01
&gt; 00000406:   NamedField CNT0
&gt; 0000040b:   NamedField CNT1
&gt; 00000410:   NamedField CNT2
&gt; 00000415:   NamedField CTRL
&gt; 0000041a: Method SPKR
&gt; 00000421:   0x01
&gt; 00000422:   Store
&gt; 00000423:     S1B_ (000003ee)
&gt; 00000427:     Local0
&gt; 00000428:   Store
&gt; 00000429:     0xb6
&gt; 0000042b:     CTRL (00000415)
&gt; 0000042f:   Store
&gt; 00000430:     0x55
&gt; 00000432:     CNT2 (00000410)
&gt; 00000436:   Store
&gt; 00000437:     0x03
&gt; 00000439:     CNT2 (00000410)
&gt; 0000043d:   Store
&gt; 0000043e:     Arg0
&gt; 0000043f:     Local2
&gt; 00000440:   While
&gt; 00000442:     LGreater
&gt; 00000443:       Local2
&gt; 00000444:       0x00
&gt; 00000446:     Or
&gt; 00000447:       S1B_ (000003ee)
&gt; 0000044b:       0x03
&gt; 0000044d:       S1B_ (000003ee)
&gt; 00000451:     Store
&gt; 00000452:       0x5fff
&gt; 00000455:       Local3
&gt; 00000456:     While
&gt; 00000458:       LGreater
&gt; 00000459:         Local3
&gt; 0000045a:         0x00
&gt; 0000045c:       Decrement
&gt; 0000045d:         Local3
&gt; 0000045e:     And
&gt; 0000045f:       S1B_ (000003ee)
&gt; 00000463:       0xfc
&gt; 00000465:       S1B_ (000003ee)
&gt; 00000469:     Store
&gt; 0000046a:       0x0eff
&gt; 0000046d:       Local3
&gt; 0000046e:     While
&gt; 00000470:       LGreater
&gt; 00000471:         Local3
&gt; 00000472:         0x00
&gt; 00000474:       Decrement
&gt; 00000475:         Local3
&gt; 00000476:     Decrement
&gt; 00000477:       Local2
&gt; 00000478:   Store
&gt; 00000479:     Local0
&gt; 0000047a:     S1B_ (000003ee)
&gt;
&gt;
&gt;
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000405201649</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-05 20:16:49-0400</timestampReceived><subject>Re: [Acpi] 2.3.99-pre4-2 no go with Abit BP6</subject><body>

--- Jon Evans &lt;jon.evans@pobox.com&gt; wrote:

&gt; Apr  1 09:35:56 evansoft acpid: started
&gt; Apr  1 09:35:56 evansoft acpid: FACP loaded from
&gt; /proc/sys/acpi/
&gt; Apr  1 09:35:56 evansoft acpid: DSDT loaded from
&gt; /proc/sys/acpi/
&gt; Apr  1 09:35:56 evansoft acpid: S0 not supported
&gt; Apr  1 09:35:56 evansoft acpid: S1 not supported
&gt; Apr  1 09:35:56 evansoft acpid: S2 not supported
&gt; Apr  1 09:35:56 evansoft acpid: S3 not supported
&gt; Apr  1 09:35:56 evansoft acpid: S4 not supported
&gt; Apr  1 09:35:56 evansoft acpid: S5 not supported
&gt; Apr  1 09:35:56 evansoft acpid: no processor block

OK, yes, it looks like your system does indeed
support S1, S4, and S5.  The latest acpid fails
while parsing your DSDT and that's why it
reports everything as unsupported.  This is
definitely a bug in acpid and I'm putting together
a fix.

&gt; shutdown key) but I don't know if it's possible to
&gt; check things like HLT
&gt; on idle.  Is there any output I can enable that
&gt; shows me that acpid is
&gt; doing more than just monitoring the power button?

Well, it doesn't look like your system supports
C2/C3 so there really isn't much else to see the
ACPI driver doing.  You can be sure that C1 (HLT
on idle) does happen, but there is no output
associated with it (C1 happens a lot, and it
is pretty much guaranteed to work with any x86
system)

-Andy


__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000501072948</emailId><senderName>Art Boulatov</senderName><senderEmail>aboulato@soros.ksu.ru</senderEmail><timestampReceived>2000-05-01 07:29:48-0400</timestampReceived><subject>Re: [Acpi] Re: Need to disable power button :)</subject><body>

Simon Richter wrote:
&gt; 
&gt; On Sun, 30 Apr 2000, Art Boulatov wrote:
&gt; 
&gt; &gt; Yes, that works,
&gt; &gt; but if I keep the button pressed for more than ~4 seconds,
&gt; &gt; it immideately poweroffs.
&gt; &gt; How do I handle that?
&gt; 
&gt; This cannot be handled, I'm afraid. :-/ &lt;microsoft&gt;But it's not a bug,
&gt; it's a feature! The users who know that pressing the power button for four
&gt; seconds will power off anyway are those who know when a lab computer
&gt; definitely needs to be rebooted.&lt;/microsoft&gt;
&gt; 
&gt; No, seriously, if someone really wants to turn the machine off, he will
&gt; pull the plug or something. However, he will first try the power button.
&gt; If you display a big red blinking warning message then, you will achieve
&gt; more than when you disable the power button completely.

I have to think about something like that.
May be some kind of electric shock going through the chair... :))

Thanks again to everybody,
Art.



&gt; 
&gt;    Simon
&gt; 
&gt; --
&gt; PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
&gt;  Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
&gt; Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

</body></email><email><emailId>20000501155016</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-05-01 15:50:16-0400</timestampReceived><subject>[Acpi] USENIX</subject><body>

Hi,

I'm thinking about going to the USENIX conference in June. Anyone
interested in meeting there/holding a BoF/going for a beer/...?

   Simon

-- 
PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

</body></email><email><emailId>20000501235020</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-05-01 23:50:20-0400</timestampReceived><subject>Re: [Acpi] Re: [RFC] Getting rid of useless daemons</subject><body>

--- Jeff Garzik &lt;jgarzik@mandrakesoft.com&gt; wrote:

&gt; Parsing tables is way different from parsing AML. 
&gt; Why does there need
&gt; to be an AML parser in the kernel?  It seems like
&gt; Andy adequate
&gt; responded to your list of drawbacks at the above
&gt; link, so I hope you
&gt; mind my request for a clarification of the issue.

And again, I'm victim to mailing list archives  :)
Actually, I've been swayed much more towards the
interpreter-in-the-kernel camp since the posting
you referenced, Jeff.

Simon is right in that control methods, including
those that return system configuration info, can
do pretty much whatever they want.  There really
is no generic way to extract config information
without running control methods at boot time.

Of course, I can think of ways around a kernel
interpreter for some specific systems.  The IA64
folks, for instance, know their interrupt routing
table is static and embedded at a specific location
in the AML so they just extract it pre-boot.  Other
systems build up a routing table dynamically with
control methods so this solution isn't going to
work across the board.

The problem gets even worse for putting devices and
the system to sleep, unless we have an interpreter
in the kernel.

-Andy


__________________________________________________
Do You Yahoo!?
Send instant messages &amp; get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

</body></email><email><emailId>20000502112458</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-02 11:24:58-0400</timestampReceived><subject>[Acpi] Re: PnP resource printing patch</subject><body>

Andy Henroid writes:
&gt;Spec work by a closed consortium of
&gt;companies allows specs to be completed and
&gt;product released fast.

And implemented more slowly...  Hey, it only took
four years after ACPI was standardized for a
working implementation...  :-/

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000502165315</emailId><senderName>Mathieu Chouquet-Stringer</senderName><senderEmail>mchouque@cs.stevens-tech.edu</senderEmail><timestampReceived>2000-05-02 16:53:15-0400</timestampReceived><subject>[Acpi] ACPI with kernel 2.3.99-pre6, MB K7V</subject><body>

	Hello !

I have an Asus K7V and the last kernel (2.3.99-pre6). When I start acpid
(the last version found on the acpi for linux web page), I experience
lockups. The debugging mode (acpid -d) doesn't work either, it hangs too
and I don't have any informations in the logs. The crash is a real good
crash because Ctrl-Altr-SysRq doesn't work.

If I can help to debug this problem, I will be glade.

-- 
Mathieu CHOUQUET-STRINGER    E-Mail : mchouque@stevens-tech.edu
     "Entities must not be multiplied beyond necessity"
		-- William of Occam --

</body></email><email><emailId>20000502184939</emailId><senderName>Crispin Flowerday</senderName><senderEmail>cehf2@hermes.cam.ac.uk</senderEmail><timestampReceived>2000-05-02 18:49:39-0400</timestampReceived><subject>[Acpi] BH6 problems</subject><body>

There is a discrepancy between apcid and pmtools:


$ acpid -d
acpid: started
acpid: FACP loaded from /proc/sys/acpi/
acpid: DSDT loaded from /proc/sys/acpi/
acpid: S0 SLP_TYP (0x0505)
acpid: S1 SLP_TYP (0x0404)
acpid: S2 not supported
acpid: S3 not supported
acpid: S4 not supported
acpid: S5 not supported
acpid: P_BLK 1 @ 0x4010:6


acpidmp DSDT | acpianalyze
acpianalyze: loading DSDT from &lt;STDIN&gt;
acpianalyze: found Processor #1 \_PR_.\_PR_.CPU0 (PBLK 0x00004010 -
0x00004016)
acpianalyze: found Fan \_SB_.PCI0.FAN0
acpianalyze: found S0 support (SLP_TYP 0x5 0x5)
acpianalyze: found S1 support (SLP_TYP 0x4 0x4)
acpianalyze: found S4 support (SLP_TYP 0x0 0x0)
acpianalyze: found S5 support (SLP_TYP 0x0 0x0)

it seems like I am missing S4 and S5.

I know S5 works fine - 
echo 0 &gt; /proc/sys/acpi/s5_slp_typ

then halt turns the computer off just fine

Crispin

*Windows leads to anger, Anger leads to hate, Hate leads to Linux*

</body></email><email><emailId>20000503052410</emailId><senderName>Mojo Jojo</senderName><senderEmail>mojojojo@pacbell.net</senderEmail><timestampReceived>2000-05-03 05:24:10-0400</timestampReceived><subject>Re: [Acpi] Toshiba Portege 3020 and ACPI (broken)</subject><body>

&gt; &gt; disabled the fpu irq by hand since SCI wanted IRQ
&gt; &gt; 13), the
&gt; 
&gt; Yes, I had heard Toshiba was using int 13 for ACPI's
&gt; SCI.  That was a poor choice and is going to at
&gt; least require a patch to arch/i386/kernel/i8259.c
&gt; and possibly a kernel build configure option.

That "at least" is perhaps what's causing it all to
wedge unusably when I start "acpid", then ... got any
suggestions on what's happening there?  And how to
keep it from locking everything up?  Does any of the
recent IRQ code reworking make this better/worse?


&gt; &gt; I can keep using APM, but ACPI is supposed to work
&gt; &gt; too;
&gt; 
&gt; OK, remember, ACPI support on Linux is not complete.
&gt; Only power off, power button, and processor power
&gt; states (save power while system is idle) are
&gt; currently working fully.  I would not expect
&gt; suspend to work yet.

Of course, the problems started right before I had
to enter "press all buttons until something happens"
debugging mode!!

Yes, I know it's not "complete" yet.  But -- what
should I do to help figure out the first problem?
(Namely, why starting "acpid" wedged the machine.)

</body></email><email><emailId>20000503084512</emailId><senderName>Andrey Panin</senderName><senderEmail>pazke@orbita.don.sitek.net</senderEmail><timestampReceived>2000-05-03 08:45:12-0400</timestampReceived><subject>[PATCH] PCI quirk for VIA ACPI device (updated)</subject><body>

    [ The following text is in the "Windows-1252" character set. ]
    [ Your display is set for the "ISO-8859-1" character set.  ]
    [ Some characters may be displayed incorrectly. ]

Hi all,

this patch (against 2.3.99-pre6) provides PCI quirk for VIA ACPI
device (same as for Intel and ALI).
Possible conflict between resource[4] and resource[7] had beed fixed.

Best  wishes,
                    Andrey

diff -urN /mnt/d/linux/drivers/pci/quirks.c
/linux/drivers/pci/quirks.c
--- /mnt/d/linux/drivers/pci/quirks.c   Tue May  2 20:02:00 2000
+++ /linux/drivers/pci/quirks.c Sat Apr 29 21:07:42 2000
@@ -164,6 +164,23 @@
 }

 /*
+ * VIA ACPI: One IO region pointed to by longword at
+ *     0x48 or 0x20 (256 bytes of ACPI registers)
+ */
+static void __init quirk_via_acpi(struct pci_dev *dev)
+{
+       u8 rev;
+       u32 region;
+
+       pci_read_config_byte(dev, PCI_CLASS_REVISION, &amp;rev);
+       if (rev &amp; 0x10) {
+               pci_read_config_dword(dev, 0x48, &amp;region);
+               region &amp;= PCI_BASE_ADDRESS_IO_MASK;
+               quirk_io_region(dev, region, 256,
PCI_BRIDGE_RESOURCES);
+       }
+}
+
+/*
  *  The main table of quirks.
  */

@@ -192,6 +209,8 @@
        { PCI_FIXUP_FINAL,      PCI_VENDOR_ID_INTEL,   
PCI_DEVICE_ID_INTEL_82443BX_2,  quirk_natoma },
        { PCI_FIXUP_FINAL,      PCI_VENDOR_ID_SI,      
PCI_DEVICE_ID_SI_5597,          quirk_nopcipci },
        { PCI_FIXUP_FINAL,      PCI_VENDOR_ID_SI,      
PCI_DEVICE_ID_SI_496,           quirk_nopcipci },
+       { PCI_FIXUP_FINAL,      PCI_VENDOR_ID_VIA,     
PCI_DEVICE_ID_VIA_82C586_3,     quirk_via_acpi },
+       { PCI_FIXUP_FINAL,      PCI_VENDOR_ID_VIA,     
PCI_DEVICE_ID_VIA_82C686_4,     quirk_via_acpi },
        { PCI_FIXUP_FINAL,      PCI_VENDOR_ID_INTEL,   
PCI_DEVICE_ID_INTEL_82371AB_3,  quirk_piix4acpi },
        { PCI_FIXUP_FINAL,      PCI_VENDOR_ID_AL,      
PCI_DEVICE_ID_AL_M7101,         quirk_ali7101 },
        { 0 }
diff -urN /mnt/d/linux/arch/i386/kernel/acpi.c
/linux/arch/i386/kernel/acpi.c
--- /mnt/d/linux/arch/i386/kernel/acpi.c        Tue May  2 20:01:35
2000
+++ /linux/arch/i386/kernel/acpi.c      Tue May  2 14:58:54 2000
@@ -631,11 +631,7 @@
        if (!(pmregmisc &amp; ACPI_PIIX4_PMIOSE))
                return -ENODEV;

-       pci_read_config_dword(dev, 0x40, &amp;base);
-       if (!(base &amp; PCI_BASE_ADDRESS_SPACE_IO))
-               return -ENODEV;
-
-       base &amp;= PCI_BASE_ADDRESS_IO_MASK;
+       base = dev-&gt;resource[PCI_BRIDGE_RESOURCES].start &amp;
PCI_BASE_ADDRESS_IO_MASK;
        if (!base)
                return -ENODEV;

@@ -688,16 +684,13 @@
        if (!(tmp &amp; 0x80))
                return -ENODEV;

-       pci_read_config_byte(dev, PCI_CLASS_REVISION, &amp;tmp);
-       tmp = (tmp &amp; 0x10 ? 0x48 : 0x20);
-
-       pci_read_config_dword(dev, tmp, &amp;base);
-       if (!(base &amp; PCI_BASE_ADDRESS_SPACE_IO))
-               return -ENODEV;
-
+       base = pci_resource_start(dev, PCI_BRIDGE_RESOURCES);
+       if (!base) {
+               base = pci_resource_start(dev, PCI_BASE_ADDRESS_4);
+               if (!base)
+                       return -ENODEV;
+       }
        base &amp;= PCI_BASE_ADDRESS_IO_MASK;
-       if (!base)
-               return -ENODEV;

        pci_read_config_byte(dev, 0x42, &amp;irq);

</body></email><email><emailId>20000503092102</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-03 09:21:02-0400</timestampReceived><subject>[Acpi] Re: confusing code</subject><body>

Andy Henroid writes:
&gt;I doesn't really matter to me either way.  You
&gt;are welcome to make that change and send me a
&gt;patch.

By assuming that the code was intended to do
something useful, I wasted a good bit of time
trying to figure out what that useful thing
was, trying to find out what about the code I
didn't understand...

So, for the next person new to acpidisasm who
tries to work with it, I've included the patch
against the latest pmtools.

Thanks!

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

diff -u --recursive pmtools-050100/acpidisasm/util.c pmtools.reindent/acpidisasm/util.c
--- pmtools-050100/acpidisasm/util.c	Mon May  1 20:24:28 2000
+++ pmtools.reindent/acpidisasm/util.c	Wed May  3 11:17:04 2000
@@ -644,125 +644,114 @@
 	static char namebuffer[MAX_SHOW_ENTRY];
 	static char outbuffer[MAX_SHOW_ENTRY];
 	const struct acpi_op *op = origin;
-
-	if(op)
-	{
 #ifdef ACPI_DEBUG
-		const u8 *aml_start = op-&gt;decl;
+	const u8 *aml_start = op-&gt;decl;
 #endif
 
-		while(op)
-		{
-			const struct acpi_op *depth;
-			int count = 0, countdown = 0;
-			char *this = NULL, *next = NULL;
+	while(op)
+	{
+		const struct acpi_op *depth;
+		int count = 0, countdown = 0;
+		char *this = NULL, *next = NULL;
 
 #ifdef ACPI_DEBUG
-			printf("%08x: ", op-&gt;decl ? (op-&gt;decl - aml_start):0);
+		printf("%08x: ", op-&gt;decl ? (op-&gt;decl - aml_start):0);
 #endif
 
-			// indentation
-			for(depth = op-&gt;parent; depth; depth = depth-&gt;parent)
+		// indentation
+		for(depth = op-&gt;parent; depth; depth = depth-&gt;parent)
+		{
+			const struct acpi_op *arg
+				= acpi_get_arg(
+					acpi_to_nonconst_op(depth), 0);
+			while(arg &amp;&amp; arg != origin)
 			{
-				const struct acpi_op *arg
-					= acpi_get_arg(
-						acpi_to_nonconst_op(depth), 0);
-				while(arg &amp;&amp; arg != origin)
-				{
-					arg = arg-&gt;next;
-				}
-				if(arg)
-				{
-					break;
-				}
-				count++;
+				arg = arg-&gt;next;
 			}
-			for(countdown = count; countdown; countdown--)
-				printf("  ");
-	    
-			if(acpi_sprint_op(buffer, sizeof(buffer), op) &gt; 0)
+			if(arg)
 			{
-				if(op-&gt;opcode == AML_NAMEPATH
-				   &amp;&amp; op-&gt;value.name)
+				break;
+			}
+			count++;
+		}
+		for(countdown = count; countdown; countdown--)
+			printf("  ");
+    
+		if(acpi_sprint_op(buffer, sizeof(buffer), op) &gt; 0)
+		{
+			if(op-&gt;opcode == AML_NAMEPATH
+			   &amp;&amp; op-&gt;value.name)
+			{
+				const struct acpi_op *source
+					= acpi_find(op-&gt;parent,
+						    op-&gt;value.name,
+						    0,
+						    0);
+				if(source)
 				{
-					const struct acpi_op *source
-						= acpi_find(op-&gt;parent,
-							    op-&gt;value.name,
-							    0,
-							    0);
-					if(source)
-					{
 #ifdef ACPI_DEBUG
-						acpi_safe_sprintf(outbuffer,
-							    sizeof(outbuffer),
-							    0,
-							    "%s (%08x)",
-							    buffer,
-							    (source-&gt;decl
-							      ? (source-&gt;decl
-							      - aml_start):0));
+					acpi_safe_sprintf(outbuffer,
+						    sizeof(outbuffer),
+						    0,
+						    "%s (%08x)",
+						    buffer,
+						    (source-&gt;decl
+						      ? (source-&gt;decl
+						      - aml_start):0));
 #else
-						strcpy(outbuffer, buffer);
+					strcpy(outbuffer, buffer);
 #endif
-					}
-					else
-					{
-						strcpy(outbuffer, buffer);
-					}
 				}
 				else
 				{
-					if (acpi_is_named_op(op-&gt;opcode)
-					    &amp;&amp; (op-&gt;opcode != AML_NAMEDFIELD)
-					    &amp;&amp; (op-&gt;opcode != AML_RESERVEDFIELD)
-					    &amp;&amp; (op-&gt;opcode != AML_ACCESSFIELD)
-					    )
-					{
-						acpi_sprint_path(namebuffer, sizeof(namebuffer), op);
-						acpi_safe_sprintf(outbuffer,
-							    sizeof(outbuffer),
-							    0,
-							    "%s (\\%s)",
-							    buffer,
-							    namebuffer);
-					}
-					else
-					{
-						strcpy(outbuffer, buffer);
-					}
+					strcpy(outbuffer, buffer);
 				}
 			}
-
-			// Now print, dealing with any embedded \n characters
-			this = outbuffer;
-			while (this)
+			else
 			{
-				next = strchr(this, '\n');
-				if (next)
-					*next = '\0';
-				printf("%s\n", this);
-				if (next)
+				if (acpi_is_named_op(op-&gt;opcode)
+				    &amp;&amp; (op-&gt;opcode != AML_NAMEDFIELD)
+				    &amp;&amp; (op-&gt;opcode != AML_RESERVEDFIELD)
+				    &amp;&amp; (op-&gt;opcode != AML_ACCESSFIELD)
+				    )
 				{
-#ifdef ACPI_DEBUG
-					printf("%08x: ", op-&gt;decl ? (op-&gt;decl - aml_start):0);
-#endif
-					for(countdown = count; countdown; countdown--)
-						printf("  ");
-					next++;
+					acpi_sprint_path(namebuffer, sizeof(namebuffer), op);
+					acpi_safe_sprintf(outbuffer,
+						    sizeof(outbuffer),
+						    0,
+						    "%s (\\%s)",
+						    buffer,
+						    namebuffer);
+				}
+				else
+				{
+					strcpy(outbuffer, buffer);
 				}
-				this = next;
 			}
-
-			op = acpi_get_depth_next(acpi_to_nonconst_op(origin),
-						 acpi_to_nonconst_op(op));
 		}
-	}
-	else
-	{
-		if(acpi_sprint_op(buffer, sizeof(buffer), op) &gt; 0)
+
+		// Now print, dealing with any embedded \n characters
+		this = outbuffer;
+		while (this)
 		{
-			printf("%s\n", buffer);
+			next = strchr(this, '\n');
+			if (next)
+				*next = '\0';
+			printf("%s\n", this);
+			if (next)
+			{
+#ifdef ACPI_DEBUG
+				printf("%08x: ", op-&gt;decl ? (op-&gt;decl - aml_start):0);
+#endif
+				for(countdown = count; countdown; countdown--)
+					printf("  ");
+				next++;
+			}
+			this = next;
 		}
+
+		op = acpi_get_depth_next(acpi_to_nonconst_op(origin),
+					 acpi_to_nonconst_op(op));
 	}
 }
 

</body></email><email><emailId>20000503182647</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-05-03 18:26:47-0400</timestampReceived><subject>[Acpi] [PATCH] PCI quirk for VIA ACPI device (updated) (fwd)</subject><body>

&gt;From the lkml.

   Simon

----- Forwarded message -----

</body></email><email><emailId>20000504110210</emailId><senderName>linuxx</senderName><senderEmail>linuxx@jaya.dyndns.org</senderEmail><timestampReceived>2000-05-04 11:02:10-0400</timestampReceived><subject>[Acpi] hi small problem with acpi</subject><body>


hi all i just installed the acpi 042500 and run ok but i dont know how to find the \
keys to press to put the machine in sleep mode S1 i use the  2.3.99-pre 6 kernel and \
                be very happy if anyone tell me this .thanks a lot.
-- 

Luis Toro Teijeiro 
AÃO 3021 de la era del pinguino :-) tux rules.
ICQ : 42466380
pasate por http://www.gulic.org  y veras Canarias y los linuxeros
http://jaya.dyndns.org  ------pagina personal
Firma gnupg disponible en http://jaya.dyndns.org/linuxx/gnupg/
Firma pgp6.5 disponible en http://jaya.dydns.org/linuxx/pgp/
GnupgFingerprint: 8F06 3E9A F610 89BF 0B09  3DEB 0C7E 9AE1 6CE0 B251 
Alguna duda ???? irc canal linux o gulic   soy linuxx pa servirte .

     


[Attachment #3 (application/pgp-signature)]

</body></email><email><emailId>20000504155914</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-05-04 15:59:14-0400</timestampReceived><subject>Re: [Acpi] Re: _HID query and patch</subject><body>

--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:

&gt; Do you know about patch's "-l" option?  It will
&gt; make it easier to apply whitespace-mangled patches.

Yes, I know I can use "-l" but that will mangle
indentation (tabs) so I would prefer not to.

-Andy


__________________________________________________
Do You Yahoo!?
Send instant messages &amp; get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

</body></email><email><emailId>20000509124712</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-05-09 12:47:12-0400</timestampReceived><subject>Re: [Acpi] acpictl suggestion</subject><body>

On Tue, 9 May 2000, Michael K. Johnson wrote:

&gt; My suggested architecture is that acpictl be the audited,
&gt; secure middleman between users and acpid.

Actually I thought of using a separate daemon for this, acpipold. Users
that don't want to use complex policy management (such as on embedded
systems can use a separate (or cut down) daemon. Also, when acpid's
funktionality gets merged into the kernel, the only thing that would have
to be changed is the communications method to the kernel.

&gt; acpictl can be setuid or perhaps (on systems such as Red Hat Linux
&gt; that support it) managed via consolehelper.

I'm using AF_UNIX SOCK_DGRAM sockets with SO_PASSCRED (Linux) or
SO_CREDENTIALS (NetBSD). This allows authentication without suid.

&gt; In any case, it can have a configuration file that defines
&gt; what normal users are allowed to do: for example, are they allowed
&gt; to set policy or only to query values?

Configuration is my greatest problem at this point. Having never used
bison before and not really having a clue how to write the rules in a
reasonable form. Some time ago, I hacked up a few rules, however they're
in broken English language rather than C. See also

http://phobos.fs.tum.de/pipermail/acpi/1999-July/000073.html

&gt; I imagine that some people
&gt; will want to set policies as normal users, and other people will
&gt; want just as strongly for normal users not to be allowed to set
&gt; policies.  Depends on the context.

Yes, and people will want to set policies from their GNOME panels and MPEG
players ("While a MPEG is playing, don't blank the screen." You can't
imagine how many people have asked for this...)

&gt; I'm going to start working on this now, but if anyone has
&gt; any better ideas or improvements to this one, feel free to
&gt; propose them.

Yes, it's been in CVS for a long time, however non-functional because I
can't think of a proper config format. The code is in CVS, in the
repository at /work/cvs/acpi, module acpipolicy (as announced on
development.html).

   Simon

-- 
PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

</body></email><email><emailId>20000427211852</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-27 21:18:52-0400</timestampReceived><subject>[Acpi] Re: PnP resource printing patch</subject><body>

"Michael K. Johnson" writes:
&gt;And that's without checksum calculation enabled -- I disabled it
&gt;because a simple u8 checksum failed[...]

Of course, it immediately occurred to me that I should just look at
the kernel and acpid to see how they calculate checksums, after a
quick look in the standard showed nothing related to checksums in
the index or the table of contents.

Well, I thought that was a good idea until I tried.  I don't see
any checksum calculation in acpi.c and the checksum is ignored for
resource descriptors, at least, in acpid -- that is, I don't see
any checksum calculation tied to the End Tag in rscalcb.c.  I'll
be glad to be proved wrong.

Or are ASL compiler writers so horrible that none of the checksums
will work out anyway and so we just have to lump it?

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000427221042</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-27 22:10:42-0400</timestampReceived><subject>Re: [Acpi] Re: PnP resource printing patch</subject><body>

&gt;-- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:

&gt; Of course, it immediately occurred to me that I
&gt; should just look at
&gt; the kernel and acpid to see how they calculate
&gt; checksums, after a
&gt; quick look in the standard showed nothing related to
&gt; checksums in
&gt; the index or the table of contents.

Right, the ACPI driver is not doing checksums
because I was seeing otherwise valid tables with
the checksum done completely wrong.  The driver
could at least generate a warning message on
bad checksum I suppose.

The checksum should just be an 8-bit sum.
Nothing magical.  Not exactly a good checksum
algorithm either.  I guess they thought nobody'd
get that wrong  :)

&gt; Or are ASL compiler writers so horrible that none of
&gt; the checksums
&gt; will work out anyway and so we just have to lump it?

I find myself often questioning the quality of
currently available ASL compilers.  Anyone out
there want to write or provide an open-source
compiler?  It probably wouldn't be too much work
and I know many people (hardware vendors,
ACPI4Linux, etc.) that would love to use it.

-Andy



__________________________________________________
Do You Yahoo!?
Talk to your friends online and get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

</body></email><email><emailId>20000428072943</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-28 07:29:43-0400</timestampReceived><subject>[Acpi] Re: PnP resource printing patch</subject><body>

Andy Henroid writes:
&gt;Right, the ACPI driver is not doing checksums
&gt;because I was seeing otherwise valid tables with
&gt;the checksum done completely wrong.  The driver
&gt;could at least generate a warning message on
&gt;bad checksum I suppose.

I'm afraid that it would print out so many errors
that people would start to look at us as incorrigible
pedants.  I've seen this with other code -- warnings
that show up on essentially every platform talking
about how non-standard it is, and everyone else just
rolls their eyes and makes deprecating comments
about the myopic developers who can't see past their
standards...

I suppose that a single error message printed when
the first bad checksum showed up wouldn't be that
bad, as long as it only is printed once per boot.

Now, in a disassembler or debugger it would make sense
to warn about bad checksums even if they occur often;
there it might make a difference, in part because more
and more hardware manufacturers are working directly
with Linux.

I'll at least tell Dell that their checksums appear
to be wrong.  However, since they appear to be using
the ASL template macros, I would expect the bug is
in the ASL template macros.

I have included a small patch to be applied after the
patch I just sent; it re-enables checksum computation
and prints warnings when checksums do not match, and
has a comment explaining why.

&gt;The checksum should just be an 8-bit sum.
&gt;Nothing magical.  Not exactly a good checksum
&gt;algorithm either.  I guess they thought nobody'd
&gt;get that wrong  :)

OK, I was doing the right checksum algorithm, at
least.  Now I feel better.  (Well, kind of; it is
not comfortable to know that we have to deal with
output from a compiler that can't even get checksums
correct...)

&gt;I find myself often questioning the quality of
&gt;currently available ASL compilers.  Anyone out
&gt;there want to write or provide an open-source
&gt;compiler?  It probably wouldn't be too much work
&gt;and I know many people (hardware vendors,
&gt;ACPI4Linux, etc.) that would love to use it.

In particular, I suppose a compiler would help us
make ACPI work on hardware with broken or missing
ACPI implementations, and thus would kind of fit
within my overall mission of making ACPI a sufficient
replacement for APM ASAP.  Would we really be able
to make that kind of use of it?  What other use
would it be to us?

Don't let me get in anyone else's way if anyone
else is interested, though, and I'm not committing
to it.  I think that there is enough other work for
me to do now that is more directly applicable to my
main goal at the moment.  :-)

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/


diff -u --recursive pmtools.resource/acpidisasm/resource.c pmtools.checksum/acpidisasm/resource.c
--- pmtools.resource/acpidisasm/resource.c	Thu Apr 27 22:12:45 2000
+++ pmtools.checksum/acpidisasm/resource.c	Fri Apr 28 09:21:03 2000
@@ -22,15 +22,13 @@
 	char *buffer;
 	char *buffer_end;
 	u8 checksum;
-	int checksum_good;
 };
 #define buffer_size (c-&gt;buffer_end - c-&gt;buffer)
 
 static int
 consume_data(struct resource_context *c)
 {
-	// FIXME: calculate this correctly
-	//c-&gt;checksum += *(c-&gt;data);
+	c-&gt;checksum += *(c-&gt;data);
 	c-&gt;data++;
 	c-&gt;data_size--;
 	if (c-&gt;data_size &lt; 0)
@@ -314,8 +312,16 @@
 	if (length != 1) return -1;
 	if (consume_data(c) == -1) return -1;
 	// after consume_data, the checksum ought to be 0
-	if (c-&gt;checksum) return -1;
-	c-&gt;checksum_good = 1;
+	if (c-&gt;checksum)
+	{
+		// Unfortunately, nearly nobody gets the checksum right
+		// so we have to ignore it for purposes of validation.
+		// However, we can at least warn, and maybe some of the
+		// vendors/compilers will start to get it right...
+		if (resource_sprintf(c, "Bad checksum 0x%x, should be 0\n",
+				     c-&gt;checksum))
+			return -1;
+	}
 	return 0;
 }
 
@@ -778,7 +784,6 @@
 	c.buffer = buffer_start;
 	c.buffer_end = buffer_start + this_buffer_size;
 	c.checksum = 0;
-	c.checksum_good = 0;
 
 	if(op-&gt;opcode != AML_BYTELIST) return -1;
 	
@@ -799,8 +804,5 @@
 		}
 	}
 
-	if (c.checksum_good)
-		return c.buffer - buffer_start;
-	else
-		return 0;
+	return c.buffer - buffer_start;
 }

</body></email><email><emailId>20000502175631</emailId><senderName>Mojo Jojo</senderName><senderEmail>mojojojo@pacbell.net</senderEmail><timestampReceived>2000-05-02 17:56:31-0400</timestampReceived><subject>[Acpi] Toshiba Portege 3020 and ACPI (broken)</subject><body>

Hi,

I've been using my Portege happily with Linux 2.2 and 2.3
for the year since I got it.  It was a bit of work to get
APM/APMD to behave, and more to get USB to work even after
laptop suspend, but it all works with pre6 (though a new USB
suspend patch is desirable).

BUT:  ACPI isn't behaving at all.  After I got a pre6
kernel to boot (pci=biosirq needed to let SCI work, and
disabled the fpu irq by hand since SCI wanted IRQ 13), the
whole machine wedged when I started acpid (0425, current).

Couldn't type at the keyboard any more.  The power button
was ignored.  (Regardless of whether or not I enable the
'experimental' S1 support.)

All I could do was shut the laptop and wait about 15
seconds (MUCH more than APM needs), and then the machine
seemed to get clued in that it should try tp suspend.
Disk spin, mode LED flashes (faster than usual, I think).

Open laptop.  NOP.  Wait some more, just in case. NOP.

Will it listen to the power button now?  Yes.  Fat lot
of good though -- disk whir, LED flash off.  Keyboard
still dead.  Screen briefly shows a single underscore
cursor before going dark.  It appears that it chose to
interpret the power button as a powerdown request (fine),
but only after that strange suspend was done (not fine).

During that experiment, I'd saved 'acpid -d' output:

	acpid: started
	acpid: FACP loaded from /proc/sys/acpi/
	acpid: DSDT loaded from /proc/sys/acpi/
	acpid: S0 SLP_TYP (0x0000)
	acpid: S1 SLP_TYP (0x0100)
	acpid: S2 not supported
	acpid: S3 SLP_TYP (0x0300)
	acpid: S4 SLP_TYP (0x0500)
	acpid: S5 SLP_TYP (0x0500)
	acpid: P_BLK 1 @ 0x18b0:6
	acpid: power button pressed

And /var/log/messages reported various ACPI data:

	kernel: e820: 00010000 @ 04010000 (ACPI data)
	kernel: e820: 00000200 @ ffee6e00 (ACPI NVS)
	...
	ACPI: "TOSHIB" found at 0x000fa30
	...	
	kernel: ACPI C2 works
	kernel: ACPI C3 works
	...

The former agrees with what "acpidmp DST | acpianalyse"
says, except it also lists a processor and battery.
(In some run I was actually able to run 'acpictl' and
it didn't report a battery though.)

"pmtest" reports only PCMCIA (D0) and keyboard (D0).
That's pretty much all the info I seem able to turn up.


Suggestions on what's going on here?  Fixes?  This is unusable.

I can keep using APM, but ACPI is supposed to work too;
and it seems to behave in Win98. (Though one can rarely
tell what causes that to suicide!  :-)

- Dave

p.s. I notice the Portege 3015 has a partial bios entry
	on the project page ... the 3020 should be the
	same hardware with a faster CPU and perhaps other
	minor system updates.  So far as I can tell, the
	entry there matches what 'acpidmp FACP | acpitbl'
	says ... but the field labels don't match (and
	are in hex vs decimal) so it's	hard to be sure.

</body></email><email><emailId>20000502214152</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-05-02 21:41:52-0400</timestampReceived><subject>Re: [Acpi] Toshiba Portege 3020 and ACPI (broken)</subject><body>

--- Mojo Jojo &lt;mojojojo@pacbell.net&gt; wrote:

&gt; disabled the fpu irq by hand since SCI wanted IRQ
&gt; 13), the

Yes, I had heard Toshiba was using int 13 for ACPI's
SCI.  That was a poor choice and is going to at
least require a patch to arch/i386/kernel/i8259.c
and possibly a kernel build configure option.

&gt; I can keep using APM, but ACPI is supposed to work
&gt; too;

OK, remember, ACPI support on Linux is not complete.
Only power off, power button, and processor power
states (save power while system is idle) are
currently working fully.  I would not expect
suspend to work yet.

-Andy


__________________________________________________
Do You Yahoo!?
Send instant messages &amp; get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

</body></email><email><emailId>20000502110640</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-02 11:06:40-0400</timestampReceived><subject>[Acpi] Re: confusing code</subject><body>

I wrote:
&gt;Andy Henroid writes:
&gt;&gt;No, this is actually correct code.  If op is
&gt;&gt;NULL then acpi_sprint_op prints "&lt;NULL&gt;".
&gt;
&gt;Um, why would op ever be null?  It's a pointer to a structure,
&gt;not op-&gt;opcode, so this isn't a ZeroOp handling method.

I never got an answer to this.

Accordingly, I tried replacing printing &lt;NULL&gt; with *(int *)0 = 0;
as a canary and it never executed.  At least on my machine, this
code just isn't used.  And I still can't see any way it would be
used.  Why would you try to print a NULL pointer as an AML tree?
I don't see that the disassembler ever tries to do that.

I still think this is meaningless code and the entire function
could have one level less of indentation and therefore be eaiser
to read if

if (op) {
	while (op) {
		...
	}
} else {
	...
}

were changed to

while (op) {
	...
}

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000502211844</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-05-02 21:18:44-0400</timestampReceived><subject>Re: [Acpi] Re: confusing code</subject><body>

--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:
&gt; 
&gt; I wrote:
&gt; &gt;Andy Henroid writes:
&gt; &gt;&gt;No, this is actually correct code.  If op is
&gt; &gt;&gt;NULL then acpi_sprint_op prints "&lt;NULL&gt;".
&gt; &gt;
&gt; &gt;Um, why would op ever be null?  It's a pointer to a
&gt; structure,
&gt; &gt;not op-&gt;opcode, so this isn't a ZeroOp handling
&gt; method.
&gt; 
&gt; I never got an answer to this.
&gt; 
&gt; Accordingly, I tried replacing printing &lt;NULL&gt; with
&gt; *(int *)0 = 0;
&gt; as a canary and it never executed.  At least on my
&gt; machine, this
&gt; code just isn't used.  And I still can't see any way
&gt; it would be
&gt; used.  Why would you try to print a NULL pointer as
&gt; an AML tree?
&gt; I don't see that the disassembler ever tries to do
&gt; that.

Yes, the only way you would hit that code is if
you called acpi_sprint_op directly with a NULL
acpi_op.  Right, acpi_show is not going to hit
it.

I doesn't really matter to me either way.  You
are welcome to make that change and send me a
patch.

-Andy


__________________________________________________
Do You Yahoo!?
Send instant messages &amp; get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

</body></email><email><emailId>20000429160243</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-29 16:02:43-0400</timestampReceived><subject>[Acpi] Re: _HID query and patch</subject><body>

Takanori Watanabe writes:
&gt;Should'nt it be treated as 0x0000d041?(PNP0000).

OK, that makes sense.  It just makes my job a little harder.  I'll
have to think about the cleanest way to handle those other cases.

&gt;&gt;I notice that plenty of the EISA IDs are ???d041 on this machine.

Aha, PNPfoo.

&gt;&gt;I also notice some HIDs with non-ascii characters; particularly
&gt;&gt;nulls, which show up as @'s when decoded:
&gt;&gt;
&gt;&gt;000008c2:   Device MEM_ (\_SB_.MEM_)
&gt;&gt;000008ca:     Name _HID (\_SB_.MEM_._HID)
&gt;&gt;000008cf:       @HLd041 (0x010cd041)
&gt;&gt;                               
&gt;
&gt;PNP0C01: System Board resource.
&gt;You probably caught in endian problem.

I guess so.  I interpreted the number as I understood the spec to
have it done, but I guess I misunderstood.  That will be trivial
to fix.

Thanks!

Now it's quite clear that it *is* important to print out these PnP
IDs when we can; it's quite easy to screw up, as I have demonstrated.

Andy, I'll fix this and send out a new patch that supercedes the
one I just sent.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000509120303</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-09 12:03:03-0400</timestampReceived><subject>[Acpi] acpictl suggestion</subject><body>

We need a good way for programs to be able to query acpid for
information and to set policies.  I've been thinking about one
way to do it that will be reasonably possible to secure.

acpid basically has to run as root, and we want most of this
functionality to be available to users (for example, querying
battery life).  This means that we need to sanitize the requests
to avoid acpid being a security hole.

My suggested architecture is that acpictl be the audited,
secure middleman between users and acpid.  acpictl can be setuid
or perhaps (on systems such as Red Hat Linux that support it)
managed via consolehelper.  It could also use PAM directly to
authenticate on systems that support it.  There are many options
here...  In any case, it can have a configuration file that defines
what normal users are allowed to do: for example, are they allowed
to set policy or only to query values?  I imagine that some people
will want to set policies as normal users, and other people will
want just as strongly for normal users not to be allowed to set
policies.  Depends on the context.

acpictl would have two modes of operation.  One would be a
fairly normal mode where it takes some command-line arguments,
does something about them, and exits.  In the other mode,
chosen by some command-line argument or by argv[0] or both,
it would open a pipe to apcid and then drop extra privileges.
It would then read textual commands from stdin, sanitize the
requests according to site policy, pass the sanitized
requests along to acpid, read results, and pass them back
in textual form on stdout.  This would be all be done
asynchronously, I expect, unless that will put too great
a burden on acpid.

I'm going to start working on this now, but if anyone has
any better ideas or improvements to this one, feel free to
propose them.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000429160745</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-29 16:07:45-0400</timestampReceived><subject>[Acpi] Re: _HID query and patch</subject><body>

"Yuki Ogawa" writes:
&gt;You should notice that any XXX0000 PnP ID which will be compliled into WORD.

OK, but there is no possibility of any PnP ID being compiled into a BYTE,
because at least two bytes will be taken up with three non-null characters,
correct?

&gt;Also, recently sometime PnP ID is expressed as string. like "ACPI0003" or "*PNP0700".
&gt;So, your condition blanch for _HID/_CID should treat DWORD, WORD, and StringPrefix.

There's no need to handle strings explicitly -- they are already in string
form and do not need to be decoded.  I'm just working on the disassembler,
not the interpreter.

However, I was ignoring _CID objects before, I'll add them.

&gt;Following code fragment may converts a Packed ID in a byte stream to PnPID.

Well, the convert_endian function that you don't include is the only
thing that really differs in anything but style from the code I already
wrote.  :-)

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000429164419</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-29 16:44:19-0400</timestampReceived><subject>[Acpi] Re: _HID query and patch</subject><body>

"Michael K. Johnson" writes:
&gt;Takanori Watanabe writes:
&gt;&gt;You probably caught in endian problem.
&gt;
&gt;I guess so.  I interpreted the number as I understood the spec to
&gt;have it done, but I guess I misunderstood.  That will be trivial
&gt;to fix.

Andy, should the disassembler be dealing with this at a lower level?

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000501191337</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-05-01 19:13:37-0400</timestampReceived><subject>Re: [Acpi] Re: _HID query and patch</subject><body>

--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:
&gt; 
&gt; "Michael K. Johnson" writes:
&gt; &gt;Takanori Watanabe writes:
&gt; &gt;&gt;You probably caught in endian problem.
&gt; &gt;
&gt; &gt;I guess so.  I interpreted the number as I
&gt; understood the spec to
&gt; &gt;have it done, but I guess I misunderstood.  That
&gt; will be trivial
&gt; &gt;to fix.
&gt; 
&gt; Andy, should the disassembler be dealing with this
&gt; at a lower level?

I think the best you can do is look for a named
object called _HID or _CID and then, if the
value is an integer, try the conversion to a
PNP string.  I don't think any lower level
work is going to help.  There is no additional
information we would have at parse time.

-Andy


__________________________________________________
Do You Yahoo!?
Send instant messages &amp; get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

</body></email><email><emailId>20000501194656</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-05-01 19:46:56-0400</timestampReceived><subject>Re: [Acpi] Re: _HID query and patch</subject><body>

--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:
&gt; 
&gt; This one seems to work.  I'm still not sure about
&gt; the endianness of
&gt; numbers as read in by parse.c -- I did all my
&gt; assembly training on
&gt; m68k machines and so get easily confused by
&gt; little-endian machines
&gt; -- but this patch doesn't break anything and does
&gt; seem to decode
&gt; all my non-method _HID objects correctly (I have no
&gt; _CID objects
&gt; on this machine).

OK, looks good and works correctly for me.  The
results are available now from

 
http://www.geocities.com/SiliconValley/Hardware/3165/

Let me know if I missed anything.

Also, if anyone hasn't seen this, there is a document
that lists many of the standard device IDs at

http://www.microsoft.com/hwdev/download/respec/devids.txt

-Andy


__________________________________________________
Do You Yahoo!?
Send instant messages &amp; get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

</body></email><email><emailId>20000502113838</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-02 11:38:38-0400</timestampReceived><subject>[Acpi] Re: _HID query and patch</subject><body>

Andy Henroid writes:
&gt;--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:
&gt;&gt; Andy, should the disassembler be dealing with this
&gt;&gt; at a lower level?
&gt;
&gt;I think the best you can do is look for a named
&gt;object called _HID or _CID and then, if the
&gt;value is an integer, try the conversion to a
&gt;PNP string.  I don't think any lower level
&gt;work is going to help.  There is no additional
&gt;information we would have at parse time.

What I meant was, is the disassembler reading
the integers in the correct endianness?  I mean,
is op-&gt;value.integer endian-correct?  If I read
the PnP BIOS specification correctly, it seems that
my endianness correction shouldn't have to happen.
But, as I said, I'm used to big endian low-level
work, so I could be mistaken.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000502191350</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-02 19:13:50-0400</timestampReceived><subject>[Acpi] Re: _HID query and patch</subject><body>

Andy Henroid writes:
&gt;http://www.geocities.com/SiliconValley/Hardware/3165/
&gt;
&gt;Let me know if I missed anything.

I probably forgot to send this, but here's a patch that adds
back checksum calculation and warns about bad checksums
without using the checksum as a heuristic.

&gt;Also, if anyone hasn't seen this, there is a document
&gt;that lists many of the standard device IDs at
&gt;
&gt;http://www.microsoft.com/hwdev/download/respec/devids.txt

Thanks!

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

diff -u --recursive pmtools-050100/acpidisasm/resource.c pmtools.eisaid/acpidisasm/resource.c
--- pmtools-050100/acpidisasm/resource.c	Thu Apr 27 22:00:32 2000
+++ pmtools.eisaid/acpidisasm/resource.c	Fri Apr 28 11:26:24 2000
@@ -22,15 +22,13 @@
 	char *buffer;
 	char *buffer_end;
 	u8 checksum;
-	int checksum_good;
 };
 #define buffer_size (c-&gt;buffer_end - c-&gt;buffer)
 
 static int
 consume_data(struct resource_context *c)
 {
-	// FIXME: calculate this correctly
-	//c-&gt;checksum += *(c-&gt;data);
+	c-&gt;checksum += *(c-&gt;data);
 	c-&gt;data++;
 	c-&gt;data_size--;
 	if (c-&gt;data_size &lt; 0)
@@ -314,8 +312,16 @@
 	if (length != 1) return -1;
 	if (consume_data(c) == -1) return -1;
 	// after consume_data, the checksum ought to be 0
-	if (c-&gt;checksum) return -1;
-	c-&gt;checksum_good = 1;
+	if (c-&gt;checksum)
+	{
+		// Unfortunately, nearly nobody gets the checksum right
+		// so we have to ignore it for purposes of validation.
+		// However, we can at least warn, and maybe some of the
+		// vendors/compilers will start to get it right...
+		if (resource_sprintf(c, "Bad checksum 0x%x, should be 0\n",
+				     c-&gt;checksum))
+			return -1;
+	}
 	return 0;
 }
 
@@ -778,7 +784,6 @@
 	c.buffer = buffer_start;
 	c.buffer_end = buffer_start + this_buffer_size;
 	c.checksum = 0;
-	c.checksum_good = 0;
 
 	if(op-&gt;opcode != AML_BYTELIST) return -1;
 	
@@ -799,8 +804,5 @@
 		}
 	}
 
-	if (c.checksum_good)
-		return c.buffer - buffer_start;
-	else
-		return 0;
+	return c.buffer - buffer_start;
 }

</body></email><email><emailId>20000503172758</emailId><senderName>"Yuki Ogawa"</senderName><senderEmail>y-ogawa@dvpj.sony.co.jp</senderEmail><timestampReceived>2000-05-03 17:27:58-0400</timestampReceived><subject>Re: [Acpi] Re: _HID query and patch</subject><body>

AML uses little endian. (5.2, 15.2.2)

and I forgot to say that _CID can be a package that contains 
a list of Compatible IDs.


----- Original Message ----- 
From: "Michael K. Johnson" &lt;johnsonm@redhat.com&gt;
To: &lt;acpi@phobos.fachschaften.tu-muenchen.de&gt;
Sent: Tuesday, May 02, 2000 8:38 PM
Subject: [Acpi] Re: _HID query and patch


&gt; 
&gt; Andy Henroid writes:
&gt; &gt;--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:
&gt; &gt;&gt; Andy, should the disassembler be dealing with this
&gt; &gt;&gt; at a lower level?
&gt; &gt;
&gt; &gt;I think the best you can do is look for a named
&gt; &gt;object called _HID or _CID and then, if the
&gt; &gt;value is an integer, try the conversion to a
&gt; &gt;PNP string.  I don't think any lower level
&gt; &gt;work is going to help.  There is no additional
&gt; &gt;information we would have at parse time.
&gt; 
&gt; What I meant was, is the disassembler reading
&gt; the integers in the correct endianness?  I mean,
&gt; is op-&gt;value.integer endian-correct?  If I read
&gt; the PnP BIOS specification correctly, it seems that
&gt; my endianness correction shouldn't have to happen.
&gt; But, as I said, I'm used to big endian low-level
&gt; work, so I could be mistaken.
&gt; 
&gt; michaelkjohnson
&gt; 
&gt; "Magazines all too frequently lead to books and should be regarded by the
&gt;  prudent as the heavy petting of literature."            -- Fran Lebowitz
&gt;  Linux Application Development     http://people.redhat.com/johnsonm/lad/
&gt; 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; 

</body></email><email><emailId>20000503175237</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-03 17:52:37-0400</timestampReceived><subject>[Acpi] Re: _HID query and patch</subject><body>

"Yuki Ogawa" writes:
&gt;AML uses little endian. (5.2, 15.2.2)

Yes, I know.  But I thought that PnP identifiers do too.  Which
is why it confuses me that I need to swap endianness to read
PnP identifiers.

&gt;and I forgot to say that _CID can be a package that contains 
&gt;a list of Compatible IDs.

Well, someone remembered, and so my patch explicitly looks
for it.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000504022937</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-05-04 02:29:37-0400</timestampReceived><subject>Re: [Acpi] Re: _HID query and patch</subject><body>

--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:

&gt; I probably forgot to send this, but here's a patch
&gt; that adds
&gt; back checksum calculation and warns about bad
&gt; checksums
&gt; without using the checksum as a heuristic.

OK, latest two patches applied and the results
available from

 
http://www.geocities.com/SiliconValley/Hardware/3165/

If you can, I'd prefer patches be sent as mail
attachments in the future.  My mail reader
(netscape) munges tabs and space when patches
are just appended.

Thanks,
Andy


__________________________________________________
Do You Yahoo!?
Send instant messages &amp; get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

</body></email><email><emailId>20000504084819</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-04 08:48:19-0400</timestampReceived><subject>[Acpi] Re: _HID query and patch</subject><body>

Andy Henroid writes:
&gt;OK, latest two patches applied and the results

Thanks!

&gt;If you can, I'd prefer patches be sent as mail
&gt;attachments in the future.  My mail reader
&gt;(netscape) munges tabs and space when patches
&gt;are just appended.

No problem, I'll do that.  Sorry to have caused
trouble, didn't know.  You might want to put a
notice to that effect at your download page and
in the README files so that future potential
contributors know.

Do you know about patch's "-l" option?  It will
make it easier to apply whitespace-mangled patches.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000428083430</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-28 08:34:30-0400</timestampReceived><subject>[Acpi] Re: PnP resource printing patch</subject><body>

Regarding writing a compiler, one of the important things that is
missing from the ACPI specification is the encoding of an EISAID.
They expected everyone who read the standard to know that as a
matter of course.  :-)

Here's an excerpt from the PnP BIOS specification, converted into
ASCII format, that describes how to construct an EISAID from an
EISAIDString.

[begin excerpt]
Device product identifier:

This field is an EISA ID, which is a seven character ASCII representation
of the product identifier compressed into a 32-bit identifier. The
seven character ID consists of a three character manufacturer code,
a three character hexadecimal product identifier, and a one character
hexadecimal revision number. For example, the third revision of the ABC
device might have an uncompressed ID such as ABC1003.

The manufacturer code is a 3 uppercase character code that is compressed
into 3 5-bit values as follows:
 1. Find hex ASCII value for each letter
 2. Subtract 40h from each ASCII value
 3. Retain 5 least-significant bits for each letter by discarding upper
    3-bits because they are always 0.
 4. Compressed code = Concatenate 0 and the 3 5-bit values for the character.

The format of the compressed product identifier is as follows:
Byte	Bits		Description
0	Bit 7:		Reserved (0)
	Bits 6-2:	1st character of the compressed manufacturer code
	Bits 1-0:	Upper 2 bits of the 2nd character of the compressed
			manufacturer code
1	Bits 7-5:	Lower 3 bits of the 2nd character of the compressed
			manufacturer code. 
	Bits 4-0:	3rd character of the compressed manufacturer code.
			(bit 4 is most significant)
2	Bits 7-4:	1st hexadecimal digit of the product number.
			(bit 7 is most significant)
	Bits 3-0:	2nd hexadecimal digit of the product number.
			(bit 3 is most significant)
3	Bits 7-4:	3rd hexadecimal digit of the product number
			(bit 7 is most significant)
	Bits 3-0:	Hexadecimal digit for the revision number.
			(bit 3 is most significant)
[end excerpt]

So ABC1003 would be encoded as 0x04431003, if I used bc correctly...

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000428193906</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-28 19:39:06-0400</timestampReceived><subject>Re: [Acpi] Re: PnP resource printing patch</subject><body>

--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:

&gt; In particular, I suppose a compiler would help us
&gt; make ACPI work on hardware with broken or missing
&gt; ACPI implementations, and thus would kind of fit
&gt; within my overall mission of making ACPI a
&gt; sufficient replacement for APM ASAP.  Would we
&gt; really be able
&gt; to make that kind of use of it?  What other use
&gt; would it be to us?

No, I think using the compiler to fix broken or
missing ACPI implementations is entirely the wrong
idea.  We should push hardware/BIOS vendors to
ensure that their tables are correct.  With growing
Linux momentum, I believe it should be quite
possible for us to say "Hey, your ACPI is broken
and will not work with Linux" and actually see a
timely response.  For example, see AMI...

The value in an open-source compiler would be to
get vendors to generate the correct AML in the
first place.  Add plenty of warnings, don't let
them get away with all of the wrong code that
the MS compiler passes right through.  Also, an
open source compiler would allow people working
on the interpreter and OS side to understand
exactly what AML is going to be generated from
said ASL.

An open-source compiler could very well become
a good reference compiler from which we could
generate feedback for those working on the ACPI
spec.  All of this closed spec work is definitely
in need of something along the lines of the
IETF, sample implementation before spec completion.

&gt; Don't let me get in anyone else's way if anyone
&gt; else is interested, though, and I'm not committing
&gt; to it.  I think that there is enough other work for
&gt; me to do now that is more directly applicable to my
&gt; main goal at the moment.  :-)

Yes, getting the ACPI implementation up to the level
of APM should really be the highest priority.  I
just mentioned the compiler idea if anyone out there
has some spare cycles and would like to see the
product of their labor in wide use across the
computer industry.

-Andy


__________________________________________________
Do You Yahoo!?
Talk to your friends online and get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

</body></email><email><emailId>20000502014657</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-05-02 01:46:57-0400</timestampReceived><subject>Re: [Acpi] Re: PnP resource printing patch</subject><body>

--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:

&gt; There are much, much more serious problems
&gt; here than lack of a free compiler.  Lack of
&gt; commitment to truly open standards on the
&gt; part of the three main sponsors of the ACPI
&gt; standard is a key problem.  I mean, there
&gt; are wonderful people like Andy at all three
&gt; companies who really understand this, but
&gt; they are clearly not high enough up the
&gt; corporate ladder to set policy for the ACPI
&gt; standard.

Hey, I agree.  Closed spec work is inherently
troubling.  And for PC technologies like ACPI that
will affect so many Linux users, it is unfortunate
that Linux developers have very little opportunity
to participate in shaping the spec.  As always,
Linux development is relegated to "here is the
hardware, here is the interface, work with it."

I do understand the other side of the argument
though.  Spec work by a closed consortium of
companies allows specs to be completed and
product released fast.  And, right or wrong,
closed spec work allows companies to feel like
they are protecting hardware interfaces and
other things they consider to be intellectual
property.

So, yes, that's the way things are and it's
going to be hard to reshape that environment
to allow participation of the Linux community.
But I do think companies are starting to realize
that there is a growing and vigilant Linux
community out there and they are beginning to
take heed of feedback.  After all, with so
much attention currently focussing on Linux,
who is willing to have their hardware designed
out?

-Andy


__________________________________________________
Do You Yahoo!?
Send instant messages &amp; get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

</body></email><email><emailId>20000403164058</emailId><senderName>Dvir Oren</senderName><senderEmail>dviro@lucidvon.com</senderEmail><timestampReceived>2000-04-03 16:40:58-0400</timestampReceived><subject>[Acpi] VIAVP4</subject><body>

When I load acpid, it reports that no sleep state is supported.  The
kernel reports a VIAVP4 bios.  Why is it not supported?

-- 
Dvir Oren               &lt;dviro@lucidvon.com&gt;
Lucid VON Ltd.     &lt;http://www.lucidvon.com&gt;
9 Saloniki St.,        Tel-Aviv       Israel
Tel:  +972 3 644 3038  Fax:  +972 3 644 3039

</body></email><email><emailId>20000404234123</emailId><senderName>Dieter =?iso-8859-1?Q?N=FCtzel?=</senderName><senderEmail>dieter.nuetzel@myokay.net</senderEmail><timestampReceived>2000-04-04 23:41:23-0400</timestampReceived><subject>[Acpi] Re: ACPI problems? YES, with IDE/eepro100 on Athlon SOLVED (half way)!!!</subject><body>


Dieter NÃ¼tzel wrote:

&gt; Andy Henroid wrote:
&gt;
&gt; &gt; --- Dieter NÃ¼tzel &lt;dieter.nuetzel@myokay.net&gt; wrote:
&gt; &gt;
&gt; &gt; &gt; If I have ACPI and eepro100 compiled into the kernel
&gt; &gt; &gt; the system hangs during process spans. Eepro100
&gt; &gt; &gt; compiled in, all other as modules or all as
&gt; &gt; &gt; modules system start up and runs with eepro100
&gt; &gt; &gt; (autoloading of eepro100.o in the second case.
&gt; &gt; &gt;
&gt; &gt; &gt; But when I will load the acpi.o modules trouble
&gt; &gt; &gt; begins. Same when I or the system would load the
&gt; &gt; &gt; IDE modules for the second time (!!!)...
&gt; &gt;
&gt; &gt; I see at least two bugs that are mine but I don't
&gt; &gt; think that they explain the majority of your
&gt; &gt; problems.
&gt; &gt;
&gt; &gt; #1  The ACPI driver loads, finds your RSDT in
&gt; &gt;     unreserved RAM (bad, BIOS E820 or the E820
&gt; &gt;     handling code isn't doing the right thing),
&gt; &gt;     fails, and probably falls back to a chipset
&gt; &gt;     specific driver.  This is bad and the ACPI
&gt; &gt;     driver should just quit if any of you ACPI
&gt; &gt;     tables are messed up.
&gt; &gt;
&gt; &gt; #2  I see you are building in APM support.  APM
&gt; &gt;     checks for ACPI before loading but ACPI doesn't
&gt; &gt;     check for APM when it is loaded as a module.
&gt; &gt;     As a result, both are up and running at the
&gt; &gt;     same time.  This is bad and I should prevent it.
&gt; &gt;
&gt; &gt; I don't not know where the crash on insmod of
&gt; &gt; acpi.o is coming from.  From the lsmod, the ACPI
&gt; &gt; driver must have crashed on init starting the
&gt; &gt; chipset-specific driver.  For the moment, you
&gt; &gt; might want to add "acpi=tables" to your kernel
&gt; &gt; command line and see if that stops the crash.
&gt; &gt;
&gt; &gt; I send out fixes for #1 and #2 shortly.  I'm
&gt; &gt; afraid neither of these are the root cause of
&gt; &gt; your problems though.
&gt; &gt;
&gt; &gt; Thanks for the thorough bug report.
&gt; &gt;
&gt; &gt; -Andy

No problem!

Now here are my latest results.

2.3.99-pre4-3 together with acpi_patch-2.3.99-3 (Yep, has some shm bugs
(X)...:-)

I think it has something to-do with the memory detection routine (the "new"
E820 stuff?).
After I figured out that I should try booting without the "append =
"mem=256M"" line in lilo.conf I didn't get anymore hangs with eepro100 and
ACPI !!!
But most tools show "only" 255MB RAM?

SunWave1&gt;free
             total       used       free     shared    buffers     cached
Mem:        255484     219548      35936          0       8988     145408
-/+ buffers/cache:      65152     190332
Swap:       200772      26304     174468

SunWave1&gt;free -t
             total       used       free     shared    buffers     cached
Mem:        255484     220420      35064          0       8988     145408
-/+ buffers/cache:      66024     189460
Swap:       200772      26304     174468
Total:      456256     246724     209532

SunWave1&gt;linuxinfo
Linux SunWave1 2.3.99-pre4 #1 Tue Apr 4 23:48:05 CET 2000
One AMD  548MHz processor, 1094.45 total bogomips, 255M RAM
System library 2.1.3

SunWave1&gt;linux_logo -c -n


                        LL     IIIIII NN   NN UU  UU XX  XX
                        LL       II   NNN  NN UU  UU  XXXX
                        LL       II   NNNN NN UU  UU   XX
                        LL       II   NN NNNN UU  UU  XXXX
         `----'         LLLLLL IIIIII NN   NN  UUUU  XX  XX

                        Linux Version 2.3.99-pre4
                        Compiled #1 Tue Apr 4 23:48:05 CET 2000
                        One 550MHz AMD Athlon Processor, 255M RAM
                        1094.45 Bogomips Total
                        SunWave1

SunWave1&gt;cat /proc/meminfo
        total:    used:    free:  shared: buffers:  cached:
Mem:  261615616 226217984 35397632        0  9203712 158162944
Swap: 205590528 26902528 178688000
MemTotal:    255484 kB
MemFree:      34568 kB
MemShared:        0 kB
Buffers:       8988 kB
Cached:      154456 kB
HighTotal:        0 kB
HighFree:         0 kB
LowTotal:    255484 kB
LowFree:      34568 kB
SwapTotal:   200772 kB
SwapFree:    174500 kB

SunWave1&gt;cat /proc/iomem
00000000-0009efff : System RAM
000a0000-000bffff : Video RAM area
000c0000-000c7fff : Video ROM
000cc000-000d07ff : Extension ROM
000f0000-000fffff : System ROM
00100000-0ffeffff : System RAM
  00100000-0020eb9f : Kernel code
  0020eba0-00221c73 : Kernel data
c0000000-cfffffff : Advanced Micro Devices [AMD] AMD-751 [Irongate] System
Controller
d8000000-dbffffff : PCI Bus #01
  d8000000-d9ffffff : 3Dfx Interactive, Inc. Voodoo 3
dc000000-ddffffff : PCI Bus #01
  dc000000-ddffffff : 3Dfx Interactive, Inc. Voodoo 3
e0000000-e00fffff : Intel Corporation 82557 [Ethernet Pro 100]
e0100000-e0100fff : Advanced Micro Devices [AMD] AMD-751 [Irongate] System
Controller
e0101000-e0101fff : Advanced Micro Devices [AMD] AMD-756 [Viper] USB
e0102000-e0102fff : Adaptec AIC-7881U
e0103000-e0103fff : Intel Corporation 82557 [Ethernet Pro 100]
  e0103000-e0103fff : eepro100

SunWave1&gt;cat /proc/ioports
0000-001f : dma1
0020-003f : pic1
0040-005f : timer
0060-006f : keyboard
0070-007f : rtc
0080-008f : dma page reg
00a0-00bf : pic2
00c0-00df : dma2
00f0-00ff : fpu
0220-022f : soundblaster
02f8-02ff : serial(auto)
0330-0333 : MPU-401 UART
03c0-03df : vga+
03f8-03ff : serial(auto)
5000-5003 : acpi
5008-500b : acpi
5020-5023 : acpi
50f0-50f1 : acpi
d000-dfff : PCI Bus #01
  d000-d0ff : 3Dfx Interactive, Inc. Voodoo 3
e000-e003 : Advanced Micro Devices [AMD] AMD-751 [Irongate] System Controller
e400-e41f : Intel Corporation 82557 [Ethernet Pro 100]
  e400-e41f : eepro100
e800-e8ff : Adaptec AIC-7881U
  e800-e8be : aic7xxx
f000-f00f : Advanced Micro Devices [AMD] AMD-756 [Viper] IDE

So it works so far but poweroff (halt -p, etc.) didn't work :-(

SunWave1&gt;./acpid -d
acpid: started
acpid: FACP loaded from /proc/sys/acpi/
acpid: DSDT loaded from /proc/sys/acpi/
acpid: S0 not supported
acpid: S1 not supported
acpid: S2 not supported
acpid: S3 not supported
acpid: S4 not supported
acpid: S5 not supported
acpid: no processor block

SunWave1&gt;./acpidmp FACP | ./acpitbl
Signature:        FACP
Length:           116
Revision:         0x01
Checksum:         0x68
OEMID:            AWARD
OEM Table ID:     AWRDACPI
OEM Revision:     0x30302e31
Creator ID:       AWRD
Creator Revision: 0x00000000
FIRMWARE_CTRL:    0x0fff0000
DSDT:             0x0fff30c0
INT_MODEL:        0x00
SCI_INT:          9
SMI_CMD:          0x0000502f
ACPI_ENABLE:      0xa1
ACPI_DISABLE:     0xa0
S4BIOS_REQ:       0xa4
PM1a_EVT_BLK:     0x00005000
PM1b_EVT_BLK:     0x00000000
PM1a_CNT_BLK:     0x000050f0
PM1b_CNT_BLK:     0x00000000
PM2_CNT_BLK:      0x00000000
PM_TMR_BLK:       0x00005008
GPE0_BLK:         0x00005020
GPE1_BLK:         0x00000000
PM1_EVT_LEN:      4
PM1_CNT_LEN:      2
PM2_CNT_LEN:      0
PM_TM_LEN:        4
GPE0_BLK_LEN:     4
GPE1_BLK_LEN:     0
GPE1_BASE:        0
P_LVL2_LAT:       90
P_LVL3_LAT:       900
FLUSH_SIZE:       0
FLUSH_STRIDE:     0
DUTY_OFFSET:      1
DUTY_WIDTH:       1
DAY_ALRM:         0x7d
MON_ALRM:         0x7e
CENTURY:          0x00
Flags:            0x00000000

Do you need more? Please ask.

-Dieter

PS Have anyone of you some hints how I should setup the latest AWE32 (no PNP)
stuff (modules.conf)?

--
Dieter NÃ¼tzel
Graduate Student, Computer Science

University of Hamburg
Department of Computer Science
Cognitive Systems Group
Vogt-KÃ¶lln-StraÃe 30
D-22527 Hamburg, Germany

email: nuetzel@kogs.informatik.uni-hamburg.de
@home: dieter.nuetzel@myokay.net



["acpidisasm.log.bz2" (application/octet-stream)]
["acpidmp.log.bz2" (application/octet-stream)]

</body></email><email><emailId>20000405202718</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-05 20:27:18-0400</timestampReceived><subject>Re: [Acpi] 2.3.99-pre4-2 no go with Abit BP6</subject><body>

--- Crispin Flowerday &lt;cehf2@cam.ac.uk&gt; wrote:
&gt; ditto with me with ABIT BH6,
&gt; 
&gt; however if I
&gt; 
&gt; echo 1 &gt; /proc/sys/acpi/s5_[whatever]
&gt; 
&gt; then it turns off on shutdown. My dsdt | acpidisasm
&gt; is pretty much the same,
&gt; however I will ens it if you need it Andy?

Yes, while acpid is broken, you can fill in the
/proc/sys/acpi/s5_slp_typ value by hand to get
S5 working if (if your system supports S5 and S5
actually works)

Look in the output of "acpidmp DSDT | acpidisasm"
for a _S5_ entry

  Name _S5_
   Package
     0x04
     0x01
     0x02
     0x00
     0x00

For the above _S5_ entry, you would then do

  echo 0x12 &gt; /proc/sys/acpi/s5_slp_typ
         ^^
         |+- from 3rd byte of S5 package (SLP_TYP_B)
         +- from 2nd byte of S5 package (SLP_TYP_A)

Messy but acpid usually takes care of this for you.

-Andy


__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000405203938</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-05 20:39:38-0400</timestampReceived><subject>Re: [Acpi] Help please</subject><body>

--- Dvir Oren &lt;dviro@lucidvon.com&gt; wrote:
&gt; When I run acpid -d I get:
&gt; ...
&gt; S1 not supported.
&gt; ...
&gt; S5 not supported.
&gt; 
&gt; Why are they not supported?
&gt; The kernel reports a VIAVP4 bios.

This is probably due to the acpid parsing bug.
A fix is in progress.

Remember, though, that just because your system
supports ACPI doesn't mean it necessarily supports
*all* ACPI features (eg. C2, C3, S1, S5, etc.)
The only way to know for sure is to check out
the contents of your ACPI tables.

&gt; Also, why does ACPI break the apm power off?

To have APM power off on most systems, you need
to engage the APM BIOS.  This is not possible
when ACPI is enabled.  Like I've been saying,
ACPI and APM, you only get one or the other.

-Andy



__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000413155235</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-13 15:52:35-0400</timestampReceived><subject>Re: [Acpi] ACPI4Linux get started</subject><body>

--- Yung-Hsiang Lu &lt;luyung@stanford.edu&gt; wrote:
&gt; Hi,
&gt; 
&gt; Sorry for the wide distribution.  Is there a
&gt; newsgroup to post questions 
&gt; for this project, instead of a mailing list?

No, there is no newsgroup.  Traffic on this
mailing list is low enough that it is not a
problem.

&gt; to be done first.  I got this message:
&gt; 
&gt; acpid: ACPI is not present

You need to build a Linux kernel with ACPI support
(Linux 2.3.x only)  Then, run acpid as you are.

&gt; It is probably generated while checking ACPI_PROC
&gt; (#define 
&gt; "/proc/sys/acpi").  Who should create it?

Right, the ACPI driver in the kernel generates
the /proc/sys/acpi entry.

-Andy


__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com

</body></email><email><emailId>20000414181003</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-14 18:10:03-0400</timestampReceived><subject>Re: [Acpi] \_OS_ and _REV Object</subject><body>

--- Yuki Ogawa &lt;y-ogawa@dvpj.sony.co.jp&gt; wrote:
&gt; My small requests are 
&gt; 
&gt; - _OS contains string "Linux" at the top as in
&gt; current design.
&gt;     And should not change.  Then BIOS can clearly
&gt; and easily identiy Linux.  
&gt;     If you make variations like "Linux", "LINUX OS",
&gt; "RedHat LINUX", and so on...,

OK, "Linux" it is.  So, I wonder what ASL developers
are planning to use the value of _OS for?  Hopefully
nothing too complex.  It would be nice for the AML
to work the same under every OS.  Right?

&gt; - Please don't change these strategy.
&gt;     If you change both _OS and _REV frequently, ASL
&gt; conditions will be quite complex.
&gt;     BIOS developpers need extra works and No
&gt; benefits for all end users.

Right, _OS will be fixed from here on.  _REV will
move slowly forward, only based on significant
interpreter changes.

-Andy


__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com

</body></email><email><emailId>20000414182121</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-14 18:21:21-0400</timestampReceived><subject>Re: [Acpi] ACPI kernel support (ACPI is not present)</subject><body>

--- Yung-Hsiang Lu &lt;luyung@stanford.edu&gt; wrote:

&gt; Tuesday).  The machine is Sony VAIO F-450 notebook
&gt; computer.  This is a 
&gt; very new machine (released this year) and I believe
&gt; it supports ACPI. I 
&gt; enabled ACPI while configuring kernel (during make
&gt; xconfig).  However, I 
&gt; still got

Hmm..  I don't know if the VAIO does fully support
ACPI or not.  I know older models don't have ACPI
tables.  I believe those have a PIIX4 chipset
so you should at least get some ACPI support.

Take a look at the kernel log (dmesg) and see if
you get any output from the ACPI driver.  Something
like

  ACPI: found PIIX4 at 0xXXXX

If your system doesn't have ACPI tables (sounds
like it doesn't) and isn't PIIX4 or VIA, then
you might not be supported.

-Andy



__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com

</body></email><email><emailId>20000414190845</emailId><senderName>Yung-Hsiang Lu</senderName><senderEmail>luyung@stanford.edu</senderEmail><timestampReceived>2000-04-14 19:08:45-0400</timestampReceived><subject>[Acpi] SONY F-450 supporting ACPI?</subject><body>

Hi,

Do you know what this means?

 &gt; grep PIIX /var/log/dmesg

PCI: Using IRQ router PIIX [8086/122e] at 00:07.0
PIIX4: IDE controller on PCI bus 00 dev 39
PIIX4: not 100% native mode: will probe irqs later

Before I bought this notebook computer, I asked Sony tech support and they 
told me it supports ACPI.  :-(  Do you know any notebook computer that 
supports ACPI for sure?

Thanks!

&gt;Hmm..  I don't know if the VAIO does fully support
&gt;ACPI or not.  I know older models don't have ACPI
&gt;tables.  I believe those have a PIIX4 chipset
&gt;so you should at least get some ACPI support.
&gt;
&gt;Take a look at the kernel log (dmesg) and see if
&gt;you get any output from the ACPI driver.  Something
&gt;like
&gt;
&gt;   ACPI: found PIIX4 at 0xXXXX
&gt;
&gt;If your system doesn't have ACPI tables (sounds
&gt;like it doesn't) and isn't PIIX4 or VIA, then
&gt;you might not be supported.
&gt;
&gt;-Andy


Yung-Hsiang Lu       luyung@stanford.edu     (650)725-3647
Electrical Engineering Dept. Stanford University
Gates 326, 353 Serra Mall, Stanford, CA 94305   

</body></email><email><emailId>20000414201050</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-14 20:10:50-0400</timestampReceived><subject>[Acpi] Re: SONY F-450 supporting ACPI?</subject><body>

--- Yung-Hsiang Lu &lt;luyung@stanford.edu&gt; wrote:
&gt; Hi,
&gt; 
&gt; Do you know what this means?
&gt; 
&gt;  &gt; grep PIIX /var/log/dmesg
&gt; 
&gt; PCI: Using IRQ router PIIX [8086/122e] at 00:07.0
&gt; PIIX4: IDE controller on PCI bus 00 dev 39
&gt; PIIX4: not 100% native mode: will probe irqs later

Well, it means you have a PIIX4 chipset which is
good.  At least you should have chipset support
for ACPI (gives you processor power states (C-states)
and ACPI events)

If you are building in ACPI support, the ACPI driver
will at least see you have PIIX4 and try to use that.

&gt; Before I bought this notebook computer, I asked Sony
&gt; tech support and they 
&gt; told me it supports ACPI.  :-(  Do you know any

Your notebook could very well be ACPI compliant
but probably isn't if it is not detected by the
ACPI driver (ie. missing ACPI tables) "Supports
ACPI", might be used somewhat ambiguously here.
Your chipset definitely supports some ACPI features
by virtue of it being PIIX4 but you also need
additional platform support to get higher ACPI
functionality (power off, suspend, battery support,
etc.)

&gt; notebook computer that 
&gt; supports ACPI for sure?

Sure, most notebooks now have ACPI support. Look
for something like "ACPI 1.0 compliant" in the
system description.

-Andy



__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com

</body></email><email><emailId>20000405092018</emailId><senderName>Dvir Oren</senderName><senderEmail>dviro@lucidvon.com</senderEmail><timestampReceived>2000-04-05 09:20:18-0400</timestampReceived><subject>[Acpi] Help please</subject><body>

When I run acpid -d I get:
...
S1 not supported.
...
S5 not supported.

Why are they not supported?
The kernel reports a VIAVP4 bios.

Also, why does ACPI break the apm power off?

-- 
Dvir Oren               &lt;dviro@lucidvon.com&gt;
Lucid VON Ltd.     &lt;http://www.lucidvon.com&gt;
9 Saloniki St.,        Tel-Aviv       Israel
Tel:  +972 3 644 3038  Fax:  +972 3 644 3039

</body></email><email><emailId>20000413045700</emailId><senderName>Yung-Hsiang Lu</senderName><senderEmail>luyung@stanford.edu</senderEmail><timestampReceived>2000-04-13 04:57:00-0400</timestampReceived><subject>[Acpi] ACPI4Linux get started</subject><body>

Hi,

Sorry for the wide distribution.  Is there a newsgroup to post questions 
for this project, instead of a mailing list?

I ftp acpid and pmtools from the web site.  I checked the mail archive but 
did not find enough information to get started.  I guess the first thing to 
do is to start acpi daemon by running

acpid/acpid

Is this correct?  It seems that something else needs to be done first.  I 
got this message:

acpid: ACPI is not present

It is probably generated while checking ACPI_PROC (#define 
"/proc/sys/acpi").  Who should create it?

Thanks for your help.

Yung-Hsiang Lu       luyung@stanford.edu     (650)725-3647
Electrical Engineering Dept. Stanford University
Gates 326, 353 Serra Mall, Stanford, CA 94305   

</body></email><email><emailId>20000413065018</emailId><senderName>"Yuki Ogawa"</senderName><senderEmail>y-ogawa@dvpj.sony.co.jp</senderEmail><timestampReceived>2000-04-13 06:50:18-0400</timestampReceived><subject>[Acpi] \_OS_ and _REV Object</subject><body>

Hi all,

Do you have a plan to change \_OS_ object defined by AML interpreter?

Currently, acpid has "Linux AML interpreter"(older one was just "AML interpreter")
as _OS which is very generic definition and will be used forever.
_REV is 2 which is likely to change.

Is this correct?


Thanks
++yuki

</body></email><email><emailId>20000414173514</emailId><senderName>Yung-Hsiang Lu</senderName><senderEmail>luyung@stanford.edu</senderEmail><timestampReceived>2000-04-14 17:35:14-0400</timestampReceived><subject>[Acpi] ACPI kernel support (ACPI is not present)</subject><body>

Hello,

I ftp and installed the latest linux kernel (2.3.99-pre5, released this 
Tuesday).  The machine is Sony VAIO F-450 notebook computer.  This is a 
very new machine (released this year) and I believe it supports ACPI. I 
enabled ACPI while configuring kernel (during make xconfig).  However, I 
still got

acpid: ACPI is not present

Specifically, /proc/sys/acpi was not created.

/var/log/messages says
e820: 0000fc00 @ 07ff0000 (ACPI data)
e820: 00000400 @ 07fffc00 (ACPI NVS)
......
ACPI: "SONY" found at 0x000f7160
ACPI: missing FACP

(Yes, I did reboot the machine :)  If you happen to know the answer, please 
let me know.  Thanks a lot!

Yung-Hsiang Lu       luyung@stanford.edu     (650)725-3647
Electrical Engineering Dept. Stanford University
Gates 326, 353 Serra Mall, Stanford, CA 94305   

</body></email><email><emailId>20000418134155</emailId><senderName>"Jeong Hwan Park"</senderName><senderEmail>jhpark@brainzsquare.com</senderEmail><timestampReceived>2000-04-18 13:41:55-0400</timestampReceived><subject>[Acpi] Is wake-on-lan possible after the system is powered off using ACPI?</subject><body>

I have a linux server which has dual PIII-550 and intel L440GX+ M/B built in intel 82559 ethernet controller.

I have installed 2.3.99-pre5 for ACPI.
I run the "acpid -d" in prompt.
I can shutdown the server and power off without pushing the power button.

Everything is ok but I can't wake the system with wake-on-lan.

When I use 2.2.14 kernel, I have no problem to wake up the system with wake-on-lan.

How can I catch two rabbits?



Best regards,

Jeong Hwan Park

BrainzSquare
http://www.brainzsquare.com
Tel. 82-42-823-9050
Fax. 82-42-823-9060

</body></email><email><emailId>20000418061920</emailId><senderName>Yung-Hsiang Lu</senderName><senderEmail>luyung@stanford.edu</senderEmail><timestampReceived>2000-04-18 06:19:20-0400</timestampReceived><subject>[Acpi] acpi/acpi fail</subject><body>

Hi,

Did anyone try acpi under the directory acpi to get the status of 
ACPI?  When I execute it, it says

acpi: Not implemented

However, acpi is indeed implemented and acpid is running.  I am running 
linux-2.3.99-pre5 with Andy's patch announced today on a Sony VAIO notebook 
computer (PCG-F450).

Thanks!

Yung-Hsiang Lu       luyung@stanford.edu     (650)725-3647
Electrical Engineering Dept. Stanford University
Gates 326, 353 Serra Mall, Stanford, CA 94305   

</body></email><email><emailId>20000420144152</emailId><senderName>Bernard Sebastien</senderName><senderEmail>sebastien.bernard@cegetel.fr</senderEmail><timestampReceived>2000-04-20 14:41:52-0400</timestampReceived><subject>[Acpi] Information about power management Chipset</subject><body>

Where Can I get informations about the 82443MX_3 component (Pci Id
8086:719b)
I looked at the datasheet about the power management unit but it is not
documented inside.

	Seb

Thanks for you help

</body></email><email><emailId>20000420145542</emailId><senderName>Anthony Jenkins</senderName><senderEmail>anthonyj@ami.com</senderEmail><timestampReceived>2000-04-20 14:55:42-0400</timestampReceived><subject>Re: [Acpi] Information about power management Chipset</subject><body>

http://developer.intel.com/design/intarch/techinfo/440BX/index.htm
http://developer.intel.com/design/intarch/applnots/27321203.pdf

Bernard Sebastien wrote:

&gt; Where Can I get informations about the 82443MX_3 component (Pci Id
&gt; 8086:719b)
&gt; I looked at the datasheet about the power management unit but it is not
&gt; documented inside.
&gt;
&gt;         Seb
&gt;
&gt; Thanks for you help
&gt;
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

--
Anthony Jenkins
American Megatrends Inc.    http://www.ami.com
(770) 246-8600 ext 7241     mailto:AnthonyJ@ami.com



</body></email><email><emailId>20000420150627</emailId><senderName>Anthony Jenkins</senderName><senderEmail>anthonyj@ami.com</senderEmail><timestampReceived>2000-04-20 15:06:27-0400</timestampReceived><subject>Re: [Acpi] Information about power management Chipset</subject><body>

Argh... you said "MX"...
http://developer.intel.com/design/chipsets/440mx/index.htm

Anthony Jenkins wrote:

&gt; http://developer.intel.com/design/intarch/techinfo/440BX/index.htm
&gt; http://developer.intel.com/design/intarch/applnots/27321203.pdf
&gt;
&gt; Bernard Sebastien wrote:
&gt;
&gt; &gt; Where Can I get informations about the 82443MX_3 component (Pci Id
&gt; &gt; 8086:719b)
&gt; &gt; I looked at the datasheet about the power management unit but it is not
&gt; &gt; documented inside.
&gt; &gt;
&gt; &gt;         Seb
&gt; &gt;
&gt; &gt; Thanks for you help
&gt; &gt;
&gt; &gt; _______________________________________________
&gt; &gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; &gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt;
&gt; --
&gt; Anthony Jenkins
&gt; American Megatrends Inc.    http://www.ami.com
&gt; (770) 246-8600 ext 7241     mailto:AnthonyJ@ami.com
&gt;
&gt; iÃb?Â¨Â¥-+-iÃbÂ¦Â¢ÃÃr?Â§Ã­z{nsÃ§Â§rÂ§uÃ¨mÂ¶YÃ¿Â¦Â¢ÃÃr?Â§Ã­z{nsÃ§Â§rÂ§uÃ¯Ã¦j)fjÃ¥SÃb?Ãº?iÃb

</body></email><email><emailId>20000420153821</emailId><senderName>Bernard Sebastien</senderName><senderEmail>sebastien.bernard@cegetel.fr</senderEmail><timestampReceived>2000-04-20 15:38:21-0400</timestampReceived><subject>RE: [Acpi] Information about power management Chipset</subject><body>

Yes I said MX. I know already this place but no pdf talks about the Power
managment part of the
82443MX.

	Seb

&gt; -----Message d'origine-----
&gt; De:	Anthony Jenkins [SMTP:AnthonyJ@ami.com]
&gt; Date:	jeudi 20 avril 2000 17:06
&gt; ï¿½:	Bernard Sebastien; 'linux-kernel@vger.rutgers.edu';
&gt; 'acpi@phobos.fachschaften.tu-muenchen.de'
&gt; Objet:	Re: [Acpi] Information about power management Chipset
&gt; 
&gt; Argh... you said "MX"...
&gt; http://developer.intel.com/design/chipsets/440mx/index.htm
&gt; 
&gt; Anthony Jenkins wrote:
&gt; 
&gt; &gt; http://developer.intel.com/design/intarch/techinfo/440BX/index.htm
&gt; &gt; http://developer.intel.com/design/intarch/applnots/27321203.pdf
&gt; &gt;
&gt; &gt; Bernard Sebastien wrote:
&gt; &gt;
&gt; &gt; &gt; Where Can I get informations about the 82443MX_3 component (Pci Id
&gt; &gt; &gt; 8086:719b)
&gt; &gt; &gt; I looked at the datasheet about the power management unit but it is
&gt; not
&gt; &gt; &gt; documented inside.
&gt; &gt; &gt;
&gt; &gt; &gt;         Seb
&gt; &gt; &gt;
&gt; &gt; &gt; Thanks for you help
&gt; &gt; &gt;
&gt; &gt; &gt; _______________________________________________
&gt; &gt; &gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; &gt; &gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; &gt;
&gt; &gt; --
&gt; &gt; Anthony Jenkins
&gt; &gt; American Megatrends Inc.    http://www.ami.com
&gt; &gt; (770) 246-8600 ext 7241     mailto:AnthonyJ@ami.com
&gt; &gt;
&gt; &gt;
&gt; iï¿½b?ï¿½ï¿½-+-iï¿½bï¿½ï¿½ï¿½ï¿½r?ï¿½ï¿½z{nsï¿½ï¿½rï¿½uï¿½mï¿½Yï¿½ï¿½ï¿½ï¿½ï¿½r?ï¿½ï¿½z{nsï¿½ï¿½rï¿½uï¿½ï¿½j)fjï¿½Sï¿½b?ï¿½
&gt; ?iï¿½b
&gt; N&lt;ï¿½ï¿½ï¿½ï¿½rï¿½&gt;yï¿½ï¿½sï¿½bï¿½Xï¿½ï¿½ï¿½ï¿½vï¿½^-)ï¿½ï¿½{.nï¿½+?ï¿½ï¿½S{ï¿½'ï¿½ï¿½zXï¿½ï¿½&gt;ï¿½ï¿½ï¿½}ï¿½zï¿½ï¿½
&gt; zï¿½&amp;j:+v?ï¿½ï¿½ï¿½ï¿½ï¿½`zï¿½vï¿½ï¿½yï¿½ï¿½ï¿½ï¿½...?ï¿½iï¿½ï¿½0 ï¿½ï¿½ï¿½ï¿½?-Iï¿½

</body></email><email><emailId>20000420165412</emailId><senderName>Anthony Jenkins</senderName><senderEmail>anthonyj@ami.com</senderEmail><timestampReceived>2000-04-20 16:54:12-0400</timestampReceived><subject>Re: [Acpi] Information about power management Chipset</subject><body>

The docs say the 82443MX combines the South bridge (PIIX4E) and North Bridge
(440BX) in one chip.  As the south bridge is responsible for most power
management functionality (and I can't find anything substantive in the
PDF specs for the 440MX), I'd have to rely on the PIIX4E documentation for
power management functionality... should be fairly
identical: http://developer.intel.com/design/chipsets/datashts/290562.htm

Bernard Sebastien wrote:

&gt; Yes I said MX. I know already this place but no pdf talks about the Power
&gt; managment part of the
&gt; 82443MX.
&gt;
&gt;         Seb
&gt;
&gt; &gt; -----Message d'origine-----
&gt; &gt; De:   Anthony Jenkins [SMTP:AnthonyJ@ami.com]
&gt; &gt; Date: jeudi 20 avril 2000 17:06
&gt; &gt; Ã:    Bernard Sebastien; 'linux-kernel@vger.rutgers.edu';
&gt; &gt; 'acpi@phobos.fachschaften.tu-muenchen.de'
&gt; &gt; Objet:        Re: [Acpi] Information about power management Chipset
&gt; &gt;
&gt; &gt; Argh... you said "MX"...
&gt; &gt; http://developer.intel.com/design/chipsets/440mx/index.htm
&gt; &gt;
&gt; &gt; Anthony Jenkins wrote:
&gt; &gt;
&gt; &gt; &gt; http://developer.intel.com/design/intarch/techinfo/440BX/index.htm
&gt; &gt; &gt; http://developer.intel.com/design/intarch/applnots/27321203.pdf
&gt; &gt; &gt;
&gt; &gt; &gt; Bernard Sebastien wrote:
&gt; &gt; &gt;
&gt; &gt; &gt; &gt; Where Can I get informations about the 82443MX_3 component (Pci Id
&gt; &gt; &gt; &gt; 8086:719b)
&gt; &gt; &gt; &gt; I looked at the datasheet about the power management unit but it is
&gt; &gt; not
&gt; &gt; &gt; &gt; documented inside.
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;         Seb
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; Thanks for you help
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; _______________________________________________
&gt; &gt; &gt; &gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; &gt; &gt; &gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; &gt; &gt;
&gt; &gt; &gt; --
&gt; &gt; &gt; Anthony Jenkins
&gt; &gt; &gt; American Megatrends Inc.    http://www.ami.com
&gt; &gt; &gt; (770) 246-8600 ext 7241     mailto:AnthonyJ@ami.com
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; iÃb?Â¨Â¥-+-iÃbÂ¦Â¢ÃÃr?Â§Ã­z{nsÃ§Â§rÂ§uÃ¨mÂ¶YÃ¿Â¦Â¢ÃÃr?Â§Ã­z{nsÃ§Â§rÂ§uÃ¯Ã¦j)fjÃ¥SÃb?Ãº
&gt; &gt; ?iÃb
&gt; &gt; N&lt;Â§Â²Ã¦Ã¬rÂ¸&gt;yÃºÃ¨sÃbÂ²XÂ¬Â¶ÃÂ§vÃ^-)ÃÂº{.nÃ+?Â·Â¥S{Â±'ÃªÃ§zXÂ§Â¶&gt;Â¡ÃÂ¨}Â©zÂ²Ã
&gt; &gt; zÃ&amp;j:+v?Â¨Â¾Â«Â®Ã«`zÂ»vÃ£Ã¥yÂ«Ã¦?Â¶...?ÃiÃ¿Ã¼0 ÃÂ±Â¢Â¸?-IÂ¥
&gt;
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

--
Anthony Jenkins
American Megatrends Inc.    http://www.ami.com
(770) 246-8600 ext 7241     mailto:AnthonyJ@ami.com



</body></email><email><emailId>20000420171732</emailId><senderName>Bernard Sebastien</senderName><senderEmail>sebastien.bernard@cegetel.fr</senderEmail><timestampReceived>2000-04-20 17:17:32-0400</timestampReceived><subject>RE: [Acpi] Information about power management Chipset</subject><body>

Ok, so maybe I have some modification to do somewhere in the kernel to
explain that the chipset
is really a PIIX4E and that all power managment functions have to be used
accordingly.
How is the selection of the Power Management Registers done in the kernel
??? (APM or ACPI)
Could it be that all behaviours problems could come from the non detection
of the chipset as it
should be - i.e. a PIIX4E instead of an unknown chipset ?
What do you think ?
	Seb


&gt; -----Message d'origine-----
&gt; De:	Anthony Jenkins [SMTP:AnthonyJ@ami.com]
&gt; Date:	jeudi 20 avril 2000 18:54
&gt; ï¿½:	Bernard Sebastien
&gt; Cc:	'acpi@phobos.fachschaften.tu-muenchen.de'
&gt; Objet:	Re: [Acpi] Information about power management Chipset
&gt; 
&gt; The docs say the 82443MX combines the South bridge (PIIX4E) and North
&gt; Bridge
&gt; (440BX) in one chip.  As the south bridge is responsible for most power
&gt; management functionality (and I can't find anything substantive in the
&gt; PDF specs for the 440MX), I'd have to rely on the PIIX4E documentation for
&gt; power management functionality... should be fairly
&gt; identical: http://developer.intel.com/design/chipsets/datashts/290562.htm
&gt; 
&gt; Bernard Sebastien wrote:
&gt; 
&gt; &gt; Yes I said MX. I know already this place but no pdf talks about the
&gt; Power
&gt; &gt; managment part of the
&gt; &gt; 82443MX.
&gt; &gt;
&gt; &gt;         Seb
&gt; &gt;
&gt; &gt; &gt; -----Message d'origine-----
&gt; &gt; &gt; De:   Anthony Jenkins [SMTP:AnthonyJ@ami.com]
&gt; &gt; &gt; Date: jeudi 20 avril 2000 17:06
&gt; &gt; &gt; ï¿½:    Bernard Sebastien; 'linux-kernel@vger.rutgers.edu';
&gt; &gt; &gt; 'acpi@phobos.fachschaften.tu-muenchen.de'
&gt; &gt; &gt; Objet:        Re: [Acpi] Information about power management Chipset
&gt; &gt; &gt;
&gt; &gt; &gt; Argh... you said "MX"...
&gt; &gt; &gt; http://developer.intel.com/design/chipsets/440mx/index.htm
&gt; &gt; &gt;
&gt; &gt; &gt; Anthony Jenkins wrote:
&gt; &gt; &gt;
&gt; &gt; &gt; &gt; http://developer.intel.com/design/intarch/techinfo/440BX/index.htm
&gt; &gt; &gt; &gt; http://developer.intel.com/design/intarch/applnots/27321203.pdf
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; Bernard Sebastien wrote:
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; Where Can I get informations about the 82443MX_3 component (Pci Id
&gt; &gt; &gt; &gt; &gt; 8086:719b)
&gt; &gt; &gt; &gt; &gt; I looked at the datasheet about the power management unit but it
&gt; is
&gt; &gt; &gt; not
&gt; &gt; &gt; &gt; &gt; documented inside.
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt;         Seb
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; Thanks for you help
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; _______________________________________________
&gt; &gt; &gt; &gt; &gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; &gt; &gt; &gt; &gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; --
&gt; &gt; &gt; &gt; Anthony Jenkins
&gt; &gt; &gt; &gt; American Megatrends Inc.    http://www.ami.com
&gt; &gt; &gt; &gt; (770) 246-8600 ext 7241     mailto:AnthonyJ@ami.com
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt;
&gt; iï¿½b?ï¿½ï¿½-+-iï¿½bï¿½ï¿½ï¿½ï¿½r?ï¿½ï¿½z{nsï¿½ï¿½rï¿½uï¿½mï¿½Yï¿½ï¿½ï¿½ï¿½ï¿½r?ï¿½ï¿½z{nsï¿½ï¿½rï¿½uï¿½ï¿½j)fjï¿½Sï¿½b?ï¿½
&gt; &gt; &gt; ?iï¿½b
&gt; &gt; &gt; N&lt;ï¿½ï¿½ï¿½ï¿½rï¿½&gt;yï¿½ï¿½sï¿½bï¿½Xï¿½ï¿½ï¿½ï¿½vï¿½^-)ï¿½ï¿½{.nï¿½+?ï¿½ï¿½S{ï¿½'ï¿½ï¿½zXï¿½ï¿½&gt;ï¿½ï¿½ï¿½}ï¿½zï¿½ï¿½
&gt; &gt; &gt; zï¿½&amp;j:+v?ï¿½ï¿½ï¿½ï¿½ï¿½`zï¿½vï¿½ï¿½yï¿½ï¿½?ï¿½...?ï¿½iï¿½ï¿½0 ï¿½ï¿½ï¿½ï¿½?-Iï¿½
&gt; &gt;
&gt; &gt; _______________________________________________
&gt; &gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; &gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; 
&gt; --
&gt; Anthony Jenkins
&gt; American Megatrends Inc.    http://www.ami.com
&gt; (770) 246-8600 ext 7241     mailto:AnthonyJ@ami.com
&gt; 
&gt; 
&gt; iï¿½b(tm)ï¿½ï¿½-+-iï¿½bï¿½ï¿½ï¿½ï¿½r...ï¿½ï¿½z{nsï¿½ï¿½rï¿½uï¿½mï¿½Yï¿½ï¿½ï¿½ï¿½ï¿½r...ï¿½ï¿½z{nsï¿½ï¿½rï¿½uï¿½ï¿½j)fj
&gt; ï¿½Sï¿½bï¿½ï¿½?iï¿½b

</body></email><email><emailId>20000420181812</emailId><senderName>Anthony Jenkins</senderName><senderEmail>anthonyj@ami.com</senderEmail><timestampReceived>2000-04-20 18:18:12-0400</timestampReceived><subject>Re: [Acpi] Information about power management Chipset</subject><body>

Bernard Sebastien wrote:

&gt; Ok, so maybe I have some modification to do somewhere in the kernel to
&gt; explain that the chipset
&gt; is really a PIIX4E and that all power managment functions have to be used
&gt; accordingly.
&gt; How is the selection of the Power Management Registers done in the kernel
&gt; ??? (APM or ACPI)

No idea on that one (yet).  I'm involved in the BIOS side of ACPI :-).

&gt; Could it be that all behaviours problems could come from the non detection
&gt; of the chipset as it
&gt; should be - i.e. a PIIX4E instead of an unknown chipset ?

Someone else might be able to answer that....as far as I can tell, it should
still see the PIIX4 power management PCI device function correctly if the code
looks for its PCI vendor/device ID (0x8086 / 0x7113).  Should be a simple
matter to search for the 0x8086 / 0x7113 values in the source code that define
the Power Management PCI function in the PIIX4 I suppose....

&gt;
&gt; What do you think ?
&gt;         Seb
&gt;
&gt; &gt; -----Message d'origine-----
&gt; &gt; De:   Anthony Jenkins [SMTP:AnthonyJ@ami.com]
&gt; &gt; Date: jeudi 20 avril 2000 18:54
&gt; &gt; Ã:    Bernard Sebastien
&gt; &gt; Cc:   'acpi@phobos.fachschaften.tu-muenchen.de'
&gt; &gt; Objet:        Re: [Acpi] Information about power management Chipset
&gt; &gt;
&gt; &gt; The docs say the 82443MX combines the South bridge (PIIX4E) and North
&gt; &gt; Bridge
&gt; &gt; (440BX) in one chip.  As the south bridge is responsible for most power

Woops.. make that (440GX)

&gt;
&gt; &gt; management functionality (and I can't find anything substantive in the
&gt; &gt; PDF specs for the 440MX), I'd have to rely on the PIIX4E documentation for
&gt; &gt; power management functionality... should be fairly
&gt; &gt; identical: http://developer.intel.com/design/chipsets/datashts/290562.htm
&gt; &gt;
&gt; &gt; Bernard Sebastien wrote:
&gt; &gt;
&gt; &gt; &gt; Yes I said MX. I know already this place but no pdf talks about the
&gt; &gt; Power
&gt; &gt; &gt; managment part of the
&gt; &gt; &gt; 82443MX.
&gt; &gt; &gt;
&gt; &gt; &gt;         Seb
&gt; &gt; &gt;
&gt; &gt; &gt; &gt; -----Message d'origine-----
&gt; &gt; &gt; &gt; De:   Anthony Jenkins [SMTP:AnthonyJ@ami.com]
&gt; &gt; &gt; &gt; Date: jeudi 20 avril 2000 17:06
&gt; &gt; &gt; &gt; Ã:    Bernard Sebastien; 'linux-kernel@vger.rutgers.edu';
&gt; &gt; &gt; &gt; 'acpi@phobos.fachschaften.tu-muenchen.de'
&gt; &gt; &gt; &gt; Objet:        Re: [Acpi] Information about power management Chipset
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; Argh... you said "MX"...
&gt; &gt; &gt; &gt; http://developer.intel.com/design/chipsets/440mx/index.htm
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; Anthony Jenkins wrote:
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; http://developer.intel.com/design/intarch/techinfo/440BX/index.htm
&gt; &gt; &gt; &gt; &gt; http://developer.intel.com/design/intarch/applnots/27321203.pdf
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; Bernard Sebastien wrote:
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; Where Can I get informations about the 82443MX_3 component (Pci Id
&gt; &gt; &gt; &gt; &gt; &gt; 8086:719b)
&gt; &gt; &gt; &gt; &gt; &gt; I looked at the datasheet about the power management unit but it
&gt; &gt; is
&gt; &gt; &gt; &gt; not
&gt; &gt; &gt; &gt; &gt; &gt; documented inside.
&gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt;         Seb
&gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; Thanks for you help
&gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; _______________________________________________
&gt; &gt; &gt; &gt; &gt; &gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; &gt; &gt; &gt; &gt; &gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; --
&gt; &gt; &gt; &gt; &gt; Anthony Jenkins
&gt; &gt; &gt; &gt; &gt; American Megatrends Inc.    http://www.ami.com
&gt; &gt; &gt; &gt; &gt; (770) 246-8600 ext 7241     mailto:AnthonyJ@ami.com
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;
&gt; &gt; iÃb?Â¨Â¥-+-iÃbÂ¦Â¢ÃÃr?Â§Ã­z{nsÃ§Â§rÂ§uÃ¨mÂ¶YÃ¿Â¦Â¢ÃÃr?Â§Ã­z{nsÃ§Â§rÂ§uÃ¯Ã¦j)fjÃ¥SÃb?Ãº
&gt; &gt; &gt; &gt; ?iÃb
&gt; &gt; &gt; &gt; N&lt;Â§Â²Ã¦Ã¬rÂ¸&gt;yÃºÃ¨sÃbÂ²XÂ¬Â¶ÃÂ§vÃ^-)ÃÂº{.nÃ+?Â·Â¥S{Â±'ÃªÃ§zXÂ§Â¶&gt;Â¡ÃÂ¨}Â©zÂ²Ã
&gt; &gt; &gt; &gt; zÃ&amp;j:+v?Â¨Â¾Â«Â®Ã«`zÂ»vÃ£Ã¥yÂ«Ã¦?Â¶...?ÃiÃ¿Ã¼0 ÃÂ±Â¢Â¸?-IÂ¥
&gt; &gt; &gt;
&gt; &gt; &gt; _______________________________________________
&gt; &gt; &gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; &gt; &gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; &gt;
&gt; &gt; --
&gt; &gt; Anthony Jenkins
&gt; &gt; American Megatrends Inc.    http://www.ami.com
&gt; &gt; (770) 246-8600 ext 7241     mailto:AnthonyJ@ami.com
&gt; &gt;
&gt; &gt;
&gt; &gt; iÃb(tm)Â¨Â¥-+-iÃbÂ¦Â¢ÃÃr...Â§Ã­z{nsÃ§Â§rÂ§uÃ¨mÂ¶YÃ¿Â¦Â¢ÃÃr...Â§Ã­z{nsÃ§Â§rÂ§uÃ¯Ã¦j)fj
&gt; &gt; Ã¥SÃb?Ãº?iÃb
&gt;
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

--
Anthony Jenkins
American Megatrends Inc.    http://www.ami.com
(770) 246-8600 ext 7241     mailto:AnthonyJ@ami.com



</body></email><email><emailId>20000413160812</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-13 16:08:12-0400</timestampReceived><subject>Re: [Acpi] \_OS_ and _REV Object</subject><body>

--- Yuki Ogawa &lt;y-ogawa@dvpj.sony.co.jp&gt; wrote:
&gt; Hi all,
&gt; 
&gt; Do you have a plan to change \_OS_ object defined by
&gt; AML interpreter?
&gt; 
&gt; Currently, acpid has "Linux AML interpreter"(older
&gt; one was just "AML interpreter")
&gt; as _OS which is very generic definition and will be
&gt; used forever.
&gt; _REV is 2 which is likely to change.

&gt;From the ACPI spec

  5.7.2 \_OS Name object
  This object contains a string that identifies
  the operating system.  This value does not change
  with different revisions of the AML interpreter.

  5.7.3 \_REV data object
  This object contains the revision of the AML
  interpreter for the specified \_OS as a Dword.
  Larger values are newer revisions of the
  interpreter.

Now that I think about it, "Linux" seems most
appropriate for _OS_ and I will change to that with
the next acpid release.  If anyone has a strong
preference for something else, let me know.

Yes, the value of _REV will continue to increase
as the interpreter matures.

-Andy


__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com

</body></email><email><emailId>20000421171412</emailId><senderName>Bernard Sebastien</senderName><senderEmail>sebastien.bernard@cegetel.fr</senderEmail><timestampReceived>2000-04-21 17:14:12-0400</timestampReceived><subject>[Acpi] Back to acpi</subject><body>


</body></email><email><emailId>20000421225218</emailId><senderName>SÃ©bastien Bernard</senderName><senderEmail>bernarbs@club-internet.fr</senderEmail><timestampReceived>2000-04-21 22:52:18-0400</timestampReceived><subject>[Acpi] Back to ACPI</subject><body>

Maybe My little message was a bit suprising isn't it ?

Sorrry about that. My exchange client just crash when sending this.
So let's do it again.
The hang in my laptop is caused by the acpi_irq which get called over
and over without reason.
I traced the values from the call :
pm1_status 0x00000100 pm1_enable 0x00000001
gpe_status0x07000000 gpe_enable 0x0000000
I used %08x for printing those values.


Can someone lend me a hand to interpret these results ?

    Seb

</body></email><email><emailId>20000414024106</emailId><senderName>"Yuki Ogawa"</senderName><senderEmail>y-ogawa@dvpj.sony.co.jp</senderEmail><timestampReceived>2000-04-14 02:41:06-0400</timestampReceived><subject>Re: [Acpi] \_OS_ and _REV Object</subject><body>

My small requests are 

- _OS contains string "Linux" at the top as in current design.
    And should not change.  Then BIOS can clearly and easily identiy Linux.  
    If you make variations like "Linux", "LINUX OS", "RedHat LINUX", and so on...,
    String compare in ASL will be quite complex and costs a lot of time.

- _REV will be changed by update if acpid or kernel contain big changes.
    If you need BIOS to know or take care of design change, _REV should be changed.
    Then BIOS can identify the version of Linux.

- Please don't change these strategy.
    If you change both _OS and _REV frequently, ASL conditions will be quite complex.
    BIOS developpers need extra works and No benefits for all end users.



FYI.  Microsoft has different strategy.
- _OS will be changed by new OS.
- _REV is a version number of ACPI spec that is supported by the AML interpreter.



Thanks
++yuki
----- Original Message ----- 
From: "Andy Henroid" &lt;andy_henroid@yahoo.com&gt;
To: "Yuki Ogawa" &lt;y-ogawa@dvpj.sony.co.jp&gt;
Cc: &lt;acpi@phobos.fs.tum.de&gt;
Sent: Friday, April 14, 2000 1:08 AM
Subject: Re: [Acpi] \_OS_ and _REV Object


&gt; --- Yuki Ogawa &lt;y-ogawa@dvpj.sony.co.jp&gt; wrote:
&gt; &gt; Hi all,
&gt; &gt; 
&gt; &gt; Do you have a plan to change \_OS_ object defined by
&gt; &gt; AML interpreter?
&gt; &gt; 
&gt; &gt; Currently, acpid has "Linux AML interpreter"(older
&gt; &gt; one was just "AML interpreter")
&gt; &gt; as _OS which is very generic definition and will be
&gt; &gt; used forever.
&gt; &gt; _REV is 2 which is likely to change.
&gt; 
&gt; &gt;From the ACPI spec
&gt; 
&gt;   5.7.2 \_OS Name object
&gt;   This object contains a string that identifies
&gt;   the operating system.  This value does not change
&gt;   with different revisions of the AML interpreter.
&gt; 
&gt;   5.7.3 \_REV data object
&gt;   This object contains the revision of the AML
&gt;   interpreter for the specified \_OS as a Dword.
&gt;   Larger values are newer revisions of the
&gt;   interpreter.
&gt; 
&gt; Now that I think about it, "Linux" seems most
&gt; appropriate for _OS_ and I will change to that with
&gt; the next acpid release.  If anyone has a strong
&gt; preference for something else, let me know.
&gt; 
&gt; Yes, the value of _REV will continue to increase
&gt; as the interpreter matures.
&gt; 
&gt; -Andy
&gt; 
&gt; 
&gt; __________________________________________________
&gt; Do You Yahoo!?
&gt; Send online invitations with Yahoo! Invites.
&gt; http://invites.yahoo.com
&gt; 

</body></email><email><emailId>20000414233948</emailId><senderName>Yung-Hsiang Lu</senderName><senderEmail>luyung@stanford.edu</senderEmail><timestampReceived>2000-04-14 23:39:48-0400</timestampReceived><subject>[Acpi] arch/i386/kernel/acpi.c</subject><body>

Hi, Andy,

I guess you wrote this file (arch/i386/kernel/acpi.c) for Linux 
2.3.99-pre5.  I did some tracing and found the following.

in acpi_find_tables, rsdt_entry_count is 2 before entering while

In the first iteration, !acpi_init_table(&amp;acpi_facp...) is 
true.  acpi_facp.table is assigned to an non-NULL value (0xc8802b65).  Also 
acpi_init_table(&amp;acpi_dsdt, dt...) also succeeds.

In the second iteration, !acpi_init_table(&amp;acpi_facp...) is 
false.  acpi_facp.table is assigned to NULL.

As a result, it concludes that "missing FACP"

How many tables should the system have?

Thanks!
Have a nice weekend.

Yung-Hsiang Lu       luyung@stanford.edu     (650)725-3647
Electrical Engineering Dept. Stanford University
Gates 326, 353 Serra Mall, Stanford, CA 94305   

</body></email><email><emailId>20000417143823</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-04-17 14:38:23-0400</timestampReceived><subject>[Acpi] ACPI bug (fwd)</subject><body>

&gt;From the lkml.

---------- Forwarded message ----------
Date: Mon, 17 Apr 2000 15:00:48 +0200
From: Bernard Sebastien &lt;sebastien.bernard@cegetel.fr&gt;
Subject: ACPI bug

Hi,
I think I've found a bug in the pre4 patch and pre5.
The acpi FACP table is detected only is the FACP table is the last table of
the RSDT.
If the table is in first position the acpi_facp is initialized correctly but
at the second occurence of the loop,
it is cleared by the acpi_init_table.
This functions checks that the signature matches the expected one but if not
the case, the table is cleared.
This leads to no FACP table found error despite the face it is OK.
I checked the fix on a laptop and a desktop (ASUS P5B) and it's ok.

acpi.c :
-----------------------
	while (rsdt_entry_count) {
		struct acpi_table *dt = acpi_map_table(*rsdt_entry);
		if (!acpi_init_table(&amp;acpi_facp, dt, 1)) {
			struct acpi_facp *facp
				= (struct acpi_facp*) acpi_facp.table;

			// map DSDT if it exists
			dt = acpi_map_table(facp-&gt;dsdt);
			if (acpi_init_table(&amp;acpi_dsdt, dt, 1))
				acpi_unmap_table(dt);
			else
+  				break;
		}
		else {
			acpi_unmap_table(dt);
		}

-----------------------

-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at http://www.tux.org/lkml/

</body></email><email><emailId>20000417143943</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-04-17 14:39:43-0400</timestampReceived><subject>[Acpi] 440MX getting closer (fwd)</subject><body>

&gt;From the lkml.

---------- Forwarded message ----------
Date: Mon, 17 Apr 2000 15:20:35 +0200
From: Bernard Sebastien &lt;sebastien.bernard@cegetel.fr&gt;
Subject: 440MX getting closer

Maybe I'm not talking to the right place for those kind of informations. If
not, could you tell me where should I head to ?

I'm still trying to use the 440MX on a NEC versa note 2000.
I've been able to check the ACPI tables. They are OK - acpidmp gives me the
correct answers-.
Now I've narrowed the problem to enabling ACPI irq.
All ACPI tables are found. The kernel freeze somewhere in the irq_enable
function.
It tries to enable the irq 9 which looks suspicious to me, but after
checking my ASUS board, I think it's OK (same IRQ too).
Now, could someone explain me how could the irq_enable "hang" the machine
like that ?

I think it's APM related, whenever the kernel tried to do something related
to "power saving" the machine locks.


Is there any magic to do with that chipset ?
The datasheet says that 440MX is a fusion between north bridge and south
bridge and that it is basicaly a PIIX.
Maybe there is some work to do about PIIX (which is recognized by IRQ router
but not by the other checks).

	Seb

-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at http://www.tux.org/lkml/

</body></email><email><emailId>20000417203136</emailId><senderName>Mathieu Chouquet-Stringer</senderName><senderEmail>mchouque@cs.stevens-tech.edu</senderEmail><timestampReceived>2000-04-17 20:31:36-0400</timestampReceived><subject>[Acpi] Acpi and Asus K7V</subject><body>


	Hi all !

I'm the owner of a K7V motherboard and I have some troubles with ACPI. I
have tried any kernels (the last 2.3.99-pre5 or pre6-3) and ACPI is not
working with my motherboard.

I got these messages during the boot:
TCP: Hash tables configured (established 16384 bind 16384)
Initializing RT netlink socket
ACPI: "ASUS" found at 0x000f5cc0
ACPI: missing FACP
apm: BIOS version 1.2 Flags 0x03 (Driver version 1.13)

I have read the code (arch/i386/kernel/acpi.c) and I have put some printk
to see where it was failing (in acpi_find_tables and acpi_init_table). For
what I have seen, the driver finds the ACPI pages in memory, try to find
(in order) FACP, DSDT, BOOT (during the loop while (rsdt_entry_count)).
BOOT is the problem because when trying to find BOOT the driver find
FACP. Is this behaviour correct ? 

If I insert a break after the if (// map FACS if it exists), it works. I
think it is not the good fix but it works (I have at least /proc/sys/acpi).
But after that, ACPI is not working. I have launched acpid and nothing
works ! When the computer must power off, the only thing to be powered off
is the screen ! Neither power or sleep buttons work.

I have attached a dump of acpidmp with this mail.

Thank you for your support !

-- 
Mathieu CHOUQUET-STRINGER    E-Mail : mchouque@stevens-tech.edu
     "Entities must not be multiplied beyond necessity"
		-- William of Occam --

["acpidmp.gz" (application/x-gunzip)]

</body></email><email><emailId>20000418142948</emailId><senderName>"Jeong Hwan Park"</senderName><senderEmail>jhpark@brainzsquare.com</senderEmail><timestampReceived>2000-04-18 14:29:48-0400</timestampReceived><subject>[Acpi] Is wake-on-lan possible after the system is powered off using ACPI?</subject><body>

I have a linux server which has dual PIII-550 and intel L440GX+ M/B built in intel 82559 ethernet controller.

I have installed 2.3.99-pre5 for ACPI.
I run the "acpid -d" in prompt.
I can shutdown the server and power off without pushing the power button.

Everything is ok but I can't wake the system with wake-on-lan.

When I use 2.2.14 kernel, I have no problem to wake up the system with wake-on-lan.

How can I catch two rabbits?

Best regards,

Jeong Hwan Park

BrainzSquare
http://www.brainzsquare.com
Tel. 82-42-823-9050
Fax. 82-42-823-9060

</body></email><email><emailId>20000418171739</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-18 17:17:39-0400</timestampReceived><subject>Re: [Acpi] acpi/acpi fail</subject><body>

--- Yung-Hsiang Lu &lt;luyung@stanford.edu&gt; wrote:

&gt; Did anyone try acpi under the directory acpi to get
&gt; the status of 
&gt; ACPI?  When I execute it, it says
&gt; 
&gt; acpi: Not implemented

Yes, acpi (or "acpictl" as it will be called soon)
is just a toy for now to show how user applications
would connect to acpid.  The "Not implemented"
message refers to the command acpi sends to acpid
and not to ACPI itself.

-Andy


__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com

</body></email><email><emailId>20000419043141</emailId><senderName>"Jeong Hwan Park"</senderName><senderEmail>jhpark@brainzsquare.com</senderEmail><timestampReceived>2000-04-19 04:31:41-0400</timestampReceived><subject>[Acpi] ACPI + WOL</subject><body>

Does your message mean that I couldn't wake up the system with WOL in =
the current ACPI4Linux?

Without ACPI (kernel 2.2.14) , I can wake up the system!

Can I change the same system status with kernel 2.2.14 (no ACPI) when I =
shutdown with ACPI?
Best regards,

Jeong Hwan Park

BrainzSquare
http://www.brainzsquare.com
Tel. 82-42-823-9050
Fax. 82-42-823-9060

</body></email><email><emailId>20000419062922</emailId><senderName>Yung-Hsiang Lu</senderName><senderEmail>luyung@stanford.edu</senderEmail><timestampReceived>2000-04-19 06:29:22-0400</timestampReceived><subject>[Acpi] pmtest</subject><body>

Hi, Everyone,

You probably find out that I am learning this project. :-)  I hope to 
contribute something once I understand things better.  Thanks!

1. It seems that pmtest will keep a device in the designated state 
regardless of coming requests.  For example, I can put my PCMCIA network 
card into D3.  However, when I ping another machine, it does not wake up 
automatically.  Is this an intended feature, or I did something wrong?

2. This may be related to the first question.  Can we put a hard disk drive 
into a sleeping state?  If a device cannot wake up automatically, we will 
not be able to wake up HDD since HDD is needed to execute pmtest.  Is this 
right?

3. According to Intel's Mobile Power Guide 
(http://developer.intel.com/design/mobile/intelpower/int_mpg.htm#download). 
CPU (9.5W) is the biggest power sink.  Is there any plan in this project to 
address this issue?  FYI: LCD 4.3W, Power Supply 2.6W, Graphics 2.4W.

4. When I change the power state of VGA, my LCD display (on a notebook 
computer) did not change.  I guess VGA and LCD have different ID's.

Where can I find a complete table for device ID (shown in pmtest)?

0x41d00303	"keyboard"
0x41d00510     "IRDA"
0x41d00e00     "PCMCIA"

Can I just add new entries, say LCD, for other devices and change their 
power states?

5. Is anybody writing a program that tells a user how much battery capacity 
is left and how fast the system is draining the battery?  This will be very 
useful for us to quantify the success of the project.

Yung-Hsiang Lu       luyung@stanford.edu     (650)725-3647
Electrical Engineering Dept. Stanford University
Gates 326, 353 Serra Mall, Stanford, CA 94305   

</body></email><email><emailId>20000419081308</emailId><senderName>Bernard Sebastien</senderName><senderEmail>sebastien.bernard@cegetel.fr</senderEmail><timestampReceived>2000-04-19 08:13:08-0400</timestampReceived><subject>[Acpi] 440MX still no clue, requesting help</subject><body>

I'm still looking forward why this chipset isn't working correctly.

All I know for now is that :
1) the acpi tables are correctly found
2) the acpi sci_enable does not work. It freezes completely the machine and
I don't know why.

Could someone help me about this  ?? Please!!

	Seb

</body></email><email><emailId>20000420190223</emailId><senderName>Bernard Sebastien</senderName><senderEmail>sebastien.bernard@cegetel.fr</senderEmail><timestampReceived>2000-04-20 19:02:23-0400</timestampReceived><subject>RE: [Acpi] Information about power management Chipset</subject><body>

I did it. Nothing changes.
After some research (translate some printk :)), I can tell you that the
acpi_irq is looping foreever
(or I'd rather says that it is called all the time - I have a lot of message
in out in out in out in out on the screen
after placing some printk inside the interrupt handler).

Why ? I'll find tonight or tomorrow (it 21:02 CEST now and i'm at work).



&gt; -----Message d'origine-----
&gt; De:	Anthony Jenkins [SMTP:AnthonyJ@ami.com]
&gt; Date:	jeudi 20 avril 2000 20:18
&gt; ï¿½:	'acpi@phobos.fachschaften.tu-muenchen.de'
&gt; Cc:	Bernard Sebastien
&gt; Objet:	Re: [Acpi] Information about power management Chipset
&gt; 
&gt; Bernard Sebastien wrote:
&gt; 
&gt; &gt; Ok, so maybe I have some modification to do somewhere in the kernel to
&gt; &gt; explain that the chipset
&gt; &gt; is really a PIIX4E and that all power managment functions have to be
&gt; used
&gt; &gt; accordingly.
&gt; &gt; How is the selection of the Power Management Registers done in the
&gt; kernel
&gt; &gt; ??? (APM or ACPI)
&gt; 
&gt; No idea on that one (yet).  I'm involved in the BIOS side of ACPI :-).
&gt; 
&gt; &gt; Could it be that all behaviours problems could come from the non
&gt; detection
&gt; &gt; of the chipset as it
&gt; &gt; should be - i.e. a PIIX4E instead of an unknown chipset ?
&gt; 
&gt; Someone else might be able to answer that....as far as I can tell, it
&gt; should
&gt; still see the PIIX4 power management PCI device function correctly if the
&gt; code
&gt; looks for its PCI vendor/device ID (0x8086 / 0x7113).  Should be a simple
&gt; matter to search for the 0x8086 / 0x7113 values in the source code that
&gt; define
&gt; the Power Management PCI function in the PIIX4 I suppose....
&gt; 
&gt; &gt;
&gt; &gt; What do you think ?
&gt; &gt;         Seb
&gt; &gt;
&gt; &gt; &gt; -----Message d'origine-----
&gt; &gt; &gt; De:   Anthony Jenkins [SMTP:AnthonyJ@ami.com]
&gt; &gt; &gt; Date: jeudi 20 avril 2000 18:54
&gt; &gt; &gt; ï¿½:    Bernard Sebastien
&gt; &gt; &gt; Cc:   'acpi@phobos.fachschaften.tu-muenchen.de'
&gt; &gt; &gt; Objet:        Re: [Acpi] Information about power management Chipset
&gt; &gt; &gt;
&gt; &gt; &gt; The docs say the 82443MX combines the South bridge (PIIX4E) and North
&gt; &gt; &gt; Bridge
&gt; &gt; &gt; (440BX) in one chip.  As the south bridge is responsible for most
&gt; power
&gt; 
&gt; Woops.. make that (440GX)
&gt; 
&gt; &gt;
&gt; &gt; &gt; management functionality (and I can't find anything substantive in the
&gt; &gt; &gt; PDF specs for the 440MX), I'd have to rely on the PIIX4E documentation
&gt; for
&gt; &gt; &gt; power management functionality... should be fairly
&gt; &gt; &gt; identical:
&gt; http://developer.intel.com/design/chipsets/datashts/290562.htm
&gt; &gt; &gt;
&gt; &gt; &gt; Bernard Sebastien wrote:
&gt; &gt; &gt;
&gt; &gt; &gt; &gt; Yes I said MX. I know already this place but no pdf talks about the
&gt; &gt; &gt; Power
&gt; &gt; &gt; &gt; managment part of the
&gt; &gt; &gt; &gt; 82443MX.
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;         Seb
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; -----Message d'origine-----
&gt; &gt; &gt; &gt; &gt; De:   Anthony Jenkins [SMTP:AnthonyJ@ami.com]
&gt; &gt; &gt; &gt; &gt; Date: jeudi 20 avril 2000 17:06
&gt; &gt; &gt; &gt; &gt; ï¿½:    Bernard Sebastien; 'linux-kernel@vger.rutgers.edu';
&gt; &gt; &gt; &gt; &gt; 'acpi@phobos.fachschaften.tu-muenchen.de'
&gt; &gt; &gt; &gt; &gt; Objet:        Re: [Acpi] Information about power management
&gt; Chipset
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; Argh... you said "MX"...
&gt; &gt; &gt; &gt; &gt; http://developer.intel.com/design/chipsets/440mx/index.htm
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; Anthony Jenkins wrote:
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt;
&gt; http://developer.intel.com/design/intarch/techinfo/440BX/index.htm
&gt; &gt; &gt; &gt; &gt; &gt; http://developer.intel.com/design/intarch/applnots/27321203.pdf
&gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; Bernard Sebastien wrote:
&gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; Where Can I get informations about the 82443MX_3 component
&gt; (Pci Id
&gt; &gt; &gt; &gt; &gt; &gt; &gt; 8086:719b)
&gt; &gt; &gt; &gt; &gt; &gt; &gt; I looked at the datasheet about the power management unit but
&gt; it
&gt; &gt; &gt; is
&gt; &gt; &gt; &gt; &gt; not
&gt; &gt; &gt; &gt; &gt; &gt; &gt; documented inside.
&gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt;         Seb
&gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; Thanks for you help
&gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; _______________________________________________
&gt; &gt; &gt; &gt; &gt; &gt; &gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; --
&gt; &gt; &gt; &gt; &gt; &gt; Anthony Jenkins
&gt; &gt; &gt; &gt; &gt; &gt; American Megatrends Inc.    http://www.ami.com
&gt; &gt; &gt; &gt; &gt; &gt; (770) 246-8600 ext 7241     mailto:AnthonyJ@ami.com
&gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt;
&gt; iï¿½b?ï¿½ï¿½-+-iï¿½bï¿½ï¿½ï¿½ï¿½r?ï¿½ï¿½z{nsï¿½ï¿½rï¿½uï¿½mï¿½Yï¿½ï¿½ï¿½ï¿½ï¿½r?ï¿½ï¿½z{nsï¿½ï¿½rï¿½uï¿½ï¿½j)fjï¿½Sï¿½b?ï¿½
&gt; &gt; &gt; &gt; &gt; ?iï¿½b
&gt; &gt; &gt; &gt; &gt; N&lt;ï¿½ï¿½ï¿½ï¿½rï¿½&gt;yï¿½ï¿½sï¿½bï¿½Xï¿½ï¿½ï¿½ï¿½vï¿½^-)ï¿½ï¿½{.nï¿½+?ï¿½ï¿½S{ï¿½'ï¿½ï¿½zXï¿½ï¿½&gt;ï¿½ï¿½ï¿½}ï¿½zï¿½ï¿½
&gt; &gt; &gt; &gt; &gt; zï¿½&amp;j:+v?ï¿½ï¿½ï¿½ï¿½ï¿½`zï¿½vï¿½ï¿½yï¿½ï¿½?ï¿½...?ï¿½iï¿½ï¿½0 ï¿½ï¿½ï¿½ï¿½?-Iï¿½
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; _______________________________________________
&gt; &gt; &gt; &gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; &gt; &gt; &gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; &gt; &gt;
&gt; &gt; &gt; --
&gt; &gt; &gt; Anthony Jenkins
&gt; &gt; &gt; American Megatrends Inc.    http://www.ami.com
&gt; &gt; &gt; (770) 246-8600 ext 7241     mailto:AnthonyJ@ami.com
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; iï¿½b(tm)ï¿½ï¿½-+-iï¿½bï¿½ï¿½ï¿½ï¿½r...ï¿½ï¿½z{nsï¿½ï¿½rï¿½uï¿½mï¿½Yï¿½ï¿½ï¿½ï¿½ï¿½r...ï¿½ï¿½z{nsï¿½ï¿½rï¿½uï¿½ï¿½j)fj
&gt; &gt; &gt; ï¿½Sï¿½b?ï¿½?iï¿½b
&gt; &gt;
&gt; &gt; _______________________________________________
&gt; &gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; &gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; 
&gt; --
&gt; Anthony Jenkins
&gt; American Megatrends Inc.    http://www.ami.com
&gt; (770) 246-8600 ext 7241     mailto:AnthonyJ@ami.com
&gt; 
&gt; 
&gt; iï¿½b(tm)ï¿½ï¿½-+-iï¿½bï¿½ï¿½ï¿½ï¿½r...ï¿½ï¿½z{nsï¿½ï¿½rï¿½uï¿½mï¿½Yï¿½ï¿½ï¿½ï¿½ï¿½r...ï¿½ï¿½z{nsï¿½ï¿½rï¿½uï¿½ï¿½j)fj
&gt; ï¿½Sï¿½bï¿½ï¿½?iï¿½b

</body></email><email><emailId>20000421234723</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-21 23:47:23-0400</timestampReceived><subject>Re: [Acpi] Back to ACPI</subject><body>

--- S=E9bastien Bernard &lt;bernarbs@club-internet.fr&gt;
wrote:

&gt; The hang in my laptop is caused by the acpi_irq
&gt; which get called over
&gt; and over without reason.
&gt; I traced the values from the call :
&gt; pm1_status 0x00000100 pm1_enable 0x00000001
&gt; gpe_status0x07000000 gpe_enable 0x0000000
&gt; I used %08x for printing those values.

&gt;From above, it doesn't look like an ACPI event is
triggering the IRQ.  Is ACPI sharing an IRQ with
any other device?  Look at /proc/interrupts.

-Andy


__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com

</body></email><email><emailId>20000801045002</emailId><senderName>"Jeong Hwan Park"</senderName><senderEmail>jhpark@brainzsquare.com</senderEmail><timestampReceived>2000-08-01 04:50:02-0400</timestampReceived><subject>[Acpi] Is it possible to shutdown a linux system by pressing the power switch?</subject><body>

[Attachment #2 (text/plain)]


A system will be used by people who have little linux experience.
I wanted to know if there is any method to shutdown when the user presses the power switch to power off.


----------------------------------------------
Jeong Hwan Park (jhpark@brainzsquare.com)
Senior System Engineer
Brainzsquare, Inc. (http://www.brainzsquare.com)

I live in http://zelcom.inticity.com. 
Visit if you have times!
----------------------------------------------
 
["=?ks_c_5601-1987?B?udogwaTIry52Y2Y=?=" (text/x-vcard)]
_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi


</body></email><email><emailId>20000801115223</emailId><senderName>Jeong Hwan Park</senderName><senderEmail>jhpark@router.brainz.co.kr</senderEmail><timestampReceived>2000-08-01 11:52:23-0400</timestampReceived><subject>[Acpi] ACPI: S5 failed</subject><body>


I have a P3B-F M/B made from ASUS.
I have installed Redhat 6.2 and there is no problem to power off when I
shut down my linux box.

Today, I upgraded kernel to 2.4.0-test5 and enabled the experimental ACPI
interpreter option.
I tried to press power switch to shutdown my linux box and I could see 
the normal shutdown procedure (just like unmounting file system and etc.)
But it doesn't power off. It gave me below message.

--------------------------------------
...
The system is halted
Power down.
ACPI: S5 failed
---------------------------------------

What's the problem?
I got the messages in boot sequence.

----------------------------------------------
...
ACPI:support found
ACPI:PBLK 1 @ 0xe410:6
ACPI:C2 supported
ACPI:7 throttling states
ACPI:S1 supported
ACPI:S5 supported
ACPI C2 works
ACPI C3 works
...
--------------------------------------------------

Whould you please explain this problem?





_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000801135423</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-08-01 13:54:23-0400</timestampReceived><subject>[Acpi] Re: Is it possible to shutdown a linux system by pressing the power switch?</subject><body>


"Jeong Hwan Park" writes:
&gt;DQpBIHN5c3RlbSB3aWxsIGJlIHVzZWQgYnkgcGVvcGxlIHdobyBoYXZlIGxpdHRsZSBsaW51eCBl
&gt;eHBlcmllbmNlLg0KSSB3YW50ZWQgdG8ga25vdyBpZiB0aGVyZSBpcyBhbnkgbWV0aG9kIHRvIHNo
&gt;dXRkb3duIHdoZW4gdGhlIHVzZXIgcHJlc3NlcyB0aGUgcG93ZXIgc3dpdGNoIHRvIHBvd2VyIG9m
&gt;Zi4NCg0KDQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQpK
&gt;ZW9uZyBId2FuIFBhcmsgKGpocGFya0BicmFpbnpzcXVhcmUuY29tKQ0KU2VuaW9yIFN5c3RlbSBF
&gt;bmdpbmVlcg0KQnJhaW56c3F1YXJlLCBJbmMuIChodHRwOi8vd3d3LmJyYWluenNxdWFyZS5jb20p
&gt;DQoNCkkgbGl2ZSBpbiBodHRwOi8vemVsY29tLmludGljaXR5LmNvbS4gDQpWaXNpdCBpZiB5b3Ug
&gt;aGF2ZSB0aW1lcyENCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
&gt;LS0NCiA=

Eeeeek!  Try sending your email as ASCII, please!

As long as they don't hold down the power switch for 4 seconds (that
causes an immediate poweroff that cannot be avoided in software), it
is technologically feasible to run shutdown when the power switch is
depressed.

The ACPI implementation is immature and in flux, but that is the
expected default behavior of the power button when ACPI is running.

michaelkjohnson

 "He that composes himself is wiser than he that composes a book."
 Linux Application Development                     -- Ben Franklin
 http://people.redhat.com/johnsonm/lad/



_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000801181014</emailId><senderName></senderName><senderEmail>donghee@eecad.sogang.ac.kr</senderEmail><timestampReceived>2000-08-01 18:10:14-0400</timestampReceived><subject>[Acpi] /proc/sys/acpi</subject><body>

[Attachment #2 (text/plain)]

Hi. 
 
I have installed Red hat 6.2.
And I upgraded my linux kernel to 2.4.0-test5.
Of course, I check ACPI menu like following.
 
CONFIG_ACPI=y
CONFIG_ACPI_INTERPRETER=y
CONFIG_ACPI_S1_SLEEP=y
 
I succedded kernel upgrade. After I reboot my linux box,
upgraded kernel is working well.
But, my linux box do not have /proc/sys/acpi directory.
In Howto, /proc/sys/acpi directory does not exist, 
odds are you didn't configure the kernel correctly.
What can i do for correctly kernel upgrade??

 
-------------------------
# ICQ : 30896574
-------------------------

[Attachment #3 (text/html)]

&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"&gt;
&lt;HTML&gt;&lt;HEAD&gt;
&lt;META content="text/html; charset=ks_c_5601-1987" http-equiv=Content-Type&gt;
&lt;META content="MSHTML 5.00.2920.0" name=GENERATOR&gt;
&lt;STYLE&gt;&lt;/STYLE&gt;
&lt;/HEAD&gt;
&lt;BODY bgColor=#ffffff&gt;
&lt;DIV&gt;
&lt;DIV&gt;&lt;FONT size=2&gt;Hi. &lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT size=2&gt;&lt;/FONT&gt;Â &lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT size=2&gt;I have installed Red hat 6.2.&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT size=2&gt;And I upgraded my linux kernel to 2.4.0-test5.&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT size=2&gt;Of course, I check ACPI menu like following.&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT size=2&gt;&lt;/FONT&gt;Â &lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT 
size=2&gt;CONFIG_ACPI=y&lt;BR&gt;CONFIG_ACPI_INTERPRETER=y&lt;BR&gt;CONFIG_ACPI_S1_SLEEP=y&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT size=2&gt;&lt;/FONT&gt;Â &lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT size=2&gt;I succedded kernel upgrade. After I reboot my linux 
box,&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT size=2&gt;upgraded kernel is working well.&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT size=2&gt;But,Â my linux box do not have /proc/sys/acpi 
directory.&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT size=2&gt;In Howto, /proc/sys/acpi directory does not exist, 
&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT size=2&gt;odds are you didn't configure the kernel 
correctly.&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT size=2&gt;What can i do for correctly kernel upgrade??&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT size=2&gt;&lt;BR&gt;Â &lt;/DIV&gt;&lt;/FONT&gt;
&lt;DIV&gt;&lt;FONT size=2&gt;-------------------------&lt;BR&gt;# ICQ : 
30896574&lt;BR&gt;-------------------------&lt;/FONT&gt;&lt;/DIV&gt;&lt;/DIV&gt;&lt;/BODY&gt;&lt;/HTML&gt;

_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi


</body></email><email><emailId>20000801191517</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-08-01 19:15:17-0400</timestampReceived><subject>Re: [Acpi] help me.</subject><body>

On Tue, 1 Aug 2000, Yuki Ogawa wrote:

&gt; I always have to add ".en" at the end of URL to access.
&gt; i.e.
&gt; &lt;http://phobos.fachschaften.tu-muenchen.de/acpi/index.html.en&gt;

&gt; why?

Our Apache does content negotiation, i.e. it gives you the document in
your preferred language, however this requires that you have set this up
in your browser. There are quite a lot of people who read the German
pages, so I'm not too keen on dropping them. I'll see whether I can hack
something up. :-)

   Simon

-- 
PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!



_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000803142132</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-08-03 14:21:32-0400</timestampReceived><subject>[Acpi] RE: ACPI: namespace load failed (fwd)</subject><body>

&gt;From the lkml

---------- Forwarded message ----------
Date: Wed, 02 Aug 2000 14:39:25 -0300
From: Garst R. Reese &lt;reese@isn.net&gt;
Cc: linux-kernel &lt;linux-kernel@vger.rutgers.edu&gt;
Subject: RE: ACPI: namespace load failed


Tigran Aivazian &lt;tigran@veritas.com&gt; noted:

	Hi guys,

	I enabled ACPI support and get "ACPI: support found" on boot followed 	
by
	"ACPI: namespace load failed". I don't know ACPI spec. I enabled ACPI 	
in the BIOS and the motherboard manual (GA 6BXD) says it does support 	
ACPI.
Same here, also this in /var/adm/debug
This is on an IBM Thinkpad 380D
Aug  1 22:03:12 aar acpid: ACPI Subsystem version [Jun  1 2000]
Aug  1 22:03:12 aar acpid:  tbutils-0240: 
Aug  1 22:03:12 aar acpid: *** Error: Invalid ACPI table checksum
Aug  1 22:03:12 aar acpid: nsapinam-0058: 
Aug  1 22:03:12 aar acpid: DSDT is not in memory
Aug  1 22:03:12 aar acpid: OsdBreakpoint: Fatal error encountered
Garst

-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at http://www.tux.org/lkml/



_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000803181229</emailId><senderName>Freud</senderName><senderEmail>freud@iona.unloved.org</senderEmail><timestampReceived>2000-08-03 18:12:29-0400</timestampReceived><subject>[Acpi] problems shutting down on an ASUS CUBX</subject><body>

Hello there,

I am having problems shutting down on my computer. When I do a poweroff, the last \
                message that I have on my screen is:
ACPI: S5 Failed.

However, my dmesg says :  
ACPI: support found
ACPI: PBLK 1 @ 0xe410:6
ACPI: C2 supported
ACPI: 7 throttling states
ACPI: S1 supported
ACPI: S5 supported
ACPI C2 works

I am using linux kernel 2.4.0-test5 with acpi compiled in. Also, I am using acpid \
version 071100. The mobo I am using is an ASUS CUBX, no upgrades made to the BIOS.    \


Can any1 help me? Thanks in advance..if You need more information..I'll look it up :)

Greetz,

FreudO


_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi


</body></email><email><emailId>20000803224651</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-08-03 22:46:51-0400</timestampReceived><subject>RE: [Acpi] acpi questions (fwd)</subject><body>

&gt; From: Garst R. Reese [mailto:reese@isn.net]
&gt; &gt; &gt; 4. What does DSDT stand for?
&gt; &gt; 
&gt; &gt; Differentiated System Description Table. This is where the 
&gt; motherboard's
&gt; &gt; resources are described, in Acpi Machine Language (AML).
&gt; 
&gt; Is there a way to build a correct substitute? The motherboard's
&gt; resources are
&gt; known.
&gt; If not, then I think it is a bug to treat acpi as working on this
&gt; machine, and it should have reverted to apm.

Microsoft basically does this when installing the OS:

if (on good bios list)
	install in ACPI mode
else if (bios date after x)
	install in ACPI mode
else
	install in APM/legacy mode

Note that they do this at system install time, so if you install in APM,
upgrade bios, you're still in APM mode.

I think the same thing is appropriate for us, but system boot may be a
better time to make the choice.

Regards -- Andy



_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000805165835</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-08-05 16:58:35-0400</timestampReceived><subject>Re: [Acpi] ACPI: namespace load failed (fwd)</subject><body>

Hi,

I think this was intended for the list, but never made it there. Remember
the list drops BCCs...

   Simon

-- 
PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

---------- Forwarded message ----------
Date: Wed, 2 Aug 2000 21:42:39 +0200 (CEST)
From: roby@localhost.localdomain
Reply-To: acpi@phobos.fachschaften.tu-muenchen.de
To: Simon Richter &lt;Simon.Richter@phobos.fachschaften.tu-muenchen.de&gt;
Subject: Re: [Acpi] ACPI: namespace load failed

On Wed, 2 Aug 2000 16:03:07 +0200 (CEST) you wrote:

The same happens to me.
An ABIT BP6 with "RU" version of BIOS
An Adaptec AIC-7850 SCSI adapter (PCI card)
An ESS ES1868 Plug and Play sound card (ISA card)
An NE2000 compatible network card (ISA card)
A RIVATNT2 M64 

I tried to remove the ESS ES1868 and NE2000 from the PC and
I get the same result

This is what I get from messages log:
----------------------------------
Kernel command line: BOOT_IMAGE=l ro root=2107 ACPI=tables,copy-tables,trust-tables

.......     : IO APIC version: 0011
ACPI: "ABIT" found at 0x000f7370
------------------------------------

Hope usefull






 &gt; &gt;From the lkml
 &gt; 
 &gt; ---------- Forwarded message ----------
 &gt; Date: Wed, 2 Aug 2000 09:47:47 +0100 (BST)
 &gt; From: Tigran Aivazian &lt;tigran@veritas.com&gt;
 &gt; Cc: andy_henroid@yahoo.com
 &gt; Subject: ACPI: namespace load failed
 &gt; 
 &gt; Hi guys,
 &gt; 
 &gt; I enabled ACPI support and get "ACPI: support found" on boot followed by
 &gt; "ACPI: namespace load failed". I don't know ACPI spec. I enabled ACPI in
 &gt; the BIOS and the motherboard manual (GA 6BXD) says it does support ACPI.
 &gt; 
 &gt; Any ideas?
 &gt; 
 &gt; (this is not critical for me as I utterly don't care about any PM - I was
 &gt; just going through various bits to see if they are working or not and am
 &gt; willing to help debugging what is broken)
 &gt; 
 &gt; Regards,
 &gt; Tigran
 &gt; 
 &gt; 
 &gt; -
 &gt; To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
 &gt; the body of a message to majordomo@vger.rutgers.edu
 &gt; Please read the FAQ at http://www.tux.org/lkml/
 &gt; 
 &gt; 
 &gt; 
 &gt; ---------- Forwarded message ----------
 &gt; Date: Wed, 2 Aug 2000 09:48:25 +0100 (BST)
 &gt; From: Tigran Aivazian &lt;tigran@veritas.com&gt;
 &gt; Cc: andy_henroid@yahoo.com
 &gt; Subject: Re: ACPI: namespace load failed
 &gt; 
 &gt; forgot to mention that it is a 2.4.0-test6-pre1 running on dual
 &gt; PIII/550MHz with 512M RAM.
 &gt; 
 &gt; On Wed, 2 Aug 2000, Tigran Aivazian wrote:
 &gt; 
 &gt; &gt; Hi guys,
 &gt; &gt; 
 &gt; &gt; I enabled ACPI support and get "ACPI: support found" on boot followed by
 &gt; &gt; "ACPI: namespace load failed". I don't know ACPI spec. I enabled ACPI in
 &gt; &gt; the BIOS and the motherboard manual (GA 6BXD) says it does support ACPI.
 &gt; &gt; 
 &gt; &gt; Any ideas?
 &gt; &gt; 
 &gt; &gt; (this is not critical for me as I utterly don't care about any PM - I was
 &gt; &gt; just going through various bits to see if they are working or not and am
 &gt; &gt; willing to help debugging what is broken)
 &gt; &gt; 
 &gt; &gt; Regards,
 &gt; &gt; Tigran
 &gt; &gt; 
 &gt; &gt; 
 &gt; 
 &gt; 
 &gt; -
 &gt; To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
 &gt; the body of a message to majordomo@vger.rutgers.edu
 &gt; Please read the FAQ at http://www.tux.org/lkml/
 &gt; 
 &gt; 
 &gt; 
 &gt; _______________________________________________
 &gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
 &gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi


--
----------------------------
Roberto Checcozzo
Home Linux Box
----------------------------






_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000805171234</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-08-05 17:12:34-0400</timestampReceived><subject>[Acpi] apm on ThinkPad 380XD (fwd)</subject><body>

&gt;From the lkml.

---------- Forwarded message ----------
Date: Sat, 05 Aug 2000 12:20:47 -0300
From: Garst R. Reese &lt;reese@isn.net&gt;
Cc: andy_henroid@yahoo.com
Subject: apm on ThinkPad 380XD

apm -s works on 2.2.13, 2.3.51, but not 2.4.0testx after acpi stuff went
in.
acpi is off
CONFIG_PM=y
# CONFIG_ACPI is not set
CONFIG_APM=m
# CONFIG_APM_IGNORE_USER_SUSPEND is not set
CONFIG_APM_DO_ENABLE=y
CONFIG_APM_CPU_IDLE=y
CONFIG_APM_DISPLAY_BLANK=y
# CONFIG_APM_RTC_IS_GMT is not set
CONFIG_APM_ALLOW_INTS=y
# CONFIG_APM_REAL_MODE_POWER_OFF is not set

I think the acpi changes screwed up CONFIG_APM_ALLOW_INTS=y
Garst

-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at http://www.tux.org/lkml/



_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000805173621</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-08-05 17:36:21-0400</timestampReceived><subject>[Acpi] Re: apm on ThinkPad 380XD</subject><body>

On Sat, 5 Aug 2000, Garst R. Reese wrote:

&gt; Apologies to ACPI4Linux, but they should also check if DSDT works before
&gt; assuming that acpi works. On the Thinkpad 380XD I end up with an empty
&gt; /proc/dstd but apm is then disabled.

Well, it would be cool to have a good BIOS/bad BIOS list. Max started this
some time ago, but the data is getting out of date, so we'd need an easy
way for users to submit new data and to check whether their BIOS is good.

Max/others, any ideas?

   Simon

-- 
PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!



_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000808154826</emailId><senderName>Casey Scott</senderName><senderEmail>casey.scott@gte.net</senderEmail><timestampReceived>2000-08-08 15:48:26-0400</timestampReceived><subject>Re: acpi digest, Vol 1 #232 - 1 msg</subject><body>

Is there a way to configure the acpid? Something like a acpid.conf? I don't
know how the acpid knows when/what to suspend?  So far no luck in X. It seems
that for some reason, activity in X is registering with acpid. 

Casey




On Mon, 07 Aug 2000, acpi-admin@phobos.fachschaften.tu-muenchen.de wrote:
&gt; Send acpi mailing list submissions to
&gt; 	acpi@phobos.fachschaften.tu-muenchen.de
&gt; 
&gt; To subscribe or unsubscribe via the web, visit
&gt; 	http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; or, via email, send a message with subject or body 'help' to
&gt; 	acpi-request@phobos.fachschaften.tu-muenchen.de
&gt; You can reach the person managing the list at
&gt; 	acpi-admin@phobos.fachschaften.tu-muenchen.de
&gt; 
&gt; When replying, please edit your Subject line so it is more specific than
&gt; "Re: Contents of acpi digest..."
&gt; 
&gt; 
&gt; Today's Topics:
&gt; 
&gt;   1. Re: X suspending (Casey Scott)
&gt; 
&gt; --__--__--
&gt; 
&gt; Message: 1
&gt; From: Casey Scott &lt;casey.scott@gte.net&gt;
&gt; To: Simon Richter &lt;Simon.Richter@phobos.fachschaften.tu-muenchen.de&gt;
&gt; Subject: Re: [Acpi] X suspending
&gt; Date: Mon, 7 Aug 2000 10:46:14 -0500
&gt; Cc: acpi@phobos.fachschaften.tu-muenchen.de
&gt; 
&gt; On Sat, 05 Aug 2000, Simon Richter wrote:
&gt; &gt; On Fri, 4 Aug 2000, Casey Scott wrote:
&gt; &gt; 
&gt; 
&gt; Yes, I am running ACPI, and nothing else. I didn't compile APM support into the
&gt; kernel, and APM is disabled in the BIOS. The BIOS is set to use ACPI for power
&gt; management. I am going to try tinkering around some more, I'll let you know if
&gt; anything works.
&gt; 
&gt; Casey
&gt; 
&gt;  &gt; &gt; Yes, sorry. It suspends the display while I am using it X, which
&gt; means that &gt; &gt; the X activity is make it to the acpid. &gt; 
&gt; &gt; Are you sure you are using ACPI? I've seen things like this occur with
&gt; &gt; APM, and since AFAIK the keyboard handling code in X11 changed before 4.0,
&gt; &gt; it may very well be possible that the keycodes are intercepted before APM
&gt; &gt; sees them.
&gt; &gt; 
&gt; &gt;    Simon
&gt; &gt; 
&gt; &gt; -- 
&gt; &gt; PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
&gt; &gt;  Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
&gt; &gt; Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!
&gt; 
&gt; 
&gt; 
&gt; 
&gt; --__--__--
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; 
&gt; 
&gt; End of acpi Digest

</body></email><email><emailId>20000808160607</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-08-08 16:06:07-0400</timestampReceived><subject>[Acpi] Re: acpi digest, Vol 1 #232 - 1 msg</subject><body>


Casey Scott writes:
&gt;Is there a way to configure the acpid? Something like a acpid.conf? I don't
&gt;know how the acpid knows when/what to suspend?  So far no luck in X. It seems

There will be, there isn't now.

michaelkjohnson

 "He that composes himself is wiser than he that composes a book."
 Linux Application Development                     -- Ben Franklin
 http://people.redhat.com/johnsonm/lad/



_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000803142315</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-08-03 14:23:15-0400</timestampReceived><subject>[Acpi] acpi questions (fwd)</subject><body>

&gt;From the lkml

---------- Forwarded message ----------
Date: Thu, 03 Aug 2000 05:16:23 -0300
From: Garst R. Reese &lt;reese@isn.net&gt;
Cc: linux-kernel &lt;linux-kernel@vger.rutgers.edu&gt;
Subject: acpi questions

1. What do these error messages mean?
 in /var/adm/debug
This is on an IBM Thinkpad 380D
Aug  1 22:03:12 aar acpid: ACPI Subsystem version [Jun  1 2000]
Aug  1 22:03:12 aar acpid:  tbutils-0240: 
Aug  1 22:03:12 aar acpid: *** Error: Invalid ACPI table checksum
Aug  1 22:03:12 aar acpid: nsapinam-0058: 
Aug  1 22:03:12 aar acpid: DSDT is not in memory
Aug  1 22:03:12 aar acpid: OsdBreakpoint: Fatal error encountered
2. from pm.txt
  "If a working ACPI implementation is found, the
ACPI driver will override and disable APM, otherwise the APM driver
will be used."
What is meant here by -working-
3. Does anybody have acpi working to their advantage?
4. What does DSDT stand for?
5. Do any of the above error msgs make sense to anybody.
6. Is there any *real* advantage to acpi vs apm?
7. Has it been implemented in *any* drivers?
Garst

-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at http://www.tux.org/lkml/



_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000802103137</emailId><senderName>George Talusan</senderName><senderEmail>gstalusan@uwaterloo.ca</senderEmail><timestampReceived>2000-08-02 10:31:37-0400</timestampReceived><subject>Re: [Acpi] ACPI: namespace load failed</subject><body>


I get the same message with my Abit BP6 using 2.4.0-test5.
I got pretty much the same result with the old ACPI modules as
well.

I'm running a 2xCelery 466.

-- - gst
George Talusan, gstalusan@uwaterloo.ca


On Wed, 2 Aug 2000, Simon Richter wrote:
&gt; ---------- Forwarded message ----------
&gt; Date: Wed, 2 Aug 2000 09:47:47 +0100 (BST)
&gt; From: Tigran Aivazian &lt;tigran@veritas.com&gt;
&gt; Cc: andy_henroid@yahoo.com
&gt; Subject: ACPI: namespace load failed
&gt; 
&gt; Hi guys,
&gt; 
&gt; I enabled ACPI support and get "ACPI: support found" on boot followed by
&gt; "ACPI: namespace load failed". I don't know ACPI spec. I enabled ACPI in
&gt; the BIOS and the motherboard manual (GA 6BXD) says it does support ACPI.
&gt; 
&gt; Any ideas?
&gt; 
&gt; (this is not critical for me as I utterly don't care about any PM - I was
&gt; just going through various bits to see if they are working or not and am
&gt; willing to help debugging what is broken)
&gt; 
&gt; Regards,
&gt; Tigran
&gt; 
&gt; 
&gt; -
&gt; To unsubscribe from this list: send the line "unsubscribe linux-kernel"
&gt; in
&gt; the body of a message to majordomo@vger.rutgers.edu
&gt; Please read the FAQ at http://www.tux.org/lkml/
&gt; 
&gt; 
&gt; 



_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000805172512</emailId><senderName>"Garst R. Reese"</senderName><senderEmail>reese@isn.net</senderEmail><timestampReceived>2000-08-05 17:25:12-0400</timestampReceived><subject>[Acpi] Re: apm on ThinkPad 380XD</subject><body>

Simon Richter wrote:
&gt; 
&gt; On Sat, 5 Aug 2000, Garst R. Reese wrote:
&gt; 
&gt; [...]
&gt; 
&gt; &gt; I think the acpi changes screwed up CONFIG_APM_ALLOW_INTS=y
&gt; 
&gt; It would be cool if you'd copy the ACPI4Linux list &lt;acpi@phobos.fs.tum.de&gt;
&gt; with everything ACPI related, since most of the developers at Intel don't
&gt; have the necessary time to read the lkml. I forward what seems relevant to
&gt; me, but sometimes mails slip through... :-)
&gt; 
&gt;    Simon
&gt; 
&gt; --
&gt; PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
&gt;  Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
&gt; Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!
Wilco
But I found the problem, and it was only coincidental that acpi happend
at the same time. Andy Hendroid disabled interrupts on suspend with a
cli.
This screwed my Thinkpad.
Apologies to ACPI4Linux, but they should also check if DSDT works before
assuming that acpi works. On the Thinkpad 380XD I end up with an empty
/proc/dstd but apm is then disabled.
Thanks for the feedback,
Garst


_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>200008081548260</emailId><senderName>Casey Scott</senderName><senderEmail>casey.scott@gte.net</senderEmail><timestampReceived>2000-08-08 15:48:26-0400</timestampReceived><subject>[Acpi] Re: acpi digest, Vol 1 #232 - 1 msg</subject><body>

Is there a way to configure the acpid? Something like a acpid.conf? I don't
know how the acpid knows when/what to suspend?  So far no luck in X. It seems
that for some reason, activity in X is registering with acpid. 

Casey




On Mon, 07 Aug 2000, acpi-admin@phobos.fachschaften.tu-muenchen.de wrote:
&gt; Send acpi mailing list submissions to
&gt; 	acpi@phobos.fachschaften.tu-muenchen.de
&gt; 
&gt; To subscribe or unsubscribe via the web, visit
&gt; 	http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; or, via email, send a message with subject or body 'help' to
&gt; 	acpi-request@phobos.fachschaften.tu-muenchen.de
&gt; You can reach the person managing the list at
&gt; 	acpi-admin@phobos.fachschaften.tu-muenchen.de
&gt; 
&gt; When replying, please edit your Subject line so it is more specific than
&gt; "Re: Contents of acpi digest..."
&gt; 
&gt; 
&gt; Today's Topics:
&gt; 
&gt;   1. Re: X suspending (Casey Scott)
&gt; 
&gt; --__--__--
&gt; 
&gt; Message: 1
&gt; From: Casey Scott &lt;casey.scott@gte.net&gt;
&gt; To: Simon Richter &lt;Simon.Richter@phobos.fachschaften.tu-muenchen.de&gt;
&gt; Subject: Re: [Acpi] X suspending
&gt; Date: Mon, 7 Aug 2000 10:46:14 -0500
&gt; Cc: acpi@phobos.fachschaften.tu-muenchen.de
&gt; 
&gt; On Sat, 05 Aug 2000, Simon Richter wrote:
&gt; &gt; On Fri, 4 Aug 2000, Casey Scott wrote:
&gt; &gt; 
&gt; 
&gt; Yes, I am running ACPI, and nothing else. I didn't compile APM support into the
&gt; kernel, and APM is disabled in the BIOS. The BIOS is set to use ACPI for power
&gt; management. I am going to try tinkering around some more, I'll let you know if
&gt; anything works.
&gt; 
&gt; Casey
&gt; 
&gt;  &gt; &gt; Yes, sorry. It suspends the display while I am using it X, which
&gt; means that &gt; &gt; the X activity is make it to the acpid. &gt; 
&gt; &gt; Are you sure you are using ACPI? I've seen things like this occur with
&gt; &gt; APM, and since AFAIK the keyboard handling code in X11 changed before 4.0,
&gt; &gt; it may very well be possible that the keycodes are intercepted before APM
&gt; &gt; sees them.
&gt; &gt; 
&gt; &gt;    Simon
&gt; &gt; 
&gt; &gt; -- 
&gt; &gt; PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
&gt; &gt;  Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
&gt; &gt; Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!
&gt; 
&gt; 
&gt; 
&gt; 
&gt; --__--__--
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; 
&gt; 
&gt; End of acpi Digest


_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000804124623</emailId><senderName>Casey Scott</senderName><senderEmail>casey.scott@gte.net</senderEmail><timestampReceived>2000-08-04 12:46:23-0400</timestampReceived><subject>[Acpi] X suspending</subject><body>


Using kernel 2.4.0test 5, and X 4.0.1 I am having a problem w/ X suspending.
When it suspends in X, there is no way to break the suspension. I have to go to
another terminal, and then go back into X to break it. The suspension breaks
normally from a prompt w/ movement of the mouse. Any suggestions?

Thanks
Casey


_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000814224424</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-08-14 22:44:24-0400</timestampReceived><subject>[Acpi] RE: ACPI error during boot</subject><body>

Hi Sasa,

Basically, it looks like it's trying to find out which sleep states your pc
supports, but the data being returned is not in the format expected (the
code is at linux/drivers/acpi/hardware/hwregs.c line 176 if you're
interested).

It *should* be fixed, but I don't think it will hurt anything for it to be
temporarily broken...

Regards -- Andy

&gt; -----Original Message-----
&gt; From: Sasa Ostrouska [mailto:maja.ostrouska@kiss.uni-lj.si]

&gt; Hello to everybody !
&gt; 
&gt; 	I'm using the linux-2.4.0.test6 kernel and I noticed the
&gt; following error during the boot time:
&gt; 
&gt; 
&gt;  devfs: v0.102 (20000622) Richard Gooch (rgooch@atnf.csiro.au)
&gt; devfs: boot_options: 0x0
&gt; kmem_create: Forcing size word alignment - nfs_fh
&gt; ACPI: support found
&gt; ACPI: PBLK 1 @ 0x4010:6
&gt; ACPI:         -0176: &lt;7&gt;ACPI: *** Error: Object type returned from
&gt; interpreter differs from expected value
&gt; ACPI:         -0176: &lt;7&gt;ACPI: *** Error: Object type returned from
&gt; interpreter differs from expected value
&gt; ACPI: S1 supported
&gt; VFS: Mounted root (ext2 filesystem) readonly.
&gt; Mounted devfs on /dev
&gt; 
&gt; 
&gt; Can somebody explain what this is and if it has to be fixed some way ?
&gt; 
&gt; I have an SMP dual PII350 box.
&gt; 
&gt; Thank you in advance and best regards

&gt; 

</body></email><email><emailId>20000815044024</emailId><senderName>David Ford</senderName><senderEmail>david@kalifornia.com</senderEmail><timestampReceived>2000-08-15 04:40:24-0400</timestampReceived><subject>[Acpi] Re: ACPI error during boot</subject><body>


Hmm.  I doubt it is fixed.  Of the dozens of different machines I have, I have
yet to find one that doesn't blabber errors or warnings on boot about ACPI.

-d

"Grover, Andrew" wrote:

&gt; Hi Sasa,
&gt;
&gt; Basically, it looks like it's trying to find out which sleep states your pc
&gt; supports, but the data being returned is not in the format expected (the
&gt; code is at linux/drivers/acpi/hardware/hwregs.c line 176 if you're
&gt; interested).
&gt;
&gt; It *should* be fixed, but I don't think it will hurt anything for it to be
&gt; temporarily broken...
&gt;
&gt; Regards -- Andy
&gt;
&gt; &gt; -----Original Message-----
&gt; &gt; From: Sasa Ostrouska [mailto:maja.ostrouska@kiss.uni-lj.si]
&gt;
&gt; &gt; Hello to everybody !
&gt; &gt;
&gt; &gt;       I'm using the linux-2.4.0.test6 kernel and I noticed the
&gt; &gt; following error during the boot time:
&gt; &gt;
&gt; &gt;
&gt; &gt;  devfs: v0.102 (20000622) Richard Gooch (rgooch@atnf.csiro.au)
&gt; &gt; devfs: boot_options: 0x0
&gt; &gt; kmem_create: Forcing size word alignment - nfs_fh
&gt; &gt; ACPI: support found
&gt; &gt; ACPI: PBLK 1 @ 0x4010:6
&gt; &gt; ACPI:         -0176: &lt;7&gt;ACPI: *** Error: Object type returned from
&gt; &gt; interpreter differs from expected value
&gt; &gt; ACPI:         -0176: &lt;7&gt;ACPI: *** Error: Object type returned from
&gt; &gt; interpreter differs from expected value
&gt; &gt; ACPI: S1 supported
&gt; &gt; VFS: Mounted root (ext2 filesystem) readonly.
&gt; &gt; Mounted devfs on /dev
&gt; &gt;
&gt; &gt;
&gt; &gt; Can somebody explain what this is and if it has to be fixed some way ?
&gt; &gt;
&gt; &gt; I have an SMP dual PII350 box.
&gt; &gt;
&gt; &gt; Thank you in advance and best regards
&gt;
&gt; &gt;
&gt;
&gt; -
&gt; To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
&gt; the body of a message to majordomo@vger.rutgers.edu
&gt; Please read the FAQ at http://www.tux.org/lkml/

--
"The difference between 'involvement' and 'commitment' is like an
eggs-and-ham breakfast: the chicken was 'involved' - the pig was
'committed'."



["david.vcf" (text/x-vcard)]

</body></email><email><emailId>20000804130439</emailId><senderName>Casey Scott</senderName><senderEmail>casey.scott@gte.net</senderEmail><timestampReceived>2000-08-04 13:04:39-0400</timestampReceived><subject>[Acpi] X suspending</subject><body>

Using kernel 2.4.0test 5, and X 4.0.1 I am having a problem w/ X suspending.
When it suspends in X, there is no way to break the suspension. I have to go to
another terminal, and then go back into X to break it. The suspension breaks
normally from a prompt w/ movement of the mouse. Any suggestions?

Thanks
Casey


_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000804170653</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-08-04 17:06:53-0400</timestampReceived><subject>Re: [Acpi] X suspending</subject><body>

On Fri, 4 Aug 2000, Casey Scott wrote:

&gt; Using kernel 2.4.0test 5, and X 4.0.1 I am having a problem w/ X suspending.
&gt; When it suspends in X, there is no way to break the suspension. I have to go to
&gt; another terminal, and then go back into X to break it. The suspension breaks
&gt; normally from a prompt w/ movement of the mouse. Any suggestions?

Do you mean suspending the computer or the display? Your description
sounds like the latter, and my first suspicion would be that the display
isn't put into suspend mode by X but by the OS. X thus thinks it doesn't
need to reinitialize the graphics board. But that's only a rough guess,
based on what's usually the cause :-) ...

To the list: I haven't been following the development lately, is there an
explanation why the kernel would suspend the display with ACPI (I know APM
does this)?

   Simon

-- 
PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!



_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000804230640</emailId><senderName>Casey Scott</senderName><senderEmail>casey.scott@gte.net</senderEmail><timestampReceived>2000-08-04 23:06:40-0400</timestampReceived><subject>Re: [Acpi] X suspending</subject><body>

On Fri, 04 Aug 2000, Simon Richter wrote:
&gt; On Fri, 4 Aug 2000, Casey Scott wrote:

Yes, sorry. It suspends the display while I am using it X, which means that
the X activity is make it to the acpid. Any ideas on how to stop that from
happening? LIke I stated earlier, the prompt behaves normally. This problem is
just in X (Window Maker)

&gt;  &gt; &gt; Using kernel 2.4.0test 5, and X 4.0.1 I am having a problem w/ X
suspending. &gt; &gt; When it suspends in X, there is no way to break the suspension.
I have to go to &gt; &gt; another terminal, and then go back into X to break it. The
suspension breaks &gt; &gt; normally from a prompt w/ movement of the mouse. Any
suggestions? &gt;  &gt; Do you mean suspending the computer or the display? Your
description &gt; sounds like the latter, and my first suspicion would be that the
display &gt; isn't put into suspend mode by X but by the OS. X thus thinks it
doesn't &gt; need to reinitialize the graphics board. But that's only a rough
guess, &gt; based on what's usually the cause :-) ...
&gt; 
&gt; To the list: I haven't been following the development lately, is there an
&gt; explanation why the kernel would suspend the display with ACPI (I know APM
&gt; does this)?
&gt; 
&gt;    Simon
&gt; 
&gt; -- 
&gt; PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
&gt;  Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
&gt; Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!


_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000805052652</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-08-05 05:26:52-0400</timestampReceived><subject>Re: [Acpi] X suspending</subject><body>

On Fri, 4 Aug 2000, Casey Scott wrote:

&gt; Yes, sorry. It suspends the display while I am using it X, which means that
&gt; the X activity is make it to the acpid.

Are you sure you are using ACPI? I've seen things like this occur with
APM, and since AFAIK the keyboard handling code in X11 changed before 4.0,
it may very well be possible that the keycodes are intercepted before APM
sees them.

   Simon

-- 
PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!



_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000807154614</emailId><senderName>Casey Scott</senderName><senderEmail>casey.scott@gte.net</senderEmail><timestampReceived>2000-08-07 15:46:14-0400</timestampReceived><subject>Re: [Acpi] X suspending</subject><body>

On Sat, 05 Aug 2000, Simon Richter wrote:
&gt; On Fri, 4 Aug 2000, Casey Scott wrote:
&gt; 

Yes, I am running ACPI, and nothing else. I didn't compile APM support into the
kernel, and APM is disabled in the BIOS. The BIOS is set to use ACPI for power
management. I am going to try tinkering around some more, I'll let you know if
anything works.

Casey

 &gt; &gt; Yes, sorry. It suspends the display while I am using it X, which
means that &gt; &gt; the X activity is make it to the acpid. &gt; 
&gt; Are you sure you are using ACPI? I've seen things like this occur with
&gt; APM, and since AFAIK the keyboard handling code in X11 changed before 4.0,
&gt; it may very well be possible that the keycodes are intercepted before APM
&gt; sees them.
&gt; 
&gt;    Simon
&gt; 
&gt; -- 
&gt; PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
&gt;  Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
&gt; Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!


_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000809170623</emailId><senderName>Casey Scott</senderName><senderEmail>casey.scott@gte.net</senderEmail><timestampReceived>2000-08-09 17:06:23-0400</timestampReceived><subject>[Acpi] X suspending</subject><body>


After several hours of tinkering, I have concluded that at least on this system
the best way to break an suspension in X is to Cntrl-Alt-F7. For some reason,
Cntrl-Alt-function key seems to recognized and breaks the suspension regardless
of whether or not the system is in a X session or console. No big deal I guess,
other than it suspending while I am using X. I'll just have to remember to hit
those keys rather than bumping the mouse. I don't suppose anyone knows how to
edit the keys that are suppose to break the suspension? 

Casey


_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000809185941</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-08-09 18:59:41-0400</timestampReceived><subject>Re: [Acpi] X suspending</subject><body>

On Wed, 9 Aug 2000, Casey Scott wrote:

[Ctrl-Alt-Fx] breaks the suspension]

&gt; I don't suppose anyone knows how to edit the keys that are suppose to
&gt; break the suspension?

It isn't possible at all because of the way this works. Ctrl-Alt-Fx
changes console in X, changing console means X setting up the graphics
board. That's why it works. :-)

If I could understand about the nature of the problem, I would probably
submit a patch to either Andy or XFree86. So far, I only have the
suspicion that ACPI blanks the console without X knowing. I would
appreciate if someone who is more into the code and has more time on
his/her hands would take a look at it.

   Simon

-- 
PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!



_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000802140307</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-08-02 14:03:07-0400</timestampReceived><subject>[Acpi] ACPI: namespace load failed</subject><body>

&gt;From the lkml

---------- Forwarded message ----------
Date: Wed, 2 Aug 2000 09:47:47 +0100 (BST)
From: Tigran Aivazian &lt;tigran@veritas.com&gt;
Cc: andy_henroid@yahoo.com
Subject: ACPI: namespace load failed

Hi guys,

I enabled ACPI support and get "ACPI: support found" on boot followed by
"ACPI: namespace load failed". I don't know ACPI spec. I enabled ACPI in
the BIOS and the motherboard manual (GA 6BXD) says it does support ACPI.

Any ideas?

(this is not critical for me as I utterly don't care about any PM - I was
just going through various bits to see if they are working or not and am
willing to help debugging what is broken)

Regards,
Tigran


-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at http://www.tux.org/lkml/



---------- Forwarded message ----------
Date: Wed, 2 Aug 2000 09:48:25 +0100 (BST)
From: Tigran Aivazian &lt;tigran@veritas.com&gt;
Cc: andy_henroid@yahoo.com
Subject: Re: ACPI: namespace load failed

forgot to mention that it is a 2.4.0-test6-pre1 running on dual
PIII/550MHz with 512M RAM.

On Wed, 2 Aug 2000, Tigran Aivazian wrote:

&gt; Hi guys,
&gt; 
&gt; I enabled ACPI support and get "ACPI: support found" on boot followed by
&gt; "ACPI: namespace load failed". I don't know ACPI spec. I enabled ACPI in
&gt; the BIOS and the motherboard manual (GA 6BXD) says it does support ACPI.
&gt; 
&gt; Any ideas?
&gt; 
&gt; (this is not critical for me as I utterly don't care about any PM - I was
&gt; just going through various bits to see if they are working or not and am
&gt; willing to help debugging what is broken)
&gt; 
&gt; Regards,
&gt; Tigran
&gt; 
&gt; 


-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at http://www.tux.org/lkml/



_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000803033241</emailId><senderName>"Jeong Hwan Park"</senderName><senderEmail>jhpark@brainzsquare.com</senderEmail><timestampReceived>2000-08-03 03:32:41-0400</timestampReceived><subject>RE: [Acpi] ACPI: namespace load failed</subject><body>

I get the same message with my Giga Byte BX2000+ using 2.4.0-test3 and
2.4.0-test5.




_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000803163210</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-08-03 16:32:10-0400</timestampReceived><subject>RE: [Acpi] acpi questions (fwd)</subject><body>


&gt; From: Garst R. Reese &lt;reese@isn.net&gt;
&gt; 1. What do these error messages mean?
&gt;  in /var/adm/debug
&gt; This is on an IBM Thinkpad 380D
&gt; Aug  1 22:03:12 aar acpid: ACPI Subsystem version [Jun  1 2000]
&gt; Aug  1 22:03:12 aar acpid:  tbutils-0240: 
&gt; Aug  1 22:03:12 aar acpid: *** Error: Invalid ACPI table checksum
&gt; Aug  1 22:03:12 aar acpid: nsapinam-0058: 
&gt; Aug  1 22:03:12 aar acpid: DSDT is not in memory
&gt; Aug  1 22:03:12 aar acpid: OsdBreakpoint: Fatal error encountered

It means the acpi subsystem was unable to load the tables, apparently due to
an invalid checksum.

&gt; 2. from pm.txt
&gt;   "If a working ACPI implementation is found, the
&gt; ACPI driver will override and disable APM, otherwise the APM driver
&gt; will be used."
&gt; What is meant here by -working-

There are a number of tables that the bios provides, which the ACPI
subsystem consumes. These tables have to be laid out properly (checksums
work out, no illegal grammar, etc.) for ACPI to work. It looks like what may
be happening in your case is that your system has some ACPI support (or we
wouldn't be finding any tables) but that they're not correctly formatted.
Just a guess. Does IBM have any bios updates for that machine?

&gt; 3. Does anybody have acpi working to their advantage?

Yep. But, please realize that all the features of ACPI are not fully
implemented yet, i.e. it's still under active development.

&gt; 4. What does DSDT stand for?

Differentiated System Description Table. This is where the motherboard's
resources are described, in Acpi Machine Language (AML).

&gt; 5. Do any of the above error msgs make sense to anybody.

Yep ;-) The interpreter currently in the kernel releases has had most of the
debug output removed, but the plans are to have a patch which reincorporates
these, for debugging.

&gt; 6. Is there any *real* advantage to acpi vs apm?

Basically, APM is bad because the bios is in charge of power management, but
the OS is the one in the system which really has the best idea of what to
do. So, ACPI moves PM into the OS, but still relies on the bios for the
platform specific tables. It's still dependent on the platform bios, but not
as much.

IA64 also requires ACPI support.

&gt; 7. Has it been implemented in *any* drivers?

I don't think so. That's a big job that's coming up.

Regards -- Andy



_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000803175702</emailId><senderName>"Garst R. Reese"</senderName><senderEmail>reese@isn.net</senderEmail><timestampReceived>2000-08-03 17:57:02-0400</timestampReceived><subject>Re: [Acpi] acpi questions (fwd)</subject><body>

"Grover, Andrew" wrote:
&gt; 
&gt; &gt; From: Garst R. Reese &lt;reese@isn.net&gt;
&gt; &gt; 1. What do these error messages mean?
&gt; &gt;  in /var/adm/debug
&gt; &gt; This is on an IBM Thinkpad 380D
&gt; &gt; Aug  1 22:03:12 aar acpid: ACPI Subsystem version [Jun  1 2000]
&gt; &gt; Aug  1 22:03:12 aar acpid:  tbutils-0240:
&gt; &gt; Aug  1 22:03:12 aar acpid: *** Error: Invalid ACPI table checksum
&gt; &gt; Aug  1 22:03:12 aar acpid: nsapinam-0058:
&gt; &gt; Aug  1 22:03:12 aar acpid: DSDT is not in memory
&gt; &gt; Aug  1 22:03:12 aar acpid: OsdBreakpoint: Fatal error encountered
&gt; 
&gt; It means the acpi subsystem was unable to load the tables, apparently due to
&gt; an invalid checksum.

&gt; 
&gt; &gt; 2. from pm.txt
&gt; &gt;   "If a working ACPI implementation is found, the
&gt; &gt; ACPI driver will override and disable APM, otherwise the APM driver
&gt; &gt; will be used."
&gt; &gt; What is meant here by -working-
&gt; 
&gt; There are a number of tables that the bios provides, which the ACPI
&gt; subsystem consumes. These tables have to be laid out properly (checksums
&gt; work out, no illegal grammar, etc.) for ACPI to work. It looks like what may
&gt; be happening in your case is that your system has some ACPI support (or we
&gt; wouldn't be finding any tables) but that they're not correctly formatted.
&gt; Just a guess. Does IBM have any bios updates for that machine?

It is a pre-flash machine, IBM 380XD, PIIX4, mobile pentium. 
The other tables are present.

&gt; &gt; 3. Does anybody have acpi working to their advantage?
&gt; 
&gt; Yep. But, please realize that all the features of ACPI are not fully
&gt; implemented yet, i.e. it's still under active development.
&gt; 
&gt; &gt; 4. What does DSDT stand for?
&gt; 
&gt; Differentiated System Description Table. This is where the motherboard's
&gt; resources are described, in Acpi Machine Language (AML).

Is there a way to build a correct substitute? The motherboard's
resources are
known.
If not, then I think it is a bug to treat acpi as working on this
machine, and it should have reverted to apm.

&gt; &gt; 5. Do any of the above error msgs make sense to anybody.
&gt; 
&gt; Yep ;-) The interpreter currently in the kernel releases has had most of the
&gt; debug output removed, but the plans are to have a patch which reincorporates
&gt; these, for debugging.

I did not activate the interpreter because 120k seemed a bit much.

&gt; &gt; 6. Is there any *real* advantage to acpi vs apm?
&gt; 
&gt; Basically, APM is bad because the bios is in charge of power management, but
&gt; the OS is the one in the system which really has the best idea of what to
&gt; do. So, ACPI moves PM into the OS, but still relies on the bios for the
&gt; platform specific tables. It's still dependent on the platform bios, but not
&gt; as much.
&gt; 
&gt; IA64 also requires ACPI support.

That answers the question I did not ask for fear of sounding like a
flame:
Q. Why did ACPI go in so late in 2.3? 
A. for IA64

&gt; &gt; 7. Has it been implemented in *any* drivers?
&gt; 
&gt; I don't think so. That's a big job that's coming up.
&gt; 
&gt; Regards -- Andy
Thanks for the great response.
	Garst


_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000809021716</emailId><senderName>Han Dong Hee</senderName><senderEmail>donghee@eecad.sogang.ac.kr</senderEmail><timestampReceived>2000-08-09 02:17:16-0400</timestampReceived><subject>[Acpi] help. - dmesg error..</subject><body>

Hi.
When I executed "dmesg" command, I checked some errors.
plz tell me what these errors mean.

# dmesg
...
ACPI: support found
ACPI: PBLK 1 @ 0x4010:6
ACPI: C2 supported
ACPI: 7 throttling states
ACPI:         -0176: &lt;7&gt;ACPI: *** Error: Object type returned from interpreter d
iffers from expected value
ACPI:         -0176: &lt;7&gt;ACPI: *** Error: Object type returned from interpreter d
iffers from expected value
ACPI: S1 supported
ACPI C2 works
ACPI C3 works
...



_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000809194416</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-08-09 19:44:16-0400</timestampReceived><subject>[Acpi] List of good/bad BIOSes</subject><body>

Hi,

as some people have noticed, the list of BIOSes on
http://phobos.fs.tum.de/acpi/bios.sql is a bit outdated. I'd like to
change that, but before we start to gather information, I'd like to have
an your opinion what we should collect.

Currently this is:
 - Mainboard name and revision
 - BIOS revision (both visible and code in the FACP)
 - BIOS vendor/product code
 - Wakeup latency values for S2-S4
 - Width of the processor throttling register
 - Presence of BOOT and APIC table

   Simon

-- 
PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!



_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000810100927</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-08-10 10:09:27-0400</timestampReceived><subject>[Acpi] "ACPI is not safe for SMP" (fwd)</subject><body>

&gt;From the lkml.

---------- Forwarded message ----------
Date: Thu, 10 Aug 2000 11:08:32 +0200
From: HA Quoc-Viet &lt;viet@mandrakesoft.com&gt;
Subject: "ACPI is not safe for SMP"

hi all,


I don't know why people feel like removing ACPI on smp boxes,
but I've found this below :
http://www.asuscom.de/Products/Techref/Acpi/solution.html
this is actually a hardware flaw on some Asus motherboards that
will load the second CPU with spurious interrupts 50% of its time, no matter what.

It's definitely NOT kernel related then.

Now you might have other good reasons to disable acpi that I am not aware of,
so ...


Viet

-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at http://www.tux.org/lkml/



_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000810112241</emailId><senderName>Denis Chalon</senderName><senderEmail>denis_chalon@hp.com</senderEmail><timestampReceived>2000-08-10 11:22:41-0400</timestampReceived><subject>[Acpi] Subscription to ACPI list</subject><body>



--
__________________________________________________________________

Denis CHALON                            E-Mail:Denis_Chalon@hp.com
R&amp;D Engineer - Network Interface Cards  Tel: +33 (0)4 76 14 49 90
Hewlett-Packard France, Grenoble        HP TELNET: 779 4990
Business Desktop Division               Fax: +33 (0)4 76 14 43 36
___________________________________________________________________





_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000811132436</emailId><senderName>Casey Scott</senderName><senderEmail>casey.scott@gte.net</senderEmail><timestampReceived>2000-08-11 13:24:36-0400</timestampReceived><subject>[Acpi] X suspending</subject><body>


I haven't got ACPI working to my satisfaction yet. So in the meantime, in an
effort to preserve suspension I have done some other things.  

setterm -powersave on (turns on suspension for console)
setterm -store		(saves settings as default)

Enabled DPMS in X 4.0.1 so X session would suspend properly. I just thought I
would share this because it seemed some what difficult to find information on
this on the Internet, especially setterm settings. So at the very least, this
will suspend the monitor while trying to figure ACPI. Although it makes it more
complicated because I have to figure out which one is actually doing the
suspension. Easiest solution seems to be to remember the times that are set,
and time it with a watch to see if it is one of these methods (set to unusually
long times) or ACPI that is working. 

Casey


_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000813161117</emailId><senderName>Max Berger</senderName><senderEmail>max.berger@xslt.de</senderEmail><timestampReceived>2000-08-13 16:11:17-0400</timestampReceived><subject>Other languages on the web-sites (was:Re: [Acpi] help me.)</subject><body>

On Tue, 1 Aug 2000, Simon Richter wrote:
&gt; On Tue, 1 Aug 2000, Yuki Ogawa wrote:
&gt; &gt; I always have to add ".en" at the end of URL to access.
&gt; &gt; i.e.
&gt; &gt; &lt;http://phobos.fachschaften.tu-muenchen.de/acpi/index.html.en&gt;
&gt; &gt; why?
&gt; Our Apache does content negotiation, i.e. it gives you the document in
&gt; your preferred language, however this requires that you have set this up
&gt; in your browser. There are quite a lot of people who read the German
&gt; pages, so I'm not too keen on dropping them. I'll see whether I can hack
&gt; something up. :-)
Or get someone else to do it....

now there's now adding .en to the URLs anymore. If your languages are not
available, you'll redirected to the english page.

However, I'd suggest you configure your browser to accept "en" as a
second/third/... language, if possible.

mfG

Max Berger
e-mail: max.berger@xslt.de

-- 
XSLT:     http://www.xslt.de/         ACPI4Linux: http://phobos.fs.tum.de/acpi/ 
FBR-Info: http://www.fs.tum.de/FSMPI/ Sysop:      http://wwwbrauer.in.tum.de/
9CF77B603671BB18 D5110085483230BB ftp://phobos.fs.tum.de/pub/pgp/max.berger.asc 

</body></email><email><emailId>20000815014344</emailId><senderName>Han Dong Hee</senderName><senderEmail>donghee@eecad.sogang.ac.kr</senderEmail><timestampReceived>2000-08-15 01:43:44-0400</timestampReceived><subject>[Acpi] pmtest..</subject><body>

Hi,
I want to measure ablities of acpi4linux that reduce the power
consumption.
For power management test, pmtest tools are used. But I don't know how
many
information pmtest tools give us. 
If I don't understatnd utility of pmtest tools, plz tell me the correct
usage 
of pmtest tools. ^_^
Is there any benchmark program about power consumption?

</body></email><email><emailId>20000815040745</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-08-15 04:07:45-0400</timestampReceived><subject>[Acpi] ACPI error during boot (fwd)</subject><body>

Hi,

this message is from the lkml. It seems to me that more people have
similar problems, so I think I'm putting up a FAQ page. If you have
something that should be mentioned on the FAQ page, please send it to me.

   Simon

-- 
PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

---------- Forwarded message ----------
Date: Mon, 14 Aug 2000 21:57:22 +0200
From: Sasa Ostrouska &lt;maja.ostrouska@kiss.uni-lj.si&gt;
Subject: ACPI error during boot

Hello to everybody !

	I'm using the linux-2.4.0.test6 kernel and I noticed the
following error during the boot time:


 devfs: v0.102 (20000622) Richard Gooch (rgooch@atnf.csiro.au)
devfs: boot_options: 0x0
kmem_create: Forcing size word alignment - nfs_fh
ACPI: support found
ACPI: PBLK 1 @ 0x4010:6
ACPI:         -0176: &lt;7&gt;ACPI: *** Error: Object type returned from
interpreter differs from expected value
ACPI:         -0176: &lt;7&gt;ACPI: *** Error: Object type returned from
interpreter differs from expected value
ACPI: S1 supported
VFS: Mounted root (ext2 filesystem) readonly.
Mounted devfs on /dev


Can somebody explain what this is and if it has to be fixed some way ?

I have an SMP dual PII350 box.

Thank you in advance and best regards


-- 
Sasa Ostrouska

-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at http://www.tux.org/lkml/

</body></email><email><emailId>20000815162558</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-08-15 16:25:58-0400</timestampReceived><subject>RE: [Acpi] Re: ACPI error during boot</subject><body>

Yes, pardon me, I didn't mean it *was* fixed, but rather that we should fix
it (and the others) at some point. ;-)

-- Andy

&gt; -----Original Message-----
&gt; From: David Ford [mailto:david@kalifornia.com]
&gt; Sent: Monday, August 14, 2000 9:40 PM
&gt; To: Grover, Andrew
&gt; Cc: 'maja.ostrouska@kiss.uni-lj.si'; linux-kernel@vger.rutgers.edu;
&gt; 'acpi@phobos.fachschaften.tu-muenchen.de'
&gt; Subject: [Acpi] Re: ACPI error during boot
&gt; 
&gt; 
&gt; Hmm.  I doubt it is fixed.  Of the dozens of different 
&gt; machines I have, I have
&gt; yet to find one that doesn't blabber errors or warnings on 
&gt; boot about ACPI.
&gt; 
&gt; -d
&gt; 
&gt; "Grover, Andrew" wrote:
&gt; 
&gt; &gt; Hi Sasa,
&gt; &gt;
&gt; &gt; Basically, it looks like it's trying to find out which 
&gt; sleep states your pc
&gt; &gt; supports, but the data being returned is not in the format 
&gt; expected (the
&gt; &gt; code is at linux/drivers/acpi/hardware/hwregs.c line 176 if you're
&gt; &gt; interested).
&gt; &gt;
&gt; &gt; It *should* be fixed, but I don't think it will hurt 
&gt; anything for it to be
&gt; &gt; temporarily broken...
&gt; &gt;
&gt; &gt; Regards -- Andy
&gt; &gt;
&gt; &gt; &gt; -----Original Message-----
&gt; &gt; &gt; From: Sasa Ostrouska [mailto:maja.ostrouska@kiss.uni-lj.si]
&gt; &gt;
&gt; &gt; &gt; Hello to everybody !
&gt; &gt; &gt;
&gt; &gt; &gt;       I'm using the linux-2.4.0.test6 kernel and I noticed the
&gt; &gt; &gt; following error during the boot time:
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt;  devfs: v0.102 (20000622) Richard Gooch (rgooch@atnf.csiro.au)
&gt; &gt; &gt; devfs: boot_options: 0x0
&gt; &gt; &gt; kmem_create: Forcing size word alignment - nfs_fh
&gt; &gt; &gt; ACPI: support found
&gt; &gt; &gt; ACPI: PBLK 1 @ 0x4010:6
&gt; &gt; &gt; ACPI:         -0176: &lt;7&gt;ACPI: *** Error: Object type returned from
&gt; &gt; &gt; interpreter differs from expected value
&gt; &gt; &gt; ACPI:         -0176: &lt;7&gt;ACPI: *** Error: Object type returned from
&gt; &gt; &gt; interpreter differs from expected value
&gt; &gt; &gt; ACPI: S1 supported
&gt; &gt; &gt; VFS: Mounted root (ext2 filesystem) readonly.
&gt; &gt; &gt; Mounted devfs on /dev
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; Can somebody explain what this is and if it has to be 
&gt; fixed some way ?
&gt; &gt; &gt;
&gt; &gt; &gt; I have an SMP dual PII350 box.
&gt; &gt; &gt;
&gt; &gt; &gt; Thank you in advance and best regards
&gt; &gt;
&gt; &gt; &gt;
&gt; &gt;
&gt; &gt; -
&gt; &gt; To unsubscribe from this list: send the line "unsubscribe 
&gt; linux-kernel" in
&gt; &gt; the body of a message to majordomo@vger.rutgers.edu
&gt; &gt; Please read the FAQ at http://www.tux.org/lkml/
&gt; 
&gt; --
&gt; "The difference between 'involvement' and 'commitment' is like an
&gt; eggs-and-ham breakfast: the chicken was 'involved' - the pig was
&gt; 'committed'."
&gt; 
&gt; 
&gt; 

</body></email><email><emailId>20000822084658</emailId><senderName>David Woodhouse</senderName><senderEmail>dwmw2@infradead.org</senderEmail><timestampReceived>2000-08-22 08:46:58-0400</timestampReceived><subject>[Acpi] sleep_on races in 2.4.0-test7-pre6</subject><body>

The attached patch shows up three places where sleep_on_interruptible() is
used unsafely. I think it would be useful to include it at least briefly to
locate other abusers.

One could cause kswapd to miss wake-ups, which is not fatal but hardly 
ideal. (mm/vmscan.c:604)

One could cause a user to miss events which arrive just as they're trying 
to read /proc/sys/acpi/event (drivers/acpi/driver.c:162)

The third could cause the acpi thread to fail to wake up and service a
queued task (drivers/acpi/driver.c:333)


Index: kernel/sched.c
===================================================================
RCS file: /inst/cvs/linux/kernel/sched.c,v
retrieving revision 1.4.2.35
diff -u -r1.4.2.35 sched.c
--- kernel/sched.c	2000/08/05 16:53:08	1.4.2.35
+++ kernel/sched.c	2000/08/09 13:19:02
@@ -785,10 +785,18 @@
 	__remove_wait_queue(q, &amp;wait);				\
 	wq_write_unlock_irqrestore(&amp;q-&gt;lock,flags);
 
+#define SLEEP_ON_LOCKCHECK						\
+	if (current-&gt;lock_depth == -1) {				\
+		printk(KERN_WARNING __FUNCTION__ " called without BKL held!\n"); \
+		BUG();							\
+	}
+
 void interruptible_sleep_on(wait_queue_head_t *q)
 {
 	SLEEP_ON_VAR
 
+	SLEEP_ON_LOCKCHECK
+
 	current-&gt;state = TASK_INTERRUPTIBLE;
 
 	SLEEP_ON_HEAD
@@ -800,6 +808,8 @@
 {
 	SLEEP_ON_VAR
 
+	SLEEP_ON_LOCKCHECK
+
 	current-&gt;state = TASK_INTERRUPTIBLE;
 
 	SLEEP_ON_HEAD
@@ -813,6 +823,8 @@
 {
 	SLEEP_ON_VAR
 	
+	SLEEP_ON_LOCKCHECK
+
 	current-&gt;state = TASK_UNINTERRUPTIBLE;
 
 	SLEEP_ON_HEAD
@@ -824,6 +836,8 @@
 {
 	SLEEP_ON_VAR
 	
+	SLEEP_ON_LOCKCHECK
+
 	current-&gt;state = TASK_UNINTERRUPTIBLE;
 
 	SLEEP_ON_HEAD


--
dwmw2

</body></email><email><emailId>20000823042225</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-08-23 04:22:25-0400</timestampReceived><subject>[Acpi] [PATCH] ACPI makefile weirdness</subject><body>

Hi all,

This patch fixes the Makefile in drivers/acpi so that it doesn't compile
unconditionally. It also adds makefiles to all the subdirectories, and
renames tables.c to table.c, so that the .o files don't collide. It is
against 2.4.test6. (I did notice it's still relinking too much, but this is
a start..)

Regards -- Andy

----------------------------
Andrew Grover
Intel/TRL/MTL
andrew.grover@intel.com



["acpi-make.diff" (application/octet-stream)]

diff -ruN virgin/drivers/acpi/Makefile linux/drivers/acpi/Makefile
--- virgin/drivers/acpi/Makefile	Wed Jul 12 13:21:57 2000
+++ linux/drivers/acpi/Makefile	Tue Aug 22 21:02:05 2000
@@ -1,27 +1,36 @@
-#
-# Makefile for the Linux ACPI interpreter
-#
-
-SUB_DIRS        :=
-MOD_SUB_DIRS    := $(SUB_DIRS)
-MOD_IN_SUB_DIRS :=
-ALL_SUB_DIRS    := $(SUB_DIRS)
-
-O_TARGET := acpi.o
-O_OBJS   :=
-M_OBJS   :=
-
-ACPI_OBJS := driver.o ec.o cpu.o os.o sys.o tables.o
-ACPI_OBJS += $(patsubst %.c,%.o,$(wildcard */*.c))
-
-EXTRA_CFLAGS += -I./include -D_LINUX
-
-# if the interpreter is used, it overrides arch/i386/kernel/acpi.c
-ifeq ($(CONFIG_ACPI_INTERPRETER),y)
-  O_OBJS += $(ACPI_OBJS)
-endif
-
-include $(TOPDIR)/Rules.make
-
-clean:
-	$(RM) *.o */*.o
+#
+# Makefile for the Linux ACPI interpreter
+#
+
+SUB_DIRS        := 
+MOD_SUB_DIRS    := $(SUB_DIRS)
+MOD_IN_SUB_DIRS :=
+ALL_SUB_DIRS    := $(SUB_DIRS)
+
+O_TARGET := acpi.o
+O_OBJS   :=
+M_OBJS   :=
+
+export ACPI_CFLAGS
+ACPI_CFLAGS := -D_LINUX
+
+EXTRA_CFLAGS += -I./include
+
+EXTRA_CFLAGS += $(ACPI_CFLAGS)
+
+# if the interpreter is used, it overrides arch/i386/kernel/acpi.c
+ifeq ($(CONFIG_ACPI_INTERPRETER),y)
+
+  SUB_DIRS += common dispatcher events hardware\
+	      interpreter namespace parser resources tables
+
+  ACPI_OBJS := $(patsubst %,%.o,$(SUB_DIRS))
+  ACPI_OBJS += $(patsubst %.c,%.o,$(wildcard *.c))
+
+  O_OBJS += $(ACPI_OBJS)
+endif
+
+include $(TOPDIR)/Rules.make
+
+clean:
+	$(RM) *.o */*.o
diff -ruN virgin/drivers/acpi/common/Makefile linux/drivers/acpi/common/Makefile
--- virgin/drivers/acpi/common/Makefile	Wed Dec 31 16:00:00 1969
+++ linux/drivers/acpi/common/Makefile	Tue Aug 22 21:02:18 2000
@@ -0,0 +1,28 @@
+#
+# Makefile for all Linux ACPI interpreter subdirectories
+#
+
+SUB_DIRS        := 
+MOD_SUB_DIRS    := $(SUB_DIRS)
+MOD_IN_SUB_DIRS :=
+ALL_SUB_DIRS    := $(SUB_DIRS)
+
+O_TARGET := ../$(shell basename `pwd`).o
+O_OBJS   :=
+M_OBJS   :=
+
+ACPI_OBJS := $(patsubst %.c,%.o,$(wildcard *.c))
+
+EXTRA_CFLAGS += -I../include
+
+EXTRA_CFLAGS += $(ACPI_CFLAGS)
+
+# if the interpreter is used, it overrides arch/i386/kernel/acpi.c
+ifeq ($(CONFIG_ACPI_INTERPRETER),y)
+  O_OBJS := $(ACPI_OBJS)
+endif
+
+include $(TOPDIR)/Rules.make
+
+clean:
+	$(RM) *.o 
diff -ruN virgin/drivers/acpi/dispatcher/Makefile linux/drivers/acpi/dispatcher/Makefile
--- virgin/drivers/acpi/dispatcher/Makefile	Wed Dec 31 16:00:00 1969
+++ linux/drivers/acpi/dispatcher/Makefile	Tue Aug 22 21:02:37 2000
@@ -0,0 +1,28 @@
+#
+# Makefile for all Linux ACPI interpreter subdirectories
+#
+
+SUB_DIRS        := 
+MOD_SUB_DIRS    := $(SUB_DIRS)
+MOD_IN_SUB_DIRS :=
+ALL_SUB_DIRS    := $(SUB_DIRS)
+
+O_TARGET := ../$(shell basename `pwd`).o
+O_OBJS   :=
+M_OBJS   :=
+
+ACPI_OBJS := $(patsubst %.c,%.o,$(wildcard *.c))
+
+EXTRA_CFLAGS += -I../include
+
+EXTRA_CFLAGS += $(ACPI_CFLAGS)
+
+# if the interpreter is used, it overrides arch/i386/kernel/acpi.c
+ifeq ($(CONFIG_ACPI_INTERPRETER),y)
+  O_OBJS := $(ACPI_OBJS)
+endif
+
+include $(TOPDIR)/Rules.make
+
+clean:
+	$(RM) *.o 
diff -ruN virgin/drivers/acpi/events/Makefile linux/drivers/acpi/events/Makefile
--- virgin/drivers/acpi/events/Makefile	Wed Dec 31 16:00:00 1969
+++ linux/drivers/acpi/events/Makefile	Tue Aug 22 21:02:39 2000
@@ -0,0 +1,28 @@
+#
+# Makefile for all Linux ACPI interpreter subdirectories
+#
+
+SUB_DIRS        := 
+MOD_SUB_DIRS    := $(SUB_DIRS)
+MOD_IN_SUB_DIRS :=
+ALL_SUB_DIRS    := $(SUB_DIRS)
+
+O_TARGET := ../$(shell basename `pwd`).o
+O_OBJS   :=
+M_OBJS   :=
+
+ACPI_OBJS := $(patsubst %.c,%.o,$(wildcard *.c))
+
+EXTRA_CFLAGS += -I../include
+
+EXTRA_CFLAGS += $(ACPI_CFLAGS)
+
+# if the interpreter is used, it overrides arch/i386/kernel/acpi.c
+ifeq ($(CONFIG_ACPI_INTERPRETER),y)
+  O_OBJS := $(ACPI_OBJS)
+endif
+
+include $(TOPDIR)/Rules.make
+
+clean:
+	$(RM) *.o 
diff -ruN virgin/drivers/acpi/hardware/Makefile linux/drivers/acpi/hardware/Makefile
--- virgin/drivers/acpi/hardware/Makefile	Wed Dec 31 16:00:00 1969
+++ linux/drivers/acpi/hardware/Makefile	Tue Aug 22 21:02:43 2000
@@ -0,0 +1,28 @@
+#
+# Makefile for all Linux ACPI interpreter subdirectories
+#
+
+SUB_DIRS        := 
+MOD_SUB_DIRS    := $(SUB_DIRS)
+MOD_IN_SUB_DIRS :=
+ALL_SUB_DIRS    := $(SUB_DIRS)
+
+O_TARGET := ../$(shell basename `pwd`).o
+O_OBJS   :=
+M_OBJS   :=
+
+ACPI_OBJS := $(patsubst %.c,%.o,$(wildcard *.c))
+
+EXTRA_CFLAGS += -I../include
+
+EXTRA_CFLAGS += $(ACPI_CFLAGS)
+
+# if the interpreter is used, it overrides arch/i386/kernel/acpi.c
+ifeq ($(CONFIG_ACPI_INTERPRETER),y)
+  O_OBJS := $(ACPI_OBJS)
+endif
+
+include $(TOPDIR)/Rules.make
+
+clean:
+	$(RM) *.o 
diff -ruN virgin/drivers/acpi/interpreter/Makefile linux/drivers/acpi/interpreter/Makefile
--- virgin/drivers/acpi/interpreter/Makefile	Wed Dec 31 16:00:00 1969
+++ linux/drivers/acpi/interpreter/Makefile	Tue Aug 22 21:02:48 2000
@@ -0,0 +1,28 @@
+#
+# Makefile for all Linux ACPI interpreter subdirectories
+#
+
+SUB_DIRS        := 
+MOD_SUB_DIRS    := $(SUB_DIRS)
+MOD_IN_SUB_DIRS :=
+ALL_SUB_DIRS    := $(SUB_DIRS)
+
+O_TARGET := ../$(shell basename `pwd`).o
+O_OBJS   :=
+M_OBJS   :=
+
+ACPI_OBJS := $(patsubst %.c,%.o,$(wildcard *.c))
+
+EXTRA_CFLAGS += -I../include
+
+EXTRA_CFLAGS += $(ACPI_CFLAGS)
+
+# if the interpreter is used, it overrides arch/i386/kernel/acpi.c
+ifeq ($(CONFIG_ACPI_INTERPRETER),y)
+  O_OBJS := $(ACPI_OBJS)
+endif
+
+include $(TOPDIR)/Rules.make
+
+clean:
+	$(RM) *.o 
diff -ruN virgin/drivers/acpi/namespace/Makefile linux/drivers/acpi/namespace/Makefile
--- virgin/drivers/acpi/namespace/Makefile	Wed Dec 31 16:00:00 1969
+++ linux/drivers/acpi/namespace/Makefile	Tue Aug 22 21:02:51 2000
@@ -0,0 +1,28 @@
+#
+# Makefile for all Linux ACPI interpreter subdirectories
+#
+
+SUB_DIRS        := 
+MOD_SUB_DIRS    := $(SUB_DIRS)
+MOD_IN_SUB_DIRS :=
+ALL_SUB_DIRS    := $(SUB_DIRS)
+
+O_TARGET := ../$(shell basename `pwd`).o
+O_OBJS   :=
+M_OBJS   :=
+
+ACPI_OBJS := $(patsubst %.c,%.o,$(wildcard *.c))
+
+EXTRA_CFLAGS += -I../include
+
+EXTRA_CFLAGS += $(ACPI_CFLAGS)
+
+# if the interpreter is used, it overrides arch/i386/kernel/acpi.c
+ifeq ($(CONFIG_ACPI_INTERPRETER),y)
+  O_OBJS := $(ACPI_OBJS)
+endif
+
+include $(TOPDIR)/Rules.make
+
+clean:
+	$(RM) *.o 
diff -ruN virgin/drivers/acpi/parser/Makefile linux/drivers/acpi/parser/Makefile
--- virgin/drivers/acpi/parser/Makefile	Wed Dec 31 16:00:00 1969
+++ linux/drivers/acpi/parser/Makefile	Tue Aug 22 21:02:53 2000
@@ -0,0 +1,28 @@
+#
+# Makefile for all Linux ACPI interpreter subdirectories
+#
+
+SUB_DIRS        := 
+MOD_SUB_DIRS    := $(SUB_DIRS)
+MOD_IN_SUB_DIRS :=
+ALL_SUB_DIRS    := $(SUB_DIRS)
+
+O_TARGET := ../$(shell basename `pwd`).o
+O_OBJS   :=
+M_OBJS   :=
+
+ACPI_OBJS := $(patsubst %.c,%.o,$(wildcard *.c))
+
+EXTRA_CFLAGS += -I../include
+
+EXTRA_CFLAGS += $(ACPI_CFLAGS)
+
+# if the interpreter is used, it overrides arch/i386/kernel/acpi.c
+ifeq ($(CONFIG_ACPI_INTERPRETER),y)
+  O_OBJS := $(ACPI_OBJS)
+endif
+
+include $(TOPDIR)/Rules.make
+
+clean:
+	$(RM) *.o 
diff -ruN virgin/drivers/acpi/resources/Makefile linux/drivers/acpi/resources/Makefile
--- virgin/drivers/acpi/resources/Makefile	Wed Dec 31 16:00:00 1969
+++ linux/drivers/acpi/resources/Makefile	Tue Aug 22 21:02:56 2000
@@ -0,0 +1,28 @@
+#
+# Makefile for all Linux ACPI interpreter subdirectories
+#
+
+SUB_DIRS        := 
+MOD_SUB_DIRS    := $(SUB_DIRS)
+MOD_IN_SUB_DIRS :=
+ALL_SUB_DIRS    := $(SUB_DIRS)
+
+O_TARGET := ../$(shell basename `pwd`).o
+O_OBJS   :=
+M_OBJS   :=
+
+ACPI_OBJS := $(patsubst %.c,%.o,$(wildcard *.c))
+
+EXTRA_CFLAGS += -I../include
+
+EXTRA_CFLAGS += $(ACPI_CFLAGS)
+
+# if the interpreter is used, it overrides arch/i386/kernel/acpi.c
+ifeq ($(CONFIG_ACPI_INTERPRETER),y)
+  O_OBJS := $(ACPI_OBJS)
+endif
+
+include $(TOPDIR)/Rules.make
+
+clean:
+	$(RM) *.o 
diff -ruN virgin/drivers/acpi/table.c linux/drivers/acpi/table.c
--- virgin/drivers/acpi/table.c	Wed Dec 31 16:00:00 1969
+++ linux/drivers/acpi/table.c	Tue Aug 22 21:16:55 2000
@@ -0,0 +1,303 @@
+/*
+ *  table.c - ACPI tables, chipset, and errata handling
+ *
+ *  Copyright (C) 2000 Andrew Henroid
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+
+#include &lt;linux/kernel.h&gt;
+#include &lt;linux/types.h&gt;
+#include &lt;linux/pci.h&gt;
+#include &lt;linux/pm.h&gt;
+#include &lt;linux/acpi.h&gt;
+#include "acpi.h"
+#include "driver.h"
+
+struct acpi_facp acpi_facp;
+
+#define ACPI_DUMMY_CHECKSUM 9
+#define ACPI_DUMMY_PBLK 51
+
+static u8 acpi_dummy_dsdt[] =
+{
+	0x44, 0x53, 0x44, 0x54,                         // "DSDT"
+	0x38, 0x00, 0x00, 0x00,                         // length
+	0x01,                                           // revision
+	0x00,                                           // checksum
+	0x4c, 0x49, 0x4e, 0x55, 0x58, 0x00,             // "LINUX"
+	0x44, 0x55, 0x4d, 0x4d, 0x59, 0x00, 0x00, 0x00, // "DUMMY"
+	0x01, 0x00, 0x00, 0x00,                         // OEM rev
+	0x4c, 0x4e, 0x55, 0x58,                         // "LNUX"
+	0x01, 0x00, 0x00, 0x00,                         // creator rev
+	0x10,                                           // Scope
+	0x13,                                           //   PkgLength
+	0x5c, 0x5f, 0x50, 0x52, 0x5f,                   //   \_PR_
+	0x5b, 0x83,                                     //   Processor
+	0x0b,                                           //     PkgLength
+	0x43, 0x50, 0x55, 0x30,                         //     CPU0
+	0x00,                                           //     ID
+	0x00, 0x00, 0x00, 0x00,                         //     PBLK
+	0x06                                            //     PBLK size
+};
+
+/*
+ * Calculate and set ACPI table checksum
+ */
+static void
+acpi_set_checksum(u8 *table, int size)
+{
+	int i, sum = 0;
+	for (i = 0; i &lt; size; i++)
+		sum += (int) table[i];
+	sum = (0x100 - ((sum - table[ACPI_DUMMY_CHECKSUM]) &amp; 0xff));
+	table[ACPI_DUMMY_CHECKSUM] = sum;
+}
+
+/*
+ * Init PIIX4 device, create a fake FACP
+ */
+static int
+acpi_init_piix4(struct pci_dev *dev)
+{
+	u32 base, pblk;
+	u16 cmd;
+	u8 pmregmisc;
+
+	pci_read_config_word(dev, PCI_COMMAND, &amp;cmd);
+	if (!(cmd &amp; PCI_COMMAND_IO))
+		return -ENODEV;
+	
+	pci_read_config_byte(dev, ACPI_PIIX4_PMREGMISC, &amp;pmregmisc);
+	if (!(pmregmisc &amp; ACPI_PIIX4_PMIOSE))
+		return -ENODEV;
+	
+	base = pci_resource_start (dev, PCI_BRIDGE_RESOURCES);
+	if (!base)
+		return -ENODEV;
+
+	printk(KERN_INFO "ACPI: found \"%s\" at 0x%04x\n", dev-&gt;name, base);
+
+	memset(&amp;acpi_facp, 0, sizeof(acpi_facp));
+	acpi_facp.hdr.signature = ACPI_FACP_SIG;
+	acpi_facp.hdr.length = sizeof(acpi_facp);
+	acpi_facp.int_model = ACPI_PIIX4_INT_MODEL;
+	acpi_facp.sci_int = ACPI_PIIX4_SCI_INT;
+	acpi_facp.smi_cmd = ACPI_PIIX4_SMI_CMD;
+	acpi_facp.acpi_enable = ACPI_PIIX4_ACPI_ENABLE;
+	acpi_facp.acpi_disable = ACPI_PIIX4_ACPI_DISABLE;
+	acpi_facp.s4bios_req = ACPI_PIIX4_S4BIOS_REQ;
+	acpi_facp.pm1a_evt = base + ACPI_PIIX4_PM1_EVT;
+	acpi_facp.pm1a_cnt = base + ACPI_PIIX4_PM1_CNT;
+	acpi_facp.pm2_cnt = ACPI_PIIX4_PM2_CNT;
+	acpi_facp.pm_tmr = base + ACPI_PIIX4_PM_TMR;
+	acpi_facp.gpe0 = base + ACPI_PIIX4_GPE0;
+	acpi_facp.pm1_evt_len = ACPI_PIIX4_PM1_EVT_LEN;
+	acpi_facp.pm1_cnt_len = ACPI_PIIX4_PM1_CNT_LEN;
+	acpi_facp.pm2_cnt_len = ACPI_PIIX4_PM2_CNT_LEN;
+	acpi_facp.pm_tm_len = ACPI_PIIX4_PM_TM_LEN;
+	acpi_facp.gpe0_len = ACPI_PIIX4_GPE0_LEN;
+	acpi_facp.p_lvl2_lat = (__u16) ACPI_INFINITE_LAT;
+	acpi_facp.p_lvl3_lat = (__u16) ACPI_INFINITE_LAT;
+
+	acpi_set_checksum((u8*) &amp;acpi_facp, sizeof(acpi_facp));
+	acpi_load_table((ACPI_TABLE_HEADER*) &amp;acpi_facp);
+
+	pblk = base + ACPI_PIIX4_P_BLK;
+	memcpy(acpi_dummy_dsdt + ACPI_DUMMY_PBLK, &amp;pblk, sizeof(pblk));
+	acpi_set_checksum(acpi_dummy_dsdt, sizeof(acpi_dummy_dsdt));
+	acpi_load_table((ACPI_TABLE_HEADER*) acpi_dummy_dsdt);
+
+	return 0;
+}
+
+/*
+ * Init VIA ACPI device and create a fake FACP
+ */
+static int
+acpi_init_via(struct pci_dev *dev)
+{
+	u32 base, pblk;
+	u8 tmp, irq;
+
+	pci_read_config_byte(dev, 0x41, &amp;tmp);
+	if (!(tmp &amp; 0x80))
+		return -ENODEV;
+
+	base = pci_resource_start(dev, PCI_BRIDGE_RESOURCES);
+	if (!base) {
+		base = pci_resource_start(dev, PCI_BASE_ADDRESS_4);
+		if (!base)
+			return -ENODEV;
+	}
+
+	pci_read_config_byte(dev, 0x42, &amp;irq);
+
+	printk(KERN_INFO "ACPI: found \"%s\" at 0x%04x\n", dev-&gt;name, base);
+
+	memset(&amp;acpi_facp, 0, sizeof(acpi_facp));
+	acpi_facp.hdr.signature = ACPI_FACP_SIG;
+	acpi_facp.hdr.length = sizeof(acpi_facp);
+	acpi_facp.int_model = ACPI_VIA_INT_MODEL;
+	acpi_facp.sci_int = irq;
+	acpi_facp.smi_cmd = base + ACPI_VIA_SMI_CMD;
+	acpi_facp.acpi_enable = ACPI_VIA_ACPI_ENABLE;
+	acpi_facp.acpi_disable = ACPI_VIA_ACPI_DISABLE;
+	acpi_facp.pm1a_evt = base + ACPI_VIA_PM1_EVT;
+	acpi_facp.pm1a_cnt = base + ACPI_VIA_PM1_CNT;
+	acpi_facp.pm_tmr = base + ACPI_VIA_PM_TMR;
+	acpi_facp.gpe0 = base + ACPI_VIA_GPE0;
+
+	acpi_facp.pm1_evt_len = ACPI_VIA_PM1_EVT_LEN;
+	acpi_facp.pm1_cnt_len = ACPI_VIA_PM1_CNT_LEN;
+	acpi_facp.pm_tm_len = ACPI_VIA_PM_TM_LEN;
+	acpi_facp.gpe0_len = ACPI_VIA_GPE0_LEN;
+	acpi_facp.p_lvl2_lat = (__u16) ACPI_INFINITE_LAT;
+	acpi_facp.p_lvl3_lat = (__u16) ACPI_INFINITE_LAT;
+
+	acpi_facp.duty_offset = ACPI_VIA_DUTY_OFFSET;
+	acpi_facp.duty_width = ACPI_VIA_DUTY_WIDTH;
+
+	acpi_facp.day_alarm = ACPI_VIA_DAY_ALARM;
+	acpi_facp.mon_alarm = ACPI_VIA_MON_ALARM;
+	acpi_facp.century = ACPI_VIA_CENTURY;
+
+	acpi_set_checksum((u8*) &amp;acpi_facp, sizeof(acpi_facp));
+	acpi_load_table((ACPI_TABLE_HEADER*) &amp;acpi_facp);
+
+	pblk = base + ACPI_VIA_P_BLK;
+	memcpy(acpi_dummy_dsdt + ACPI_DUMMY_PBLK, &amp;pblk, sizeof(pblk));
+	acpi_set_checksum(acpi_dummy_dsdt, sizeof(acpi_dummy_dsdt));
+	acpi_load_table((ACPI_TABLE_HEADER*) acpi_dummy_dsdt);
+
+	return 0;
+}
+
+typedef enum
+{
+        CH_UNKNOWN = 0,
+        CH_INTEL_PIIX4,
+        CH_VIA_586,
+        CH_VIA_686A,
+} acpi_chip_t;
+
+/* indexed by value of each enum in acpi_chip_t */
+const static struct
+{
+        int (*chip_init)(struct pci_dev *dev);
+} acpi_chip_info[] =
+{
+        {NULL,},
+        {acpi_init_piix4},
+        {acpi_init_via},
+        {acpi_init_via},
+};
+
+static struct pci_device_id acpi_pci_tbl[] =
+{
+        {0x8086, 0x7113, PCI_ANY_ID, PCI_ANY_ID, 0, 0, CH_INTEL_PIIX4},
+        {0x1106, 0x3040, PCI_ANY_ID, PCI_ANY_ID, 0, 0, CH_VIA_586},
+        {0x1106, 0x3057, PCI_ANY_ID, PCI_ANY_ID, 0, 0, CH_VIA_686A},
+        {0,} /* terminate list */
+};
+
+static int
+acpi_probe(struct pci_dev *dev, const struct pci_device_id *id)
+{
+        return acpi_chip_info[id-&gt;driver_data].chip_init(dev);
+}
+
+static struct pci_driver acpi_driver =
+{
+        name:           "acpi",
+        id_table:       acpi_pci_tbl,
+        probe:          acpi_probe,
+};
+static int acpi_driver_registered = 0;
+
+/*
+ * Locate a known ACPI chipset
+ */
+static int
+acpi_find_chipset(void)
+{
+        if (pci_register_driver(&amp;acpi_driver) &lt; 1)
+                return -ENODEV;
+        acpi_driver_registered = 1;
+        return 0;
+}
+
+/*
+ * Fetch the FACP information
+ */
+static int
+acpi_fetch_facp(void)
+{
+	ACPI_BUFFER buffer;
+
+	memset(&amp;acpi_facp, 0, sizeof(acpi_facp));
+	buffer.pointer = &amp;acpi_facp;
+	buffer.length = sizeof(acpi_facp);
+	if (!ACPI_SUCCESS(acpi_get_table(ACPI_TABLE_FACP, 1, &amp;buffer))) {
+		printk(KERN_ERR "ACPI: missing FACP\n");
+		return -ENODEV;
+	}
+
+	if (acpi_facp.p_lvl2_lat
+	    &amp;&amp; acpi_facp.p_lvl2_lat &lt;= ACPI_MAX_P_LVL2_LAT) {
+		acpi_c2_exit_latency
+			= ACPI_uS_TO_TMR_TICKS(acpi_facp.p_lvl2_lat);
+		acpi_c2_enter_latency
+			= ACPI_uS_TO_TMR_TICKS(ACPI_TMR_HZ / 1000);
+	}
+	if (acpi_facp.p_lvl3_lat
+	    &amp;&amp; acpi_facp.p_lvl3_lat &lt;= ACPI_MAX_P_LVL3_LAT) {
+		acpi_c3_exit_latency
+			= ACPI_uS_TO_TMR_TICKS(acpi_facp.p_lvl3_lat);
+		acpi_c3_enter_latency
+			= ACPI_uS_TO_TMR_TICKS(acpi_facp.p_lvl3_lat * 5);
+	}
+
+	return 0;
+}
+
+/*
+ * Find and load ACPI tables
+ */
+int
+acpi_load_tables(void)
+{
+	if (ACPI_SUCCESS(acpi_load_firmware_tables()))
+	{
+		printk(KERN_INFO "ACPI: support found\n");
+	}
+	else if (acpi_find_chipset()) {
+		acpi_terminate();
+		return -1;
+	}
+
+	if (acpi_fetch_facp()) {
+		acpi_terminate();
+		return -1;
+	}
+
+	if (!ACPI_SUCCESS(acpi_load_namespace())) {
+		printk(KERN_ERR "ACPI: namespace load failed\n");
+		acpi_terminate();
+		return -1;
+	}
+
+	return 0;
+}
diff -ruN virgin/drivers/acpi/tables/Makefile linux/drivers/acpi/tables/Makefile
--- virgin/drivers/acpi/tables/Makefile	Wed Dec 31 16:00:00 1969
+++ linux/drivers/acpi/tables/Makefile	Tue Aug 22 21:03:01 2000
@@ -0,0 +1,28 @@
+#
+# Makefile for all Linux ACPI interpreter subdirectories
+#
+
+SUB_DIRS        := 
+MOD_SUB_DIRS    := $(SUB_DIRS)
+MOD_IN_SUB_DIRS :=
+ALL_SUB_DIRS    := $(SUB_DIRS)
+
+O_TARGET := ../$(shell basename `pwd`).o
+O_OBJS   :=
+M_OBJS   :=
+
+ACPI_OBJS := $(patsubst %.c,%.o,$(wildcard *.c))
+
+EXTRA_CFLAGS += -I../include
+
+EXTRA_CFLAGS += $(ACPI_CFLAGS)
+
+# if the interpreter is used, it overrides arch/i386/kernel/acpi.c
+ifeq ($(CONFIG_ACPI_INTERPRETER),y)
+  O_OBJS := $(ACPI_OBJS)
+endif
+
+include $(TOPDIR)/Rules.make
+
+clean:
+	$(RM) *.o 
diff -ruN virgin/drivers/acpi/tables.c linux/drivers/acpi/tables.c
--- virgin/drivers/acpi/tables.c	Thu Jul 13 09:39:49 2000
+++ linux/drivers/acpi/tables.c	Wed Dec 31 16:00:00 1969
@@ -1,303 +0,0 @@
-/*
- *  tables.c - ACPI tables, chipset, and errata handling
- *
- *  Copyright (C) 2000 Andrew Henroid
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
- */
-
-#include &lt;linux/kernel.h&gt;
-#include &lt;linux/types.h&gt;
-#include &lt;linux/pci.h&gt;
-#include &lt;linux/pm.h&gt;
-#include &lt;linux/acpi.h&gt;
-#include "acpi.h"
-#include "driver.h"
-
-struct acpi_facp acpi_facp;
-
-#define ACPI_DUMMY_CHECKSUM 9
-#define ACPI_DUMMY_PBLK 51
-
-static u8 acpi_dummy_dsdt[] =
-{
-	0x44, 0x53, 0x44, 0x54,                         // "DSDT"
-	0x38, 0x00, 0x00, 0x00,                         // length
-	0x01,                                           // revision
-	0x00,                                           // checksum
-	0x4c, 0x49, 0x4e, 0x55, 0x58, 0x00,             // "LINUX"
-	0x44, 0x55, 0x4d, 0x4d, 0x59, 0x00, 0x00, 0x00, // "DUMMY"
-	0x01, 0x00, 0x00, 0x00,                         // OEM rev
-	0x4c, 0x4e, 0x55, 0x58,                         // "LNUX"
-	0x01, 0x00, 0x00, 0x00,                         // creator rev
-	0x10,                                           // Scope
-	0x13,                                           //   PkgLength
-	0x5c, 0x5f, 0x50, 0x52, 0x5f,                   //   \_PR_
-	0x5b, 0x83,                                     //   Processor
-	0x0b,                                           //     PkgLength
-	0x43, 0x50, 0x55, 0x30,                         //     CPU0
-	0x00,                                           //     ID
-	0x00, 0x00, 0x00, 0x00,                         //     PBLK
-	0x06                                            //     PBLK size
-};
-
-/*
- * Calculate and set ACPI table checksum
- */
-static void
-acpi_set_checksum(u8 *table, int size)
-{
-	int i, sum = 0;
-	for (i = 0; i &lt; size; i++)
-		sum += (int) table[i];
-	sum = (0x100 - ((sum - table[ACPI_DUMMY_CHECKSUM]) &amp; 0xff));
-	table[ACPI_DUMMY_CHECKSUM] = sum;
-}
-
-/*
- * Init PIIX4 device, create a fake FACP
- */
-static int
-acpi_init_piix4(struct pci_dev *dev)
-{
-	u32 base, pblk;
-	u16 cmd;
-	u8 pmregmisc;
-
-	pci_read_config_word(dev, PCI_COMMAND, &amp;cmd);
-	if (!(cmd &amp; PCI_COMMAND_IO))
-		return -ENODEV;
-	
-	pci_read_config_byte(dev, ACPI_PIIX4_PMREGMISC, &amp;pmregmisc);
-	if (!(pmregmisc &amp; ACPI_PIIX4_PMIOSE))
-		return -ENODEV;
-	
-	base = pci_resource_start (dev, PCI_BRIDGE_RESOURCES);
-	if (!base)
-		return -ENODEV;
-
-	printk(KERN_INFO "ACPI: found \"%s\" at 0x%04x\n", dev-&gt;name, base);
-
-	memset(&amp;acpi_facp, 0, sizeof(acpi_facp));
-	acpi_facp.hdr.signature = ACPI_FACP_SIG;
-	acpi_facp.hdr.length = sizeof(acpi_facp);
-	acpi_facp.int_model = ACPI_PIIX4_INT_MODEL;
-	acpi_facp.sci_int = ACPI_PIIX4_SCI_INT;
-	acpi_facp.smi_cmd = ACPI_PIIX4_SMI_CMD;
-	acpi_facp.acpi_enable = ACPI_PIIX4_ACPI_ENABLE;
-	acpi_facp.acpi_disable = ACPI_PIIX4_ACPI_DISABLE;
-	acpi_facp.s4bios_req = ACPI_PIIX4_S4BIOS_REQ;
-	acpi_facp.pm1a_evt = base + ACPI_PIIX4_PM1_EVT;
-	acpi_facp.pm1a_cnt = base + ACPI_PIIX4_PM1_CNT;
-	acpi_facp.pm2_cnt = ACPI_PIIX4_PM2_CNT;
-	acpi_facp.pm_tmr = base + ACPI_PIIX4_PM_TMR;
-	acpi_facp.gpe0 = base + ACPI_PIIX4_GPE0;
-	acpi_facp.pm1_evt_len = ACPI_PIIX4_PM1_EVT_LEN;
-	acpi_facp.pm1_cnt_len = ACPI_PIIX4_PM1_CNT_LEN;
-	acpi_facp.pm2_cnt_len = ACPI_PIIX4_PM2_CNT_LEN;
-	acpi_facp.pm_tm_len = ACPI_PIIX4_PM_TM_LEN;
-	acpi_facp.gpe0_len = ACPI_PIIX4_GPE0_LEN;
-	acpi_facp.p_lvl2_lat = (__u16) ACPI_INFINITE_LAT;
-	acpi_facp.p_lvl3_lat = (__u16) ACPI_INFINITE_LAT;
-
-	acpi_set_checksum((u8*) &amp;acpi_facp, sizeof(acpi_facp));
-	acpi_load_table((ACPI_TABLE_HEADER*) &amp;acpi_facp);
-
-	pblk = base + ACPI_PIIX4_P_BLK;
-	memcpy(acpi_dummy_dsdt + ACPI_DUMMY_PBLK, &amp;pblk, sizeof(pblk));
-	acpi_set_checksum(acpi_dummy_dsdt, sizeof(acpi_dummy_dsdt));
-	acpi_load_table((ACPI_TABLE_HEADER*) acpi_dummy_dsdt);
-
-	return 0;
-}
-
-/*
- * Init VIA ACPI device and create a fake FACP
- */
-static int
-acpi_init_via(struct pci_dev *dev)
-{
-	u32 base, pblk;
-	u8 tmp, irq;
-
-	pci_read_config_byte(dev, 0x41, &amp;tmp);
-	if (!(tmp &amp; 0x80))
-		return -ENODEV;
-
-	base = pci_resource_start(dev, PCI_BRIDGE_RESOURCES);
-	if (!base) {
-		base = pci_resource_start(dev, PCI_BASE_ADDRESS_4);
-		if (!base)
-			return -ENODEV;
-	}
-
-	pci_read_config_byte(dev, 0x42, &amp;irq);
-
-	printk(KERN_INFO "ACPI: found \"%s\" at 0x%04x\n", dev-&gt;name, base);
-
-	memset(&amp;acpi_facp, 0, sizeof(acpi_facp));
-	acpi_facp.hdr.signature = ACPI_FACP_SIG;
-	acpi_facp.hdr.length = sizeof(acpi_facp);
-	acpi_facp.int_model = ACPI_VIA_INT_MODEL;
-	acpi_facp.sci_int = irq;
-	acpi_facp.smi_cmd = base + ACPI_VIA_SMI_CMD;
-	acpi_facp.acpi_enable = ACPI_VIA_ACPI_ENABLE;
-	acpi_facp.acpi_disable = ACPI_VIA_ACPI_DISABLE;
-	acpi_facp.pm1a_evt = base + ACPI_VIA_PM1_EVT;
-	acpi_facp.pm1a_cnt = base + ACPI_VIA_PM1_CNT;
-	acpi_facp.pm_tmr = base + ACPI_VIA_PM_TMR;
-	acpi_facp.gpe0 = base + ACPI_VIA_GPE0;
-
-	acpi_facp.pm1_evt_len = ACPI_VIA_PM1_EVT_LEN;
-	acpi_facp.pm1_cnt_len = ACPI_VIA_PM1_CNT_LEN;
-	acpi_facp.pm_tm_len = ACPI_VIA_PM_TM_LEN;
-	acpi_facp.gpe0_len = ACPI_VIA_GPE0_LEN;
-	acpi_facp.p_lvl2_lat = (__u16) ACPI_INFINITE_LAT;
-	acpi_facp.p_lvl3_lat = (__u16) ACPI_INFINITE_LAT;
-
-	acpi_facp.duty_offset = ACPI_VIA_DUTY_OFFSET;
-	acpi_facp.duty_width = ACPI_VIA_DUTY_WIDTH;
-
-	acpi_facp.day_alarm = ACPI_VIA_DAY_ALARM;
-	acpi_facp.mon_alarm = ACPI_VIA_MON_ALARM;
-	acpi_facp.century = ACPI_VIA_CENTURY;
-
-	acpi_set_checksum((u8*) &amp;acpi_facp, sizeof(acpi_facp));
-	acpi_load_table((ACPI_TABLE_HEADER*) &amp;acpi_facp);
-
-	pblk = base + ACPI_VIA_P_BLK;
-	memcpy(acpi_dummy_dsdt + ACPI_DUMMY_PBLK, &amp;pblk, sizeof(pblk));
-	acpi_set_checksum(acpi_dummy_dsdt, sizeof(acpi_dummy_dsdt));
-	acpi_load_table((ACPI_TABLE_HEADER*) acpi_dummy_dsdt);
-
-	return 0;
-}
-
-typedef enum
-{
-        CH_UNKNOWN = 0,
-        CH_INTEL_PIIX4,
-        CH_VIA_586,
-        CH_VIA_686A,
-} acpi_chip_t;
-
-/* indexed by value of each enum in acpi_chip_t */
-const static struct
-{
-        int (*chip_init)(struct pci_dev *dev);
-} acpi_chip_info[] =
-{
-        {NULL,},
-        {acpi_init_piix4},
-        {acpi_init_via},
-        {acpi_init_via},
-};
-
-static struct pci_device_id acpi_pci_tbl[] =
-{
-        {0x8086, 0x7113, PCI_ANY_ID, PCI_ANY_ID, 0, 0, CH_INTEL_PIIX4},
-        {0x1106, 0x3040, PCI_ANY_ID, PCI_ANY_ID, 0, 0, CH_VIA_586},
-        {0x1106, 0x3057, PCI_ANY_ID, PCI_ANY_ID, 0, 0, CH_VIA_686A},
-        {0,} /* terminate list */
-};
-
-static int
-acpi_probe(struct pci_dev *dev, const struct pci_device_id *id)
-{
-        return acpi_chip_info[id-&gt;driver_data].chip_init(dev);
-}
-
-static struct pci_driver acpi_driver =
-{
-        name:           "acpi",
-        id_table:       acpi_pci_tbl,
-        probe:          acpi_probe,
-};
-static int acpi_driver_registered = 0;
-
-/*
- * Locate a known ACPI chipset
- */
-static int
-acpi_find_chipset(void)
-{
-        if (pci_register_driver(&amp;acpi_driver) &lt; 1)
-                return -ENODEV;
-        acpi_driver_registered = 1;
-        return 0;
-}
-
-/*
- * Fetch the FACP information
- */
-static int
-acpi_fetch_facp(void)
-{
-	ACPI_BUFFER buffer;
-
-	memset(&amp;acpi_facp, 0, sizeof(acpi_facp));
-	buffer.pointer = &amp;acpi_facp;
-	buffer.length = sizeof(acpi_facp);
-	if (!ACPI_SUCCESS(acpi_get_table(ACPI_TABLE_FACP, 1, &amp;buffer))) {
-		printk(KERN_ERR "ACPI: missing FACP\n");
-		return -ENODEV;
-	}
-
-	if (acpi_facp.p_lvl2_lat
-	    &amp;&amp; acpi_facp.p_lvl2_lat &lt;= ACPI_MAX_P_LVL2_LAT) {
-		acpi_c2_exit_latency
-			= ACPI_uS_TO_TMR_TICKS(acpi_facp.p_lvl2_lat);
-		acpi_c2_enter_latency
-			= ACPI_uS_TO_TMR_TICKS(ACPI_TMR_HZ / 1000);
-	}
-	if (acpi_facp.p_lvl3_lat
-	    &amp;&amp; acpi_facp.p_lvl3_lat &lt;= ACPI_MAX_P_LVL3_LAT) {
-		acpi_c3_exit_latency
-			= ACPI_uS_TO_TMR_TICKS(acpi_facp.p_lvl3_lat);
-		acpi_c3_enter_latency
-			= ACPI_uS_TO_TMR_TICKS(acpi_facp.p_lvl3_lat * 5);
-	}
-
-	return 0;
-}
-
-/*
- * Find and load ACPI tables
- */
-int
-acpi_load_tables(void)
-{
-	if (ACPI_SUCCESS(acpi_load_firmware_tables()))
-	{
-		printk(KERN_INFO "ACPI: support found\n");
-	}
-	else if (acpi_find_chipset()) {
-		acpi_terminate();
-		return -1;
-	}
-
-	if (acpi_fetch_facp()) {
-		acpi_terminate();
-		return -1;
-	}
-
-	if (!ACPI_SUCCESS(acpi_load_namespace())) {
-		printk(KERN_ERR "ACPI: namespace load failed\n");
-		acpi_terminate();
-		return -1;
-	}
-
-	return 0;
-}


</body></email><email><emailId>20000824220808</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-08-24 22:08:08-0400</timestampReceived><subject>[Acpi] Scheduling downtime for phobos</subject><body>

Hi,

I'd like to do a hardware upgrade on phobos next Friday, 12:00 CET. The
machine will be down for a few minutes.

   Simon

PS: For those who have noticed: The forty minutes downtime today were due
to an unscheduled power outage.

-- 
PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

</body></email><email><emailId>20000825081958</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-08-25 08:19:58-0400</timestampReceived><subject>[Acpi] Re: power management and XFree86 4.01 (this has existed in X 4.0</subject><body>

&gt;From the lkml (Sorry, overlooked the original post, will try to find that
later).

   Simon

---------- Forwarded message ----------
Date: Fri, 25 Aug 2000 00:48:50 -0400
From: Trever Adams &lt;trever_Adams@bigfoot.com&gt;
Cc: XFree86@XFree86.org, linux-kernel@vger.kernel.org
Subject: Re: power management and XFree86 4.01 (this has existed in X 4.0
    with devel  kernels for some time)

Erik Mouw wrote:
&gt; 
&gt; Trever Adams wrote:
&gt; &gt;       I am running the glint driver and currently using 2.4.0-test7.  If I leave the
&gt; &gt; machine idle long enough for the ACPI to kick in and start shutting things down
&gt; &gt; (monitor included), the machine hangs... at least to keyboard response
&gt; &gt; (including SAK).  I do not know about network life.  I haven't tried, but I am
&gt; &gt; assuming it is since SAK fails.
&gt; 
&gt; I've seen this kind of lockups with an IBM ThinkPad 600X. The problem
&gt; was that it has a broken BIOS e820 memory detection, so Linux took
&gt; the complete 192MB available. Unfortunately, the ACPI tables lived in
&gt; the last megabyte of memory, so as soon as the system got an ACPI
&gt; event, it locked. We solved it by using "mem=191M" on the command line
&gt; (instead of using all 192 MB).
&gt; 
&gt; Erik
&gt; 

Erik-

	Thank you so much for your idea.  Apparently, it is ACPI related, though I am
afraid I must disagree with you on the nature, at least in my case.  I disabled
the upper megabyte per your suggestion.  Now no ACPI functionality works.  My
ACPI table also includes a ACPI data and ACPI NVS region ( IOS-e820:
0000000000008000 @ 0000000007ff0000 (ACPI data)
 BIOS-e820: 0000000000008000 @ 0000000007ff8000 (ACPI NVS)).

	My screen now does not power down, and the lockup is gone.

If anyone has any idea of what might be going on, please let me know (Erik may
be correct and I just have a little more screwiness).

Trever
-- 
The finest family and value oriented products are at http://www.daysofyore.com/
Tired of high costs and games with domain names? http://domains.daysofyore.com/
-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
Please read the FAQ at http://www.tux.org/lkml/

</body></email><email><emailId>20000828205410</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-08-28 20:54:10-0400</timestampReceived><subject>[Acpi] Software Suspend v7a (fwd)</subject><body>

Hi,

although not directly related ACPI, this might be interesting for those
who don't have S4BIOS.

   Simon

-- 
PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

---------- Forwarded message ----------
Date: Mon, 28 Aug 2000 22:35:29 +0200
From: Kurt Garloff &lt;kurt@garloff.de&gt;
Cc: Linux kernel list &lt;linux-kernel@vger.kernel.org&gt;
Subject: Software Suspend v7a

Hi Gabor,

as I needed to install Linux-2.2.16 on my laptop, I had to work on your 
software-suspend patch again: There were many changes in apm.c that broke
your v7 patch.

I created v7a, which works fine for me with 2.2.16 (actually 2.2.16-SuSE,
which is rather similar to a 2.2.17-pre1x.)
Find it on
http://www.suse.de/~garloff/TravelMate/swsusp.html

Enjoy!
-- 
Kurt Garloff                   &lt;kurt@garloff.de&gt;         [Eindhoven, NL]
Physics: Plasma simulations &lt;k.garloff@phys.tue.nl&gt;   [TU Eindhoven, NL]
Linux: SCSI, Security          &lt;garloff@suse.de&gt;   [SuSE Nuernberg, FRG]
 (See mail header or public key servers for PGP2 and GPG public keys.)

</body></email><email><emailId>20000829065819</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-08-29 06:58:19-0400</timestampReceived><subject>[Acpi] Problem with APIC and ACPI (fwd)</subject><body>

&gt;From the lkml.

---------- Forwarded message ----------
Date: Mon, 28 Aug 2000 21:59:17 -0700 (PDT)
From: Johnny Luong &lt;jrl@cats.ucsc.edu&gt;
Subject: Problem with APIC and ACPI

See attachments.


Johnny Luong
jrl@cats.ucsc.edu

["bug_report" (TEXT/PLAIN)]

1. Linux APIC errors and ACPI causes my machine to shutdown.

2. I'm using linux-2.4.0-test7 and the problem seems to be somewhat odd.
I can't nail it to any certain program or any certain process.  Anyways,
if I enable ACPI in my BIOS (with the noapic tag removed from boot), my
machine shuts down.  Also, I get APIC errors, regardless of whether or
not I put in "noapic" on the boot line and here's a sample of what I get...

APIC error on CPU1: 00(04)
APIC error on CPU0: 00(08)
APIC error on CPU1: 04(04)
APIC error on CPU0: 08(02)
APIC error on CPU0: 02(04)
APIC error on CPU1: 04(08)

Some of it doesn't even make sense according to the comments in the apic
code and I'm not even sure how it's called.

3. kernel, ACPI APIC

4. Linux version 2.4.0-test7 (root@localhost) (gcc version egcs-2.91.66 \
19990314/Linux (egcs-1.1.2 release)) #1 SMP Sun Aug 27 14:58:06 PDT 2000

7.1 
-- Versions installed: (if some fields are empty or look
-- unusual then possibly you have very old versions)
Linux localhost 2.4.0-test7 #1 SMP Sun Aug 27 14:58:06 PDT 2000 i686 unknown
Kernel modules         2.3.10-pre1
Gnu C                  egcs-2.91.66
Binutils               2.9.5.0.22
Linux C Library        2.1.3
Dynamic linker         ldd (GNU libc) 2.1.3
Procps                 2.0.6
Mount                  2.10f
Net-tools              1.54
Console-tools          0.3.3
Sh-utils               2.0
Modules Loaded         ppp_deflate bsd_comp ppp_async ppp_generic slhc tuner bttv \
i2c-algo-bit videodev eeprom w83781d sensors i2c-isa i2c-piix4 i2c-core eepro100 \
nls_iso8859-1 nls_cp437 vfat fat opl3 sb sb_lib uart401 sound soundcore

7.2
---
processor	: 0
vendor_id	: GenuineIntel
cpu family	: 6
model		: 6
model name	: Celeron (Mendocino)
stepping	: 5
cpu MHz		: 400.915727
cache size	: 128 KB
fdiv_bug	: no
hlt_bug		: no
sep_bug		: no
f00f_bug	: no
coma_bug	: no
fpu		: yes
fpu_exception	: yes
cpuid level	: 2
wp		: yes
flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 mmx \
fxsr bogomips	: 799.54

processor	: 1
vendor_id	: GenuineIntel
cpu family	: 6
model		: 6
model name	: Celeron (Mendocino)
stepping	: 5
cpu MHz		: 400.915727
cache size	: 128 KB
fdiv_bug	: no
hlt_bug		: no
sep_bug		: no
f00f_bug	: no
coma_bug	: no
fpu		: yes
fpu_exception	: yes
cpuid level	: 2
wp		: yes
flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 mmx \
fxsr bogomips	: 801.18

7.3
---
ppp_deflate            40700   0 (autoclean)
bsd_comp                4132   0 (autoclean)
ppp_async               6732   1 (autoclean)
ppp_generic            18336   2 (autoclean) [ppp_deflate bsd_comp ppp_async]
slhc                    4608   1 (autoclean) [ppp_generic]
tuner                   2960   1 (autoclean)
bttv                   54852   0 (unused)
i2c-algo-bit            7208   1 [bttv]
videodev                4672   2 [bttv]
eeprom                  3092   0 (unused)
w83781d                17300   0 (unused)
sensors                 6012   0 [eeprom w83781d]
i2c-isa                 1128   0 (unused)
i2c-piix4               3612   0 (unused)
i2c-core               11820   0 [tuner bttv i2c-algo-bit eeprom w83781d sensors \
i2c-isa i2c-piix4] eepro100               17028   1 (autoclean)
nls_iso8859-1           2832   2 (autoclean)
nls_cp437               4340   2 (autoclean)
vfat                   11564   2 (autoclean)
fat                    32224   0 (autoclean) [vfat]
opl3                   11500   0 (unused)
sb                      1648   0
sb_lib                 34644   0 [sb]
uart401                 6480   0 [sb_lib]
sound                  58860   0 [opl3 sb_lib uart401]
soundcore               3748   4 [sb_lib sound]

7.4
---

/proc/ioports
-------------

0000-001f : dma1
0020-003f : pic1
0040-005f : timer
0060-006f : keyboard
0080-008f : dma page reg
00a0-00bf : pic2
00c0-00df : dma2
00f0-00ff : fpu
01f0-01f7 : ide0
0220-022f : soundblaster
0290-0297 : w83782d
02e8-02ef : serial(set)
0388-038b : Yamaha OPL3
03c0-03df : vga+
03f6-03f6 : ide0
03f8-03ff : serial(auto)
0cf8-0cff : PCI conf1
4000-403f : Intel Corporation 82371AB PIIX4 ACPI
5000-501f : Intel Corporation 82371AB PIIX4 ACPI
  5000-5007 : piix4-smbus
d000-d01f : Intel Corporation 82371AB PIIX4 USB
d400-d43f : Intel Corporation 82557 [Ethernet Pro 100]
  d400-d43f : eepro100
d800-d807 : Triones Technologies, Inc. HPT366
  d800-d807 : ide2
dc00-dc03 : Triones Technologies, Inc. HPT366
  dc02-dc02 : ide2
e000-e0ff : Triones Technologies, Inc. HPT366
  e000-e007 : ide2
  e010-e0ff : HPT366
e400-e407 : Triones Technologies, Inc. HPT366 (#2)
  e400-e407 : ide3
e800-e803 : Triones Technologies, Inc. HPT366 (#2)
  e802-e802 : ide3
ec00-ecff : Triones Technologies, Inc. HPT366 (#2)
  ec00-ec07 : ide3
  ec10-ecff : HPT366
f000-f00f : Intel Corporation 82371AB PIIX4 IDE
  f000-f007 : ide0
  f008-f00f : ide1

/proc/iomem
-----------
00000000-0009fbff : System RAM
0009fc00-0009ffff : reserved
000a0000-000bffff : Video RAM area
000c0000-000c7fff : Video ROM
000c8000-000c97ff : Extension ROM
000ca000-000cafff : Extension ROM
000f0000-000fffff : System ROM
00100000-07ffffff : System RAM
  00100000-00218427 : Kernel code
  00218428-0022f8ff : Kernel data
d0000000-d3ffffff : Intel Corporation 440BX/ZX - 82443BX/ZX Host bridge
d4000000-d5ffffff : PCI Bus #01
  d5000000-d507ffff : Intel Corporation i740
d6000000-d6ffffff : PCI Bus #01
  d6000000-d6ffffff : Intel Corporation i740
d8000000-d8ffffff : 3Dfx Interactive, Inc. Voodoo 2
d9000000-d90fffff : Intel Corporation 82557 [Ethernet Pro 100]
d9100000-d9100fff : Intel Corporation 82557 [Ethernet Pro 100]
  d9100000-d9100fff : eepro100
d9101000-d9101fff : Brooktree Corporation Bt848 TV with DMA push
  d9101000-d9101fff : bttv
fec00000-fec00fff : reserved
fee00000-fee00fff : reserved
ffff0000-ffffffff : reserved

7.5
---
00:00.0 Host bridge: Intel Corporation 440BX/ZX - 82443BX/ZX Host bridge (rev 03)
	Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- \
FastB2B-  Status: Cap+ 66Mhz- UDF- FastB2B- ParErr- DEVSEL=medium &gt;TAbort- &lt;TAbort- \
&lt;MAbort+ &gt;SERR- &lt;PERR-  Latency: 32 set
	Region 0: Memory at d0000000 (32-bit, prefetchable) [size=64M]
	Capabilities: &lt;available only to root&gt;

00:01.0 PCI bridge: Intel Corporation 440BX/ZX - 82443BX/ZX AGP bridge (rev 03) \
(prog-if 00 [Normal decode])  Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- \
VGASnoop- ParErr- Stepping- SERR+ FastB2B-  Status: Cap- 66Mhz+ UDF- FastB2B- ParErr- \
DEVSEL=medium &gt;TAbort- &lt;TAbort- &lt;MAbort- &gt;SERR- &lt;PERR-  Latency: 64 set
	Bus: primary=00, secondary=01, subordinate=01, sec-latency=32
	I/O behind bridge: 0000f000-00000fff
	Memory behind bridge: d4000000-d5ffffff
	Prefetchable memory behind bridge: d6000000-d6ffffff
	BridgeCtl: Parity- SERR- NoISA- VGA+ MAbort- &gt;Reset- FastB2B+

00:07.0 ISA bridge: Intel Corporation 82371AB PIIX4 ISA (rev 02)
	Control: I/O+ Mem+ BusMaster+ SpecCycle+ MemWINV- VGASnoop- ParErr- Stepping- SERR- \
FastB2B-  Status: Cap- 66Mhz- UDF- FastB2B+ ParErr- DEVSEL=medium &gt;TAbort- &lt;TAbort- \
&lt;MAbort- &gt;SERR- &lt;PERR-  Latency: 0 set

00:07.1 IDE interface: Intel Corporation 82371AB PIIX4 IDE (rev 01) (prog-if 80 \
[Master])  Control: I/O+ Mem- BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- \
Stepping- SERR- FastB2B-  Status: Cap- 66Mhz- UDF- FastB2B+ ParErr- DEVSEL=medium \
&gt;TAbort- &lt;TAbort- &lt;MAbort- &gt;SERR- &lt;PERR-  Latency: 32 set
	Region 4: I/O ports at f000 [size=16]

00:07.2 USB Controller: Intel Corporation 82371AB PIIX4 USB (rev 01) (prog-if 00 \
[UHCI])  Control: I/O+ Mem- BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- \
Stepping- SERR- FastB2B-  Status: Cap- 66Mhz- UDF- FastB2B+ ParErr- DEVSEL=medium \
&gt;TAbort- &lt;TAbort- &lt;MAbort- &gt;SERR- &lt;PERR-  Latency: 32 set
	Interrupt: pin D routed to IRQ 10
	Region 4: I/O ports at d000 [size=32]

00:07.3 Bridge: Intel Corporation 82371AB PIIX4 ACPI (rev 02)
	Control: I/O+ Mem+ BusMaster- SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- \
FastB2B-  Status: Cap- 66Mhz- UDF- FastB2B+ ParErr- DEVSEL=medium &gt;TAbort- &lt;TAbort- \
&lt;MAbort- &gt;SERR- &lt;PERR-

00:09.0 Multimedia video controller: Brooktree Corporation Bt848 TV with DMA push \
(rev 12)  Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- \
Stepping- SERR- FastB2B-  Status: Cap- 66Mhz- UDF- FastB2B+ ParErr- DEVSEL=medium \
&gt;TAbort- &lt;TAbort- &lt;MAbort- &gt;SERR- &lt;PERR-  Latency: 16 min, 40 max, 32 set
	Interrupt: pin A routed to IRQ 10
	Region 0: Memory at d9101000 (32-bit, prefetchable) [size=4K]

00:0b.0 Ethernet controller: Intel Corporation 82557 [Ethernet Pro 100] (rev \
08)	Subsystem: Intel Corporation EtherExpress PRO/100+ Management Adapter  Control: \
I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B-  \
Status: Cap+ 66Mhz- UDF- FastB2B+ ParErr- DEVSEL=medium &gt;TAbort- &lt;TAbort- &lt;MAbort- \
&gt;SERR- &lt;PERR-  Latency: 8 min, 56 max, 32 set, cache line size 08
	Interrupt: pin A routed to IRQ 11
	Region 0: Memory at d9100000 (32-bit, non-prefetchable) [size=4K]
	Region 1: I/O ports at d400 [size=64]
	Region 2: Memory at d9000000 (32-bit, non-prefetchable) [size=1M]
	Expansion ROM at &lt;unassigned&gt; [disabled] [size=1M]
	Capabilities: &lt;available only to root&gt;

00:0f.0 Multimedia video controller: 3Dfx Interactive, Inc. Voodoo 2 (rev 02)
	Control: I/O- Mem+ BusMaster- SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- \
FastB2B-  Status: Cap- 66Mhz- UDF- FastB2B+ ParErr- DEVSEL=fast &gt;TAbort- &lt;TAbort- \
&lt;MAbort- &gt;SERR- &lt;PERR-  Region 0: Memory at d8000000 (32-bit, prefetchable) \
[size=16M]

00:13.0 Unknown mass storage controller: Triones Technologies, Inc. HPT366 (rev 01)
	Control: I/O+ Mem- BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- \
FastB2B-  Status: Cap- 66Mhz- UDF- FastB2B- ParErr- DEVSEL=medium &gt;TAbort- &lt;TAbort- \
&lt;MAbort- &gt;SERR- &lt;PERR-  Latency: 8 min, 8 max, 120 set, cache line size 08
	Interrupt: pin A routed to IRQ 11
	Region 0: I/O ports at d800 [size=8]
	Region 1: I/O ports at dc00 [size=4]
	Region 4: I/O ports at e000 [size=256]
	Expansion ROM at &lt;unassigned&gt; [disabled] [size=128K]

00:13.1 Unknown mass storage controller: Triones Technologies, Inc. HPT366 (rev 01)
	Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- \
FastB2B-  Status: Cap- 66Mhz- UDF- FastB2B- ParErr- DEVSEL=medium &gt;TAbort- &lt;TAbort- \
&lt;MAbort- &gt;SERR- &lt;PERR-  Latency: 8 min, 8 max, 120 set, cache line size 08
	Interrupt: pin B routed to IRQ 11
	Region 0: I/O ports at e400 [size=8]
	Region 1: I/O ports at e800 [size=4]
	Region 4: I/O ports at ec00 [size=256]

01:00.0 VGA compatible controller: Intel Corporation i740 (rev 21) (prog-if 00 [VGA])
	Subsystem: Intel Corporation: Unknown device ff00
	Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- \
FastB2B-  Status: Cap+ 66Mhz+ UDF- FastB2B+ ParErr- DEVSEL=medium &gt;TAbort- &lt;TAbort- \
&lt;MAbort- &gt;SERR- &lt;PERR-  Latency: 0 set
	Interrupt: pin A routed to IRQ 5
	Region 0: Memory at d6000000 (32-bit, prefetchable) [size=16M]
	Region 1: Memory at d5000000 (32-bit, non-prefetchable) [size=512K]
	Expansion ROM at &lt;unassigned&gt; [disabled] [size=256K]
	Capabilities: &lt;available only to root&gt;

7.7
---
	It's a Abit BP6 Motherboard.  I don't overclock it.  I use the RU Bios.
I do have a 3dfx module (that I edited so it'd work in 2.4), but I don't have
that loaded.  I'm running dnetc in the background, and X with all the nice
gui programs out there (gnome, sawfish, netscape, gaim running generally).
If you need any more info, let me know via the reply-to email.... on the
plus side, my tv tuner works and unloads right, and I'm happy for that too!
I've also included the kernel config I used.


["config" (TEXT/PLAIN)]

#
# Automatically generated by make menuconfig: don't edit
#
CONFIG_X86=y
CONFIG_ISA=y
# CONFIG_SBUS is not set
CONFIG_UID16=y

#
# Code maturity level options
#
CONFIG_EXPERIMENTAL=y

#
# Loadable module support
#
CONFIG_MODULES=y
# CONFIG_MODVERSIONS is not set
CONFIG_KMOD=y

#
# Processor type and features
#
# CONFIG_M386 is not set
# CONFIG_M486 is not set
# CONFIG_M586 is not set
# CONFIG_M586TSC is not set
# CONFIG_M586MMX is not set
CONFIG_M686=y
# CONFIG_M686FXSR is not set
# CONFIG_MK6 is not set
# CONFIG_MK7 is not set
# CONFIG_MCRUSOE is not set
# CONFIG_MWINCHIPC6 is not set
# CONFIG_MWINCHIP2 is not set
# CONFIG_MWINCHIP3D is not set
CONFIG_X86_WP_WORKS_OK=y
CONFIG_X86_INVLPG=y
CONFIG_X86_CMPXCHG=y
CONFIG_X86_BSWAP=y
CONFIG_X86_POPAD_OK=y
CONFIG_X86_L1_CACHE_BYTES2
CONFIG_X86_TSC=y
CONFIG_X86_GOOD_APIC=y
CONFIG_X86_PGE=y
CONFIG_X86_USE_PPRO_CHECKSUM=y
# CONFIG_MICROCODE is not set
# CONFIG_X86_MSR is not set
# CONFIG_X86_CPUID is not set
CONFIG_NOHIGHMEM=y
# CONFIG_HIGHMEM4G is not set
# CONFIG_HIGHMEM64G is not set
# CONFIG_MATH_EMULATION is not set
CONFIG_MTRR=y
CONFIG_SMP=y
CONFIG_HAVE_DEC_LOCK=y

#
# General setup
#
CONFIG_NET=y
# CONFIG_VISWS is not set
CONFIG_X86_IO_APIC=y
CONFIG_X86_LOCAL_APIC=y
CONFIG_PCI=y
# CONFIG_PCI_GOBIOS is not set
# CONFIG_PCI_GODIRECT is not set
CONFIG_PCI_GOANY=y
CONFIG_PCI_BIOS=y
CONFIG_PCI_DIRECT=y
CONFIG_PCI_NAMES=y
# CONFIG_MCA is not set
# CONFIG_HOTPLUG is not set
# CONFIG_PCMCIA is not set
CONFIG_SYSVIPC=y
CONFIG_BSD_PROCESS_ACCT=y
CONFIG_SYSCTL=y
CONFIG_KCORE_ELF=y
# CONFIG_KCORE_AOUT is not set
CONFIG_BINFMT_AOUT=m
CONFIG_BINFMT_ELF=y
CONFIG_BINFMT_MISC=m
CONFIG_PM=y
CONFIG_ACPI=y
CONFIG_ACPI_INTERPRETER=y
CONFIG_ACPI_S1_SLEEP=y
CONFIG_APM=m
# CONFIG_APM_IGNORE_USER_SUSPEND is not set
# CONFIG_APM_DO_ENABLE is not set
# CONFIG_APM_CPU_IDLE is not set
# CONFIG_APM_DISPLAY_BLANK is not set
# CONFIG_APM_RTC_IS_GMT is not set
# CONFIG_APM_ALLOW_INTS is not set
# CONFIG_APM_REAL_MODE_POWER_OFF is not set

#
# Memory Technology Devices (MTD)
#
# CONFIG_MTD is not set

#
# Parallel port support
#
CONFIG_PARPORT=m
CONFIG_PARPORT_PC=m
CONFIG_PARPORT_PC_FIFO=y
# CONFIG_PARPORT_PC_SUPERIO is not set
# CONFIG_PARPORT_AMIGA is not set
# CONFIG_PARPORT_MFC3 is not set
# CONFIG_PARPORT_ATARI is not set
# CONFIG_PARPORT_SUNBPP is not set
CONFIG_PARPORT_OTHER=y
CONFIG_PARPORT_1284=y

#
# Plug and Play configuration
#
# CONFIG_PNP is not set
# CONFIG_ISAPNP is not set

#
# Block devices
#
CONFIG_BLK_DEV_FD=m
# CONFIG_BLK_DEV_XD is not set
# CONFIG_PARIDE is not set
# CONFIG_BLK_CPQ_DA is not set
# CONFIG_BLK_DEV_DAC960 is not set
CONFIG_BLK_DEV_LOOP=m
CONFIG_BLK_DEV_NBD=m
CONFIG_BLK_DEV_LVM=m
CONFIG_LVM_PROC_FS=y
CONFIG_BLK_DEV_MD=m
CONFIG_MD_LINEAR=m
CONFIG_MD_RAID0=m
CONFIG_MD_RAID1=m
CONFIG_MD_RAID5=m
# CONFIG_BLK_DEV_RAM is not set
# CONFIG_BLK_DEV_INITRD is not set

#
# Networking options
#
CONFIG_PACKET=m
CONFIG_PACKET_MMAP=y
CONFIG_NETLINK=y
CONFIG_RTNETLINK=y
CONFIG_NETLINK_DEV=m
# CONFIG_NETFILTER is not set
CONFIG_FILTER=y
CONFIG_UNIX=y
CONFIG_INET=y
CONFIG_IP_MULTICAST=y
# CONFIG_IP_ADVANCED_ROUTER is not set
# CONFIG_IP_PNP is not set
CONFIG_NET_IPIP=m
# CONFIG_NET_IPGRE is not set
# CONFIG_IP_MROUTE is not set
# CONFIG_ARPD is not set
CONFIG_INET_ECN=y
CONFIG_SYN_COOKIES=y
# CONFIG_IPV6 is not set
# CONFIG_KHTTPD is not set
# CONFIG_ATM is not set
CONFIG_IPX=m
CONFIG_IPX_INTERN=y
# CONFIG_SPX is not set
CONFIG_ATALK=m
# CONFIG_DECNET is not set
CONFIG_BRIDGE=m
# CONFIG_X25 is not set
# CONFIG_LAPB is not set
# CONFIG_LLC is not set
# CONFIG_ECONET is not set
# CONFIG_WAN_ROUTER is not set
# CONFIG_NET_FASTROUTE is not set
# CONFIG_NET_HW_FLOWCONTROL is not set

#
# QoS and/or fair queueing
#
# CONFIG_NET_SCHED is not set

#
# Telephony Support
#
# CONFIG_PHONE is not set
# CONFIG_PHONE_IXJ is not set

#
# ATA/IDE/MFM/RLL support
#
CONFIG_IDE=y

#
# IDE, ATA and ATAPI Block devices
#
CONFIG_BLK_DEV_IDE=y
# CONFIG_BLK_DEV_HD_IDE is not set
# CONFIG_BLK_DEV_HD is not set
CONFIG_BLK_DEV_IDEDISK=y
# CONFIG_IDEDISK_MULTI_MODE is not set
# CONFIG_BLK_DEV_IDEDISK_VENDOR is not set
# CONFIG_BLK_DEV_IDEDISK_FUJITSU is not set
# CONFIG_BLK_DEV_IDEDISK_IBM is not set
# CONFIG_BLK_DEV_IDEDISK_MAXTOR is not set
# CONFIG_BLK_DEV_IDEDISK_QUANTUM is not set
# CONFIG_BLK_DEV_IDEDISK_SEAGATE is not set
# CONFIG_BLK_DEV_IDEDISK_WD is not set
# CONFIG_BLK_DEV_COMMERIAL is not set
# CONFIG_BLK_DEV_TIVO is not set
# CONFIG_BLK_DEV_IDECS is not set
CONFIG_BLK_DEV_IDECD=m
CONFIG_BLK_DEV_IDETAPE=m
CONFIG_BLK_DEV_IDEFLOPPY=m
# CONFIG_BLK_DEV_IDESCSI is not set
# CONFIG_BLK_DEV_CMD640 is not set
# CONFIG_BLK_DEV_CMD640_ENHANCED is not set
# CONFIG_BLK_DEV_ISAPNP is not set
# CONFIG_BLK_DEV_RZ1000 is not set
CONFIG_BLK_DEV_IDEPCI=y
CONFIG_IDEPCI_SHARE_IRQ=y
CONFIG_BLK_DEV_IDEDMA_PCI=y
# CONFIG_BLK_DEV_OFFBOARD is not set
CONFIG_IDEDMA_PCI_AUTO=y
CONFIG_BLK_DEV_IDEDMA=y
CONFIG_IDEDMA_PCI_WIP=y
# CONFIG_IDEDMA_NEW_DRIVE_LISTINGS is not set
# CONFIG_BLK_DEV_AEC62XX is not set
# CONFIG_AEC62XX_TUNING is not set
# CONFIG_BLK_DEV_ALI15X3 is not set
# CONFIG_WDC_ALI15X3 is not set
# CONFIG_BLK_DEV_AMD7409 is not set
# CONFIG_AMD7409_OVERRIDE is not set
# CONFIG_BLK_DEV_CMD64X is not set
# CONFIG_BLK_DEV_CY82C693 is not set
# CONFIG_BLK_DEV_CS5530 is not set
# CONFIG_BLK_DEV_HPT34X is not set
# CONFIG_HPT34X_AUTODMA is not set
CONFIG_BLK_DEV_HPT366=y
CONFIG_BLK_DEV_PIIX=y
CONFIG_PIIX_TUNING=y
# CONFIG_BLK_DEV_NS87415 is not set
# CONFIG_BLK_DEV_OPTI621 is not set
# CONFIG_BLK_DEV_PDC202XX is not set
# CONFIG_PDC202XX_BURST is not set
# CONFIG_BLK_DEV_SIS5513 is not set
# CONFIG_BLK_DEV_TRM290 is not set
# CONFIG_BLK_DEV_VIA82CXXX is not set
# CONFIG_VIA82CXXX_TUNING is not set
# CONFIG_IDE_CHIPSETS is not set
CONFIG_IDEDMA_AUTO=y
CONFIG_IDEDMA_IVB=y
# CONFIG_DMA_NONPCI is not set
CONFIG_BLK_DEV_IDE_MODES=y

#
# SCSI support
#
CONFIG_SCSI=m
CONFIG_BLK_DEV_SD=m
CONFIG_SD_EXTRA_DEVS@
CONFIG_CHR_DEV_ST=m
CONFIG_BLK_DEV_SR=m
# CONFIG_BLK_DEV_SR_VENDOR is not set
CONFIG_SR_EXTRA_DEVS=2
# CONFIG_CHR_DEV_SG is not set
CONFIG_SCSI_DEBUG_QUEUES=y
CONFIG_SCSI_MULTI_LUN=y
CONFIG_SCSI_CONSTANTS=y
# CONFIG_SCSI_LOGGING is not set

#
# SCSI low-level drivers
#
CONFIG_BLK_DEV_3W_XXXX_RAID=m
CONFIG_SCSI_7000FASST=m
CONFIG_SCSI_ACARD=m
CONFIG_SCSI_AHA152X=m
CONFIG_SCSI_AHA1542=m
CONFIG_SCSI_AHA1740=m
CONFIG_SCSI_AIC7XXX=m
# CONFIG_AIC7XXX_TCQ_ON_BY_DEFAULT is not set
CONFIG_AIC7XXX_CMDS_PER_DEVICE=8
# CONFIG_AIC7XXX_PROC_STATS is not set
CONFIG_AIC7XXX_RESET_DELAY=5
CONFIG_SCSI_IPS=m
CONFIG_SCSI_ADVANSYS=m
CONFIG_SCSI_IN2000=m
CONFIG_SCSI_AM53C974=m
CONFIG_SCSI_MEGARAID=m
CONFIG_SCSI_BUSLOGIC=m
# CONFIG_SCSI_OMIT_FLASHPOINT is not set
CONFIG_SCSI_DMX3191D=m
CONFIG_SCSI_DTC3280=m
CONFIG_SCSI_EATA=m
CONFIG_SCSI_EATA_TAGGED_QUEUE=y
# CONFIG_SCSI_EATA_LINKED_COMMANDS is not set
CONFIG_SCSI_EATA_MAX_TAGS
CONFIG_SCSI_EATA_DMA=m
CONFIG_SCSI_EATA_PIO=m
CONFIG_SCSI_FUTURE_DOMAIN=m
CONFIG_SCSI_GDTH=m
CONFIG_SCSI_GENERIC_NCR5380=m
# CONFIG_SCSI_GENERIC_NCR53C400 is not set
CONFIG_SCSI_G_NCR5380_PORT=y
# CONFIG_SCSI_G_NCR5380_MEM is not set
CONFIG_SCSI_INITIO=m
CONFIG_SCSI_INIA100=m
CONFIG_SCSI_PPA=m
CONFIG_SCSI_IMM=m
# CONFIG_SCSI_IZIP_EPP16 is not set
# CONFIG_SCSI_IZIP_SLOW_CTR is not set
# CONFIG_SCSI_NCR53C406A is not set
CONFIG_SCSI_SYM53C416=m
CONFIG_SCSI_SIM710=m
CONFIG_SCSI_NCR53C7xx=m
# CONFIG_SCSI_NCR53C7xx_sync is not set
# CONFIG_SCSI_NCR53C7xx_FAST is not set
# CONFIG_SCSI_NCR53C7xx_DISCONNECT is not set
CONFIG_SCSI_NCR53C8XX=m
CONFIG_SCSI_SYM53C8XX=m
CONFIG_SCSI_NCR53C8XX_DEFAULT_TAGS=4
CONFIG_SCSI_NCR53C8XX_MAX_TAGS2
CONFIG_SCSI_NCR53C8XX_SYNC 
# CONFIG_SCSI_NCR53C8XX_PROFILE is not set
# CONFIG_SCSI_NCR53C8XX_IOMAPPED is not set
# CONFIG_SCSI_NCR53C8XX_PQS_PDS is not set
# CONFIG_SCSI_NCR53C8XX_SYMBIOS_COMPAT is not set
CONFIG_SCSI_PAS16=m
CONFIG_SCSI_PCI2000=m
CONFIG_SCSI_PCI2220I=m
CONFIG_SCSI_PSI240I=m
CONFIG_SCSI_QLOGIC_FAS=m
CONFIG_SCSI_QLOGIC_ISP=m
CONFIG_SCSI_QLOGIC_FC=m
CONFIG_SCSI_QLOGIC_1280=m
CONFIG_SCSI_SEAGATE=m
CONFIG_SCSI_DC390T=m
# CONFIG_SCSI_DC390T_NOGENSUPP is not set
CONFIG_SCSI_T128=m
CONFIG_SCSI_U14_34F=m
# CONFIG_SCSI_U14_34F_LINKED_COMMANDS is not set
CONFIG_SCSI_U14_34F_MAX_TAGS=8
CONFIG_SCSI_ULTRASTOR=m
# CONFIG_SCSI_DEBUG is not set

#
# IEEE 1394 (FireWire) support
#
CONFIG_IEEE1394=m
CONFIG_IEEE1394_PCILYNX=m
CONFIG_IEEE1394_PCILYNX_LOCALRAM=y
CONFIG_IEEE1394_PCILYNX_PORTS=y
CONFIG_IEEE1394_AIC5800=m
CONFIG_IEEE1394_OHCI1394=m
CONFIG_IEEE1394_VIDEO1394=m
CONFIG_IEEE1394_RAWIO=m
# CONFIG_IEEE1394_VERBOSEDEBUG is not set

#
# I2O device support
#
CONFIG_I2O=m
CONFIG_I2O_PCI=m
CONFIG_I2O_BLOCK=m
CONFIG_I2O_LAN=m
CONFIG_I2O_SCSI=m
CONFIG_I2O_PROC=m

#
# Network device support
#
CONFIG_NETDEVICES=y

#
# ARCnet devices
#
# CONFIG_ARCNET is not set

#
# Appletalk devices
#
# CONFIG_APPLETALK is not set
CONFIG_DUMMY=m
CONFIG_BONDING=m
# CONFIG_EQUALIZER is not set
# CONFIG_TUN is not set
# CONFIG_ETHERTAP is not set
# CONFIG_NET_SB1000 is not set

#
# Ethernet (10 or 100Mbit)
#
CONFIG_NET_ETHERNET=y
# CONFIG_NET_VENDOR_3COM is not set
# CONFIG_LANCE is not set
# CONFIG_NET_VENDOR_SMC is not set
# CONFIG_NET_VENDOR_RACAL is not set
# CONFIG_AT1700 is not set
# CONFIG_DEPCA is not set
# CONFIG_NET_ISA is not set
CONFIG_NET_PCI=y
# CONFIG_PCNET32 is not set
# CONFIG_ADAPTEC_STARFIRE is not set
# CONFIG_AC3200 is not set
# CONFIG_APRICOT is not set
# CONFIG_CS89x0 is not set
# CONFIG_DE4X5 is not set
# CONFIG_TULIP is not set
# CONFIG_DGRS is not set
# CONFIG_DM9102 is not set
CONFIG_EEPRO100=m
# CONFIG_EEPRO100_PM is not set
# CONFIG_LNE390 is not set
# CONFIG_NATSEMI is not set
# CONFIG_NE2K_PCI is not set
# CONFIG_NE3210 is not set
# CONFIG_RTL8129 is not set
# CONFIG_8139TOO is not set
# CONFIG_SIS900 is not set
# CONFIG_TLAN is not set
# CONFIG_VIA_RHINE is not set
# CONFIG_ES3210 is not set
# CONFIG_EPIC100 is not set
# CONFIG_NET_POCKET is not set

#
# Ethernet (1000 Mbit)
#
# CONFIG_YELLOWFIN is not set
# CONFIG_ACENIC is not set
# CONFIG_SK98LIN is not set
# CONFIG_FDDI is not set
# CONFIG_HIPPI is not set
# CONFIG_PLIP is not set
CONFIG_PPP=m
CONFIG_PPP_MULTILINK=y
CONFIG_PPP_ASYNC=m
CONFIG_PPP_SYNC_TTY=m
CONFIG_PPP_DEFLATE=m
CONFIG_PPP_BSDCOMP=m
CONFIG_PPPOE=m
# CONFIG_SLIP is not set

#
# Wireless LAN (non-hamradio)
#
# CONFIG_NET_RADIO is not set

#
# Token Ring devices
#
# CONFIG_TR is not set
# CONFIG_NET_FC is not set
# CONFIG_RCPCI is not set
# CONFIG_SHAPER is not set

#
# Wan interfaces
#
# CONFIG_WAN is not set

#
# Amateur Radio support
#
# CONFIG_HAMRADIO is not set

#
# IrDA (infrared) support
#
# CONFIG_IRDA is not set

#
# ISDN subsystem
#
# CONFIG_ISDN is not set

#
# Old CD-ROM drivers (not SCSI, not IDE)
#
# CONFIG_CD_NO_IDESCSI is not set

#
# Input core support
#
CONFIG_INPUT=m
CONFIG_INPUT_KEYBDEV=m
CONFIG_INPUT_MOUSEDEV=m
CONFIG_INPUT_MOUSEDEV_SCREEN_X24
CONFIG_INPUT_MOUSEDEV_SCREEN_Yv8
CONFIG_INPUT_JOYDEV=m
CONFIG_INPUT_EVDEV=m

#
# Character devices
#
CONFIG_VT=y
CONFIG_VT_CONSOLE=y
CONFIG_SERIAL=y
# CONFIG_SERIAL_CONSOLE is not set
# CONFIG_SERIAL_EXTENDED is not set
# CONFIG_SERIAL_NONSTANDARD is not set
CONFIG_UNIX98_PTYS=y
CONFIG_UNIX98_PTY_COUNT%6
CONFIG_PRINTER=m
# CONFIG_LP_CONSOLE is not set
# CONFIG_PPDEV is not set

#
# I2C support
#
CONFIG_I2C=m
CONFIG_I2C_ALGOBIT=m
CONFIG_I2C_PHILIPSPAR=m
CONFIG_I2C_ELV=m
CONFIG_I2C_VELLEMAN=m
CONFIG_I2C_ALGOPCF=m
CONFIG_I2C_ELEKTOR=m
CONFIG_I2C_CHARDEV=m

#
# Mice
#
# CONFIG_BUSMOUSE is not set
CONFIG_MOUSE=y
CONFIG_PSMOUSE=y
# CONFIG_82C710_MOUSE is not set
# CONFIG_PC110_PAD is not set

#
# Joysticks
#
CONFIG_JOYSTICK=y
CONFIG_INPUT_NS558=m
CONFIG_INPUT_LIGHTNING=m
CONFIG_INPUT_PCIGAME=m
CONFIG_INPUT_ANALOG=m
CONFIG_INPUT_A3D=m
CONFIG_INPUT_ADI=m
CONFIG_INPUT_COBRA=m
CONFIG_INPUT_GF2K=m
CONFIG_INPUT_GRIP=m
CONFIG_INPUT_INTERACT=m
CONFIG_INPUT_TMDC=m
CONFIG_INPUT_SIDEWINDER=m
CONFIG_INPUT_SERPORT=m
CONFIG_INPUT_WARRIOR=m
CONFIG_INPUT_MAGELLAN=m
CONFIG_INPUT_SPACEORB=m
CONFIG_INPUT_SPACEBALL=m
CONFIG_INPUT_IFORCE_232=m
# CONFIG_INPUT_IFORCE_USB is not set
CONFIG_INPUT_DB9=m
CONFIG_INPUT_GAMECON=m
CONFIG_INPUT_TURBOGRAFX=m
# CONFIG_QIC02_TAPE is not set

#
# Watchdog Cards
#
# CONFIG_WATCHDOG is not set
CONFIG_INTEL_RNG=m
# CONFIG_NVRAM is not set
CONFIG_RTC=m
CONFIG_DTLK=m
# CONFIG_R3964 is not set
# CONFIG_APPLICOM is not set

#
# Ftape, the floppy tape device driver
#
# CONFIG_FTAPE is not set
CONFIG_AGP=m
CONFIG_AGP_INTEL=y
# CONFIG_AGP_I810 is not set
# CONFIG_AGP_VIA is not set
# CONFIG_AGP_AMD is not set
# CONFIG_AGP_SIS is not set
# CONFIG_AGP_ALI is not set
CONFIG_DRM=y
CONFIG_DRM_TDFX=m
CONFIG_DRM_GAMMA=m
CONFIG_DRM_R128=m
CONFIG_DRM_I810=m
CONFIG_DRM_MGA=m

#
# Multimedia devices
#
CONFIG_VIDEO_DEV=m

#
# Video For Linux
#
CONFIG_VIDEO_PROC_FS=y
# CONFIG_I2C_PARPORT is not set
CONFIG_VIDEO_BT848=m
# CONFIG_VIDEO_PMS is not set
# CONFIG_VIDEO_BWQCAM is not set
# CONFIG_VIDEO_CQCAM is not set
# CONFIG_VIDEO_CPIA is not set
# CONFIG_VIDEO_SAA5249 is not set
# CONFIG_TUNER_3036 is not set
# CONFIG_VIDEO_STRADIS is not set
# CONFIG_VIDEO_ZORAN is not set
# CONFIG_VIDEO_BUZ is not set
# CONFIG_VIDEO_ZR36120 is not set

#
# Radio Adapters
#
# CONFIG_RADIO_CADET is not set
# CONFIG_RADIO_RTRACK is not set
# CONFIG_RADIO_RTRACK2 is not set
# CONFIG_RADIO_AZTECH is not set
# CONFIG_RADIO_GEMTEK is not set
# CONFIG_RADIO_MIROPCM20 is not set
# CONFIG_RADIO_SF16FMI is not set
# CONFIG_RADIO_TERRATEC is not set
# CONFIG_RADIO_TRUST is not set
# CONFIG_RADIO_TYPHOON is not set
# CONFIG_RADIO_ZOLTRIX is not set

#
# File systems
#
CONFIG_QUOTA=y
CONFIG_AUTOFS_FS=m
CONFIG_AUTOFS4_FS=m
# CONFIG_ADFS_FS is not set
# CONFIG_ADFS_FS_RW is not set
# CONFIG_AFFS_FS is not set
# CONFIG_HFS_FS is not set
# CONFIG_BFS_FS is not set
CONFIG_FAT_FS=m
CONFIG_MSDOS_FS=m
# CONFIG_UMSDOS_FS is not set
CONFIG_VFAT_FS=m
# CONFIG_EFS_FS is not set
# CONFIG_JFFS_FS is not set
CONFIG_CRAMFS=m
CONFIG_RAMFS=m
CONFIG_ISO9660_FS=m
CONFIG_JOLIET=y
# CONFIG_MINIX_FS is not set
CONFIG_NTFS_FS=m
# CONFIG_NTFS_RW is not set
# CONFIG_HPFS_FS is not set
CONFIG_PROC_FS=y
# CONFIG_DEVFS_FS is not set
# CONFIG_DEVFS_MOUNT is not set
# CONFIG_DEVFS_DEBUG is not set
CONFIG_DEVPTS_FS=y
# CONFIG_QNX4FS_FS is not set
# CONFIG_QNX4FS_RW is not set
# CONFIG_ROMFS_FS is not set
CONFIG_EXT2_FS=y
# CONFIG_SYSV_FS is not set
# CONFIG_SYSV_FS_WRITE is not set
CONFIG_UDF_FS=m
# CONFIG_UDF_RW is not set
CONFIG_UFS_FS=m
# CONFIG_UFS_FS_WRITE is not set

#
# Network File Systems
#
CONFIG_CODA_FS=m
CONFIG_NFS_FS=m
CONFIG_NFS_V3=y
# CONFIG_ROOT_NFS is not set
CONFIG_NFSD=m
CONFIG_NFSD_V3=y
CONFIG_SUNRPC=m
CONFIG_LOCKD=m
CONFIG_LOCKD_V4=y
CONFIG_SMB_FS=m
CONFIG_SMB_NLS_REMOTE=""
CONFIG_NCP_FS=m
CONFIG_NCPFS_PACKET_SIGNING=y
CONFIG_NCPFS_IOCTL_LOCKING=y
CONFIG_NCPFS_STRONG=y
CONFIG_NCPFS_NFS_NS=y
CONFIG_NCPFS_OS2_NS=y
CONFIG_NCPFS_SMALLDOS=y
CONFIG_NCPFS_MOUNT_SUBDIR=y
CONFIG_NCPFS_NDS_DOMAINS=y
CONFIG_NCPFS_NLS=y
CONFIG_NCPFS_EXTRAS=y

#
# Partition Types
#
CONFIG_PARTITION_ADVANCED=y
# CONFIG_ACORN_PARTITION is not set
# CONFIG_OSF_PARTITION is not set
# CONFIG_AMIGA_PARTITION is not set
# CONFIG_ATARI_PARTITION is not set
# CONFIG_MAC_PARTITION is not set
CONFIG_MSDOS_PARTITION=y
CONFIG_BSD_DISKLABEL=y
CONFIG_SOLARIS_X86_PARTITION=y
# CONFIG_UNIXWARE_DISKLABEL is not set
# CONFIG_SGI_PARTITION is not set
# CONFIG_ULTRIX_PARTITION is not set
CONFIG_SUN_PARTITION=y
CONFIG_NLS=y

#
# Native Language Support
#
CONFIG_NLS_DEFAULT="iso8859-1"
CONFIG_NLS_CODEPAGE_437=m
# CONFIG_NLS_CODEPAGE_737 is not set
# CONFIG_NLS_CODEPAGE_775 is not set
# CONFIG_NLS_CODEPAGE_850 is not set
# CONFIG_NLS_CODEPAGE_852 is not set
# CONFIG_NLS_CODEPAGE_855 is not set
# CONFIG_NLS_CODEPAGE_857 is not set
# CONFIG_NLS_CODEPAGE_860 is not set
# CONFIG_NLS_CODEPAGE_861 is not set
# CONFIG_NLS_CODEPAGE_862 is not set
# CONFIG_NLS_CODEPAGE_863 is not set
# CONFIG_NLS_CODEPAGE_864 is not set
# CONFIG_NLS_CODEPAGE_865 is not set
# CONFIG_NLS_CODEPAGE_866 is not set
# CONFIG_NLS_CODEPAGE_869 is not set
# CONFIG_NLS_CODEPAGE_874 is not set
# CONFIG_NLS_CODEPAGE_932 is not set
# CONFIG_NLS_CODEPAGE_936 is not set
# CONFIG_NLS_CODEPAGE_949 is not set
# CONFIG_NLS_CODEPAGE_950 is not set
CONFIG_NLS_ISO8859_1=m
# CONFIG_NLS_ISO8859_2 is not set
# CONFIG_NLS_ISO8859_3 is not set
# CONFIG_NLS_ISO8859_4 is not set
# CONFIG_NLS_ISO8859_5 is not set
# CONFIG_NLS_ISO8859_6 is not set
# CONFIG_NLS_ISO8859_7 is not set
# CONFIG_NLS_ISO8859_8 is not set
# CONFIG_NLS_ISO8859_9 is not set
# CONFIG_NLS_ISO8859_14 is not set
# CONFIG_NLS_ISO8859_15 is not set
# CONFIG_NLS_KOI8_R is not set
CONFIG_NLS_UTF8=m

#
# Console drivers
#
CONFIG_VGA_CONSOLE=y
CONFIG_VIDEO_SELECT=y
# CONFIG_MDA_CONSOLE is not set

#
# Frame-buffer support
#
CONFIG_FB=y
CONFIG_DUMMY_CONSOLE=y
CONFIG_FB_RIVA=m
CONFIG_FB_CLGEN=m
CONFIG_FB_PM2=m
CONFIG_FB_CYBER2000=m
CONFIG_FB_VESA=y
# CONFIG_FB_VGA16 is not set
# CONFIG_FB_HGA is not set
CONFIG_VIDEO_SELECT=y
CONFIG_FB_MATROX=m
CONFIG_FB_MATROX_MILLENIUM=y
CONFIG_FB_MATROX_MYSTIQUE=y
CONFIG_FB_MATROX_G100=y
CONFIG_FB_MATROX_I2C=m
CONFIG_FB_MATROX_MAVEN=m
# CONFIG_FB_MATROX_MULTIHEAD is not set
CONFIG_FB_ATY=m
CONFIG_FB_ATY128=m
CONFIG_FB_3DFX=m
# CONFIG_FB_SIS is not set
# CONFIG_FB_VIRTUAL is not set
# CONFIG_FBCON_ADVANCED is not set
CONFIG_FBCON_MFB=m
CONFIG_FBCON_CFB8=y
CONFIG_FBCON_CFB16=y
CONFIG_FBCON_CFB24=y
CONFIG_FBCON_CFB32=y
# CONFIG_FBCON_FONTWIDTH8_ONLY is not set
# CONFIG_FBCON_FONTS is not set
CONFIG_FONT_8x8=y
CONFIG_FONT_8x16=y

#
# Sound
#
CONFIG_SOUND=m
# CONFIG_SOUND_CMPCI is not set
CONFIG_SOUND_EMU10K1=m
# CONFIG_SOUND_FUSION is not set
# CONFIG_SOUND_ES1370 is not set
# CONFIG_SOUND_ES1371 is not set
# CONFIG_SOUND_ESSSOLO1 is not set
# CONFIG_SOUND_MAESTRO is not set
# CONFIG_SOUND_SONICVIBES is not set
# CONFIG_SOUND_TRIDENT is not set
# CONFIG_SOUND_MSNDCLAS is not set
# CONFIG_SOUND_MSNDPIN is not set
# CONFIG_SOUND_VIA82CXXX is not set
CONFIG_SOUND_OSS=m
CONFIG_SOUND_TRACEINIT=y
CONFIG_SOUND_DMAP=y
# CONFIG_SOUND_AD1816 is not set
# CONFIG_SOUND_SGALAXY is not set
# CONFIG_SOUND_ADLIB is not set
# CONFIG_SOUND_ACI_MIXER is not set
# CONFIG_SOUND_CS4232 is not set
# CONFIG_SOUND_SSCAPE is not set
# CONFIG_SOUND_GUS is not set
# CONFIG_SOUND_ICH is not set
# CONFIG_SOUND_VMIDI is not set
# CONFIG_SOUND_TRIX is not set
# CONFIG_SOUND_MSS is not set
# CONFIG_SOUND_MPU401 is not set
# CONFIG_SOUND_NM256 is not set
# CONFIG_SOUND_MAD16 is not set
# CONFIG_SOUND_PAS is not set
# CONFIG_PAS_JOYSTICK is not set
# CONFIG_SOUND_PSS is not set
CONFIG_SOUND_SOFTOSS=m
CONFIG_SOUND_SB=m
# CONFIG_SOUND_AWE32_SYNTH is not set
# CONFIG_SOUND_WAVEFRONT is not set
# CONFIG_SOUND_MAUI is not set
CONFIG_SOUND_YM3812=m
# CONFIG_SOUND_OPL3SA1 is not set
# CONFIG_SOUND_OPL3SA2 is not set
# CONFIG_SOUND_YMPCI is not set
# CONFIG_SOUND_UART6850 is not set
# CONFIG_SOUND_AEDSP16 is not set
CONFIG_SOUND_TVMIXER=m

#
# USB support
#
CONFIG_USB=m
CONFIG_USB_DEBUG=y
CONFIG_USB_DEVICEFS=y
CONFIG_USB_BANDWIDTH=y
CONFIG_USB_UHCI=m
CONFIG_USB_UHCI_ALT=m
CONFIG_USB_OHCI=m
CONFIG_USB_PRINTER=m
CONFIG_USB_SCANNER=m
CONFIG_USB_MICROTEK=m
CONFIG_USB_AUDIO=m
CONFIG_USB_ACM=m
CONFIG_USB_SERIAL=m
CONFIG_USB_SERIAL_GENERIC=y
CONFIG_USB_SERIAL_VISOR=m
CONFIG_USB_SERIAL_WHITEHEAT=m
CONFIG_USB_SERIAL_FTDI_SIO=m
CONFIG_USB_SERIAL_KEYSPAN_PDA=m
CONFIG_USB_SERIAL_KEYSPAN=m
CONFIG_USB_SERIAL_KEYSPAN_USA28=y
CONFIG_USB_SERIAL_KEYSPAN_USA28X=y
CONFIG_USB_SERIAL_KEYSPAN_USA19=y
CONFIG_USB_SERIAL_KEYSPAN_USA18X=y
CONFIG_USB_SERIAL_KEYSPAN_USA19W=y
CONFIG_USB_SERIAL_DIGI_ACCELEPORT=m
CONFIG_USB_SERIAL_OMNINET=m
CONFIG_USB_SERIAL_DEBUG=y
CONFIG_USB_IBMCAM=m
CONFIG_USB_OV511=m
CONFIG_USB_DC2XX=m
CONFIG_USB_MDC800=m
CONFIG_USB_STORAGE=m
CONFIG_USB_STORAGE_DEBUG=y
# CONFIG_USB_USS720 is not set
# CONFIG_USB_DABUSB is not set
CONFIG_USB_PLUSB=m
CONFIG_USB_PEGASUS=m
CONFIG_USB_RIO500=m
CONFIG_USB_DSBR=m
CONFIG_USB_BLUETOOTH=m
CONFIG_USB_HID=m
CONFIG_USB_KBD=m
CONFIG_USB_MOUSE=m
CONFIG_USB_WACOM=m

#
# Kernel hacking
#
CONFIG_MAGIC_SYSRQ=y


</body></email><email><emailId>20000830154647</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-08-30 15:46:47-0400</timestampReceived><subject>[Acpi] Re: Problem with APIC and ACPI (fwd)</subject><body>

From the lkml

---------- Forwarded message ----------
Date: Tue, 29 Aug 2000 14:27:10 +0200
From: FORT David &lt;fort@irin.univ-nantes.fr&gt;
Cc: linux-kernel@vger.kernel.org
Subject: Re: Problem with APIC and ACPI

Johnny Luong wrote:

&gt; See attachments.
&gt; 
&gt; Johnny Luong
&gt; jrl@cats.ucsc.edu
&gt; 
&gt; ------------------------------------------------------------------------
&gt; 1. Linux APIC errors and ACPI causes my machine to shutdown.
&gt; 
&gt; 2. I'm using linux-2.4.0-test7 and the problem seems to be somewhat odd.
&gt; I can't nail it to any certain program or any certain process.  Anyways,
&gt; if I enable ACPI in my BIOS (with the noapic tag removed from boot), my
&gt; machine shuts down.  Also, I get APIC errors, regardless of whether or
&gt; not I put in "noapic" on the boot line and here's a sample of what I get...
&gt; 
&gt; APIC error on CPU1: 00(04)
&gt; APIC error on CPU0: 00(08)
&gt; APIC error on CPU1: 04(04)
&gt; APIC error on CPU0: 08(02)
&gt; APIC error on CPU0: 02(04)
&gt; APIC error on CPU1: 04(08)
&gt; 
&gt; Some of it doesn't even make sense according to the comments in the apic
&gt; code and I'm not even sure how it's called.
&gt; 
&gt; 3. kernel, ACPI APIC
&gt; 
&gt; 4. Linux version 2.4.0-test7 (root@localhost) (gcc version egcs-2.91.66 \
&gt; 19990314/Linux (egcs-1.1.2 release)) #1 SMP Sun Aug 27 14:58:06 PDT 2000 
&gt; 7.1
&gt; -- Versions installed: (if some fields are empty or look
&gt; -- unusual then possibly you have very old versions)
&gt; Linux localhost 2.4.0-test7 #1 SMP Sun Aug 27 14:58:06 PDT 2000 i686 unknown
&gt; Kernel modules         2.3.10-pre1
&gt; Gnu C                  egcs-2.91.66
&gt; Binutils               2.9.5.0.22
&gt; Linux C Library        2.1.3
&gt; Dynamic linker         ldd (GNU libc) 2.1.3
&gt; Procps                 2.0.6
&gt; Mount                  2.10f
&gt; Net-tools              1.54
&gt; Console-tools          0.3.3
&gt; Sh-utils               2.0
&gt; Modules Loaded         ppp_deflate bsd_comp ppp_async ppp_generic slhc tuner bttv \
&gt; i2c-algo-bit videodev eeprom w83781d sensors i2c-isa i2c-piix4 i2c-core eepro100 \
&gt; nls_iso8859-1 nls_cp437 vfat fat opl3 sb sb_lib uart401 sound soundcore 
&gt; 

I think the first thing to do is read Documentation/CHANGES before running \
anything(modutils.....), next the ACPI is notoriously buggy on BP6 Mobo (i have one, \
so.....) so perhaps you should consider setting it off.

I think the CHANGES file should be changes for something with a file giving software \
requirement and another giving real changes(perhaps the fixed part of the 2.4 TODO \
page ), that certainly avoid having people reporting bugs when they run wrong \
modutils for exemple......

--
%--IRIN-&gt;-Institut-de-Recherche-en-Informatique-de-Nantes-----------------%
% FORT David,                                                             %
% 7 avenue de la morvandiÃ¨re                 0240726275                   %
% 44470 Thouare, France                      fortd@ensinfo.univ-nantes.fr %
% ICU:54999224   AIM: enlighted popo             fort@irin.univ-nantes.fr %
%--LINUX-HTTPD-PIOGENE----------------------------------------------------%
%  -datamining                            |   .~.                         %
%  -networking                            |   /V\        L  I  N  U  X    %
%  -opensource                            |  // \\     &gt;Fear the Penguin&lt; %
%  -GNOME/enlightenment/GIMP              | /(   )\                       %
%           feel enlighted....            |  ^^-^^                        %
%-------------------------------------------------------------------------%


</body></email><email><emailId>20000703165155</emailId><senderName>Stefan Hoffmeister</senderName><senderEmail>stefan.hoffmeister@econos.de</senderEmail><timestampReceived>2000-07-03 16:51:55-0400</timestampReceived><subject>[Acpi] Re: Debugging ACPI stuff on a vaio ?</subject><body>

&gt;For information, the bios is a Phoenix, rev R0114Z1 / RK114Z1,
&gt;which is acpi compliant.

FWIW, the latest revision (in my Z600) is R0116Z1 / RK116Z1. I have no
clue what has changed compared to earlier revisions.

The only indication that something "meaningful" has changed is that for
early Z600 BIOSes there are a number of reports about network hangs after
a suspend - with my BIOS, I can suspend and hibernate and completely
resurrect the network (Samba, Internet) via /etc/rc.d/init.d/network
restart.

</body></email><email><emailId>20000703165214</emailId><senderName>Stefan Hoffmeister</senderName><senderEmail>stefan.hoffmeister@econos.de</senderEmail><timestampReceived>2000-07-03 16:52:14-0400</timestampReceived><subject>[Acpi] ACPI power saving modes?</subject><body>

I am currently using a Sony Vaio Z600RE notebook with a 2.2.14 kernel
(stock RedHat 6.2) and am exceedingly happy with the power management
features I can get to work: Suspend (to memory) works, Hibernate (to disk)
works - in every conceivable situation, perfectly.

The only thing I am not happy about is the amount of heat the machine
produces. It is my understanding that the Mobile PIII (500) that's in the
Vaio can be configured somehow to work in some sort of "power saving
mode". It is also my understanding that using ACPI I could accomplish
that.

IOW, I currently do not care (that much) about performance, but I want to
extend the battery's life as much as possible (and reduce that heat :-&gt;).

Is there a way that I could get the PIII into this "permanent" power
saving mode with a 2.2.14 kernel? 

I'd be happy to be a guinea pig for a 2.4pre kernel, as long as the docs
on how to upgrade from 2.2.14 to 2.4pre are crystal clear and as long I
can easily *revert back* to a working kernel. Oh, and I definitiely don't
want to loose suspend + hibernate (some messages in the archive made me a
bit nervous about that bit).

Any thoughts?

Thanks very much,
Stefan

</body></email><email><emailId>20000711174758</emailId><senderName>Mathieu Chouquet-Stringer</senderName><senderEmail>mchouque@cs.stevens-tech.edu</senderEmail><timestampReceived>2000-07-11 17:47:58-0400</timestampReceived><subject>[Acpi] acpi and asus k7v</subject><body>

	Hello !

I have an asus k7v motherboard (athlon base system) and acpi doesn't seem
to work. I have all the tools (acpid), tried the latest kernel 2.4.0-test3
and the computer hangs if I start acpid (for previous kernel) or if I use
kernel 2.4 with acpi interpreter.
The only solution for previous kernel is to boot with acpi=no-c3
option. But in this case, the computer can't poweroff or standby when
requested...

I have emailed many times and didn't receive any answers. If anyone has the
same motherboard with acpi working, please let me know.

Thank you.

-- 
Mathieu CHOUQUET-STRINGER    E-Mail : mchouque@stevens-tech.edu
     "Entities must not be multiplied beyond necessity"
		-- William of Occam --

</body></email><email><emailId>20000711203054</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-07-11 20:30:54-0400</timestampReceived><subject>[Acpi] acpid update (071100)</subject><body>

A new version of acpid is available now from

http://www.geocities.com/SiliconValley/Hardware/3165/

Changes
* Interpreter and associated code moved to the kernel

This update should work with the latest Linux
kernel (2.4.0-test3) with the experimental
ACPI interpreter option turned on.  All other
kernel versions and configurations should still
use the old acpid (052200)

-Andy


__________________________________________________
Do You Yahoo!?
Get Yahoo! Mail =96 Free email you can access from anywhere!
http://mail.yahoo.com/

</body></email><email><emailId>20000712212427</emailId><senderName>Dieter =?iso-8859-1?Q?N=FCtzel?=</senderName><senderEmail>dieter.nuetzel@myokay.net</senderEmail><timestampReceived>2000-07-12 21:24:27-0400</timestampReceived><subject>[Acpi] New interpreter with Irongate C4 (MSI 6167) :-(</subject><body>

Hello Andy,

kernel 2.4.0-test3 with the new interpreter code enabled show the same
symptoms as I reported some time ago on my MSI 6167 Rev. 1.0B (Irongate
C4) mobo.
Bad slowdown with ppp(d).

Will try it without interpreter, tomorrow.

Regards,
        Dieter

--
Dieter N=FCtzel
Graduate Student, Computer Science

University of Hamburg
Department of Computer Science
Cognitive Systems Group
Vogt-K=F6lln-Stra=DFe 30
D-22527 Hamburg, Germany

email: nuetzel@kogs.informatik.uni-hamburg.de
@home: dieter.nuetzel@myokay.net

</body></email><email><emailId>20000712214103</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-07-12 21:41:03-0400</timestampReceived><subject>[Acpi] [admin] Changing the list setup?</subject><body>

Hi,

I'd like to change all occurences of the long version of our hostname to
the shorter CNAME, but this will also mean that the envelope from address
and the the X-List-Id field will change (which some of you might use for
filtering).

If there are no objections, I'd change on Friday, 10pm CET DST, which
should be a time where most of the readers are awake (Sorry to the folks
in Japan :-/).

   Simon

-- 
PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

</body></email><email><emailId>20000713085346</emailId><senderName>"Tasnim Ahmed"</senderName><senderEmail>debugger@bigfoot.com</senderEmail><timestampReceived>2000-07-13 08:53:46-0400</timestampReceived><subject>[Acpi] ACPI queries</subject><body>

Hello:

I have a gigabyte ACPI board and if I use APM

# halt

turns off my computer but using ACPI it does not. While windows2000 does
that and it recognizes my PC as ACPI compatible.

Anybody please shed some light on this and tell me if I can use any software
to suspend my computer.

thanks,
tasnim

</body></email><email><emailId>20000713163746</emailId><senderName>Jurgen Botz</senderName><senderEmail>jurgen@botz.org</senderEmail><timestampReceived>2000-07-13 16:37:46-0400</timestampReceived><subject>Re: [Acpi] ACPI changes</subject><body>

Kernel 2.4.0-test4-pre6 hangs my Sony VAIO N505VE hard during boot...
"ACPI: support found" prints, and then... nada, hard freeze.

Prior to 2.4.0-test3 kernels with ACPI support had no such problems,
and ACPI /seemed/ to recognize the systems capabilities, but sleep
did not work (system would freeze on sleep).

-j

</body></email><email><emailId>20000714113325</emailId><senderName>Mitch Miers</senderName><senderEmail>mmiers@intellinet-tech.com</senderEmail><timestampReceived>2000-07-14 11:33:25-0400</timestampReceived><subject>[Acpi] Inspiron 7500 has no C3</subject><body>

I'm back with my Maestro and sluggish system problem ;)

Is there a reason why no-c2, no-c3 was removed?  (test4-pre6).
C3 is giving me fits.  My kernel says:

ACPI: support found 
ACPI: PBLK 0 @ 0x1010:6 
ACPI: C2 supported 
ACPI: 7 throttling states 
ACPI: S1 supported 
ACPI: S5 supported 
ACPI: found EC @ (0x62,0x66,9) 

However, the ACPI thread reports:

C2 works ok
C3 works ok

which it (C3) doesn't, at least with my Maestro.

Why would C3 be used if it isn't supported?  In the past, if I did
acpi=no-c3 in lilo.conf, things worked ok.  I'm guessing that this
is a bug?

Not subscribed to this list, please CC me on any replies.

Mitch

</body></email><email><emailId>20000716172635</emailId><senderName>David Woodhouse</senderName><senderEmail>dwmw2@infradead.org</senderEmail><timestampReceived>2000-07-16 17:26:35-0400</timestampReceived><subject>[Acpi] 2.4.0-test4 kernel ACPI fails on BP6.</subject><body>


Debugging this has been a PITA because I can only load the acpi
interpreter module about three times before the machine powers down - on
the fourth attempt it just powers down immediately.

It appears that acpi_ns_lookup() called from around line 272 of
dispatcher/dswload.c (in acpi_ds_load2_begin_op()) is failing to find
"DBG1".

DSDT disassembly attached. This is a BP6 with the latest (RU) BIOS. Is
this their fault or ours, and if the former, can we do anything to work
round it?

-- 
dwmw2

["dsdtdisasm-bp6-rubios.gz" (APPLICATION/x-gzip)]

</body></email><email><emailId>20000719103015</emailId><senderName>"Therien, Guy"</senderName><senderEmail>guy.therien@intel.com</senderEmail><timestampReceived>2000-07-19 10:30:15-0400</timestampReceived><subject>RE: [Acpi] reduce idle power</subject><body>

APM and ACPI with OS-directed power management should reduce your notebook
power consumption to a few watts max when idle. This depends on the level of
hardware power management implemented by your system. APM or ACPI/OSPM can
take advantage of the hw power management provided. When idle the CPU and
chipset is placed into a low power state. If idle long enough, other devices
should also be turned off (e.g. audio, disk, etc).
Guy

-----Original Message-----
From: Yung-Hsiang Lu [mailto:luyung@stanford.edu]
Sent: Tuesday, July 18, 2000 8:51 PM
To: acpi@phobos.fachschaften.tu-muenchen.de
Subject: [Acpi] reduce idle power


Hi,

Does anybody knows the answer to this question, or some partial 
answers?  Thanks!

"When my notebook is idle (for a 5-min coffee break), it still takes nearly 
10 W.  This excludes the display, the hard disk, the network card.  Pentium 
idle instruction (hlt) is used.  Is this 10W consumed by chips on the 
motherboard?  Does APM or ACPI help?"

I don't think APM helps reducing idle power due to chipsets unless entering 
suspend mode.  How about ACPI?

Yung-Hsiang Lu       luyung@stanford.edu     (650)725-3647
Computer Systems Laboratory, Stanford University
Gates 326, 353 Serra Mall, Stanford, CA 94305   


_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000719134645</emailId><senderName>Chris Worley</senderName><senderEmail>cworley@liberate.com</senderEmail><timestampReceived>2000-07-19 13:46:45-0400</timestampReceived><subject>Re: [Acpi] Re: Using power switch to go into standby mode</subject><body>

&gt;From looking at the ACPI source, I'm guessing:

&gt;	-0061 Warning: RSDP structure not found

means ACPI won't work on this board?

Is that correct?

If not, can anyone suggest a debugging procedure?

Thanks,

Chris

Chris Worley wrote:
&gt; 
&gt; I'm trying to get ACPI working on an I-Opener running Jailbait V6 (v
&gt; 2.2.4test4 kernel).
&gt; 
&gt; At boot, I get two ACPI error messages:
&gt; 
&gt; -0061 Warning: RSDP structure not found
&gt; -0550 Success: namespace and objects deleted p1 p2 &lt; p5 p6 p7 p8 &gt;
&gt; 
&gt; After boot, there's no /proc/sys/acpi directory.  I didn't compile APM
&gt; in, so the power switch no longer works at all.  Note: I'm not running
&gt; the acpid yet, I figure without /proc/sys/acpi it won't work anyway.
&gt; 
&gt; What did I do wrong?
&gt; 
&gt; If I can get acpi working, what must I do to make the power-off message
&gt; cause a standby?
&gt; 
&gt; Thanks,
&gt; 
&gt; Chris
&gt; 
&gt; Max Berger wrote:
&gt; &gt;
&gt; &gt; Hi,
&gt; &gt;
&gt; &gt; On Sun, 16 Jul 2000, Chris Worley wrote:
&gt; &gt; &gt; In QNX, the power switch merely turned off the power to the monitor...
&gt; &gt; &gt; How did they do that?  I'd like to be able to do the same in Linux.
&gt; &gt;
&gt; &gt; &gt; Any ideas on how to associate the switch to standby mode?
&gt; &gt;
&gt; &gt; what your asking for is a feature which is not supported by APM. It is,
&gt; &gt; however supported by ACPI. You might have to upgrade to the latest
&gt; &gt; 2.4-test kernel and try the acpid.
&gt; &gt;
&gt; &gt; see http://phobos.fs.tum.de/acpi/ for more details.
&gt; &gt;
&gt; &gt; Max Berger
&gt; &gt; e-mail: max.berger@xslt.de
&gt; &gt;
&gt; &gt; --
&gt; &gt; XSLT:     http://www.xslt.de/         ACPI4Linux: http://phobos.fs.tum.de/acpi/
&gt; &gt; FBR-Info: http://www.fs.tum.de/FSMPI/ Sysop:      http://wwwbrauer.in.tum.de/
&gt; &gt; 9CF77B603671BB18 D5110085483230BB ftp://phobos.fs.tum.de/pub/pgp/max.berger.asc
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000721105943</emailId><senderName>Kuros Yalpani</senderName><senderEmail>kyalpani@gmx.de</senderEmail><timestampReceived>2000-07-21 10:59:43-0400</timestampReceived><subject>[Acpi] help!!!</subject><body>

Greetings. Can I expect my acer travelmate 505T notebook, that has
ACPI power management, to work smoothly if I install
Redhat 6.2 (or earlier versions) without installing ACPI enabled
kernel, the acpi libraries and software? I originally
repartitioned my harddrive to have win98 and linux side by side. But
after this, both linux and win98 started failing terribly (freezing
and crashing with disk write errors). I read somewhere that win98 
powermanagement software possibly corrupts the linux partition
($%&amp;/=Â§"!$.)

I tried reinstalling win98 with the recovery-cd that came with the
notebook
(without the linux partition this time) and still win98 the same problems
as
before. Then I reinstalled linux (without win98)
and I still have problems ('ls' command crashes with segmentation fault)

Your opinions are welcome...

P.S. I am a fairly experienced software developer (right!!!) and I will 
gladly help the ACPI group with development work if there is some...

Kuros Yalpani
Munich/Germany

-- 
Sent through GMX FreeMail - http://www.gmx.net

</body></email><email><emailId>20000722163226</emailId><senderName>"cchandel"</senderName><senderEmail>cchandel@bplnet.com</senderEmail><timestampReceived>2000-07-22 16:32:26-0400</timestampReceived><subject>[Acpi] ACPI : EC GPE mesasage repeated 533 times</subject><body>

Hi !
  I'm running linux 2.4.0-test 4 on a compaq 1688. It has an AMD K2 400 =
with an ALi Viper II (M 7101).
  Basically the acpi part doesn't really work after the kernel detection =
process is complete and I get ACPI : EC GPE areound 533 times. The =
kernel messages are as follows :-
  ACPI: PBLK 0 @ 0x1010:6
  ACPI: 7 throttling states
  ACPI: S1 supported
  ACPI: S5 supported
  ACPI: found EC @ (0x62,0x66,6)
  ACPI: EC GPE
  localhost last message repeated 533 times

 Of course these are just the ACPI related stuff.
 With APM enabled the APM daemon takes over - ACPI says that APM has =
been detected and doesn't start. ( I tried building the kernel with both =
ACPI &amp; APM enabled and one with just ACPI) Does anyone have any answers =
?
 Thanx
Chaitanya


[Attachment #3 (text/html)]

&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"&gt;
&lt;HTML&gt;&lt;HEAD&gt;
&lt;META content="text/html; charset=iso-8859-1" http-equiv=Content-Type&gt;
&lt;META content="MSHTML 5.00.2919.6307" name=GENERATOR&gt;
&lt;STYLE&gt;&lt;/STYLE&gt;
&lt;/HEAD&gt;
&lt;BODY bgColor=#ffffff&gt;
&lt;DIV&gt;&lt;FONT face=Arial size=2&gt;
&lt;DIV&gt;&lt;FONT face=Arial size=2&gt;Hi !&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=Arial size=2&gt;Â  I'm running linux 2.4.0-test 4 on a compaq 
1688. It has an AMD K2 400 with an ALi Viper II (M 7101).&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=Arial size=2&gt;Â  Basically the acpi part doesn't really work 
after the kernel detection process is complete and I get ACPI : EC GPE areound 
533 times. The kernel messages are as follows :-&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;Â  ACPI: PBLK 0 @ 0x1010:6&lt;/DIV&gt;
&lt;DIV&gt;Â  ACPI: 7 throttling states&lt;/DIV&gt;
&lt;DIV&gt;Â  ACPI: S1 supported&lt;/DIV&gt;
&lt;DIV&gt;Â  ACPI: S5 supported&lt;/DIV&gt;
&lt;DIV&gt;Â  ACPI: found EC @ (0x62,0x66,6)&lt;/DIV&gt;
&lt;DIV&gt;Â  ACPI: EC GPE&lt;/DIV&gt;
&lt;DIV&gt;Â  localhost last message repeated 533 times&lt;/DIV&gt;
&lt;DIV&gt;Â &lt;/DIV&gt;
&lt;DIV&gt;Â Of course theseÂ are just the ACPI related stuff.&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=Arial size=2&gt;Â With APM enabled the APM daemon takes over - 
ACPI says that APM has been detected and doesn't start. ( I tried building the 
kernel with both ACPIÂ &amp; APM enabled and one with just ACPI) Does anyone 
have any answers ?&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;Â Thanx&lt;/DIV&gt;
&lt;DIV&gt;Chaitanya&lt;/DIV&gt;
&lt;DIV&gt;Â &lt;/DIV&gt;&lt;/FONT&gt;&lt;/DIV&gt;&lt;/BODY&gt;&lt;/HTML&gt;


</body></email><email><emailId>20000724183656</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-07-24 18:36:56-0400</timestampReceived><subject>[Acpi] [PATCH] ACPI interpreter on ACPI-tableless systems (fwd)</subject><body>

&gt;From the lkml.

   Simon

---------- Forwarded message ----------
Date: Mon, 24 Jul 2000 13:06:39 +0400 (MSD)
From: Andrey Panin &lt;pazke@orbita.don.sitek.net&gt;
Subject: [PATCH] ACPI interpreter on ACPI-tableless systems


Hi,

this patch make ACPI interpreter useful on systems without
BIOS-provided ACPI tables (at least for VIA chipsets).

Patch consist of 2 parts:
	- disable SCI/SMI mode switching when SCI IRQ == 0;
	- /proc/sys/sX_slp_typ (X = 0,1,5) proc entries are back.
	  These entries are required for power off (at least on my
	  machine :)

Best wishes,
	Andrey

["patch-acpi-2.4.0-test4" (TEXT/PLAIN)]

diff -urN /linux/drivers/acpi/driver.c /tmp/linux/drivers/acpi/driver.c
--- /linux/drivers/acpi/driver.c	Sun Jul 23 23:56:21 2000
+++ /tmp/linux/drivers/acpi/driver.c	Sun Jul 23 23:44:12 2000
@@ -259,6 +259,18 @@
 	 &amp;acpi_c3_enter_latency, sizeof(acpi_c3_enter_latency),
 	 0644, NULL, &amp;acpi_do_ulong},
 
+	{ACPI_S0_SLP_TYP, "s0_slp_typ",
+	 &amp;acpi_slptyp[ACPI_S0], sizeof(acpi_slptyp[ACPI_S0]),
+	 0644, NULL, &amp;acpi_do_ulong},
+
+	{ACPI_S1_SLP_TYP, "s1_slp_typ",
+	 &amp;acpi_slptyp[ACPI_S1], sizeof(acpi_slptyp[ACPI_S1]),
+	 0644, NULL, &amp;acpi_do_ulong},
+
+	{ACPI_S5_SLP_TYP, "s5_slp_typ",
+	 &amp;acpi_slptyp[ACPI_S5], sizeof(acpi_slptyp[ACPI_S5]),
+	 0644, NULL, &amp;acpi_do_ulong},
+
 	{ACPI_SLEEP, "sleep", NULL, 0, 0600, NULL, &amp;acpi_do_sleep},
 
 	{ACPI_EVENT, "event", NULL, 0, 0400, NULL, &amp;acpi_do_event},
diff -urN /linux/drivers/acpi/driver.h /tmp/linux/drivers/acpi/driver.h
--- /linux/drivers/acpi/driver.h	Sun Jul 23 23:56:21 2000
+++ /tmp/linux/drivers/acpi/driver.h	Sun Jul 23 23:45:02 2000
@@ -65,6 +65,7 @@
  * tables.c
  */
 extern struct acpi_facp acpi_facp;
+extern unsigned long acpi_slptyp[ACPI_S5 + 1];
 
 int acpi_load_tables(void);
 
diff -urN /linux/drivers/acpi/events/evxfevnt.c /tmp/linux/drivers/acpi/events/evxfevnt.c
--- /linux/drivers/acpi/events/evxfevnt.c	Sun Jul 23 23:55:43 2000
+++ /tmp/linux/drivers/acpi/events/evxfevnt.c	Mon Jul 17 20:25:19 2000
@@ -53,7 +53,6 @@
 {
 	ACPI_STATUS             status;
 
-
 	/* Make sure we've got ACPI tables */
 
 	if (!acpi_gbl_DSDT) {
@@ -82,16 +81,19 @@
 		return (AE_ERROR);
 	}
 
-	/* Install the SCI handler */
+	if (acpi_gbl_FACP-&gt;sci_int) {
 
-	if (ACPI_FAILURE (acpi_ev_install_sci_handler ())) {
-		return (AE_ERROR);
-	}
+		/* Install the SCI handler */
 
-	/* Transition to ACPI mode */
+		if (ACPI_FAILURE (acpi_ev_install_sci_handler ())) {
+			return (AE_ERROR);
+		}
 
-	if (AE_OK != acpi_hw_set_mode (SYS_MODE_ACPI)) {
-		return (AE_ERROR);
+		/* Transition to ACPI mode */
+
+		if (AE_OK != acpi_hw_set_mode (SYS_MODE_ACPI)) {
+			return (AE_ERROR);
+		}
 	}
 
 	/* Install handlers for control method GPE handlers (_Lxx, _Exx) */
diff -urN /linux/drivers/acpi/sys.c /tmp/linux/drivers/acpi/sys.c
--- /linux/drivers/acpi/sys.c	Sun Jul 23 23:56:21 2000
+++ /tmp/linux/drivers/acpi/sys.c	Sun Jul 23 23:42:13 2000
@@ -37,7 +37,7 @@
 };
 
 volatile acpi_sstate_t acpi_sleep_state = ACPI_S0;
-static unsigned long acpi_slptyp[ACPI_S5 + 1] = {ACPI_INVALID,};
+unsigned long acpi_slptyp[ACPI_S5 + 1] = {ACPI_INVALID,};
 
 /*
  * Enter system sleep state


</body></email><email><emailId>20000725095511</emailId><senderName>BERNARD Sebastien</senderName><senderEmail>sebastien.bernard@cegetel.fr</senderEmail><timestampReceived>2000-07-25 09:55:11-0400</timestampReceived><subject>[Acpi] Stuck with new acpi</subject><body>

Once, with the old acpi, I was able to get the laptop working by enabling
acpi-irq when enabling the acpi.
Now, with the new code layout the patch is no more possible neither easy.
The irq is set in the interpreter and I don't see a clean way of maintaining
the behaviour that works with my laptop.

I admit that my modification is a ugly hack.
I never understood why it's up to the acpid daemon to enable the acpi and
what is the daemon now supposed to do ?
the kernel stays for a long time with the acpi-irq enabled but the acpi
disabled.
Is it a correct way of working regarding the acpi specs ?
Moreover, pcmcia is not working, and the embedded Ethernet controler (a
tulip one) is no more working when
acpi is on. Maybe the interrupt scheme expected by the bios is different
thant the one set by the kernel.
I remembered having read a statement in the spec that says: if the acpi is
to be used, then all devices that are acpi aware
must be initialized by the ACPI interpreter. So, all devices are not
initialized by the ACPI and maybe it's the source of problem.
Where can I find in the tables the method or ressources allocated by each
device (the reserved interrupts and IO) ?


Any help is welcome.

</body></email><email><emailId>20000727133539</emailId><senderName>Simon Josefsson</senderName><senderEmail>simon@josefsson.org</senderEmail><timestampReceived>2000-07-27 13:35:39-0400</timestampReceived><subject>Re: [Acpi] Pbm to register a GPE handler</subject><body>

Hi, I compiled with ACPI support in my 2.4.0-test4 kernel and I'm
running acpid, and everything "seem" to work, at least nothing is
complaining.  This is a Dell Latitude LSt.

But with APM my fan used to be go on when I started compiling things,
with ACPI the fan never seem to go on no matter what I do.  Is this a
configuration issue?

And with APM I could type "apm" to see battery status, how do I do
this with ACPI?

I've reverted to APM meanwhile.

Kernel print on boot:

ACPI: support found 
ACPI: PBLK 0 @ 0x8010:6 
ACPI: C2 supported 
ACPI: 7 throttling states 
ACPI: S5 supported 
ACPI: found EC @ (0x62,0x66,0) 

</body></email><email><emailId>20000730151304</emailId><senderName>Dieter =?iso-8859-1?Q?N=FCtzel?=</senderName><senderEmail>dieter.nuetzel@myokay.net</senderEmail><timestampReceived>2000-07-30 15:13:04-0400</timestampReceived><subject>[Acpi] 2.4.0-test5 (final) and Irongate C4 (MS-6167)</subject><body>

Hello all,

the 'new' ACPI interpreter included in the 'latest' 2.4.0-test5 (final)
kernel didn't work on my MSI MS-6167 Rev. 1.0B (Irongate C4) mobo.

The pppd slowdown still exists and ACPI show some errors:

Linux version 2.4.0-test5 (root@SunWave1) (gcc version 2.95.2 19991024
(release)) #1 Sun Jul 30 00:12:16 CEST 2000
BIOS-provided physical RAM map:
 e820: 000000000009fc00 @ 0000000000000000 (usable)
 e820: 0000000000000400 @ 000000000009fc00 (reserved)
 e820: 0000000000010000 @ 00000000000f0000 (reserved)
 e820: 0000000000010000 @ 00000000ffff0000 (reserved)
 e820: 000000000fef0000 @ 0000000000100000 (usable)
 e820: 000000000000d000 @ 000000000fff3000 (ACPI data)
 e820: 0000000000003000 @ 000000000fff0000 (ACPI NVS)
Scan SMP from c0000000 for 1024 bytes.
Scan SMP from c009fc00 for 1024 bytes.
Scan SMP from c00f0000 for 65536 bytes.
Scan SMP from c009fc00 for 4096 bytes.
On node 0 totalpages: 65520
zone(0): 4096 pages.
zone(1): 61424 pages.
zone(2): 0 pages.
mapped APIC to ffffe000 (01404000)
Kernel command line: auto BOOT_IMAGE=linux ro root=803 reboot=warm
Initializing CPU#0
Detected 548948674 Hz processor.
Console: colour VGA+ 80x25
Calibrating delay loop... 1094.45 BogoMIPS
Memory: 255876k/262080k available (1261k kernel code, 5816k reserved,
76k data, 164k init,
0k highmem)

[snip]

Real Time Clock Driver v1.10c
ACPI: support found
ACPI: PBLK 1 @ 0x5010:6
ACPI: C2 supported
ACPI: 1 throttling states
ACPI:         -0176: &lt;7&gt;ACPI: *** Error: Object type returned from
interpreter differs from expected value
ACPI:         -0176: &lt;7&gt;ACPI: *** Error: Object type returned from
interpreter differs from expected value
ACPI: S1 supported
VFS: Mounted root (ext2 filesystem) readonly.
Freeing unused kernel memory: 164k freed
ACPI C2 works

[snip]

Is this a mobo without BIOS ACPI tables?
I would be happy if I get some replies...

Thanks,
    Dieter

--
Dieter NÃ¼tzel
Graduate Student, Computer Science

University of Hamburg
Department of Computer Science
Cognitive Systems Group
Vogt-KÃ¶lln-StraÃe 30
D-22527 Hamburg, Germany

email: nuetzel@kogs.informatik.uni-hamburg.de
@home: dieter.nuetzel@myokay.net

</body></email><email><emailId>20000731190720</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-07-31 19:07:20-0400</timestampReceived><subject>Re: [Acpi] help me.</subject><body>

On Mon, 31 Jul 2000, Alexander Gottwald wrote:

&gt; &gt; I can't connetc http://phobos.fs.tum.de/acpi/index.html

&gt; try http://phobos.fachschaften.tu-muenchen.de/acpi/index.html

&gt; seems like some dns-entries are wrong/have changed

Yes, the zone file for the shorter names seems to be more recent than the
serial number. I've notified the admins about this, they will bump the
serial number and hope the problem goes away :-)

   Simon

-- 
PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

</body></email><email><emailId>20000719035059</emailId><senderName>Yung-Hsiang Lu</senderName><senderEmail>luyung@stanford.edu</senderEmail><timestampReceived>2000-07-19 03:50:59-0400</timestampReceived><subject>[Acpi] reduce idle power</subject><body>

Hi,

Does anybody knows the answer to this question, or some partial 
answers?  Thanks!

"When my notebook is idle (for a 5-min coffee break), it still takes nearly 
10 W.  This excludes the display, the hard disk, the network card.  Pentium 
idle instruction (hlt) is used.  Is this 10W consumed by chips on the 
motherboard?  Does APM or ACPI help?"

I don't think APM helps reducing idle power due to chipsets unless entering 
suspend mode.  How about ACPI?

Yung-Hsiang Lu       luyung@stanford.edu     (650)725-3647
Computer Systems Laboratory, Stanford University
Gates 326, 353 Serra Mall, Stanford, CA 94305   

</body></email><email><emailId>20000717235609</emailId><senderName>Chris Worley</senderName><senderEmail>cworley@symbionsys.com</senderEmail><timestampReceived>2000-07-17 23:56:09-0400</timestampReceived><subject>[Acpi] Re: Using power switch to go into standby mode</subject><body>

I'm trying to get ACPI working on an I-Opener running Jailbait V6 (v
2.2.4test4 kernel).

At boot, I get two ACPI error messages:

-0061 Warning: RSDP structure not found
-0550 Success: namespace and objects deleted p1 p2 &lt; p5 p6 p7 p8 &gt;

After boot, there's no /proc/sys/acpi directory.  I didn't compile APM
in, so the power switch no longer works at all.  Note: I'm not running
the acpid yet, I figure without /proc/sys/acpi it won't work anyway.

What did I do wrong?

If I can get acpi working, what must I do to make the power-off message
cause a standby?

Thanks,

Chris

Max Berger wrote:
&gt; 
&gt; Hi,
&gt; 
&gt; On Sun, 16 Jul 2000, Chris Worley wrote:
&gt; &gt; In QNX, the power switch merely turned off the power to the monitor...
&gt; &gt; How did they do that?  I'd like to be able to do the same in Linux.
&gt; 
&gt; &gt; Any ideas on how to associate the switch to standby mode?
&gt; 
&gt; what your asking for is a feature which is not supported by APM. It is,
&gt; however supported by ACPI. You might have to upgrade to the latest
&gt; 2.4-test kernel and try the acpid.
&gt; 
&gt; see http://phobos.fs.tum.de/acpi/ for more details.
&gt; 
&gt; Max Berger
&gt; e-mail: max.berger@xslt.de
&gt; 
&gt; --
&gt; XSLT:     http://www.xslt.de/         ACPI4Linux: http://phobos.fs.tum.de/acpi/
&gt; FBR-Info: http://www.fs.tum.de/FSMPI/ Sysop:      http://wwwbrauer.in.tum.de/
&gt; 9CF77B603671BB18 D5110085483230BB ftp://phobos.fs.tum.de/pub/pgp/max.berger.asc

</body></email><email><emailId>20000727131158</emailId><senderName>Eric Estievenart</senderName><senderEmail>eestievenart@apsydev.com</senderEmail><timestampReceived>2000-07-27 13:11:58-0400</timestampReceived><subject>[Acpi] Pbm to register a GPE handler</subject><body>


Hello,
I'm writing a small driver for an ACPI-compatible embedded controller,
and I would like to know how to register a gpe event handler.

What I do is (don't worry it it looks bad ;):

extern "C"
{
  #include "/usr/local/src/linux/drivers/acpi/include/acpi.h"
  #include "/usr/local/src/linux/drivers/acpi/include/acpixf.h"
}

extern "C" void Generic_GPE_handler( void *pCtxt )
{
  CAcpiEvt *pEvt = (CAcpiEvt*)pCtxt;
  pEvt-&gt;OnIrq();
}

int CAcpiEvt::VReserve()
{
  return acpi_install_gpe_handler( m_iGpeBit,
                                   ACPI_GPE_EDGE_TRIGGERED,
                                   Generic_GPE_handler, this );
}

void CAcpiEvt::VFree()
{
  acpi_remove_gpe_handler( m_iGpeBit, Generic_GPE_handler );
}

Compile is fine, but my module won't load :
stevebook/home/steve/src/ddk# insmod -pv mymod.o
Using mymod.o
Symbol version prefix 'smp_'
mymod.o: unresolved symbol acpi_remove_gpe_handler
mymod.o: unresolved symbol acpi_install_gpe_handler

Where have the symbols gone ? evxface.c has been compiled during
the kernel build, the functions are in the kernel map,
but once I booted, they are not in /proc/ksyms.

For info, the kernel is a 2.4.0-test3, with full acpi support.

Did I miss something (maybe a problem because my kernel build is smp ?
And is there something else needed to initialize acpi before I can do
such an install_gpe_handler ?

Thanks in advance,

  Steve

</body></email><email><emailId>20000731062505</emailId><senderName></senderName><senderEmail>donghee@eecad.sogang.ac.kr</senderEmail><timestampReceived>2000-07-31 06:25:05-0400</timestampReceived><subject>[Acpi] help me.</subject><body>

[Attachment #2 (text/plain)]

I can't connetc http://phobos.fs.tum.de/acpi/index.html
What's wrong?
I want to get more information about ACPI for Linux. 

-------------------------
# ICQ : 30896574
-------------------------

[Attachment #3 (text/html)]

&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"&gt;
&lt;HTML&gt;&lt;HEAD&gt;
&lt;META content="text/html; charset=ks_c_5601-1987" http-equiv=Content-Type&gt;
&lt;META content="MSHTML 5.00.2920.0" name=GENERATOR&gt;
&lt;STYLE&gt;&lt;/STYLE&gt;
&lt;/HEAD&gt;
&lt;BODY bgColor=#ffffff&gt;
&lt;DIV&gt;&lt;FONT size=2&gt;I can't connetc &lt;A 
href="http://phobos.fs.tum.de/acpi/index.html"&gt;http://phobos.fs.tum.de/acpi/index.html&lt;/A&gt;&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT size=2&gt;What's wrong?&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT size=2&gt;I want to get more information about ACPI for Linux. 
&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;Â &lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT size=2&gt;-------------------------&lt;BR&gt;# ICQ : 
30896574&lt;BR&gt;-------------------------&lt;/FONT&gt;&lt;/DIV&gt;&lt;/BODY&gt;&lt;/HTML&gt;


</body></email><email><emailId>20000731173744</emailId><senderName>Alexander Gottwald</senderName><senderEmail>alexander.gottwald@informatik.tu-chemnitz.de</senderEmail><timestampReceived>2000-07-31 17:37:44-0400</timestampReceived><subject>Re: [Acpi] help me.</subject><body>

On Mon, 31 Jul 2000, [ks_c_5601-1987] ÃÃÂµÂ¿ÃÃ± wrote:

&gt; I can't connetc http://phobos.fs.tum.de/acpi/index.html
&gt; What's wrong?
&gt; I want to get more information about ACPI for Linux. 
try http://phobos.fachschaften.tu-muenchen.de/acpi/index.html

seems like some dns-entries are wrong/have changed
&gt; 

-- 
 Alexander.Gottwald@informatik.tu-chemnitz.de | http://www.gotti.org
 Wollen Sie Ihre Festplatte formatieren?
  [J]a      [N]atÃ¼rlich 

</body></email><email><emailId>20000801031720</emailId><senderName>"Yuki Ogawa"</senderName><senderEmail>y-ogawa@dvpj.sony.co.jp</senderEmail><timestampReceived>2000-08-01 03:17:20-0400</timestampReceived><subject>Re: [Acpi] help me.</subject><body>

I always have to add ".en" at the end of URL to access.
i.e.
&lt;http://phobos.fachschaften.tu-muenchen.de/acpi/index.html.en&gt;


why?

----- Original Message ----- 
From: "Simon Richter" &lt;Simon.Richter@phobos.fs.tum.de&gt;
To: "Alexander Gottwald" &lt;Alexander.Gottwald@informatik.tu-chemnitz.de&gt;
Cc: "acpi" &lt;acpi@phobos.fachschaften.tu-muenchen.de&gt;
Sent: Tuesday, August 01, 2000 4:07 AM
Subject: Re: [Acpi] help me.


&gt; On Mon, 31 Jul 2000, Alexander Gottwald wrote:
&gt; 
&gt; &gt; &gt; I can't connetc http://phobos.fs.tum.de/acpi/index.html
&gt; 
&gt; &gt; try http://phobos.fachschaften.tu-muenchen.de/acpi/index.html
&gt; 
&gt; &gt; seems like some dns-entries are wrong/have changed
&gt; 
&gt; Yes, the zone file for the shorter names seems to be more recent than the
&gt; serial number. I've notified the admins about this, they will bump the
&gt; serial number and hope the problem goes away :-)
&gt; 
&gt;    Simon
&gt; 
&gt; -- 
&gt; PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
&gt;  Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
&gt; Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!
&gt; 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; 



_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000801033423</emailId><senderName>Ryan Bloom</senderName><senderEmail>rbb@ntrnet.net</senderEmail><timestampReceived>2000-08-01 03:34:23-0400</timestampReceived><subject>Re: [Acpi] help me.</subject><body>

On Tue, 1 Aug 2000, Yuki Ogawa wrote:

&gt; I always have to add ".en" at the end of URL to access.
&gt; i.e.
&gt; &lt;http://phobos.fachschaften.tu-muenchen.de/acpi/index.html.en&gt;

The reason is that multi-views isn't turned on on the web page.  The en
specifies the language the page is in.  Your browser sends a request to
the server that has a language code in it.  That language code is used by
the server to determine which page should be viewed.  The feature of
Apache that does this is commonly termed "MultiViews".  If this isn't on
or it isn't configured properly, then the server can't figure out the
correct page to send back.  By adding the .en, you tell the server that is
the exact page you want.

That is probably more information than you wanted, but I figure the more
explanation, the better.

Ryan

&gt; 
&gt; 
&gt; why?
&gt; 
&gt; ----- Original Message ----- 
&gt; From: "Simon Richter" &lt;Simon.Richter@phobos.fs.tum.de&gt;
&gt; To: "Alexander Gottwald" &lt;Alexander.Gottwald@informatik.tu-chemnitz.de&gt;
&gt; Cc: "acpi" &lt;acpi@phobos.fachschaften.tu-muenchen.de&gt;
&gt; Sent: Tuesday, August 01, 2000 4:07 AM
&gt; Subject: Re: [Acpi] help me.
&gt; 
&gt; 
&gt; &gt; On Mon, 31 Jul 2000, Alexander Gottwald wrote:
&gt; &gt; 
&gt; &gt; &gt; &gt; I can't connetc http://phobos.fs.tum.de/acpi/index.html
&gt; &gt; 
&gt; &gt; &gt; try http://phobos.fachschaften.tu-muenchen.de/acpi/index.html
&gt; &gt; 
&gt; &gt; &gt; seems like some dns-entries are wrong/have changed
&gt; &gt; 
&gt; &gt; Yes, the zone file for the shorter names seems to be more recent than the
&gt; &gt; serial number. I've notified the admins about this, they will bump the
&gt; &gt; serial number and hope the problem goes away :-)
&gt; &gt; 
&gt; &gt;    Simon
&gt; &gt; 
&gt; &gt; -- 
&gt; &gt; PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
&gt; &gt;  Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
&gt; &gt; Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; _______________________________________________
&gt; &gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; &gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; &gt; 
&gt; 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; 


_______________________________________________________________________________
Ryan Bloom                        	rbb@apache.org
406 29th St.
San Francisco, CA 94131
-------------------------------------------------------------------------------



_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000608160450</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-06-08 16:04:50-0400</timestampReceived><subject>Re: [Acpi] ACPI and linux-2.4.0-test1-ac6</subject><body>

On 7 Jun 2000 root@shea.math.fu-berlin.de wrote:

&gt; I've successfully compiled the acpid (both release and CVS).

Which is exactly the same, as CVS follows release currently.

&gt; &gt;From what my kernel tells, my board is acpi-capable:
&gt; &lt;6&gt;ACPI: found VIA Technologies, Inc. VT82C586B ACPI at 0x4000

&gt; Jun  7 22:15:43 shea acpid: OsdBreakpoint: Fatal error encountered
&gt; Jun  7 22:15:43 shea acpid: cannot load ACPI namespace

&gt; Has somebody success with this kernel?
&gt; Or have I to wait for a newer demon?

This smells like a broken BIOS. Are you using the latest version?

   Simon

-- 
PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

</body></email><email><emailId>20000609214612</emailId><senderName>"Chris Edgington"</senderName><senderEmail>chrise@intelligraphics.com</senderEmail><timestampReceived>2000-06-09 21:46:12-0400</timestampReceived><subject>[Acpi] ACPI GetSystemMap Support</subject><body>

Hello. I don't subscribe to your list, so please respond directly to my email address.
We're being asked to write an X-server for Linux for a device that gets its frame-buffer
memory from system memory. It relies on the operating system's support of the ACPI
GetSystemMap function to properly "steal" the system memory. Under windows it looks like
any other memory-mapped PCI device, you just map from a physical address to a linear
address and you've got access to the frame buffer.

Does any version of the Linux kernel use the GetSystemMap interrupt for determining the
system memory layout? If not, as that part of the project you folks are doing?

Thanks,
-Chris Edgington
 Director of Graphics Development
 Intelligraphics Inc.

</body></email><email><emailId>20000612225939</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-06-12 22:59:39-0400</timestampReceived><subject>[Acpi] Re: ACPI GetSystemMap Support</subject><body>

"Chris Edgington" writes:
&gt;&gt; I don't have my ACPI standard handy at the moment, but I imagine that you
&gt;&gt; are referring to the map provided by the e820 extended memory query function.
&gt;&gt; Modern versions of Linux use that to find out about system memory.  You can
&gt;&gt; see the implementation, if you like, in arch/i386/kernel/setup.c
&gt;&gt;
&gt;&gt; I hope that's useful.
&gt;
&gt;Miachel, thanks for the info. That is exactly what I'm looking for. However, I see that
&gt;not even the 2.2.14 kernel provided with RH6.2 implements this functionality. I don't see
&gt;it being used until the 2.3.99 kernel. Am I missing something . . . . or is this what you
&gt;meant as "Modern"? (I assumed 6.2 would be considered "modern".)

Sorry, I was looking at the 2.3.99 kernel sources and thought I was
looking at the 2.2.14 kernel sources; my mistake (I thought I had my
/usr/src/linux symlink pointing to the 2.2.14 sources and went straight
to /usr/src/linux/arch/i386/kernel without looking to see where I was).
So I was wrong to use the word "Modern".  "Development" would have been
the right word.  Sorry about that.

That said, I don't have 2.2.15 or 2.2.16 sources handy to look at to
see if e820 handling got in to the stable kernel in any form recently.
But I agree that I don't see e820 handling in the 2.2.14 source tree.

michaelkjohnson

 "He that composes himself is wiser than he that composes a book."
 Linux Application Development                     -- Ben Franklin
 http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000614185840</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-06-14 18:58:40-0400</timestampReceived><subject>Re: [Acpi] acpitools package?</subject><body>

On Wed, 14 Jun 2000, Johannes Erdfelt wrote:

&gt; Does anyone have a copy of the acpitools package? I don't have my copy
&gt; anymore and I'm really interested in acpidisasm so I can take a look at
&gt; some AML I have from another machine.

The package is now called pmtools, available from the usual places[1].

   Simon

[1] http://phobos.fs.tum.de/acpi/download.html
    http://www.geocities.com/SiliconValley/Hardware/3165/

-- 
PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

</body></email><email><emailId>20000614190531</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-06-14 19:05:31-0400</timestampReceived><subject>[Acpi] Re: acpitools package?</subject><body>

Johannes Erdfelt writes:
&gt;Does anyone have a copy of the acpitools package? I don't have my copy
&gt;anymore and I'm really interested in acpidisasm so I can take a look at
&gt;some AML I have from another machine.

It's where it has always been, at
http://www.geocities.com/SiliconValley/Hardware/3165/

It's now contained in the pmtools archive.

michaelkjohnson

 "He that composes himself is wiser than he that composes a book."
 Linux Application Development                     -- Ben Franklin
 http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000616131844</emailId><senderName>"Mitch Miers"</senderName><senderEmail>mmiers@intellinet-tech.com</senderEmail><timestampReceived>2000-06-16 13:18:44-0400</timestampReceived><subject>RE: [Acpi] Dell Inspiron 7500/Maestro 2e + acpid = sluggish</subject><body>

Zach,

I'd be happy to work with you on this.  BTW, it seems I spoke
too soon about use_pm=0.  I only though it worked;)  I get

maestro: APU register select failed.
(message repeated 399 times)
maestro: ac97 codec timeout reading 0x0.
maestro: ac97 codec timeout reading 0x7c.
maestro: ac97 codec timeout reading 0x7e.
maestro: ac97 codec timeout reading 0x0.
maestro: ac97 codec timeout reading 0x26.
maestro: ac97 codec timeout reading 0x0.
maestro: AC97 Codec detected: v: 0x 0 0 caps: 0x0 pwr: 0x0
maestro: ac97 codec timeout reading 0xe.
maestro: 1 channels configured.

when I "insmod maestro use_pm=0".  Dunno if these are bad
news or not, but maybe the ac97 does come into play somehow.

I'll try turning off the C-states as well.

Mitch

&gt; -----Original Message-----
&gt; From: Zach Brown [mailto:zab@zabbo.net]
&gt; Sent: Thursday, June 15, 2000 9:25 PM
&gt; To: Andy Henroid
&gt; Cc: Mitch Miers; acpi@phobos.fachschaften.tu-muenchen.de
&gt; Subject: Re: [Acpi] Dell Inspiron 7500/Maestro 2e + acpid = sluggish
&gt; 
&gt; 
&gt; &gt; Otherwise, Zach, you are adding D-state support
&gt; &gt; to the Maestro, right? (cool, by the way)  Have
&gt; &gt; you seen this?
&gt; 
&gt; I haven't, no, but I haven't gotten much feedback on the apm code
&gt; in general :)  
&gt; 
&gt; The Maestro power management stuff in the existing driver is pretty
&gt; danged minimal.  It was only added because when win&lt;something&gt; shutdown
&gt; it left the maestro shutdown and a soft reboot to linux meant your
&gt; maestro didn't work anymore.
&gt; 
&gt; The maestro chip has config registers to say what parts
&gt; of the chip should have their clocks fed.  When we don't have any
&gt; devices open, we drop the clock to almost all the units.  I don't
&gt; honestly know if this reduces the load the chip draws at all, but it
&gt; probably should :)  More importantly, paying attention to power
&gt; management stuff made the maestro come to life after win had suspended
&gt; it :)
&gt; 
&gt; I'm not sure exactly what the problem could be.  It sounds like
&gt; the chip is making the world very unhappy when its suspended, I would
&gt; guess this is 'cause its causing small mountains of spurious ints on the
&gt; bus or is doing Evil Things while messing up legacy bus snooping.  I'm
&gt; not at all sure why the hell it would do either of these things :)  My
&gt; first experiment would be to mess around with the set of units that have
&gt; their clocks disabled.  
&gt; 
&gt; Also interesting is the fact that the current PM code does absolutely
&gt; nothing with the AC97.  Dell may have wired things so that powering down
&gt; things without paying attention to the ac97 does bad stuff.  I dunno.
&gt; 
&gt; So, 'got me', but I'll work with someone whose interested in playing
&gt; with it :)   I don't have maestro hardware at the moment, let alone
&gt; maestro hardware that I could play with power management on..
&gt; 
&gt; -- 
&gt;  zach
&gt; 

</body></email><email><emailId>20000617140103</emailId><senderName>Zach Brown</senderName><senderEmail>zab@zabbo.net</senderEmail><timestampReceived>2000-06-17 14:01:03-0400</timestampReceived><subject>[Acpi] Re: Dell Inspiron 7500/Maestro 2e + acpid = sluggish</subject><body>

On Fri, Jun 16, 2000 at 06:30:01PM -0400, Mitch Miers wrote:

&gt; 
&gt; My codec and caps are different (whatever that means).

see

ftp://download.intel.com/ial/scalableplatforms/audio/ac97r21.pdf

page 39 ;)  

-- 
 zach

</body></email><email><emailId>20000620232114</emailId><senderName>Dieter =?iso-8859-1?Q?N=FCtzel?=</senderName><senderEmail>dieter.nuetzel@myokay.net</senderEmail><timestampReceived>2000-06-20 23:21:14-0400</timestampReceived><subject>[Acpi] Irongate C4+ACPI+pppd (kppp) slowdown still exists:-(</subject><body>

Hello,

my reported ppp connection slowdown (&lt; 1 KB/sec, only some bytes per
minute) still exists in all "latest" kernels. I've tried all 2.3.9x and
2.4.0-test1-acxx (latest -ac22-rick/classzone).

I do NOT get "0x1" with the following!!!

SunWave1&gt;echo 0x100 &gt;/proc/sys/acpi/pm1_enable
SunWave1&gt;echo 1 &gt; /proc/sys/acpi/sleep
SunWave1&gt;cat /proc/sys/acpi/s0_slp_typ
0xffffffff
SunWave1&gt;cat /proc/sys/acpi/s1_slp_typ
0xffffffff
SunWave1&gt;cat /proc/sys/acpi/s5_slp_typ
0xffffffff
SunWave1&gt;cat /proc/sys/acpi/sleep

In another window (three times power button pressed):

SunWave1&gt;cat /proc/sys/acpi/event
0x00000100 0x00000000 0x0		&lt;--- NO "0x1"?!
0x00000100 0x00000000 0x0
0x00000100 0x00000000 0x0

SunWave1&gt;cat /proc/version
Linux version 2.4.0-test1-ac22-class (root@SunWave1) (gcc version 2.95.2
19991024 (release)) #1 Tue Jun 20 18:44:33 CEST 2000

Jun 21 00:42:50 SunWave1 acpid: started
Jun 21 00:42:50 SunWave1 acpid: FACP loaded from /proc/sys/acpi/
Jun 21 00:42:51 SunWave1 acpid: DSDT loaded from /proc/sys/acpi/
Jun 21 00:42:51 SunWave1 acpid: S0 SLP_TYP (0x0505)
Jun 21 00:42:51 SunWave1 acpid: S1 SLP_TYP (0x0404)
Jun 21 00:42:51 SunWave1 acpid: S2 not supported
Jun 21 00:42:51 SunWave1 acpid: S3 not supported
Jun 21 00:42:51 SunWave1 acpid: S4 SLP_TYP (0x0000)
Jun 21 00:42:51 SunWave1 acpid: S5 SLP_TYP (0x0000)
Jun 21 00:42:51 SunWave1 acpid: P_BLK 1 @ 0x5010:6
Jun 21 00:42:51 SunWave1 kernel: ACPI C2 works
Jun 21 00:45:09 SunWave1 acpid: power button pressed

SunWave1&gt;./acpidmp DSDT | ../acpianalyze/acpianalyze
acpianalyze: loading DSDT from &lt;STDIN&gt;
acpianalyze: found Processor #1 \_PR_.\_PR_.CPU0 (PBLK 0x00005010 -
0x00005016)
acpianalyze: found Fan \_TZ_.FAN_
acpianalyze: found S0 support (SLP_TYP 0x5 0x5)
acpianalyze: found S1 support (SLP_TYP 0x4 0x4)
acpianalyze: found S4 support (SLP_TYP 0x0 0x0)
acpianalyze: found S5 support (SLP_TYP 0x0 0x0)

SunWave1&gt;./acpidmp FACP | ./acpitbl
Signature:        FACP
Length:           116
Revision:         0x01
Checksum:         0x68
OEMID:            AWARD
OEM Table ID:     AWRDACPI
OEM Revision:     0x30302e31
Creator ID:       AWRD
Creator Revision: 0x00000000
FIRMWARE_CTRL:    0x0fff0000
DSDT:             0x0fff30c0
INT_MODEL:        0x00
SCI_INT:          9
SMI_CMD:          0x0000502f
ACPI_ENABLE:      0xa1
ACPI_DISABLE:     0xa0
S4BIOS_REQ:       0xa4
PM1a_EVT_BLK:     0x00005000
PM1b_EVT_BLK:     0x00000000
PM1a_CNT_BLK:     0x000050f0
PM1b_CNT_BLK:     0x00000000
PM2_CNT_BLK:      0x00000000
PM_TMR_BLK:       0x00005008
GPE0_BLK:         0x00005020
GPE1_BLK:         0x00000000
PM1_EVT_LEN:      4
PM1_CNT_LEN:      2
PM2_CNT_LEN:      0
PM_TM_LEN:        4
GPE0_BLK_LEN:     4
GPE1_BLK_LEN:     0
GPE1_BASE:        0
P_LVL2_LAT:       90
P_LVL3_LAT:       900
FLUSH_SIZE:       0
FLUSH_STRIDE:     0
DUTY_OFFSET:      1
DUTY_WIDTH:       1
DAY_ALRM:         0x7d
MON_ALRM:         0x7e
CENTURY:          0x00
Flags:            0x00000000

I have an acpidmp.log.bz2 and an acpidisasm.log.bz2 handy if you need.

"acpi=no-c2,no-c3" help with 2.3.99

Thanks,
    Dieter

--
Dieter NÃ¼tzel
Graduate Student, Computer Science

University of Hamburg
Department of Computer Science
Cognitive Systems Group
Vogt-KÃ¶lln-StraÃe 30
D-22527 Hamburg, Germany

email: nuetzel@kogs.informatik.uni-hamburg.de
@home: dieter.nuetzel@myokay.net

</body></email><email><emailId>20000629103741</emailId><senderName>Eric Estievenart</senderName><senderEmail>eestievenart@apsydev.com</senderEmail><timestampReceived>2000-06-29 10:37:41-0400</timestampReceived><subject>[Acpi] Debugging ACPI stuff on a vaio ?</subject><body>

	Hi there,

I'm quite new with ACPI stuff, but very interested in.
I recently bough a Sony Vaio Z600, and stuff like the
power button didn't seem to work properly with ACPI
(undetected in fact).

I tried an echo "0xffffffff" &gt; /proc/sys/acpi/pm1_enable,
which in return was set to 0x00000521, in order to see
the more events that could come from detected devices.

Then cat /proc/sys/acpi/events revealed nothing while
pressing the power button or the small wheel (what they
call Jog Dial @ Sony)

For information, the bios is a Phoenix, rev R0114Z1 / RK114Z1,
which is acpi compliant.

Some devices are detected correctly, anyway patched a little
acpianalyze to have all devices displayed, even if I don't know what
they all are (even if I can guess) :

acpianalyze: found Processor #0 _PR_.CPU0 (PBLK 0x00008010 - 0x00008016)
acpianalyze: found Unknown device _SB_.PWRB
acpianalyze: found Unknown device _SB_.PCI0
acpianalyze: found Unknown device _SB_.PCI0.ISA_.MOTH
acpianalyze: found Unknown device _SB_.PCI0.ISA_.MEM_
acpianalyze: found Unknown device _SB_.PCI0.ISA_.DMAC
acpianalyze: found Unknown device _SB_.PCI0.ISA_.RTC_
acpianalyze: found Unknown device _SB_.PCI0.ISA_.PIC_
acpianalyze: found Unknown device _SB_.PCI0.ISA_.FPU_
acpianalyze: found Unknown device _SB_.PCI0.ISA_.TMR_
acpianalyze: found Unknown device _SB_.PCI0.ISA_.SPKR
acpianalyze: found Unknown device _SB_.PCI0.ISA_.KBC_
acpianalyze: found Unknown device _SB_.PCI0.ISA_.MOUE
acpianalyze: found Embedded Controller _SB_.PCI0.ISA_.EC0_
acpianalyze: found Battery #1 _SB_.PCI0.ISA_.EC0_.BAT1
acpianalyze: found Unknown device string _SB_.PCI0.ISA_.EC0_.ACAD
acpianalyze: found Unknown device _SB_.PCI0.ISA_.SPIC
acpianalyze: found Unknown device _SB_.PCI0.ISA_.COMA
acpianalyze: found Unknown device _SB_.PCI0.ISA_.FIR_
acpianalyze: found Unknown device #1 _SB_.PCI0.ISA_.LPTA
acpianalyze: found Unknown device #2 _SB_.PCI0.ISA_.LPTB
acpianalyze: found Unknown device _SB_.PCI0.ISA_.ECP_
acpianalyze: found Unknown device #3 _SB_.PCI0.ISA_.EPP_
acpianalyze: found Unknown device _SB_.PCI0.ISA_.SNC_
acpianalyze: found Unknown device #1 _SB_.LNKA
acpianalyze: found Unknown device #2 _SB_.LNKB
acpianalyze: found Unknown device #3 _SB_.LNKC
acpianalyze: found Unknown device #4 _SB_.LNKD
acpianalyze: found S0 support (SLP_TYP 0x5 0x5)
acpianalyze: found S1 support (SLP_TYP 0x4 0x4)
acpianalyze: found S3 support (SLP_TYP 0x1 0x1)
acpianalyze: found S4 support (SLP_TYP 0x0 0x0)
acpianalyze: found S5 support (SLP_TYP 0x0 0x0)

(Every "Unknown device" is returned by my patched match_hid function)

I'd like to have some pointers on the following points, in order to
help you.
- First, I didn't see a database of hardware types in the code,
  which might be useful, like what is done with lspci. It is
  really helpfull in debugging what devices are present, even
  if we don't handle them properly. We can also ask the people to report
  the missing data when they find something not recognized.
  If you give me the pointer, I'll write the basic stuff for acpianalyze
  to detect and report everything properly.
  (But maybe only a few hid are needed, not like the vendor:id pci
stuff.
   I'll read the specs tonight ;)

- Then, I wondered how it was that I didn't get any event.
  Is it possible to put all (or some) of the devices in the state
  where they trigger IRQs, and report every event, even
  if we don't know what to do with them ?
  (what I tried to enable with the 0xffffffff &gt; pm1_enable,
  without success).
  I feel this is really needed when debugging the hardware,
  mostly for unknown devices. How could this be done, I'd like
  to have this functionality, and I can spend some time on it.
  Do you have some pointers on that ? 

Sorry if some questions have already been answered, I read like
6 months of the mailing-list archives yesterday, it took me hours,
and I didn't see anything regarding that.

Thanks,

Eric

</body></email><email><emailId>20000610135917</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-06-10 13:59:17-0400</timestampReceived><subject>[Acpi] Re: ACPI GetSystemMap Support</subject><body>

"Chris Edgington" writes:
&gt;Hello. I don't subscribe to your list, so please respond directly to my email address.
&gt;We're being asked to write an X-server for Linux for a device that gets its frame-buffer
&gt;memory from system memory. It relies on the operating system's support of the ACPI
&gt;GetSystemMap function to properly "steal" the system memory. Under windows it looks like
&gt;any other memory-mapped PCI device, you just map from a physical address to a linear
&gt;address and you've got access to the frame buffer.
&gt;
&gt;Does any version of the Linux kernel use the GetSystemMap interrupt for determining the
&gt;system memory layout? If not, as that part of the project you folks are doing?

I don't have my ACPI standard handy at the moment, but I imagine that you
are referring to the map provided by the e820 extended memory query function.
Modern versions of Linux use that to find out about system memory.  You can
see the implementation, if you like, in arch/i386/kernel/setup.c

I hope that's useful.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000612214359</emailId><senderName>"Chris Edgington"</senderName><senderEmail>chrise@intelligraphics.com</senderEmail><timestampReceived>2000-06-12 21:43:59-0400</timestampReceived><subject>[Acpi] RE: ACPI GetSystemMap Support</subject><body>

&gt; I don't have my ACPI standard handy at the moment, but I imagine that you
&gt; are referring to the map provided by the e820 extended memory query function.
&gt; Modern versions of Linux use that to find out about system memory.  You can
&gt; see the implementation, if you like, in arch/i386/kernel/setup.c
&gt;
&gt; I hope that's useful.

Miachel, thanks for the info. That is exactly what I'm looking for. However, I see that
not even the 2.2.14 kernel provided with RH6.2 implements this functionality. I don't see
it being used until the 2.3.99 kernel. Am I missing something . . . . or is this what you
meant as "Modern"? (I assumed 6.2 would be considered "modern".)

Thanks,
-Chris

</body></email><email><emailId>20000614184533</emailId><senderName>Johannes Erdfelt</senderName><senderEmail>jerdfelt@valinux.com</senderEmail><timestampReceived>2000-06-14 18:45:33-0400</timestampReceived><subject>[Acpi] acpitools package?</subject><body>

Does anyone have a copy of the acpitools package? I don't have my copy
anymore and I'm really interested in acpidisasm so I can take a look at
some AML I have from another machine.

JE

</body></email><email><emailId>20000615224237</emailId><senderName>"Mitch Miers"</senderName><senderEmail>mmiers@intellinet-tech.com</senderEmail><timestampReceived>2000-06-15 22:42:37-0400</timestampReceived><subject>[Acpi] Dell Inspiron 7500/Maestro 2e + acpid = sluggish</subject><body>

Hello,

As per the subject.

When acpid is not running, everything is fine.

When acpid is running, the system is sluggish if no process
has /dev/dsp open (mouse movement is slower, etc).  It seems
to effect timekeeping in general, as (e.g.) the interval
between top redisplays is longer than normal.

The maestro docs (linux/Documentation/sound/Maestro) say
that when no program has /dev/dsp open, the maestro chip is
"shut down".  If /dev/dsp is opened, the system behavior
goes back to normal (acpid running).  I could quote the
docs, but if you've got a 2.3.x or 2.4.0pre you've got the
docs - look for "When using power management".

Now, I can fix this by module option (use_pm=0, disabling pm
for the sound chip), but I'd rather know why this happens.
Any hints?  The archives mention this laptop, but in
conjunction with a different problem.

I'm not on the list, please CC any replies.  Table dumps or
other info available on request.

Mitch

</body></email><email><emailId>20000616153002</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-06-16 15:30:02-0400</timestampReceived><subject>[Acpi] Re: Dell Inspiron 7500/Maestro 2e + acpid = sluggish</subject><body>

Hi, Zach!

Zach Brown writes:
&gt;So, 'got me', but I'll work with someone whose interested in playing
&gt;with it :)   I don't have maestro hardware at the moment, let alone
&gt;maestro hardware that I could play with power management on..

One more piece of data: I have an Inspiron 7500 on which I have never
seen this behavior.

michaelkjohnson

 "He that composes himself is wiser than he that composes a book."
 Linux Application Development                     -- Ben Franklin
 http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000616193442</emailId><senderName>"Mitch Miers"</senderName><senderEmail>mmiers@intellinet-tech.com</senderEmail><timestampReceived>2000-06-16 19:34:42-0400</timestampReceived><subject>[Acpi] RE: Dell Inspiron 7500/Maestro 2e + acpid = sluggish</subject><body>

Do you have the Maestro 2e as the sound chip?  I wonder if
maybe it's a firmware rev somewhere.  I bought mine last
November (500MHz PIII, 256MB, 15.4" panel).  BTW,
acpi=no-c2,no-c3 "fixes" the problem.

Mitch

&gt; -----Original Message-----
&gt; From: johnsonm@redhat.com [mailto:johnsonm@redhat.com]
&gt; Sent: Friday, June 16, 2000 11:30 AM
&gt; To: Zach Brown
&gt; Cc: Andy Henroid; Mitch Miers; acpi@phobos.fachschaften.tu-muenchen.de
&gt; Subject: Re: Dell Inspiron 7500/Maestro 2e + acpid = sluggish 
&gt; 
&gt; 
&gt; 
&gt; Hi, Zach!
&gt; 
&gt; Zach Brown writes:
&gt; &gt;So, 'got me', but I'll work with someone whose interested in playing
&gt; &gt;with it :)   I don't have maestro hardware at the moment, let alone
&gt; &gt;maestro hardware that I could play with power management on..
&gt; 
&gt; One more piece of data: I have an Inspiron 7500 on which I have never
&gt; seen this behavior.
&gt; 
&gt; michaelkjohnson
&gt; 
&gt;  "He that composes himself is wiser than he that composes a book."
&gt;  Linux Application Development                     -- Ben Franklin
&gt;  http://people.redhat.com/johnsonm/lad/
&gt; 

</body></email><email><emailId>20000616205044</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-06-16 20:50:44-0400</timestampReceived><subject>[Acpi] Re: Dell Inspiron 7500/Maestro 2e + acpid = sluggish</subject><body>

"Mitch Miers" writes:
&gt;Do you have the Maestro 2e as the sound chip?  I wonder if
&gt;maybe it's a firmware rev somewhere.  I bought mine last
&gt;November (500MHz PIII, 256MB, 15.4" panel).  BTW,
&gt;acpi=no-c2,no-c3 "fixes" the problem.

Yup, I have a 2e:
maestro: Configuring ESS Maestro 2E found at IO 0x1400 IRQ 5 
maestro:  subvendor id: 0x009e1028 
maestro: PCI power managment capability: 0x7622 
maestro: AC97 Codec detected: v: 0x41445303 caps: 0x400 pwr: 0xf 
maestro: 1 channels configured. 

I wasn't implying that you couldn't be seeing what you are
seeing; rather, that it does not appear to be consistent.

You might want to see if there are any updates to the firmware
available beyond what you have.  I'm not sure when my machine
was manufactured, as Dell used it in their lab before they
sent it to me to work on ACPI with.

michaelkjohnson

 "He that composes himself is wiser than he that composes a book."
 Linux Application Development                     -- Ben Franklin
 http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000616223001</emailId><senderName>"Mitch Miers"</senderName><senderEmail>mmiers@intellinet-tech.com</senderEmail><timestampReceived>2000-06-16 22:30:01-0400</timestampReceived><subject>[Acpi] RE: Dell Inspiron 7500/Maestro 2e + acpid = sluggish</subject><body>

My codec and caps are different (whatever that means).

maestro: Ac97 Codec detected: v: 0x83847609 caps: 0x6940 pwr: 0xf

?

Mitch

&gt; -----Original Message-----
&gt; From: johnsonm@redhat.com [mailto:johnsonm@redhat.com]
&gt; Sent: Friday, June 16, 2000 4:51 PM
&gt; To: Mitch Miers
&gt; Cc: Zach Brown; Andy Henroid; acpi@phobos.fachschaften.tu-muenchen.de
&gt; Subject: Re: Dell Inspiron 7500/Maestro 2e + acpid = sluggish 
&gt; 
&gt; 
&gt; 
&gt; "Mitch Miers" writes:
&gt; &gt;Do you have the Maestro 2e as the sound chip?  I wonder if
&gt; &gt;maybe it's a firmware rev somewhere.  I bought mine last
&gt; &gt;November (500MHz PIII, 256MB, 15.4" panel).  BTW,
&gt; &gt;acpi=no-c2,no-c3 "fixes" the problem.
&gt; 
&gt; Yup, I have a 2e:
&gt; maestro: Configuring ESS Maestro 2E found at IO 0x1400 IRQ 5 
&gt; maestro:  subvendor id: 0x009e1028 
&gt; maestro: PCI power managment capability: 0x7622 
&gt; maestro: AC97 Codec detected: v: 0x41445303 caps: 0x400 pwr: 0xf 
&gt; maestro: 1 channels configured. 
&gt; 
&gt; I wasn't implying that you couldn't be seeing what you are
&gt; seeing; rather, that it does not appear to be consistent.
&gt; 
&gt; You might want to see if there are any updates to the firmware
&gt; available beyond what you have.  I'm not sure when my machine
&gt; was manufactured, as Dell used it in their lab before they
&gt; sent it to me to work on ACPI with.
&gt; 
&gt; michaelkjohnson
&gt; 
&gt;  "He that composes himself is wiser than he that composes a book."
&gt;  Linux Application Development                     -- Ben Franklin
&gt;  http://people.redhat.com/johnsonm/lad/
&gt; 

</body></email><email><emailId>20000509123548</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-09 12:35:48-0400</timestampReceived><subject>[Acpi] vsnprintf</subject><body>

I notice that a lot of our acpi code uses vsprintf
instead of vsnprintf.  Because this really is
Linux-specific, where vsnprintf is always available,
and because vsnprintf implementations are floating
around, and because in the worst case you can do a
trivial function that ignores the length and converts
to vsprintf for impoverished platforms that are
lacking vsnprintf, could we switch basically
everything over to using vsnprintf?

The sooner we start working on potential buffer
overflows, the more secure we'll be.  And
remember that many buffer overflows do not start
because they were originally written as buffer
overflows; very often it is because code is
copied, or the environment changes and no one
notices; basically, code rot.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000509133152</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-09 13:31:52-0400</timestampReceived><subject>[Acpi] popt</subject><body>

I'm making all sorts of suggestions today...

I'd like to suggest using popt for argument parsing,
for a variety of reasons.

First, it removes 90% of the "get_options" boilerplate that
Andy has written.  It removes several coding redundancies,
reducing the potential for errors when editing existing
code.  It can even, in most circumstances, remove entirely
the need for specifying the short options in triplicate
(struct option, getopt_long third argument, case statements)
and reduce them to a single instance.

Second, it has a great many features that getopt_long doesn't
have and that we might like, such as automatic help text
generation, table nesting (so that libraries can provide
common argument handling that is fully integrated in all
related applications), configurable argument handling and
argument aliasing via a text file, and recursion safety.

Third, it is available on all full Linux systems.  That is,
it is available on all systems that have RPM, and all Linux
distributions either are based on RPM or include it as a
component that can be installed.  To break that down, it is
available on Red Hat Linux, all distributions based on Red
Hat Linux, Debian, all distributions based on Debian, and
on Slackware.  Many other packages now depend on it,
including GNOME and ORBiT.

You can see how useful it is if you run, say,
gnome-terminal --help
All the help text you see there is auto-generated from the
tables that describe the argument parsing.  You can tell
which options apply to which package because they are labelled
and logically separated.

Also, once you require it for command-line parsing, it is
quite useful in other contexts.  It can be used, for example,
as the guts to a parser for configuration files with lines
that look like command lines.

It is portable enough to work on any POSIX platform, and this
has been tested in part because rpm has been ported to many
platforms (not just Unix, but amiga, windows, etc.) and popt
is a required component of rpm.

While it has been extended considerably from its original
implementation, the authors have maintained backwards
compatibility, and expect to continue to do so for the
forseeable future.

Finally, it is comprehensively documented in a style that is
easy to follow; read the popt man page to see what I'm talking
about.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000511021500</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-05-11 02:15:00-0400</timestampReceived><subject>[Acpi] acpid update</subject><body>

A new version of acpid is available now from

 
http://www.geocities.com/SiliconValley/Hardware/3165/

Changes
* Added Michael Johnson's latest patches
  (note that the popt library is now required
  to build acpictl)
* Added information about creating bug reports
  (see REPORTING-BUGS)
* Added an option (-t) to acpid to produce a (rather
  sizeable) debug trace which should help us
  track down, at the very least, crashes
  (see REPORTING-BUGS)
* A nifty AML debugger is turned on by default
  now when using -d.  Try "help".  Additional
  documentation will be available soon.



__________________________________________________
Do You Yahoo!?
Send instant messages &amp; get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

</body></email><email><emailId>20000509150207</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-09 15:02:07-0400</timestampReceived><subject>[Acpi] Re: acpictl suggestion</subject><body>

Simon Richter writes:
&gt;Actually I thought of using a separate daemon for this, acpipold. Users
&gt;that don't want to use complex policy management (such as on embedded
&gt;systems can use a separate (or cut down) daemon. Also, when acpid's
&gt;funktionality gets merged into the kernel, the only thing that would have
&gt;to be changed is the communications method to the kernel.

I'm suggesting that we have one tool that can act as a per-user
communications daemon instead of having to have precisely one
deamon for the whole system, and I'm suggesting that instead of
reimplementing the communication mechanism N times for N similar
tools, we make one program serve multiple functions.

I'm not convinced, either, that ALL of acpid's functionality will be
moved into the kernel.  The AML interpreter will, but most of the rest
of it will not.  I still expect, frankly, that when I open my socket,
that a user-space acpid will be on the other end of it, not a
kernel-space acpid.

Andy?

&gt;&gt; acpictl can be setuid or perhaps (on systems such as Red Hat Linux
&gt;&gt; that support it) managed via consolehelper.
&gt;
&gt;I'm using AF_UNIX SOCK_DGRAM sockets with SO_PASSCRED (Linux) or
&gt;SO_CREDENTIALS (NetBSD). This allows authentication without suid.

At some point, information created by an untrusted user needs to
pass into a trusted domain, and that information MUST be cleaned
up.  The smaller the domain in which it is cleaned, the easier
that domain is to secure.  That domain must have special privileges
in order to be trusted to do the cleaning.  It's really not an
issue whether those privileges are setuid or SO_PASSCRED; that's
an implementation detail that can be easily changed.

That's why I want a small tool that does simple translation and
testing, and which relies only on secure tools.

Understand that the parts of acpictl that are not touched by the
code patch in daemon mode do not have to be secured in the same
way, so they don't affect the domain size significantly.

&gt;&gt; In any case, it can have a configuration file that defines
&gt;&gt; what normal users are allowed to do: for example, are they allowed
&gt;&gt; to set policy or only to query values?
&gt;
&gt;Configuration is my greatest problem at this point. Having never used
&gt;bison before and not really having a clue how to write the rules in a
&gt;reasonable form. Some time ago, I hacked up a few rules, however they're
&gt;in broken English language rather than C. See also
&gt;
&gt;http://phobos.fs.tum.de/pipermail/acpi/1999-July/000073.html

I know how to write parsers, and I know how to write configuration
languages, it is what I've been doing for years.  Leave that to me.

The interesting part is specifying what things need to be configured,
figuring out what users really want to set.  However, if we effectively
force them to write a program to set the policy (in order, of course,
to be REALLY FLEXIBLE) most people will hate it, and acceptance will
be basically non-existant...   I think we need an entirely non-procedural
language that is capable of describing complete policy state.  Then
users, if they are allowed to do so by site policy, can send state
changes to the policy engine at will.

However, as long as we do not have programmatic policy, or the potential
for programmatic policy, that 0.01% of users who actualy want to be
able to store a program as policy will be unhappy with us.  They can
get programmatic policy by writing a perl or python program which
talks via acpictl to acpid, listens to events, and dynamically resets
the current policy state based on those events.  That will give us
programmatic policy without needless complexity for 99.99% of users.

That leaves us with creating a formal definition of policy state.
The description that you posted of things that people might like to
see is a start.  I'll try to go through it and write up a more formal
description, then I'll define a language that looks normal to people,
expresses it reasonably, and is easy to parse.

&gt;&gt; I imagine that some people
&gt;&gt; will want to set policies as normal users, and other people will
&gt;&gt; want just as strongly for normal users not to be allowed to set
&gt;&gt; policies.  Depends on the context.
&gt;
&gt;Yes, and people will want to set policies from their GNOME panels and MPEG
&gt;players ("While a MPEG is playing, don't blank the screen." You can't
&gt;imagine how many people have asked for this...)

As I say, some people will want it.  But I guarantee you that other
people will not want it ("If you put my webserver into quiet mode,
I'm going to HUNT YOU DOWN AND CASTRATE YOU!" :-) so that in itself
must be configurable.

&gt;&gt; I'm going to start working on this now, but if anyone has
&gt;&gt; any better ideas or improvements to this one, feel free to
&gt;&gt; propose them.
&gt;
&gt;Yes, it's been in CVS for a long time, however non-functional because I
&gt;can't think of a proper config format. The code is in CVS, in the
&gt;repository at /work/cvs/acpi, module acpipolicy (as announced on
&gt;development.html).

I'm sorry, could you give me a more complete reference than
"development.html"?

I'll look at acpipolicy, but I don't guarantee that I'm going to
follow that mold.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000509172113</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-05-09 17:21:13-0400</timestampReceived><subject>Re: [Acpi] Re: acpictl suggestion</subject><body>

On Tue, 9 May 2000, Michael K. Johnson wrote:

&gt; I'm suggesting that we have one tool that can act as a per-user
&gt; communications daemon instead of having to have precisely one
&gt; deamon for the whole system, and I'm suggesting that instead of
&gt; reimplementing the communication mechanism N times for N similar
&gt; tools, we make one program serve multiple functions.

Well, my approach would be a shared library that applications could use to
talk to the policy manager, which would then decide, based on its
configuration, what commands to give to acpid. User applications can only
see the library, so the communications protocol is exchangeable. Even the
daemon would be exchangeable (see below).

&gt; At some point, information created by an untrusted user needs to pass
&gt; into a trusted domain, and that information MUST be cleaned up.  The
&gt; smaller the domain in which it is cleaned, the easier that domain is
&gt; to secure.

This is perfectly possible using the my approach. The code is after the
recvmsg() in acpipolicy/src/acpipold/server.c.

&gt; The interesting part is specifying what things need to be configured,
&gt; figuring out what users really want to set.  However, if we effectively
&gt; force them to write a program to set the policy (in order, of course,
&gt; to be REALLY FLEXIBLE) most people will hate it, and acceptance will
&gt; be basically non-existant...

What about different "configuration backends"? If someone thinks he needs
the programmable interface, he may just install it. To the applications,
nothing has changed. However, this isn't something we need to do.

&gt; That leaves us with creating a formal definition of policy state.
&gt; The description that you posted of things that people might like to
&gt; see is a start.  I'll try to go through it and write up a more formal
&gt; description, then I'll define a language that looks normal to people,
&gt; expresses it reasonably, and is easy to parse.

Cool, thanks.

&gt; &gt;repository at /work/cvs/acpi, module acpipolicy (as announced on
&gt; &gt;development.html).

&gt; I'm sorry, could you give me a more complete reference than
&gt; "development.html"?

http://phobos.fs.tum.de/acpi/development.html . BTW, I've moved the ssh2
server back to port 22 (shared with ssh1), as telling ssh2 to use a
different port is a major PITA.

   Simon

-- 
PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

</body></email><email><emailId>20000510004512</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-05-10 00:45:12-0400</timestampReceived><subject>Re: [Acpi] Re: acpictl suggestion</subject><body>

--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:

&gt; I'm not convinced, either, that ALL of acpid's
&gt; functionality will be
&gt; moved into the kernel.  The AML interpreter will,
&gt; but most of the rest
&gt; of it will not.  I still expect, frankly, that when
&gt; I open my socket,
&gt; that a user-space acpid will be on the other end of
&gt; it, not a
&gt; kernel-space acpid.

Right, the interpreter and possibly some kind of
device manager is all that I foresee needing to go
into the kernel.  The interface between user and
kernel will probably consist of the ability to

  * run control methods and obtain the results
    (gives battery/AC, thermal, some device
     configuration and control, system indicators)
  * initiate suspend (S1-S5)
  * manage devices (list, configure, status,
    suspend individual devices)
  * get system events (buttons, lid, dock/undock)
  * get and set processor power (C-state) policy
  ? Am I missing anything here ?

Besides processor, all policy will probably go up
in userspace where it can be easily configured by
users and localized by Linux distributions.

acpid (or pmd?) will do the coordination between
user policy preferences and the needs of currently
running applications and control the user-kernel
interface accordingly.  acpictl should be a nice
interface for obtaining system status (battery,
thermal, etc.) from acpid, specifying user
preferences, or possibly even forcing the system
to suspend.  Alternately, if someone wanted to drop
acpid completely, the user-kernel interface should
be powerful enough to utilize directly for a
home-grown policy implementation.

I would rather see auditing take place as close to
the user as possible.  This means, better in acpictl
than in acpid.  Putting auditing in acpictl allows
us to lock down acpid and minimize security risks
at the system/daemon level.  It also gives Linux
distributions the flexibility to scrap acpictl,
keep acpid, and do their own auditing if they
prefer.

-Andy


__________________________________________________
Do You Yahoo!?
Send instant messages &amp; get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

</body></email><email><emailId>20000510091221</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-10 09:12:21-0400</timestampReceived><subject>[Acpi] Re: acpictl suggestion</subject><body>

Simon Richter writes:
&gt;On Tue, 9 May 2000, Michael K. Johnson wrote:
&gt;
&gt;&gt; I'm suggesting that we have one tool that can act as a per-user
&gt;&gt; communications daemon instead of having to have precisely one
&gt;&gt; deamon for the whole system, and I'm suggesting that instead of
&gt;&gt; reimplementing the communication mechanism N times for N similar
&gt;&gt; tools, we make one program serve multiple functions.
&gt;
&gt;Well, my approach would be a shared library that applications could use to
&gt;talk to the policy manager, which would then decide, based on its
&gt;configuration, what commands to give to acpid.

That's exactly what I proposed, modulo the library.  I'm not against the
library, but I suggest that it talk to the policy manager with a protocol
that we agree on, because it is not always convenient to link against a
library to "just do the right thing" because the library authors do not
always know what application authors will want.  Also, remember that
multiple implementations of a protocol tend to make the implementation
of the protocol more solid, and the protocol itself better-defined.
That's why the IETF requires at least two independent implementations
of any standard protocol.

&gt;User applications can only
&gt;see the library, so the communications protocol is exchangeable. Even the
&gt;daemon would be exchangeable (see below).

Do you see why I disagree with you on this?

&gt;&gt; At some point, information created by an untrusted user needs to pass
&gt;&gt; into a trusted domain, and that information MUST be cleaned up.  The
&gt;&gt; smaller the domain in which it is cleaned, the easier that domain is
&gt;&gt; to secure.
&gt;
&gt;This is perfectly possible using the my approach. The code is after the
&gt;recvmsg() in acpipolicy/src/acpipold/server.c.

No, you missed my point.  My point is that the whole untrusted information
domain needs to be audited for security, and my approach makes the domain
smaller.

&gt;&gt; The interesting part is specifying what things need to be configured,
&gt;&gt; figuring out what users really want to set.  However, if we effectively
&gt;&gt; force them to write a program to set the policy (in order, of course,
&gt;&gt; to be REALLY FLEXIBLE) most people will hate it, and acceptance will
&gt;&gt; be basically non-existant...
&gt;
&gt;What about different "configuration backends"? If someone thinks he needs
&gt;the programmable interface, he may just install it. To the applications,
&gt;nothing has changed. However, this isn't something we need to do.

Read the proposal I'm writing in a separate letter.  Basically, any
application that is allowed to set policy can modify the configuration
in response to events, which gives the potential for programmatic
policy configuration without imposing it on the vast majority who
simply do not want it.

In other words, I don't think we disagree here fundamentally, but I
think I have a concrete suggestion how to attain all desired ends.

&gt;&gt; That leaves us with creating a formal definition of policy state.
&gt;&gt; The description that you posted of things that people might like to
&gt;&gt; see is a start.  I'll try to go through it and write up a more formal
&gt;&gt; description, then I'll define a language that looks normal to people,
&gt;&gt; expresses it reasonably, and is easy to parse.
&gt;
&gt;Cool, thanks.

And that's the proposal I'm still working on.  :-)

The short summary is that I am trying to define an instantaneous policy
definition separate from a policy change mechanism.  I think we need to
keep the layers separate to avoid confusion.

&gt;http://phobos.fs.tum.de/acpi/development.html . BTW, I've moved the ssh2
&gt;server back to port 22 (shared with ssh1), as telling ssh2 to use a
&gt;different port is a major PITA.

I've only got ssh1 available on this computer right now.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000508153042</emailId><senderName>Dieter =?iso-8859-1?Q?N=FCtzel?=</senderName><senderEmail>dieter.nuetzel@myokay.net</senderEmail><timestampReceived>2000-05-08 15:30:42-0400</timestampReceived><subject>[Acpi] ACPI now works on Irongate C4 but huge slow down with pppd?!</subject><body>


Hello Andy,

I've got it with my MSI MS-6167 Rev. 1.0B (Irongate C4).
My Athlon 550 is running with 550 MHz and I use the "latest"
2.3.99-pre7-6 together and without Andrea's classzone-25.

I have the following in my rc.local file:

# Starting acpid
if [ -e /proc/sys/acpi/s5_slp_typ ]
then
       if [ -x /usr/local/sbin/acpid ]
       then
               echo "Starting acpid..."
               /usr/local/sbin/acpid
               echo 0 &gt; /proc/sys/acpi/s5_slp_typ
       fi
fi

System can power down normally and sleep wen I do "echo 0|1 &gt;
/proc/sys/acpi/sleep".
But after the system goes sleeping I have to press the poweron button to
wake it up again. Now it goes directly to poweroff? :-(

Second.

After the acpid has started I get only ~1 KB/sec with pppd. My ppp
connections are so slow that I can't use them together with acpid
running. To solve the situation I have to reboot without starting acpid,
again.

Here are some debug info's:

Signature:        DSDT
Length:           9454
Revision:         0x01
Checksum:         0xc4
OEMID:            AWARD
OEM Table ID:     AWRDACPI
OEM Revision:     0x00001000
Creator ID:       MSFT
Creator Revision: 0x0100000c

acpianalyze: loading DSDT from &lt;STDIN&gt;
acpianalyze: found Processor #1 \_PR_.\_PR_.CPU0 (PBLK 0x00005010 -
0x00005016)
acpianalyze: found Fan \_TZ_.FAN_
acpianalyze: found S0 support (SLP_TYP 0x5 0x5)
acpianalyze: found S1 support (SLP_TYP 0x4 0x4)
acpianalyze: found S4 support (SLP_TYP 0x0 0x0)
acpianalyze: found S5 support (SLP_TYP 0x0 0x0)

Signature:        FACP
Length:           116
Revision:         0x01
Checksum:         0x68
OEMID:            AWARD
OEM Table ID:     AWRDACPI
OEM Revision:     0x30302e31
Creator ID:       AWRD
Creator Revision: 0x00000000
FIRMWARE_CTRL:    0x0fff0000
DSDT:             0x0fff30c0
INT_MODEL:        0x00
SCI_INT:          9
SMI_CMD:          0x0000502f
ACPI_ENABLE:      0xa1
ACPI_DISABLE:     0xa0
S4BIOS_REQ:       0xa4
PM1a_EVT_BLK:     0x00005000
PM1b_EVT_BLK:     0x00000000
PM1a_CNT_BLK:     0x000050f0
PM1b_CNT_BLK:     0x00000000
PM2_CNT_BLK:      0x00000000
PM_TMR_BLK:       0x00005008
GPE0_BLK:         0x00005020
GPE1_BLK:         0x00000000
PM1_EVT_LEN:      4
PM1_CNT_LEN:      2
PM2_CNT_LEN:      0
PM_TM_LEN:        4
GPE0_BLK_LEN:     4
GPE1_BLK_LEN:     0
GPE1_BASE:        0
P_LVL2_LAT:       90
P_LVL3_LAT:       900
FLUSH_SIZE:       0
FLUSH_STRIDE:     0
DUTY_OFFSET:      1
DUTY_WIDTH:       1
DAY_ALRM:         0x7d
MON_ALRM:         0x7e
CENTURY:          0x00
Flags:            0x00000000

Have you any glue?

Thank you very much.
-Dieter

--
Dieter N=FCtzel
Graduate Student, Computer Science

University of Hamburg
Department of Computer Science
Cognitive Systems Group
Vogt-K=F6lln-Stra=DFe 30
D-22527 Hamburg, Germany

email: nuetzel@kogs.informatik.uni-hamburg.de
@home: dieter.nuetzel@myokay.net



["DSDT-disasm.log.bz2" (application/octet-stream)]

</body></email><email><emailId>20000515140000</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-15 14:00:00-0400</timestampReceived><subject>[Acpi] ECs improperly limited in acpica</subject><body>

I notice that acpica/control/ec/ec.c only looks at I/O-accessed, and not
memory-accessed ECs.  I presume that is because current ECs only are in
I/O space, but the standard allows for memory-accessed ECs, and if ACPI
ever does make it onto non-Intel platforms, that may include platforms
that don't have I/O space...

In EcAddDevice:
    if (ACPI_FAILURE(Status = EcGetPortValues(EmbeddedController)))
    {
        goto End;
    }
And then in EcGetPortValues (notice the weighted naming of the
function...  :-)
    if ((FirstResource-&gt;Id != Io) || (SecondResource-&gt;Id != Io))
    {
        Status = AE_BAD_DATA;
        goto End;
    }

Section 13.11 of the standard says, "Embedded Controler's [sic]
are considered static resources, hence only return their defined
resources.  The embedded controller resides only in system I/O
or memory space."

Andy, does the EC driver work on any machine yet?  Looks like mine
is bog-standard, but even after EcInitialize, acpid complains that
EC space is an unknown space and so hangs.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000516192744</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-16 19:27:44-0400</timestampReceived><subject>[Acpi] Re: ECs improperly limited in acpica</subject><body>

"Michael K. Johnson" writes:
&gt;I looked at the trace, and it looks like it's
&gt;trying to get at EC space before calling
&gt;EcInitialize (that is, "EcInitialize" wasn't
&gt;in the trace at all and it was complaining
&gt;about unknown space 3); I'm really not clear
&gt;why that is happening, as I had to leave just
&gt;after I figured that out.  Back to work now,
&gt;I guess...

OK, that was mildly obvious:

BmInitialize depends on EcInitialize being called
if a battery uses an embedded controller.

But in bm.c, EcInitialize is called after BmInitialize,
so BmInitialize can't make the battery work.

I tried changing acpid_bm_init to
nt
acpid_bm_init(void)
{
        EcInitialize();
        PwInitialize();
        TzInitialize();
        BtInitialize();

        if (!ACPI_SUCCESS(BmInitialize()))
        {
                acpid_log(LOG_ERR, "BmInitialize failed");
                BtTerminate();
                TzTerminate();
                PwTerminate();
                EcTerminate();
                return -1;
        }


        acpid_enum_battery();
        acpid_enum_thermal();

        return 0;
}

But then I discovered that EcInitialize, for reasons I do not
understand, appears to depend on BmInitialize.  Here's the tail
of the trace with my new function:

acpid:  cmmutex-0193: 
acpid: Released Mutex  [MTX_Namespace] Status AE_OK
acpid:    evapi-0722: 
acpid:  01 Exiting Function: AcpiInstallAddressSpaceHandler, AE_OK
acpid:       ec-0255: 
acpid:  01 Entered Function: EcInitialize
acpid:       bm-0679: 
acpid:  02 Entered Function: BmRegisterControl
acpid:       bm-0597: 
acpid:  03 Entered Function: BmSearch

At this point it hangs (and segfaults when I send it a signal).

Andy, I don't think I have enough information about acpica
design to resolve this.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000509155331</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-09 15:53:31-0400</timestampReceived><subject>[Acpi] Re: Organisational stuff and the APIs</subject><body>

Simon wrote, long ago:
&gt;My ideas for handling this in userspace would be as follows:

I think you are making that way too complex.  You appear to be attempting
to turn Linux into Windows.

&gt; - If the program registers with libacpi, everything is fine, and we can
&gt;   expect the program to be able to tell when the computer and certain
&gt;   pieces of hardware may go to sleep and what provisions (such as
&gt;   wake-on-lan, wake-on-ring, ...) are required to allow turning off that
&gt;   hardware.

I wouldn't put it this way.  I'd say that IF allowed by local configuration,
programs can modify policies.  That's it.

&gt; - If the program does not have a controlling terminal and a UID in a
&gt;   defined (config) range, then it is considered a server. A server's
&gt;   requirements can be determined by querying different acpid modules to
&gt;   which I refer as "plugins". They query specific information such as
&gt;   whether it has any listening sockets and tell acpid their conclusions.
&gt;   The machine should go to sleep after a certain time of inactivity.

You don't need that.  /proc gives you enough information about the
network state to make decisions without worrying about specific
processes.  If there are established incoming connections, going
to sleep would be rude.

That gets rid of a lot of your rules.

Some of the rest of your rules seem to think that we are going to
be controlling the scheduler from acpid.  I'm not sure why you think
that.  ACPI shouldn't be putting individual processes to sleep.
And in terms of unused resources being put to sleep individually,
we don't need to know anything about individual programs; the pm
interface in the kernel should be sufficient.  The kernel is there
for resource management; use it.

&gt; - If a program is using io space directly, it cannot be put to sleep. It
&gt;   might leave the hardware in some weird state.

So much for X.

I would suggest that if a program has iopl set or has mmapped ioports
AND is in running state, then we should not go to sleep.  But if a
program is in running state, we probably shouldn't go to sleep anyway,
so there is no need for a special rule here.

&gt; - If the machine's load5 (the 5 seconds average) and load1 are below a
&gt;   point where the CPU can be clocked down without increasing the load to 
&gt;   1, the CPU gets clocked down.

Actually, it's simpler than that; this can be done with very
simple metrics that do not depend on load average calculations.
We can look at frequency and length of Cn states and if we are
spending enough time in Cn states, clock the processor down.
That would fit trivially into our current kernel-based framework.

&gt; - If a program requests a change to temperature management settings, the
&gt;   request is checked against the allowed values (config), then placed in
&gt;   a list. Precedence is given according to rules in the config and a
&gt;   self-defined priority. The priority is an estimate how serious the
&gt;   request is. If someone is working in the background and someone else at
&gt;   the console, they can manage to get along this way... hopefully. :-)

Even easier: no lists at all, no priorities at all.  You can either set
it, or you can't.  The API has a way to ask for "at least" or "at most"
which is done via get-change?-set?, and a way to store current values
to be restored.

If you have people logged remotely into your system, you don't need to
go to sleep.

&gt; - If an unimportant program (see above) is running, and the system is
&gt;   battery powered, acpid issues a priority 0 TM request that puts the
&gt;   machine into power-saving mode, which is basically the same as silent
&gt;   mode.

Not necessarily what the user wants.  This is easily configurable.

&gt;Home user/Workstation:
&gt; - Many local X connections
&gt;    We don't care about that. These are local connections, as long as the
&gt;    kernel is aware of it (Max? :-) ), they won't time out.

There is no problem here.  People with APM suspend to disk for days
with X running.

&gt; - Few remote X connections
&gt;    It is the duty of the X server to notify/state-save all of its
&gt;    clients. If all of the clients are ACPI aware, this should not be a
&gt;    great problem, since the (not yet existant) specification for aware
&gt;    clients tells how to react (close the connection and wait for
&gt;    notification from the server). If not, we have a real problem. Open a
&gt;    window that informs the user about the problem, and ask for a
&gt;    solution. Also, I cannot offer you a solution if the user forgets
&gt;    about his clients. Sorry.

No.

1) The X server is not involved in session management any more than
   it is involved in window management.

2) Session management is not a complete save/restore state.  It should
   only be done at the user's explicit request.

If there are remote X connections, don't go to sleep.  X is chatty.

&gt; - Some local daemons that are idle most of the time
&gt;    This is no real problem. Servers may be put to sleep as long as they
&gt;    do not have any active non-local connections, and with the appropriate
&gt;    plugins that should not be difficult to detect.

Again, no need for plugins.  We can get network state from proc without
daemon-specific plugins.

&gt;Home server:
&gt; - A few gatewayed connections, depending on whether someone is working
&gt;    While these connections are active, the networking subsystem may not
&gt;    sleep.

Again, nothing special, we know how to get network state.

&gt; - Some daemons that are used sometimes, depending on whether someone is
&gt;   working
&gt;    As long as noone is working, the machine may sleep with wake-on-lan,
&gt;    as soon as someone connects, it needs to wake up. The plugins cat tell
&gt;    you how fast.

This is an example of one particular policy that someone might want to
put into place, or might not.

&gt; - Some cron jobs
&gt;    Cron should be ACPI aware, or we're having a huge problem here.

No need, just use anacron.  It works with APM, and it will work with
ACPI with no problem.

&gt; - Exported filesystems
&gt;    These daemons should be ACPI aware if you want the system to be able
&gt;    to sleep. Sorry.

If you have a network connection, don't go to sleep.  If you don't, then
it's not a problem.  You are again manufacturing problems.

&gt;Small business server:
&gt; - Some server programs being active during normal work hours
&gt;    This should keep the network and hard disk subsystems running
&gt; - Casual activity during the nights/weekends
&gt;    The server programs stay running, since noone is connected, acpid
&gt;    initiates sleep mode with wake-on-lan

You can have cron jobs that install different policy sets at different
times.  Nice and trivial.

&gt;Server: Constant activity keeps all relevant subsystems up.

Even easier...

&gt;Laptop:
&gt; - Battery troubles
&gt;    Every program that can give trouble, in fact those that access
&gt;    hardware directly, should be ACPI aware. If they are not, the only
&gt;    thing we can do is try to maintain device context as long as possible
&gt;    by turning off everything else, and kill the program if there is no
&gt;    other way. Active servers are only a minor problem, since a laptop
&gt;    that is connected to a network is usually also connected to a power
&gt;    source. If not, however, all we can do is refuse to accept() if the
&gt;    battery is low, and thus hope to get the connection table cleared
&gt;    until it gets really critical.

Easier than this, just have the battery monitor program warn the user
to do something intelligent.  And guess what, they already do!  We
just need to export battery status to the battery monitor programs.

The accept() hack won't work.  Slowing down incoming identd() requests
will just keep the connection table full of established outgoing
connections.

Keep it simple!

&gt; - libacpi
&gt;   The interface library for all programs that need to interface the local
&gt;   ACPI subsystem. 

This should talk to my proposed acpictl intermediary program.

&gt; - libXacpi

No need.

&gt; - some ACPI awareness patches
&gt;   X, cron, init, atd, ...

For X, there are two possibilities: systems whose AML code is
correct and which save the graphics state correctly on sleep,
and those that are broken.  As a workaround for broken systems,
we already know what to do, because APM has the right workaround:
switch to a text virtual console.  I can do a better job of it
than APM does -- they aren't taking advantage of the VC interface
as well as they could, but it's really not difficult programming.

Since this has gotten so long, I'll start working on concrete
policy definition in another email.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000519131659</emailId><senderName>Steven Newbury</senderName><senderEmail>acpi-list@snewbury.demon.co.uk</senderEmail><timestampReceived>2000-05-19 13:16:59-0400</timestampReceived><subject>[Acpi] MS5169</subject><body>

I have been trying to get ACPI working with my Microstar ALi chipset
motherboard.

After some experimentaion I have managed to get the ACPI driver loaded.  I
had to set 15-16Mb hole in the BIOS otherwise the BIOS would forget to
reserve the ACPI tables?!?

Anyway when I have acpid it doesn't seem to do anything, including power
off on shutdown.

How can I test whether it is working or not?

--
Steven Newbury

</body></email><email><emailId>20000522193324</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-05-22 19:33:24-0400</timestampReceived><subject>[Acpi] acpid update (052200)</subject><body>

A new version of acpid is available now from

 
http://www.geocities.com/SiliconValley/Hardware/3165/

Changes
* Assembly fix for global lock
* Updated interpreter and core

This update should address some of the problems
people are seeing with the MSI5169 and BP6

If you want to report a bug, please follow the
instructions in acpid/REPORTING-BUGS to generate
enough information for me to track down the bug.

Thanks,
Andy


__________________________________________________
Do You Yahoo!?
Send instant messages &amp; get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

</body></email><email><emailId>20000526221457</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-05-26 22:14:57-0400</timestampReceived><subject>Re: [Acpi] 400MX Some good news some bad</subject><body>

--- SÃ©bastien Bernard &lt;bernarbs@club-internet.fr&gt;
wrote:

&gt; I just wanted to give some report about my
&gt; investigation.
&gt; As I expected, putting the request_irq in the
&gt; acpi_enable worked for me.

Hmm..  I might be tempted to leave the request_irq
in acpi_init.  This allows the ACPI driver to detect
interrupt conflicts when it initializes, rather than
much later when it goes to turn on ACPI.

If the problem is what I think, this should also
work

  ...
  int acpi_enabled = 0;
  ...
  static void acpi_irq(...)
  {
     if (!acpi_enabled)
       return;
     ...
  }
  ...
  static int acpi_enable(...)
  {
     ...
     acpi_enabled = 1;
     ...
  }

&gt; Next for my card (Dec tulip 21143), I put some debug
&gt; in the driver.
&gt; As expected, the interrupt got called again and
&gt; again.

&gt; Something is wrong in the driver logic I think.
&gt; This interrupt got called again and again. I freeze
&gt; after the counter

So, I forget, the ACPI interrupt is being shared
with your ethernet card?  If so, I would expect a
lot of interrupts to come in from the ethernet
card.  Perhaps your ACPI implementation doesn't
like to be polled (to see if ACPI is the source
of the interrupt) before it is enabled?  If so,
the above patch should fix.

Let me know.

Thanks,
Andy



__________________________________________________
Do You Yahoo!?
Kick off your party with Yahoo! Invites.
http://invites.yahoo.com/

</body></email><email><emailId>20000526224448</emailId><senderName>SÃ©bastien Bernard</senderName><senderEmail>bernarbs@club-internet.fr</senderEmail><timestampReceived>2000-05-26 22:44:48-0400</timestampReceived><subject>[Acpi] 400MX Some good news some bad</subject><body>

I'm apparently the only one on this list for the past 48 hours :).
I just wanted to give some report about my investigation.
As I expected, putting the request_irq in the acpi_enable worked for me.

irq is reclaimed only when acpid issues the acpi_enable. Is this
behaviour againts the specs ?
I don't think so. Do you think this way of dealing is correct?
Next for my card (Dec tulip 21143), I put some debug in the driver.
As expected, the interrupt got called again and again.
The text of the loop is as follows:
--------------------------------------------
eth0: interrupt csr5= 0xf0000000 new csr5 = 0xf0000000
eth0: in rx suspend mode: (#) (tp-&gt;cur_rx = 0, ttimer = 1,rx = 0) go /
stay in suspend mode
eth0: exiting interrupt, csr5 = 0xf0000000
--------------------------------------------

Then, I looked at the code. All happens in the interrupt function.
The rx_buffers[entry].skb is NULL.
Something is wrong in the driver logic I think.
This interrupt got called again and again. I freeze after the counter
(the # mark in the extract of the log) goes up to 32.
Any clue guys ?

</body></email><email><emailId>20000527042634</emailId><senderName>James Mastros</senderName><senderEmail>james@rtweb.net</senderEmail><timestampReceived>2000-05-27 04:26:34-0400</timestampReceived><subject>Re: [Acpi] 400MX Some good news some bad</subject><body>

On Sat, May 27, 2000 at 12:44:48AM +0200, S?bastien Bernard wrote:
&gt; --------------------------------------------
&gt; eth0: interrupt csr5= 0xf0000000 new csr5 = 0xf0000000
&gt; eth0: in rx suspend mode: (#) (tp-&gt;cur_rx = 0, ttimer = 1,rx = 0) go /
&gt; stay in suspend mode
&gt; eth0: exiting interrupt, csr5 = 0xf0000000
&gt; --------------------------------------------
&gt; 
&gt; Any clue guys ?
Try loading your NIC as a module, and see if that helps.  Also, if you can,
set your NIC to a different IRQ.
(Then figure out how to properly filter the interupts.)

	-=- James Mastros

</body></email><email><emailId>20000523023641</emailId><senderName>"James Mastros"</senderName><senderEmail>james@rtweb.net</senderEmail><timestampReceived>2000-05-23 02:36:41-0400</timestampReceived><subject>Re: [Acpi] acpid update (052200)</subject><body>

From: "Andy Henroid" &lt;andy_henroid@yahoo.com&gt;
Sent: Monday, May 22, 2000 3:33 PM
&gt; A new version of acpid is available now from
&gt; http://www.geocities.com/SiliconValley/Hardware/3165/
Minor procedureal question: are these in sync with the phobos CVS tree?
(IE which should I track?)

    -=- James Mastros

</body></email><email><emailId>20000519180643</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-05-19 18:06:43-0400</timestampReceived><subject>Re: [Acpi] MS5169</subject><body>

--- Steven Newbury &lt;acpi-list@snewbury.demon.co.uk&gt;
wrote:

&gt; Anyway when I have acpid it doesn't seem to do
&gt; anything, including power
&gt; off on shutdown.
&gt; 
&gt; How can I test whether it is working or not?

Fetch and build the PM tools from the ACPI4Linux
website and run

  acpidmp DSDT | acpianalyze

First look for

  acpianalyze: found S5 support (SLP_TYP 0xX 0xX)

to see if power-off on shutdown (AKA S5) is supported
by your system.

-Andy


__________________________________________________
Do You Yahoo!?
Send instant messages &amp; get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

</body></email><email><emailId>20000520105251</emailId><senderName>Steven Newbury</senderName><senderEmail>acpi-list@snewbury.demon.co.uk</senderEmail><timestampReceived>2000-05-20 10:52:51-0400</timestampReceived><subject>Re: [Acpi] MS5169</subject><body>

On Fri, 19 May 2000, Andy Henroid wrote:

&gt; --- Steven Newbury &lt;acpi-list@snewbury.demon.co.uk&gt;
&gt; wrote:
&gt; 
&gt; &gt; Anyway when I have acpid it doesn't seem to do
&gt; &gt; anything, including power
&gt; &gt; off on shutdown.
&gt; &gt; 
&gt; &gt; How can I test whether it is working or not?
&gt; 
&gt; Fetch and build the PM tools from the ACPI4Linux
&gt; website and run
&gt; 
&gt;   acpidmp DSDT | acpianalyze
&gt; 
&gt; First look for
&gt; 
&gt;   acpianalyze: found S5 support (SLP_TYP 0xX 0xX)
&gt; 
&gt; to see if power-off on shutdown (AKA S5) is supported
&gt; by your system.
&gt; 
Thanks for your reply! Here is the output of acpianalyse:

acpianalyze: loading DSDT from &lt;STDIN&gt;
acpianalyze: found Processor #1 \_PR_.CPU1 (PBLK 0x00004010 - 0x00004016)
acpianalyze: found S0 support (SLP_TYP 0x4 0x0)
acpianalyze: found S1 support (SLP_TYP 0x3 0x0)
acpianalyze: found S5 support (SLP_TYP 0x0 0x0)
                                             ^
                                    does this look suspicious?
I will be in the US for the next week so I will not be able to reply
until I get back to England.

&gt; -Andy
 

</body></email><email><emailId>20000510111027</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-10 11:10:27-0400</timestampReceived><subject>[Acpi] Re: Organisational stuff and the APIs</subject><body>

I wrote:
&gt;I think you are making that way too complex.  You appear to be attempting
&gt;to turn Linux into Windows.

Sorry, I was missing a ":-)" there.

&gt;Even easier: no lists at all, no priorities at all.  You can either set
&gt;it, or you can't.  The API has a way to ask for "at least" or "at most"
&gt;which is done via get-change?-set?, and a way to store current values
&gt;to be restored.

I'm starting to think that I was making it too simple here.  How about
this, instead:

A program can change policy.  It can do that in one of several ways:
 o  It can simply change the current policy
 o  It can conditionally change the current policy ("I need at least
    50% CPU speed, but if the current CPU speed is higher, do not
    lower it to 50%")
 o  It can request a temporary change
A temporary change is removed when requested or when the program
severs its connection (explicitly or implicitly via termination),
whichever comes first.  A temporary change is the only kind that
is stacked.

Rules like that will help keep the policy stack from turning into
a free-for-all memory leak (like, ahem, X shared memory segments... :-)

I'm not sure about attaching priorities to temporary changes; I
think it is likely to end up being unnecessary complication.

Sorry for the occasionally harsh tone of that mail; it was late and
I was tired and hungry...  Didn't mean it to sound that way.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000512011141</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-05-12 01:11:41-0400</timestampReceived><subject>Re: [Acpi] Re: Organisational stuff and the APIs</subject><body>

On Tue, 9 May 2000, Michael K. Johnson wrote:

&gt; Some of the rest of your rules seem to think that we are going to
&gt; be controlling the scheduler from acpid.  I'm not sure why you think
&gt; that.

Well, it's not my native language... I've always meant S-states with
"sleeping".

&gt; &gt; - If a program is using io space directly, it cannot be put to sleep. It
&gt; &gt;   might leave the hardware in some weird state.

&gt; So much for X.

Well, as you mention below, there is the console switch hack (also it
should be possible to have the X server register a callback). Also, with
DRI, X might work without iopl() later on.

&gt; I would suggest that if a program has iopl set or has mmapped ioports
&gt; AND is in running state, then we should not go to sleep.  But if a
&gt; program is in running state, we probably shouldn't go to sleep anyway,
&gt; so there is no need for a special rule here.

The machine should go to sleep when the sleep button is pressed even if
there are programs running. The only exception should be if this breaks
anything (i.e. iopl() or active connections).

[Temperature management]

&gt; Even easier: no lists at all, no priorities at all.  You can either set
&gt; it, or you can't.  The API has a way to ask for "at least" or "at most"
&gt; which is done via get-change?-set?, and a way to store current values
&gt; to be restored.

What about different users with conflicting wishes? The console user
possibly wants to set silent mode, while a remote user needs full
processing power.

&gt; If you have people logged remotely into your system, you don't need to
&gt; go to sleep.

The above rule is mainly about CPU throttling vs. fans.

&gt; &gt; - If an unimportant program (see above) is running, and the system is
        ^ only

Missing words tend to give sentences new meanings.

&gt; &gt;   battery powered, acpid issues a priority 0 TM request that puts the
&gt; &gt;   machine into power-saving mode, which is basically the same as silent
&gt; &gt;   mode.

&gt; Not necessarily what the user wants.  This is easily configurable.

This was to catch a special case: Laptop users running distributed.net
clients. This was a requested feature, nearly as often as disabling the
blanker during MPEG movies.

[X]

&gt; 1) The X server is not involved in session management any more than
&gt;    it is involved in window management.

Basically the right thing to do would be having the server notify xsm. I'm
working on this.

&gt; &gt; - Some local daemons that are idle most of the time
&gt; &gt;    This is no real problem. Servers may be put to sleep as long as they
&gt; &gt;    do not have any active non-local connections, and with the appropriate
&gt; &gt;    plugins that should not be difficult to detect.

&gt; Again, no need for plugins.  We can get network state from proc without
&gt; daemon-specific plugins.

I didn't think of daemon-specific plugins, but of network-stack (or
subsystem) specific ones. One such plugin would, for example, forbid
sleeping if the modem was active.

&gt; &gt; - Some cron jobs
&gt; &gt;    Cron should be ACPI aware, or we're having a huge problem here.

&gt; No need, just use anacron.  It works with APM, and it will work with
&gt; ACPI with no problem.

Well, I'd like to have the machine wake up for jobs that run at night.
That's what I need to change cron for.

[evil accept() hack]

&gt; The accept() hack won't work.  Slowing down incoming identd() requests
&gt; will just keep the connection table full of established outgoing
&gt; connections.

Refusing the connections right away should work IMO.

&gt; &gt; - libacpi

&gt; This should talk to my proposed acpictl intermediary program.

Do you intend to keep that program running or start it on-demand. If the
former, it's basically the same as acpipold. :-)

&gt; &gt; - libXacpi

&gt; No need.

It would be cool if you could communicate some things between server and
client, for example hacking something into xsm would require some sort of
extension to the X server so the event can be sent to the client. But I'll
see first how far I will get without that.

   Simon

-- 
PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

</body></email><email><emailId>20000512092222</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-12 09:22:22-0400</timestampReceived><subject>[Acpi] Re: Organisational stuff and the APIs</subject><body>

Simon Richter writes:
&gt;On Tue, 9 May 2000, Michael K. Johnson wrote:
&gt;
&gt;&gt; Some of the rest of your rules seem to think that we are going to
&gt;&gt; be controlling the scheduler from acpid.  I'm not sure why you think
&gt;&gt; that.
&gt;
&gt;Well, it's not my native language... I've always meant S-states with
&gt;"sleeping".

No, I was talking specifically about your suggestions that say that
individual *processes* will be put to sleep.

&gt;&gt; &gt; - If a program is using io space directly, it cannot be put to sleep. It
&gt;&gt; &gt;   might leave the hardware in some weird state.
&gt;
&gt;&gt; So much for X.
&gt;
&gt;Well, as you mention below, there is the console switch hack (also it
&gt;should be possible to have the X server register a callback). Also, with
&gt;DRI, X might work without iopl() later on.

By "So much for X" I meant that your rule would not work reliably for
X.

&gt;&gt; I would suggest that if a program has iopl set or has mmapped ioports
&gt;&gt; AND is in running state, then we should not go to sleep.  But if a
&gt;&gt; program is in running state, we probably shouldn't go to sleep anyway,
&gt;&gt; so there is no need for a special rule here.
&gt;
&gt;The machine should go to sleep when the sleep button is pressed even if
&gt;there are programs running. The only exception should be if this breaks
&gt;anything (i.e. iopl() or active connections).

Of course.

&gt;[Temperature management]
&gt;
&gt;&gt; Even easier: no lists at all, no priorities at all.  You can either set
&gt;&gt; it, or you can't.  The API has a way to ask for "at least" or "at most"
&gt;&gt; which is done via get-change?-set?, and a way to store current values
&gt;&gt; to be restored.
&gt;
&gt;What about different users with conflicting wishes? The console user
&gt;possibly wants to set silent mode, while a remote user needs full
&gt;processing power.

Easy.  Of the users allowed to set policy, the last one wins.

If you are the administrator, you set whether or not remote users are
allowed to set policy.

&gt;&gt; If you have people logged remotely into your system, you don't need to
&gt;&gt; go to sleep.
&gt;
&gt;The above rule is mainly about CPU throttling vs. fans.

Again, my rule handles this very easily.

&gt;&gt; &gt;   battery powered, acpid issues a priority 0 TM request that puts the
&gt;&gt; &gt;   machine into power-saving mode, which is basically the same as silent
&gt;&gt; &gt;   mode.
&gt;
&gt;&gt; Not necessarily what the user wants.  This is easily configurable.
&gt;
&gt;This was to catch a special case: Laptop users running distributed.net
&gt;clients. This was a requested feature, nearly as often as disabling the
&gt;blanker during MPEG movies.

I suggest that rather than overload the nice value with this new meaning,
simply being able to specify a regular expression matched against the
contents of /proc/pid/cmdline to determine which processes are ignored
for the purposes of making decisions about sleeping and explicit CPU
throttling.

&gt;[X]
&gt;
&gt;&gt; 1) The X server is not involved in session management any more than
&gt;&gt;    it is involved in window management.
&gt;
&gt;Basically the right thing to do would be having the server notify xsm. I'm
&gt;working on this.

No, that's not the right thing to do.

Session management, even when implemented in full, is not a suspend/resume
operation.  Just don't do it.

Furthermore, there is not just one xsm.  I know for certain that GNOME
has its own session manager, and I think that KDE does as well.

&gt;&gt; &gt; - Some local daemons that are idle most of the time
&gt;&gt; &gt;    This is no real problem. Servers may be put to sleep as long as they
&gt;&gt; &gt;    do not have any active non-local connections, and with the appropriate
&gt;&gt; &gt;    plugins that should not be difficult to detect.
&gt;
&gt;&gt; Again, no need for plugins.  We can get network state from proc without
&gt;&gt; daemon-specific plugins.
&gt;
&gt;I didn't think of daemon-specific plugins, but of network-stack (or
&gt;subsystem) specific ones. One such plugin would, for example, forbid
&gt;sleeping if the modem was active.

I think that making these plugins is a bit overengineered...  Let's just
put this functionality in the daemon, and use a reasonable interface so
that we can move to plugins if it turns out to be a good idea.

&gt;&gt; &gt; - Some cron jobs
&gt;&gt; &gt;    Cron should be ACPI aware, or we're having a huge problem here.
&gt;
&gt;&gt; No need, just use anacron.  It works with APM, and it will work with
&gt;&gt; ACPI with no problem.
&gt;
&gt;Well, I'd like to have the machine wake up for jobs that run at night.
&gt;That's what I need to change cron for.

Um, how do you intend to tell the difference between jobs that really
should be run at night and jobs that are run regularly (say, every
few minutes) but should not cause the machine to be woken up?  I'll
bet that you can't come up with a heuristic that I can't come up with
a counterexample for.

Just have anacron run jobs that were missed (that's its job) and make
it possible to ask the daemon to wake up at specified times -- people
who *really* want their machine to wake up in the middle of the night
to do things can add that configuration separately, and then cron or
anacron (whichever is appropriate in the circumstances) will just
automatically do what they wanted.

&gt;[evil accept() hack]
&gt;
&gt;&gt; The accept() hack won't work.  Slowing down incoming identd() requests
&gt;&gt; will just keep the connection table full of established outgoing
&gt;&gt; connections.
&gt;
&gt;Refusing the connections right away should work IMO.

User starts outgoing connection.
All Incoming connections turned off.
Machine on other ends waits for ident to succeed.
User's outgoing connection waits for machine which is waiting for ident,
which doesn't succeed...

I think this is overengineered, anyway.  Trying to drain the connection
table is something we shouldn't try, at least in the first instance.
Let's concentrate on doing things right when there are no connections,
for a start, and then move on from there.

&gt;&gt; &gt; - libacpi
&gt;
&gt;&gt; This should talk to my proposed acpictl intermediary program.
&gt;
&gt;Do you intend to keep that program running or start it on-demand. If the
&gt;former, it's basically the same as acpipold. :-)

On demand.  And each invocation talks to only one program.  Architecture
is like this:

app1[user1] &lt;--&gt; acpictl -i &lt;-+-&gt; acpid [&lt;--&gt; kernel]
app2[user1] &lt;--&gt; acpictl -i &lt;-----^
app3[user2] &lt;--&gt; acpictl -i &lt;-----^
app4[user3] &lt;--&gt; acpictl -i &lt;-----^
              ^                 ^
              This is a pipe    |
                                This is the acpid unix domain socket


acpictl is setgid foo.  Only group foo (and root, of course) is allowed
to open the acpid socket.  Any application can talk to acpictl.  acpictl
sanitizes the requests, *avoiding the potential for buffer overruns in
acpid*.  acpictl is small and therefore easier to write securely and to
audit for security.  It also has limited privileges and thus even if
there is a hole in it, there is less that an attacker can do with it than
with a hole in a setuid program.  Of course, acpid also tries to make sure
that its input is sane (someone could have broken acpictl even if we have
audited it).  Because the protocols are somewhat different, it makes it
hard to come up with an attack that will get through both layers and
attack acpid directly.

&gt;&gt; &gt; - libXacpi
&gt;
&gt;&gt; No need.
&gt;
&gt;It would be cool if you could communicate some things between server and
&gt;client, for example hacking something into xsm would require some sort of
&gt;extension to the X server so the event can be sent to the client. But I'll
&gt;see first how far I will get without that.

Give up on the session management.  It's just not up to the task that you
want to give it.  It's BARELY up to the task of saving your desktop layout,
as we discovered when working on GNOME session management.


You'll notice that I overused one word in this response: "overengineered".
Your note said that you needed 5 people to do all the implementations.
Remember that programmer time is not fungible.  You appear to be trying
to jump into second system effect without even doing the first system...
Let's get something relatively simple, that we actually can implement,
working first, and working well.  If we succeed at that, we may attract
people who want to do more work, and then it will be time to reevaluate.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000512144040</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-05-12 14:40:40-0400</timestampReceived><subject>Re: [Acpi] Re: Organisational stuff and the APIs</subject><body>

On Fri, 12 May 2000, Michael K. Johnson wrote:

&gt; &gt;Well, it's not my native language... I've always meant S-states with
&gt; &gt;"sleeping".

&gt; No, I was talking specifically about your suggestions that say that
&gt; individual *processes* will be put to sleep.

Which doesn't make sense. I meant S-states, but it was 3am. :-)

[X/xsm]

&gt; Session management, even when implemented in full, is not a suspend/resume
&gt; operation.  Just don't do it.

:-) As I said, I'm working on that.

&gt; Furthermore, there is not just one xsm.  I know for certain that GNOME
&gt; has its own session manager, and I think that KDE does as well.

The changes to xsm will be minimal (in fact it just needs to register for
the event and send SaveYourself to every application running when). Most
of the work will happen in the toolkits. I'm going to do a reference
implementation in Xt/Xaw and see whether this works.

&gt; &gt;Refusing the connections right away should work IMO.

&gt; User starts outgoing connection.
&gt; All Incoming connections turned off.
&gt; Machine on other ends waits for ident to succeed.
&gt; User's outgoing connection waits for machine which is waiting for ident,
&gt; which doesn't succeed...

Nope, don't ignore the connection - refuse it. The ident will fail, but
that doesn't matter when the battery is empty anyway.

&gt; I think this is overengineered, anyway.  Trying to drain the connection
&gt; table is something we shouldn't try, at least in the first instance.

Agree.

&gt; On demand.  And each invocation talks to only one program.  
&gt; Architecture is like this:
[...]

How do you want to respond to battery events? You need some program that
keeps running and receives the event.

&gt; acpictl sanitizes the requests, *avoiding the potential for buffer
&gt; overruns in acpid*.  acpictl is small and therefore easier to write
&gt; securely and to audit for security.

The only thing we actually seem to disagree on is whether to have a
daemon or a standalone program and whether the API will be a library or a
pipe to a program.

The daemon helps to save state between requests and can also respond to
events (I'd like to have that functionality out of acpid, since acpid will
most likely be used on many different OSes, possibly even ones with
(really) different filesystem trees).

A pipe as the official API has certain limitations when you need to extend
the API. I don't want to end up with ExtOp requests... :-)

&gt; Because the protocols are somewhat different, it makes it hard to come
&gt; up with an attack that will get through both layers and attack acpid
&gt; directly.

acpipold does the same.

&gt; Let's get something relatively simple, that we actually can implement,
&gt; working first, and working well.  If we succeed at that, we may attract
&gt; people who want to do more work, and then it will be time to reevaluate.

Basically I can live with that, however APIs tend to live longer than
planned. :-)

   Simon

-- 
PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

</body></email><email><emailId>20000512163010</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-12 16:30:10-0400</timestampReceived><subject>[Acpi] Re: Organisational stuff and the APIs</subject><body>

Simon Richter writes:
&gt;[X/xsm]
&gt;
&gt;&gt; Session management, even when implemented in full, is not a suspend/resume
&gt;&gt; operation.  Just don't do it.
&gt;
&gt;:-) As I said, I'm working on that.

And, as I said, Just don't do it.  I'm strongly convinced, based on
our experience in GNOME, that X session management is not up to the
task.  At all.  There is no way to make it fit the bill.

X session management should only be done at explicit user request.
Just because the word "save" is in "SaveYourself" does not mean
that the word "save" really should have been used...

Furthermore, users do not necessarily want that particular state
saved.  It could just blow away their carefully saved state.

Go ahead and do whatever you want, but I won't cry at the funeral
when it turns out to have been a waste of time...  :-)

&gt;&gt; I think this is overengineered, anyway.  Trying to drain the connection
&gt;&gt; table is something we shouldn't try, at least in the first instance.
&gt;
&gt;Agree.

OK, no problem there.

&gt;&gt; On demand.  And each invocation talks to only one program.  
&gt;&gt; Architecture is like this:
&gt;[...]
&gt;
&gt;How do you want to respond to battery events? You need some program that
&gt;keeps running and receives the event.

acpid.

&gt;&gt; acpictl sanitizes the requests, *avoiding the potential for buffer
&gt;&gt; overruns in acpid*.  acpictl is small and therefore easier to write
&gt;&gt; securely and to audit for security.
&gt;
&gt;The only thing we actually seem to disagree on is whether to have a
&gt;daemon or a standalone program and whether the API will be a library or a
&gt;pipe to a program.

No, you have a larger domain that needs to be audited, because you have
an entire daemon, shared between users, that performs several functions,
only one of which is data sanitization.  I strongly disagree with this
approach.  You also don't seem to understand the difference between data
sanitization and authentication, based on your insistence that SO_PASSCRED
solves the sanitization problem.  SO_PASSCRED is only for authentication,
not for data sanitization.

&gt;The daemon helps to save state between requests and can also respond to
&gt;events (I'd like to have that functionality out of acpid, since acpid will
&gt;most likely be used on many different OSes, possibly even ones with
&gt;(really) different filesystem trees).

There's no reason to take it out of acpid on Linux.  acpictl can abstract
that.  On other OS's you can have another architecture under that.

&gt;A pipe as the official API has certain limitations when you need to extend
&gt;the API. I don't want to end up with ExtOp requests... :-)

There's a history on the net of extensible text protocols.  It's no
secret how to do it.

Look at how often kmemps used to have to be rewritten, and compare
that to procps, which can be stable across many different kernel
versions.  Text protocols have much better long-term stability
than binary protocols.

Please explain your "certain limitations".

&gt;&gt; Because the protocols are somewhat different, it makes it hard to come
&gt;&gt; up with an attack that will get through both layers and attack acpid
&gt;&gt; directly.
&gt;
&gt;acpipold does the same.

No, because acpipold does more stuff.  It's a bigger domain to audit.

&gt;&gt; Let's get something relatively simple, that we actually can implement,
&gt;&gt; working first, and working well.  If we succeed at that, we may attract
&gt;&gt; people who want to do more work, and then it will be time to reevaluate.
&gt;
&gt;Basically I can live with that, however APIs tend to live longer than
&gt;planned. :-)

Especially when they work well.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000514173838</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-05-14 17:38:38-0400</timestampReceived><subject>Re: [Acpi] Re: Organisational stuff and the APIs</subject><body>

On Fri, 12 May 2000, Michael K. Johnson wrote:

&gt; &gt;How do you want to respond to battery events? You need some program that
&gt; &gt;keeps running and receives the event.

&gt; acpid.

Well, I'd like to have that functionality split out into a separate
daemon. Policy management isn't a kernel issue IMHO, it shouldn't be
handled by a daemon that is part of the kernel (I consider it part of the
kernel because certain functionality depends on it). Splitting it out
would reduce acpid's complexity and size (-&gt; embedded systems).

&gt; No, you have a larger domain that needs to be audited, because you have
&gt; an entire daemon, shared between users, that performs several functions,
&gt; only one of which is data sanitization.

server.c does exactly what you want to do in acpictl. It checks an
incoming packet, then rewrites it to the internal protocol and appends it
to a queue to be processed by another function. It may run in a separate
thread or process, however I don't really see that is really necessary.

&gt; I strongly disagree with this
&gt; approach.  You also don't seem to understand the difference between data
&gt; sanitization and authentication, based on your insistence that SO_PASSCRED
&gt; solves the sanitization problem.  SO_PASSCRED is only for authentication,
&gt; not for data sanitization.

Nope. The data from SO_PASSCRED is added as (trusted) authentication data
to the internal packet. The internal packet however is only built if the
data makes sense.

For the binary vs. text stuff: I can see your point. I'll try to switch
server.c (and libacpi) over to it, since only one request (sleep) has been
implemented yet, this shouldn't be too difficult. I still expect code to
grow significantly, though.

   Simon

-- 
PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

</body></email><email><emailId>20000515093927</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-15 09:39:27-0400</timestampReceived><subject>[Acpi] Re: Organisational stuff and the APIs</subject><body>

Simon Richter writes:
&gt;Well, I'd like to have that functionality split out into a separate
&gt;daemon. Policy management isn't a kernel issue IMHO, it shouldn't be
&gt;handled by a daemon that is part of the kernel (I consider it part of the
&gt;kernel because certain functionality depends on it). Splitting it out
&gt;would reduce acpid's complexity and size (-&gt; embedded systems).

Um, calling acpid part of the kernel because some functionality
is like calling init part of the kernel because the kernel.  Highly
sophistical, and highly suspect.

&gt;&gt; No, you have a larger domain that needs to be audited, because you have
&gt;&gt; an entire daemon, shared between users, that performs several functions,
&gt;&gt; only one of which is data sanitization.
&gt;
&gt;server.c does exactly what you want to do in acpictl. It checks an
&gt;incoming packet, then rewrites it to the internal protocol and appends it
&gt;to a queue to be processed by another function. It may run in a separate
&gt;thread or process, however I don't really see that is really necessary.

A different *address space* is what I have in mind, and yes, it does
make a difference.  If there is an overrun in the first stage of parsing,
then if they are both in the same address space, that overrun could be
used to hit anything.  If they are in a different address space, then
such an overrun can only have an effect if it can be used to take advantage
of a completely different overrun (or other breach) in the process that
is running in a separate address space.

&gt;Nope. The data from SO_PASSCRED is added as (trusted) authentication data
&gt;to the internal packet. The internal packet however is only built if the
&gt;data makes sense.

OK, you know the difference, you just weren't expressing it...  :-)

I still suggest using that data as trusted authentication information to
pass to PAM and let the policy decisions about which users are allowed
to set power management policy (boy, that's confusing!) be done in a
way that is standard across services.

&gt;For the binary vs. text stuff: I can see your point. I'll try to switch
&gt;server.c (and libacpi) over to it, since only one request (sleep) has been
&gt;implemented yet, this shouldn't be too difficult. I still expect code to
&gt;grow significantly, though.

Can I please request that you post a formal definition of that text
protocol here before you set it in stone?  If you don't want your
protocol to limit you in the future, peer review is the only way to
avoid that.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000516204712</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-05-16 20:47:12-0400</timestampReceived><subject>Re: [Acpi] Re: ECs improperly limited in acpica</subject><body>

--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:

&gt; BmInitialize depends on EcInitialize being called
&gt; if a battery uses an embedded controller.
&gt; 
&gt; But in bm.c, EcInitialize is called after
&gt; BmInitialize,
&gt; so BmInitialize can't make the battery work.

No, actually BmInitialize should be called first
followed by EcInitialize, BtInitialize (battery),
TzInitialize (thermal).  Each of the components
(EC, battery, thermal) then register with the
bus manager (Bm) and AddDevice is called for each
instance of battery, EC, or thermal zone found.

This architecture is very plug-n-play-like.

&gt; Andy, I don't think I have enough information about
&gt; acpica design to resolve this.

Documentation is hopefully on its way.

-Andy


__________________________________________________
Do You Yahoo!?
Send instant messages &amp; get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

</body></email><email><emailId>20000516175853</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-05-16 17:58:53-0400</timestampReceived><subject>Re: [Acpi] ECs improperly limited in acpica</subject><body>

--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:

&gt; Andy, does the EC driver work on any machine yet? 
&gt; Looks like mine
&gt; is bog-standard, but even after EcInitialize, acpid
&gt; complains that
&gt; EC space is an unknown space and so hangs.

Yes, I definitely know of the EC working on
recent Fujitsu laptops like mine.  What does
the _CRS for your embedded controller look
like?

Right, EC support is currently limited to
I/O and there is no support for memory mapped.
AFAIK, I/O-based ECs are the only ones out
there and probably the only ones likely to
appear.

A memory mapped interface would be too costly
for an EC.  And even if someone did implement a
mem-mapped EC, they would be foolish to use the
standard EC protocol to access it.

-Andy



__________________________________________________
Do You Yahoo!?
Send instant messages &amp; get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

</body></email><email><emailId>20000516184644</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-16 18:46:44-0400</timestampReceived><subject>Re: [Acpi] ECs improperly limited in acpica</subject><body>

Andy Henroid writes:
&gt;Yes, I definitely know of the EC working on
&gt;recent Fujitsu laptops like mine.  What does
&gt;the _CRS for your embedded controller look
&gt;like?

Looks perfectly sane to me.

00003768:         Name _CRS (\_SB_.PCI0.PX40.EC0_._CRS)
0000376d:           Buffer
0000376f:             0x12
00003771:             ByteList &lt;0x47 0x01 0x62 0x00 0x62 0x00 0x01 0x01 
00003771:                       0x47 0x01 0x66 0x00 0x66 0x00 0x01 0x01 
00003771:                       0x79 0x00&gt;
00003771:             Interpreted as PnP Resource Descriptor:
00003771:             I/O Ports: 16 bit address decoding,
00003771:             minbase 0x62, maxbase 0x62, align 0x1, count 0x1
00003771:             I/O Ports: 16 bit address decoding,
00003771:             minbase 0x66, maxbase 0x66, align 0x1, count 0x1
00003771:             Bad checksum 0x9d, should be 0

(Andy, if you want more than that, you have
my entire EC0 definition in an earlier email
from when we were talking about the suspend
key handling on my machine, which is done by
EC0.  This explains, in part, my interest in
getting ECs working...)

I looked at the trace, and it looks like it's
trying to get at EC space before calling
EcInitialize (that is, "EcInitialize" wasn't
in the trace at all and it was complaining
about unknown space 3); I'm really not clear
why that is happening, as I had to leave just
after I figured that out.  Back to work now,
I guess...

Here's a snippet from the trace where I see
the complaint:

...
acpid: AmlReadFieldData: OpRegion EmbeddedControl at 0000003e width 8
acpid: evregion-0278: 
acpid:  19 Entered Function: EvAddressSpaceDispatch
acpid: evregion-0288: 
acpid: Dispatch address access region 0x80F3AC8, no handler
acpid: evregion-0289: 
acpid:  19 Exiting Function: EvAddressSpaceDispatch, AE_EXIST
acpid:  iefread-0116: 
acpid: AmlReadFieldData: **** Unknown OpRegion SpaceID 3
acpid: OsdBreakpoint: Fatal error encountered

Because I see in acpica/control/ec/ec.c:EcInitialize()
the line
    FUNCTION_TRACE("EcInitialize");
I expected to be able to search for EcInitialize in the
trace output, but
[johnsonm@bastable acpid]$ grep EcInit acpitrace.ec
[johnsonm@bastable acpid]$ 

Does that support my analysis?

&gt;Right, EC support is currently limited to
&gt;I/O and there is no support for memory mapped.
&gt;AFAIK, I/O-based ECs are the only ones out
&gt;there and probably the only ones likely to
&gt;appear.

Even if ACPI 2.0 supports, say, PowerPC devices
with no I/O space at all?

&gt;A memory mapped interface would be too costly
&gt;for an EC.

Why?  How could memory mapping be more costly
than I/O mapping?

&gt;And even if someone did implement a
&gt;mem-mapped EC, they would be foolish to use the
&gt;standard EC protocol to access it.

Why?

If they wanted to use existing hardware on a
non-intel machine, wouldn't memory-mapped
access be the cheapest and easiest way to do
it?

Oh, I guess I should quit wondering about things
that will never happen (ACPI on a non-intel
platform) and get back to work...

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000509205313</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-05-09 20:53:13-0400</timestampReceived><subject>Re: [Acpi] ACPI now works on Irongate C4 but huge slow down with pppd?!</subject><body>

--- Dieter NÃ¼tzel &lt;dieter.nuetzel@myokay.net&gt; wrote:

&gt; System can power down normally and sleep wen I do
&gt; "echo 0|1 &gt;
&gt; /proc/sys/acpi/sleep".
&gt; But after the system goes sleeping I have to press
&gt; the poweron button to
&gt; wake it up again. Now it goes directly to poweroff?
&gt; :-(

Hmm..  I wonder if that is bounce?  (physical,
electrical, etc.)  You can test this by
rebooting without acpid, then

  # turn the power button event on
  echo 0x100 &gt; /proc/sys/acpi/pm1_enable
  # wait for the power button event
  cat /proc/sys/acpi/event
  # in another window or console, initiate sleep
  echo 1 &gt; /proc/sys/acpi/sleep

Now, what do you get back from the "cat" ?
You should see a single line

  0x00000100 0x00000000 0x1
         ^                ^
         power button     occured while in S1

If you get back multiple lines, that could
very well be bounce and we'll have to see
about fixing that in software.  If you
don't see "0x1" (occurred during S1) that
would also be a problem.

&gt; Second.
&gt; 
&gt; After the acpid has started I get only ~1 KB/sec
&gt; with pppd. My ppp
&gt; connections are so slow that I can't use them
&gt; together with acpid
&gt; running. To solve the situation I have to reboot
&gt; without starting acpid,
&gt; again.

Strange.  Unlikely, but it could be possible that
C-states are interfering with PPP processing
Ie. your system really isn't idle, it is waiting
for PPP data, and the latency involved in going
in and out of C2 or C3 is messing up PPP timeouts.

You could try disabling C-states and see if your
bandwidth improves.  Add "acpi=no-c2,no-c3" to
your kernel command line and let us know what
you see.

-Andy


__________________________________________________
Do You Yahoo!?
Send instant messages &amp; get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

</body></email><email><emailId>20000512013807</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-05-12 01:38:07-0400</timestampReceived><subject>Re: [Acpi] Re: acpictl suggestion</subject><body>

On Wed, 10 May 2000, Michael K. Johnson wrote:

&gt; That's exactly what I proposed, modulo the library.  I'm not against
&gt; the library, but I suggest that it talk to the policy manager with a
&gt; protocol that we agree on, because it is not always convenient to link
&gt; against a library to "just do the right thing" because the library
&gt; authors do not always know what application authors will want.

Well, I expect implementing the protocol will be more difficult than
linking against a library. I can see your point, though.

&gt; No, you missed my point.  My point is that the whole untrusted information
&gt; domain needs to be audited for security, and my approach makes the domain
&gt; smaller.

Well, the untrusted domain is everything an ordinary user can fully 
control. Whether this is argv[] or the contents of a network packet
doesn't really matter (Although I think the network packet can be checked
more easily).

&gt; Read the proposal I'm writing in a separate letter.  Basically, any
&gt; application that is allowed to set policy can modify the configuration
&gt; in response to events, which gives the potential for programmatic
&gt; policy configuration without imposing it on the vast majority who
&gt; simply do not want it.

This would mean the user would need another daemon that runs scripts based
on ACPI events?

[ssh1 vs. ssh2]

&gt; I've only got ssh1 available on this computer right now.

ssh2 is known not to be fully 8 bit clean, so you're probably better off
with ssh1 anyway. I'm just leaving ssh2 open for those who are frightened
by the buffer overruns in RSAREF.

   Simon

-- 
PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

</body></email><email><emailId>20000617124231</emailId><senderName>Mitch Miers</senderName><senderEmail>mmiers@intellinet-tech.com</senderEmail><timestampReceived>2000-06-17 12:42:31-0400</timestampReceived><subject>[Acpi] Re: Dell Inspiron 7500/Maestro 2e + acpid = sluggish</subject><body>

So do I take that to mean:

0x6940 =  ID6 | ID8 | SE1 | SE3 | SE4 ?

Meaning: 18 bit DAC resolution, 18 bit ADC resolution, SigmaTel
3D enhancement (if I'm reading my bits right).  If so, then we
do have different versions of the AC97.  v: seems to be vendor
words.  Does this suggest a different foundry as well?

Mitch

Zach Brown wrote:
&gt; 
&gt; On Fri, Jun 16, 2000 at 06:30:01PM -0400, Mitch Miers wrote:
&gt; 
&gt; &gt;
&gt; &gt; My codec and caps are different (whatever that means).
&gt; 
&gt; see
&gt; 
&gt; ftp://download.intel.com/ial/scalableplatforms/audio/ac97r21.pdf
&gt; 
&gt; page 39 ;)
&gt; 
&gt; --
&gt;  zach

</body></email><email><emailId>20000616002338</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-06-16 00:23:38-0400</timestampReceived><subject>Re: [Acpi] Dell Inspiron 7500/Maestro 2e + acpid = sluggish</subject><body>

Huh, the only thing that really gets turned on
when acpid starts is C-states (the processor
powers down while the system is idle)  Try
turning those off and see if the problem goes
away.  Append "acpi=no-c2,no-c3" to the kernel
command line.

Otherwise, Zach, you are adding D-state support
to the Maestro, right? (cool, by the way)  Have
you seen this?

-Andy

--- Mitch Miers &lt;mmiers@intellinet-tech.com&gt; wrote:
&gt; 
&gt; Hello,
&gt; 
&gt; As per the subject.
&gt; 
&gt; When acpid is not running, everything is fine.
&gt; 
&gt; When acpid is running, the system is sluggish if no
&gt; process
&gt; has /dev/dsp open (mouse movement is slower, etc). 
&gt; It seems
&gt; to effect timekeeping in general, as (e.g.) the
&gt; interval
&gt; between top redisplays is longer than normal.
&gt; 
&gt; The maestro docs (linux/Documentation/sound/Maestro)
&gt; say
&gt; that when no program has /dev/dsp open, the maestro
&gt; chip is
&gt; "shut down".  If /dev/dsp is opened, the system
&gt; behavior
&gt; goes back to normal (acpid running).  I could quote
&gt; the
&gt; docs, but if you've got a 2.3.x or 2.4.0pre you've
&gt; got the
&gt; docs - look for "When using power management".
&gt; 
&gt; Now, I can fix this by module option (use_pm=0,
&gt; disabling pm
&gt; for the sound chip), but I'd rather know why this
&gt; happens.
&gt; Any hints?  The archives mention this laptop, but in
&gt; conjunction with a different problem.
&gt; 
&gt; I'm not on the list, please CC any replies.  Table
&gt; dumps or
&gt; other info available on request.
&gt; 
&gt; Mitch
&gt; 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  - 
&gt; acpi@phobos.fachschaften.tu-muenchen.de
&gt;
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi


__________________________________________________
Do You Yahoo!?
Send instant messages with Yahoo! Messenger.
http://im.yahoo.com/

</body></email><email><emailId>20000616012431</emailId><senderName>Zach Brown</senderName><senderEmail>zab@zabbo.net</senderEmail><timestampReceived>2000-06-16 01:24:31-0400</timestampReceived><subject>Re: [Acpi] Dell Inspiron 7500/Maestro 2e + acpid = sluggish</subject><body>

&gt; Otherwise, Zach, you are adding D-state support
&gt; to the Maestro, right? (cool, by the way)  Have
&gt; you seen this?

I haven't, no, but I haven't gotten much feedback on the apm code
in general :)  

The Maestro power management stuff in the existing driver is pretty
danged minimal.  It was only added because when win&lt;something&gt; shutdown
it left the maestro shutdown and a soft reboot to linux meant your
maestro didn't work anymore.

The maestro chip has config registers to say what parts
of the chip should have their clocks fed.  When we don't have any
devices open, we drop the clock to almost all the units.  I don't
honestly know if this reduces the load the chip draws at all, but it
probably should :)  More importantly, paying attention to power
management stuff made the maestro come to life after win had suspended
it :)

I'm not sure exactly what the problem could be.  It sounds like
the chip is making the world very unhappy when its suspended, I would
guess this is 'cause its causing small mountains of spurious ints on the
bus or is doing Evil Things while messing up legacy bus snooping.  I'm
not at all sure why the hell it would do either of these things :)  My
first experiment would be to mess around with the set of units that have
their clocks disabled.  

Also interesting is the fact that the current PM code does absolutely
nothing with the AC97.  Dell may have wired things so that powering down
things without paying attention to the ac97 does bad stuff.  I dunno.

So, 'got me', but I'll work with someone whose interested in playing
with it :)   I don't have maestro hardware at the moment, let alone
maestro hardware that I could play with power management on..

-- 
 zach

</body></email><email><emailId>20000509162524</emailId><senderName>Dieter =?iso-8859-1?Q?N=FCtzel?=</senderName><senderEmail>dieter.nuetzel@myokay.net</senderEmail><timestampReceived>2000-05-09 16:25:24-0400</timestampReceived><subject>[Acpi] Re: ACPI now works on Irongate C4...</subject><body>

Hello,

you have any suggestions for my reported ppp connection slowdown when
acpid is running?

Thank you,
            Dieter

--
Dieter N=FCtzel
Graduate Student, Computer Science

University of Hamburg
Department of Computer Science
Cognitive Systems Group
Vogt-K=F6lln-Stra=DFe 30
D-22527 Hamburg, Germany

email: nuetzel@kogs.informatik.uni-hamburg.de
@home: dieter.nuetzel@myokay.net

</body></email><email><emailId>20000510004919</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-05-10 00:49:19-0400</timestampReceived><subject>Re: [Acpi] vsnprintf</subject><body>

--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:

&gt; I notice that a lot of our acpi code uses vsprintf
&gt; instead of vsnprintf.

&gt; lacking vsnprintf, could we switch basically
&gt; everything over to using vsnprintf?

Yes, sounds like a good idea.  I'll make the change.

-Andy


__________________________________________________
Do You Yahoo!?
Send instant messages &amp; get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

</body></email><email><emailId>20000510005856</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-05-10 00:58:56-0400</timestampReceived><subject>Re: [Acpi] popt</subject><body>

--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:

&gt; I'd like to suggest using popt for argument parsing,
&gt; for a variety of reasons.

I'm open to using popt unless anyone out there has
a strong objection to it.  I don't love adding
an additional library requirement for building
acpid but it sounds like popt might be worth
it.

-Andy


__________________________________________________
Do You Yahoo!?
Send instant messages &amp; get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

</body></email><email><emailId>20000510114427</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-10 11:44:27-0400</timestampReceived><subject>[Acpi] concrete policy definition</subject><body>

OK, here's my first shot at actually defining a structure for real
items of policy.  This is a static policy, so it doesn't say things
like "if battery then this policy, else that policy".  That is a
separate issue.

Priority: Performance|Battery|Quiet

	This setting is an overall setting; this is used to adjust
	settings when other policies are not set or do not apply.
	This is the only setting that cannot be "None".

All the rest of the policies default to "None", meaning that there
is no setting, fall back to Priority.

SuspendPolicy: Ram|Disk

	When an external suspend event arrives (i.e. the user has
	closed the lid, pressed a suspend key, whatever) determines
	whether the user prefers a quick suspend to ram (S3) or a
	slower suspend to disk (S4).  This is ignored when we have
	a way of telling which kind of suspend the user requested,
	such as on machines with separate suspend-to-ram and
	suspend-to-disk keys/buttons.

Sleep: Lightly|Deeply (Or perhaps a percentage scale or something)

	Weights how readily the system transitions to S2 instead
	of S1.  Think of it as a system-wide nice level.

MaxCPUSpeed: percentage

	Gives a suggested maximum percentage CPU speed.  This will,
	of course, be subject to what speed stepping levels exist
	on the machine.  A value of None will cause this to be
	dynamically set based on Priority.

	Note: the ACPI standard appears to consider CPU throttling
	only as a thermal management procedure, without considering
	the effects on battery life management.

This is, of course, only a start.  What other static policy states
do we need?


Please understand that the final language we define could well
have multiple policy definitions and events, like:
default {
	Priority Noise
	MaxCPUSpeed None
	Sleep None
}
event mains {
	Priority Performance
	MaxCPUSpeed None
	Sleep None
}
event battery {
	Priority Battery
	MaxCPUSpeed 50
	Sleep lightly
}
event battery_low {
	Priority Battery
	Sleep deeply
	Fans quiet
	SuspendPolicy Disk
}
Obviously those event names are bad and the structure sucks, but
my point is that restricting our current work to the definition of
a static policy does not imply that we can't react to events.  It's
just a way of limiting the scope of our work so that we do not
confuse ourselves at this stage.

This policy is also not inclusive of necessary actions.  For
example, the fact that PPP connections will not survive a
suspend action is not included here.  Event actions are a
completely different topic, and there are many of them that
we will have to define.

I'm open to other completely different definitions of static
policy -- just try to make them relatively formal so that we can
discuss them intelligently.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000510141841</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-10 14:18:41-0400</timestampReceived><subject>[Acpi] write lock...</subject><body>

Just a FYI that I'm doing rather heavy
modification of acpid/ipc.{c,h} and of
the entire acpictl directory.  I'm not
making heavy protocol changes, but I'm
changing several things at once, in an
interconnected way.

I'm also mucking lightly with bm.c
(only the request handling part)
and probably lightly with other parts
as I work on this, but the merging
should be simpler for those parts.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000510161534</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-10 16:15:34-0400</timestampReceived><subject>[Acpi] acpid conversation protocol patch</subject><body>

This is a multipart MIME message.


I've added a protocol versioning system to
acpid's socket protocol.  As soon as we have
two binaries (acpid and acpictl) floating
around that share a protocol, it becomes obvious
that someday someone will have two different
versions on his system, built from different
sources, and this will wreak havoc.  Even though
they are built from the same sources, and thus
should change together, imagine the following
scenario as only one instance of what could go
wrong.

Joe User tries out acpi.  He first does a
./configure --prefix /usr/local
while trying things out, and then later does
./configure --prefix /usr
with a newer once he is satisfied that he likes
ACPI.  In the meantime, of course, the protocol
numbers have changed.  Joe has /usr/local/bin
first in his path because he has some nifty
programs there that intentionally override
versions in /usr/bin and /bin for him without
mangling system scripts that rely on the
stodgy normal versions.  So, of course, when
he runs acpictl, he runs the old version in
/usr/local/bin/acpictl and it tries to talk
to the new daemon, which of course was started
as /usr/sbin/acpid from the new
/etc/rc.d/init.d/acpi script that the new
version of acpid installed.  The output is
mangled in strange ways, and we get a really
wierd-looking bug report here.  We spend a
few hours looking through his bug report before
someone thinks about old versions of acpictl...

We'll avoid that entirely by adding the protocol number
to the protocol before making acpictl an installed
program (right now, Makefile.am sets acpictl to
be built but not installed).


While I was at it, I rearranged the protocol a bit;
I made the enumeration a bit more sane by using a
hierarchical naming scheme, and by using an enumeration
for the otherwise not-explicitly-defined status value.

I also made acpictl only query batteries that it
discovers to exist, made acpictl depend on popt,
moved to *nprintf within acpictl and ipc.{c,h} and
did various other things that I'm forgetting at the
moment...

Note that after applying this patch, you will have to
run ./autogen.sh because I modified acpictl/Makefile.am


 *** Andy, please tell me whether or not you apply this;
     if you do apply it, and if it touches other code
     that you have been working on, please make another
     code drop so that we can stay in sync.  Thanks!
     If you don't apply it, let me know what you want
     changed.

Oh, and I haven't tested this, except to make sure that
it compiles.  :-/  Sometimes I wish I was back in the
office with separate test and development machines...
On the other hand, untested patches work for Linus, so
maybe this will work for me!  :-)

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/


["acpid.protocol.diff" (text/plain)]

--- acpid.protocol/acpictl/Makefile.am.orig	Wed May 10 14:25:58 2000
+++ acpid.protocol/acpictl/Makefile.am	Wed May 10 14:27:31 2000
@@ -1,6 +1,6 @@
-noinst_PROGRAMS = acpictl
+bin_PROGRAMS = acpictl
 
 INCLUDES = -I$(top_srcdir)/acpid
 
 acpictl_SOURCES = acpictl.c
-
+acpictl_LDADD = -lpopt
--- acpid.protocol/acpictl/acpictl.c.orig	Tue May  9 14:38:45 2000
+++ acpid.protocol/acpictl/acpictl.c	Wed May 10 17:54:15 2000
@@ -29,6 +29,8 @@
 #include &lt;string.h&gt;
 #include &lt;stdarg.h&gt;
 
+#include &lt;popt.h&gt;
+
 #include "ipc.h"
 
 static const char *acpictl_name = "";
@@ -39,11 +41,12 @@
 void
 log(char *fmt,...)
 {
-	static char buffer[256];
+	static char buffer[ACPID_MAX_REQUEST];
 	va_list args;
 
 	va_start(args, fmt);
-	vsprintf(buffer, fmt, args);
+	buffer[0] = '\0';
+	vsnprintf(buffer, ACPID_MAX_REQUEST-1, fmt, args);
 	va_end(args);
 
 	fprintf(stderr, "%s: %s\n", acpictl_name, buffer);
@@ -57,11 +60,12 @@
 {
 	int fd, size;
 	struct sockaddr_un addr;
+	char buffer[1];
 
 	fd = socket(PF_UNIX, SOCK_STREAM, 0);
 	if (fd &lt; 0)
 	{
-		printf("socket: %s\n", strerror(errno));
+		fprintf(stderr, "socket: %s\n", strerror(errno));
 		return -1;
 	}
 
@@ -77,55 +81,138 @@
 		return -1;
 	}
 
+	if ((write(fd, ACPID_PROTOCOL, strlen(ACPID_PROTOCOL))
+	    &lt; strlen(ACPID_PROTOCOL)) ||
+	    (read(fd, buffer, 1) &lt; 1))
+	{
+		log("bad protocol version.");
+		close(fd);
+		return -1;
+	}
+
 	return fd;
 }
 
 /*
- * Send and display simple request
+ * Send a simple request and listen for a return
+ * Return value points to static struct that will be
+ * overwritten next time the function is called.
  */
-int
+struct acpid_request *
 send_request(int fd, int type, const char *data)
 {
 	static char buffer[ACPID_MAX_REQUEST];
 	struct acpid_request *rqst = (struct acpid_request*) buffer;
 	
 	rqst-&gt;type = type;
-	rqst-&gt;status = 0;
+	rqst-&gt;status = ACPID_STATUS_OK;
 	strcpy(rqst-&gt;data, data ? data:"");
 	rqst-&gt;size = sizeof(*rqst) + strlen(rqst-&gt;data) + 1;
 
 	if (write(fd, rqst, rqst-&gt;size) != rqst-&gt;size
 	    || read(fd, buffer, sizeof(buffer)) &lt; sizeof(struct acpid_request))
 	{
-		return -1;
+		return NULL;
 	}
 
-	log("  %s", rqst-&gt;data);
-	return rqst-&gt;status;
+	return rqst;
 }
 
+
 int
 main(int argc, char **argv)
 {
 	int fd;
+	int acpid_pid = 0;
+	int battery = 0;
+	int intermediary = 0;
+	int rc;
+	struct acpid_request *rqst;
+
+	poptContext optCon;
+	struct poptOption optionsTable[] = {
+		{ "pid", 'p', POPT_ARG_NONE, &amp;acpid_pid, 0,
+		  "print acpid's pid", NULL},
+		{ "battery", 'b', POPT_ARG_NONE, &amp;battery, 0,
+		  "print battery information", NULL},
+		{ "intermediary", 'i', POPT_ARG_NONE, &amp;intermediary, 0,
+		  "act as intermediary between another program and acpid", NULL},
+#if 0
+		{ "", '', POPT_ARG_, &amp;, 0,
+		  "", ""},
+#endif
+		POPT_AUTOHELP
+		{ NULL, 0, 0, NULL, 0 },
+	};
+
 
 	acpictl_name = strrchr(argv[0], '/');
 	acpictl_name = acpictl_name ? (acpictl_name + 1):argv[0];
 
+	optCon = poptGetContext("acpictl", argc, argv, optionsTable, 0);
+	rc = poptReadDefaultConfig(optCon, 0);
+	if (rc &lt; 0)
+	{
+		fprintf(stderr, "%s: %s\n", acpictl_name, poptStrerror(rc));
+		exit(1);
+	}
+	rc = poptGetNextOpt(optCon);
+	if (rc &lt; 0)
+	{
+		fprintf(stderr, "%s: %s: %s\n", acpictl_name,
+			poptBadOption(optCon, POPT_BADOPTION_NOALIAS),
+			poptStrerror(rc));
+		exit(1);
+	}
+	poptFreeContext(optCon);
+
 	fd = client_init();
 	if (fd &lt; 0)
 		exit(1);
 
-	log("ACPID_GET_BATTERY_COUNT");
-	send_request(fd, ACPID_GET_BATTERY_COUNT, NULL);
-	log("ACPID_GET_BATTERY_INFO 0");
-	send_request(fd, ACPID_GET_BATTERY_INFO, "0");
-	log("ACPID_GET_BATTERY_STATUS 0");
-	send_request(fd, ACPID_GET_BATTERY_STATUS, "0");
-	log("ACPID_GET_BATTERY_INFO 1");
-	send_request(fd, ACPID_GET_BATTERY_INFO, "1");
-	log("ACPID_GET_BATTERY_STATUS 1");
-	send_request(fd, ACPID_GET_BATTERY_STATUS, "1");
+
+	if (intermediary)
+	{
+		/* FIXME */
+
+		/* do not try running anything else */
+		exit (0);
+	}
+
+
+	if (acpid_pid)
+	{
+		rqst = send_request(fd, ACPID_PID_GET, NULL);
+		if (rqst-&gt;status &gt;=0)
+			log("acpid pid %s", rqst-&gt;data);
+		else
+			log("acpid not running");
+	}
+
+	if (battery)
+	{
+		int i, count;
+		char batnum[12]; /* more than enough for an integer */
+		struct acpid_request *rqst;
+
+		rqst = send_request(fd, ACPID_BATTERY_GET_COUNT, NULL);
+		if (rqst-&gt;status != ACPID_STATUS_OK)
+		{
+			log("no batteries");
+		}
+		else
+		{
+			log("%s batteries;", rqst-&gt;data);
+			count = strtol(rqst-&gt;data, NULL, 0);
+			for(i = 0; i &lt; count; i++) {
+				snprintf(batnum, sizeof(batnum), "%d", i);
+				rqst = send_request(fd, ACPID_BATTERY_GET_INFO, batnum);
+				log("BATTERY INFO[%d]: %s", i, rqst-&gt;data);
+				rqst = send_request(fd, ACPID_BATTERY_GET_STATUS, batnum);
+				log("BATTERY STATUS[%d]: %s", i, rqst-&gt;data);
+			}
+		}
+	}
 
 	close(fd);
 	
--- acpid.protocol/acpid/ipc.c.orig	Wed May 10 16:06:23 2000
+++ acpid.protocol/acpid/ipc.c	Wed May 10 17:37:37 2000
@@ -61,14 +61,19 @@
 	strcpy(addr.sun_path, ACPID_SERVER_PATH);
 	size = strlen(addr.sun_path) + sizeof(addr.sun_family);
 
-	if (connect(fd, (struct sockaddr*) &amp;addr, size) &lt; 0)
+	/* connect, send protocol version, get ack, bail on any error */
+	if ((connect(fd, (struct sockaddr*) &amp;addr, size) &lt; 0) ||
+	    (write(fd, ACPID_PROTOCOL, strlen(ACPID_PROTOCOL))
+	     &lt; strlen(ACPID_PROTOCOL)) ||
+	    (read(fd, buffer, 1) &lt; 1))
 	{
 		close(fd);
 		return -1;
 	}
 
-	rqst-&gt;type = ACPID_GET_PID;
-	rqst-&gt;status = 0;
+
+	rqst-&gt;type = ACPID_PID_GET;
+	rqst-&gt;status = ACPID_STATUS_OK;
 	rqst-&gt;size = sizeof(*rqst);
 
 	if (write(fd, rqst, rqst-&gt;size) == rqst-&gt;size
@@ -133,12 +138,22 @@
 {
 	struct sockaddr_un addr;
 	int size, client;
+	char protocol[8];
 
 	size = sizeof(addr);
 	client = accept(fd, (struct sockaddr*) &amp;addr, &amp;size);
 	if (client &lt; 0)
 		return -1;
 
+	/* get, check, and ack protocol version */
+	if ((read(client, protocol, sizeof(protocol)) &lt; sizeof(protocol)) ||
+	    (strncmp(protocol, ACPID_PROTOCOL, sizeof(protocol))) ||
+	    (write(client, "\n", 1) &lt; 1))
+	{
+		close (client);
+		return -1;
+	}
+
 	return client;
 }
 
@@ -159,21 +174,18 @@
 		return -1;
 	}
 
-	rqst-&gt;status = -1;
-	switch(rqst-&gt;type)
+	rqst-&gt;status = ACPID_STATUS_ERROR;
+	if(rqst-&gt;type == ACPID_PID_GET)
 	{
-	case ACPID_GET_PID:
-		sprintf(rqst-&gt;data, "%d", getpid());
-		rqst-&gt;status = 0;
-		break;
-	case ACPID_GET_BATTERY_COUNT:
-	case ACPID_GET_BATTERY_INFO:
-	case ACPID_GET_BATTERY_STATUS:
+		snprintf(rqst-&gt;data, ACPID_REQUEST_DATA_SIZE, "%d", getpid());
+		rqst-&gt;status = ACPID_STATUS_OK;
+	}
+	else if(rqst-&gt;type | ACPID_BATTERY_MASK)
 		rqst-&gt;status = acpid_battery_request(rqst);
-		break;
-	default:
+	else 
+	{
 		strcpy(rqst-&gt;data, "Not implemented");
-		break;
+		rqst-&gt;status = ACPID_STATUS_ERROR;
 	}
 	rqst-&gt;size = sizeof(*rqst) + strlen(rqst-&gt;data) + 1;
 
--- acpid.protocol/acpid/ipc.h.orig	Wed May 10 16:06:29 2000
+++ acpid.protocol/acpid/ipc.h	Wed May 10 17:14:46 2000
@@ -21,18 +21,44 @@
 #ifndef _IPC_H_
 #define _IPC_H_
 
+/* always 8 bytes of protocol number */
+#define ACPID_PROTOCOL "00000001"
 #define ACPID_SERVER_PATH "/tmp/.acpi-unix"
 #define ACPID_MAX_REQUEST 512
+#define ACPID_REQUEST_DATA_SIZE \
+	(ACPID_MAX_REQUEST - (sizeof(struct acpid_request) + 1))
 
 /*
  * Request types
+ *
+ * Use explicit enumeration in order to keep protocol stable and
+ * to create family masks.
+ * A family is a set of requests that are handled by a single function.
+ * A family mask is a bitmask that when or'ed with a request type
+ * will determine whether the request type falls in that family.
+ *
+ * Values in this enumeration have the format
+ * ACPID_&lt;FAMILY&gt;_&lt;VERB&gt;[_&lt;OBJECT&gt;]
+ * or
+ * ACPID_&lt;FAMILY&gt;_MASK
  */
 enum
 {
-	ACPID_GET_PID,
-	ACPID_GET_BATTERY_COUNT,
-	ACPID_GET_BATTERY_INFO,
-	ACPID_GET_BATTERY_STATUS,
+	ACPID_PID_GET = 0,
+
+	ACPID_BATTERY_GET_COUNT = 0x1,
+	ACPID_BATTERY_GET_INFO = 0x2,
+	ACPID_BATTERY_GET_STATUS = 0x3,
+	ACPID_BATTERY_MASK = 0x4,
+};
+
+/*
+ * Status values
+ */
+enum
+{
+	ACPID_STATUS_ERROR= -1,
+	ACPID_STATUS_OK = 0,
 };
 
 /*
--- acpid.protocol/acpid/bm.c.orig	Wed May 10 16:32:35 2000
+++ acpid.protocol/acpid/bm.c	Wed May 10 16:33:15 2000
@@ -214,7 +214,7 @@
 {
 	switch (rqst-&gt;type)
 	{
-	case ACPID_GET_BATTERY_COUNT:
+	case ACPID_BATTERY_GET_COUNT:
 		{
 			int count = 0;
 			struct list_entry *entry = acpid_batteries.next;
@@ -226,7 +226,7 @@
 			sprintf(rqst-&gt;data, "%d", count);
 		}
 		break;
-	case ACPID_GET_BATTERY_INFO:
+	case ACPID_BATTERY_GET_INFO:
 		{
 			int id = strtoul(rqst-&gt;data, 0, 0);
 			struct acpid_battery *bat = acpid_find_battery(id);
@@ -252,7 +252,7 @@
 				bat-&gt;info.OEMInformation);
 		}
 		break;
-	case ACPID_GET_BATTERY_STATUS:
+	case ACPID_BATTERY_GET_STATUS:
 		{
 			int id = strtoul(rqst-&gt;data, 0, 0);
 			struct acpid_battery *bat = acpid_find_battery(id);


</body></email><email><emailId>20000510195359</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-10 19:53:59-0400</timestampReceived><subject>[Acpi] Re: acpid conversation protocol patch</subject><body>

This is a multipart MIME message.


"Michael K. Johnson" writes:
&gt;Oh, and I haven't tested this, except to make sure that
&gt;it compiles.  :-/  Sometimes I wish I was back in the
&gt;office with separate test and development machines...
&gt;On the other hand, untested patches work for Linus, so
&gt;maybe this will work for me!  :-)

Well, I still haven't tested it, but I have rectified
the worst ugliness, and it still compiles.

Andy, this should be applied over my last patch.  It
should be functionally identical, but is easier to read
and modify.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/


["acpid.functions.diff" (text/plain)]

--- acpid.new/acpictl/acpictl.c.orig	Wed May 10 21:44:40 2000
+++ acpid.new/acpictl/acpictl.c	Wed May 10 21:49:14 2000
@@ -118,6 +118,43 @@
 	return rqst;
 }
 
+static void
+do_battery_request(int fd)
+{
+	int i, count;
+	char batnum[12]; /* more than enough for an integer */
+	struct acpid_request *rqst;
+
+	rqst = send_request(fd, ACPID_BATTERY_GET_COUNT, NULL);
+	if (rqst-&gt;status != ACPID_STATUS_OK)
+	{
+		log("no batteries");
+		return;
+	}
+
+	log("%s batteries;", rqst-&gt;data);
+	count = strtol(rqst-&gt;data, NULL, 0);
+	for(i = 0; i &lt; count; i++) {
+		snprintf(batnum, sizeof(batnum), "%d", i);
+		rqst = send_request(fd, ACPID_BATTERY_GET_INFO, batnum);
+		log("BATTERY INFO[%d]: %s", i, rqst-&gt;data);
+		rqst = send_request(fd, ACPID_BATTERY_GET_STATUS, batnum);
+		log("BATTERY STATUS[%d]: %s", i, rqst-&gt;data);
+	}
+}
+
+static void
+do_pid_request(int fd)
+{
+	struct acpid_request *rqst;
+
+	rqst = send_request(fd, ACPID_PID_GET, NULL);
+	if (rqst-&gt;status != ACPID_STATUS_OK)
+		log("acpid not running");
+	else
+		log("acpid pid %s", rqst-&gt;data);
+}
+
 
 int
 main(int argc, char **argv)
@@ -181,38 +218,10 @@
 
 
 	if (acpid_pid)
-	{
-		rqst = send_request(fd, ACPID_PID_GET, NULL);
-		if (rqst-&gt;status &gt;=0)
-			log("acpid pid %s", rqst-&gt;data);
-		else
-			log("acpid not running");
-	}
+		do_pid_request(fd);
 
 	if (battery)
-	{
-		int i, count;
-		char batnum[12]; /* more than enough for an integer */
-		struct acpid_request *rqst;
-
-		rqst = send_request(fd, ACPID_BATTERY_GET_COUNT, NULL);
-		if (rqst-&gt;status != ACPID_STATUS_OK)
-		{
-			log("no batteries");
-		}
-		else
-		{
-			log("%s batteries;", rqst-&gt;data);
-			count = strtol(rqst-&gt;data, NULL, 0);
-			for(i = 0; i &lt; count; i++) {
-				snprintf(batnum, sizeof(batnum), "%d", i);
-				rqst = send_request(fd, ACPID_BATTERY_GET_INFO, batnum);
-				log("BATTERY INFO[%d]: %s", i, rqst-&gt;data);
-				rqst = send_request(fd, ACPID_BATTERY_GET_STATUS, batnum);
-				log("BATTERY STATUS[%d]: %s", i, rqst-&gt;data);
-			}
-		}
-	}
+		do_battery_request(fd);
 
 	close(fd);
 	


</body></email><email><emailId>200005110215000</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-05-11 02:15:00-0400</timestampReceived><subject>[Acpi] acpid update</subject><body>

A new version of acpid is available now from

 
http://www.geocities.com/SiliconValley/Hardware/3165/

Changes
* Added Michael Johnson's latest patches
  (note that the popt library is now required
  to build acpictl)
* Added information about creating bug reports
  (see REPORTING-BUGS)
* Added an option (-t) to acpid to produce a (rather
  sizeable) debug trace which should help us
  track down, at the very least, crashes
  (see REPORTING-BUGS)
* A nifty AML debugger is turned on by default
  now when using -d.  Try "help".  Additional
  documentation will be available soon.



__________________________________________________
Do You Yahoo!?
Send instant messages &amp; get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

</body></email><email><emailId>20000511132352</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-11 13:23:52-0400</timestampReceived><subject>[Acpi] Re: acpid update</subject><body>

This is a multipart MIME message.


Andy Henroid writes:
&gt;* Added Michael Johnson's latest patches
&gt;  (note that the popt library is now required
&gt;  to build acpictl)

Untested patches don't work so well for me; there was a
0 that should have been a -1.  Here's a patch that fixes
that and also improves some formatting.

The other improvements look very spiffy.  I had fun
crashing acpid in the debugger, running random control
methods, etc.  :-)

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

["acpid.poptfix.diff" (text/plain)]

--- acpid-051000/acpictl/acpictl.c.orig	Thu May 11 13:46:31 2000
+++ acpid-051000/acpictl/acpictl.c	Thu May 11 13:52:17 2000
@@ -132,14 +132,14 @@
 		return;
 	}
 
-	log("%s batteries;", rqst-&gt;data);
+	log("%s batteries", rqst-&gt;data);
 	count = strtol(rqst-&gt;data, NULL, 0);
 	for(i = 0; i &lt; count; i++) {
 		snprintf(batnum, sizeof(batnum), "%d", i);
 		rqst = send_request(fd, ACPID_BATTERY_GET_INFO, batnum);
-		log("BATTERY INFO[%d]: %s", i, rqst-&gt;data);
+		log("battery[%d]   info: %s", i, rqst-&gt;data);
 		rqst = send_request(fd, ACPID_BATTERY_GET_STATUS, batnum);
-		log("BATTERY STATUS[%d]: %s", i, rqst-&gt;data);
+		log("battery[%d] status: %s", i, rqst-&gt;data);
 	}
 }
 
@@ -196,7 +196,7 @@
 		exit(1);
 	}
 	rc = poptGetNextOpt(optCon);
-	if (rc &lt; 0)
+	if (rc &lt; -1)
 	{
 		fprintf(stderr, "%s: %s: %s\n", acpictl_name,
 			poptBadOption(optCon, POPT_BADOPTION_NOALIAS),


</body></email><email><emailId>20000511210617</emailId><senderName>Tony Hoyle</senderName><senderEmail>tmh@magenta-logic.com</senderEmail><timestampReceived>2000-05-11 21:06:17-0400</timestampReceived><subject>[Acpi] BP6 at last!</subject><body>

I eventually got acpid powering off with the BP6.  The new debugging
features allowed me to come up the the attached patch, which makes it
work.

It looks like a combination of a libc bug (strncmp was failing for some
reason, so I got the error 'Unknown table 'FACP' followed by the error
'Cannot find FACP'!) and an ABIT bug (In S4 and S5 a type is set to zero
instead of the required object type).  Also I had a compliation error
which I patched in the best way I knew how, given that I don't know any
GAS assembler...

Now when I start up in debug mode I get a couple of screens full of
warnings about AE_NULL_OBJECT then it settles down and tells me that
s0,s1,s4 and s5 are available, which is good enough for me. (debug
output attached).

Tony
["acpi.diff" (text/plain)]

diff -rubN acpid-051000/acpica/subsystem/common/cmsize.c \
                acpid-patched/acpica/subsystem/common/cmsize.c
--- acpid-051000/acpica/subsystem/common/cmsize.c	Thu May 11 01:33:46 2000
+++ acpid-patched/acpica/subsystem/common/cmsize.c	Thu May 11 21:39:38 2000
@@ -81,7 +81,7 @@
          * The only type that should be here is opcode AML_NAMEPATH_OP -- since
          * this means an object reference 
          */
-        if (InternalObj-&gt;Reference.OpCode != AML_NAMEPATH_OP)
+        if (InternalObj-&gt;Reference.OpCode &amp;&amp; InternalObj-&gt;Reference.OpCode != \
AML_NAMEPATH_OP)  {
             DEBUG_PRINT (ACPI_ERROR, ("CmGetSimpleObjectSize: Unsupported Reference \
                opcode=0x%X in object %p\n",
                                         InternalObj-&gt;Reference.OpCode, \
                InternalObj));
diff -rubN acpid-051000/acpica/subsystem/tables/tbinstal.c \
                acpid-patched/acpica/subsystem/tables/tbinstal.c
--- acpid-051000/acpica/subsystem/tables/tbinstal.c	Thu May 11 01:33:48 2000
+++ acpid-patched/acpica/subsystem/tables/tbinstal.c	Thu May 11 21:18:18 2000
@@ -122,7 +122,7 @@
     Status = AE_BAD_SIGNATURE;
     for (i = 1; i &lt; NUM_ACPI_TABLES; i++)       /* Start at one -&gt; Skip RSDP */
     {
-        if (!STRNCMP (TableHeader-&gt;Signature, Gbl_AcpiTableData[i].Signature, \
Gbl_AcpiTableData[i].SigLength)) +        if (!memcmp (TableHeader-&gt;Signature, \
Gbl_AcpiTableData[i].Signature, Gbl_AcpiTableData[i].SigLength))  {
             /* Found a signature match, get the pertinent info from the TableData \
structure */  
diff -rubN acpid-051000/acpid/acenv.h acpid-patched/acpid/acenv.h
--- acpid-051000/acpid/acenv.h	Thu May 11 00:40:04 2000
+++ acpid-patched/acpid/acenv.h	Thu May 11 20:19:50 2000
@@ -89,7 +89,7 @@
          "jnz               1b;"            \
          "cmpb              $0x3,%%dl;"     \
          "sbbl              %%eax,%%eax"    \
-         :"=a"(Acq):"c"(GLptr),"i"(~1L):"cx","dx")
+         :"=a"(Acq):"c"(GLptr),"i"(~1L):"dx")
 
 #define ASM_ReleaseGL(GLptr, Acq)           \
   asm("1: movl              (%1),%%eax;"    \
@@ -98,6 +98,6 @@
          "lock; cmpxchgl    %%edx,(%1);"    \
          "jnz               1b;"            \
          "andl              $0x1,%%eax"     \
-         :"=a"(Acq):"c"(GLptr),"i"(~3L):"cx","dx")
+         :"=a"(Acq):"c"(GLptr),"i"(~3L):"dx")
 
 #endif /* _ACENV_H_ */


["acpid.output" (text/plain)]

acpid: started
acpid: FACP loaded from /proc/sys/acpi/
acpid: DSDT loaded from /proc/sys/acpi/
acpid: Parsing Methods:
acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c2fa4 [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c3434 [_CRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c38e4 [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c3904 [_CRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c3964 [_PRT] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c48bc [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c4dac [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c4dcc [_PRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c4dec [_DIS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c4e0c [_CRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c4e2c [_SRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c5b9c [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c5bbc [_PRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c5bdc [_DIS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c5bfc [_CRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c5c1c [_SRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c694c [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c696c [_PRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c698c [_DIS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c69ac [_CRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c69cc [_SRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c76fc [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c771c [_PRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c773c [_DIS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c775c [_CRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c777c [_SRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c9484 [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c94a4 [_DIS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c94c4 [_CRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c9504 [_SRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80ca254 [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80ca274 [_DIS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80ca294 [_CRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80ca2d4 [_SRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80cadbc [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80caddc [_DIS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80cadfc [_CRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80cae3c [_SRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80cb904 [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80cb924 [_DIS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80cb944 [_CRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80cb984 [_SRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80ca02c [CKID] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80cc6d4 [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80cc6f4 [_DIS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80cc714 [_CRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80cc754 [_SRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80cd23c [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80cd25c [_DIS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80cd27c [_CRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80cd2bc [_SRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80cdd84 [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80ce214 [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c1bbc [_PSV] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c1bdc [_CRT] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c1bfc [_TMP] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c1c1c [_SCP] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c1c3c [STMP] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80cec54 [ENF1] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80cec74 [EXF1] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: 
76 Control Methods found and parsed
acpid: nsapinam-0093: 
acpid: **** ACPI Namespace successfully loaded at root 0x0x809ce34
acpid: S0 SLP_TYP (0x0505)
acpid: S1 SLP_TYP (0x0404)
acpid: S2 not supported
acpid: S3 not supported
acpid: S4 SLP_TYP (0x0000)
acpid: S5 SLP_TYP (0x0000)
acpid: P_BLK 0 @ 0x0000:0
acpid: P_BLK 1 @ 0x0000:0
acpid: no usable processor block
acpid: exiting


</body></email><email><emailId>20000512093413</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-12 09:34:13-0400</timestampReceived><subject>[Acpi] Re: acpictl suggestion</subject><body>

Simon Richter writes:
&gt;On Wed, 10 May 2000, Michael K. Johnson wrote:
&gt;&gt; No, you missed my point.  My point is that the whole untrusted information
&gt;&gt; domain needs to be audited for security, and my approach makes the domain
&gt;&gt; smaller.
&gt;
&gt;Well, the untrusted domain is everything an ordinary user can fully 
&gt;control. Whether this is argv[] or the contents of a network packet
&gt;doesn't really matter (Although I think the network packet can be checked
&gt;more easily).

My point is that the process of translation by trusted code will have
the tendency to make buffer overflows harder to find.

In general, binary protocols have seemed to be bad from a security
standpoint because they seem more susceptible to code rot -- it was
secure when first written, but when new contributors come, they just
don't recognize the implications of some new combination they just
created, and, whoops, that integer index that used to be a short
now indexes some important piece of memory and it's not checked and
welcome to root, Mr. Cracker!  :-/

I'm of the opinion that the discipline of transforming a textual
protocol into a binary protocol makes some of these interactions
more obvious and makes it harder to, say, make a buffer overflow
at the hidden level if there is a level of error-checking in
between in which there is an attempt made to sanitize the data.

The vast majority of programmers, even really hot-shot programmers,
honestly don't have the first clue how to write secure programs.  I
am myself only moderately good at analyzing my own programs for
security, better than average but important stuff I ask people better
than me to audit.  I don't trust Joe Random Contributor to get this
right...

&gt;&gt; Read the proposal I'm writing in a separate letter.  Basically, any
&gt;&gt; application that is allowed to set policy can modify the configuration
&gt;&gt; in response to events, which gives the potential for programmatic
&gt;&gt; policy configuration without imposing it on the vast majority who
&gt;&gt; simply do not want it.
&gt;
&gt;This would mean the user would need another daemon that runs scripts based
&gt;on ACPI events?

Respond to that letter separately -- I've realized that acpid needs to
be able to respond to events, but I still don't want it to be done
procedurally.  That configuration language should be an event-&gt;action
mapping, not a turing-equvalent (or even turing-similar...) language.

My point is that people who want to control policy with a turing-equiv
language can do so by writing an application which talks through
acpictl to acpid, subscribes to events, and changes policy in response
to them.

The other half of that point is that almost no users will want to do
this, but my architecture makes that complexity available to them
without imposing it on normal users who would only be confused by it.
I'm trying to think of this configuration in part from the perspective
of writing a graphical configuration tool that modifies it.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000512130950</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-05-12 13:09:50-0400</timestampReceived><subject>[Acpi] [PATCH] PCI quirk for ACPI devices (fwd)</subject><body>

&gt;From the lkml.

   Simon

---------- Forwarded message ----------
Date: Fri, 12 May 2000 11:19:33 +0400
From: Andrey Panin &lt;pazke@orbita.don.sitek.net&gt;
Subject: [PATCH] PCI quirk for ACPI devices

Hi all,

this is updated PCI quirk for ACPI devices.
Changes from previous post:
        - fixup type changed PCI_FIXUP_FINAL -&gt; PCI_FIXUP_HEADER;
        - added IRQ setting for Intel and VIA devices;
        - minor cleanup in chipset support code of /linux/arch/i386/kernel/acpi.c.

Also one question:
        why dev-&gt;irq != dev-&gt;irq_resource[0].start in pci_dev structure ?
        IMHO it cause some ugly lines of code in drivers supporting both PCI
        and ISA PnP devices (look at /linux/drivers/char/serial.c for example).

Best wishes,
                Andrey



begin 666 patch-viacpi-2.3.99-pre7
M9&amp;EF9B M=7).("]M;G0O9"]L:6YU&gt;"]D&lt;FEV97)S+W!C:2]Q=6ER:W,N8R O
M;&amp;EN=7@O9')I=F5R&lt;R]P8VDO&lt;75I&lt;FMS+F,*+2TM("]M;G0O9"]L:6YU&gt;"]D
M&lt;FEV97)S+W!C:2]Q=6ER:W,N8PE7960@36%Y(#$P(#(P.C0X.C(R(#(P,# *
M*RLK("]L:6YU&gt;"]D&lt;FEV97)S+W!C:2]Q=6ER:W,N8PE7960@36%Y(#$P(#(R
M.C$U.C0P(#(P,# *0$ @+3$U,BPQ,2 K,34R+#$S($! "B @*B!024E8-"!!
M0U!).B!4=V\@24\@&lt;F5G:6]N&lt;R!P;VEN=&amp;5D('1O(&amp;)Y(F=W;W)D&lt;R!A
M= H@("H),'@T," H-C0@8GET97,@;V8@04-022!R96=I&lt;W1E&lt;G,I"B @*@DP
M&gt;#DP("@S,B!B&gt;71E&lt;R!O9B!334(@&lt;F5G:7-T97)S*0HK("H)86YD(&amp;AA&lt;F1W
M:7)E9"!)4E$Y+@H@("HO"B!S=&amp;%T:6,@=F]I9"!?7VEN:70@&lt;75I&lt;FM?&lt;&amp;EI
M&gt;#1A8W!I*'-T&lt;G5C="!P8VE?9&amp;5V("ID978I"B!["B )=3,R(')E9VEO;CL*
M( HK"61E=BT^:7)Q(#T@.3L*( EP8VE?&lt;F5A9%]C;VYF:6=?9'=O&lt;F0H9&amp;5V
M+" P&gt;#0P+" F&lt;F5G:6]N*3L*( EQ=6ER:U]I;U]R96=I;VXH9&amp;5V+"!R96=I
M;VXL(#8T+"!00TE?0E))1$=%7U)%4T]54D-%4RD["B )&lt;&amp;-I7W)E861?8V]N
M9FEG7V1W;W)D*&amp;1E=BP@,'@Y,"P@)G)E9VEO;BD["D! ("TQ-C8L,3(@*S$V
M."PQ-R! 0 H@+RH*(" J(%9)02!!0U!).B!/;F4@24\@&lt;F5G:6]N('!O:6YT
M960@=&amp;\@8GD@;&amp;]N9W=O&lt;F0@870*(" J"3!X-#@@;W(@,'@R," H,C4V(&amp;)Y
M=&amp;5S(&amp;]F($%#4$D@&lt;F5G:7-T97)S*0HK("H)86YD($E242!N=6UB97(@870@
M,'@T,BX*(" J+PH@&lt;W1A=&amp;EC('9O:60@7U]I;FET('%U:7)K7W9I85]A8W!I
M*'-T&lt;G5C="!P8VE?9&amp;5V("ID978I"B!["BT)=3@@&lt;F5V.PHK"74X(')E=BP@
M:7)Q.PH@"74S,B!R96=I;VX["B **PEP8VE?&lt;F5A9%]C;VYF:6=?8GET92AD
M978L(#!X-#(L("9I&lt;G$I.PHK"6EF("AI&lt;G$I"BL)"61E=BT^:7)Q(#T@:7)Q
M.PD**PH@"7!C:5]R96%D7V-O;F9I9U]B&gt;71E*&amp;1E=BP@4$-)7T-,05-37U)%
M5DE324].+" F&lt;F5V*3L*( EI9B H&lt;F5V("8@,'@Q,"D@&gt;PH@"0EP8VE?&lt;F5A
M9%]C;VYF:6=?9'=O&lt;F0H9&amp;5V+" P&gt;#0X+" F&lt;F5G:6]N*3L*0$ @+3(P.2PQ
M," K,C$V+#$P($! "B )&gt;R!00TE?1DE855!?1DE.04PL"5!#25]614Y$3U)?
M241?24Y414PL( E00TE?1$5624-%7TE$7TE.5$5,7S@R-#0S0EA?,BP@"7%U
M:7)K7VYA=&amp;]M82!]+ H@"7L@4$-)7T9)6%507T9)3D%,+ E00TE?5D5.1$]2
M7TE$7U-)+ E00TE?1$5624-%7TE$7U-)7S4U.3&lt;L"0EQ=6ER:U]N;W!C:7!C
M:2!]+ H@"7L@4$-)7T9)6%507T9)3D%,+ E00TE?5D5.1$]27TE$7U-)+ E0
M0TE?1$5624-%7TE$7U-)7S0Y-BP)"7%U:7)K7VYO&lt;&amp;-I&lt;&amp;-I('TL"BT)&gt;R!0
M0TE?1DE855!?1DE.04PL"5!#25]614Y$3U)?241?5DE!+ E00TE?1$5624-%
M7TE$7U9)05\X,D,U.#9?,RP)&lt;75I&lt;FM?=FEA7V%C&lt;&amp;D@?2P*+0E[(%!#25]&amp;
M25A54%]&amp;24Y!3"P)4$-)7U9%3D1/4E])1%]624$L"5!#25]$159)0T5?241?
M5DE!7S@R0S8X-E\T+ EQ=6ER:U]V:6%?86-P:2!]+ HM"7L@4$-)7T9)6%50
M7T9)3D%,+ E00TE?5D5.1$]27TE$7TE.5$5,+ E00TE?1$5624-%7TE$7TE.
M5$5,7S@R,S&lt;Q04)?,RP)&lt;75I&lt;FM?&lt;&amp;EI&gt;#1A8W!I('TL"BT)&gt;R!00TE?1DE8
M55!?1DE.04PL"5!#25]614Y$3U)?241?04PL"5!#25]$159)0T5?241?04Q?
M33&lt;Q,#$L"0EQ=6ER:U]A;&amp;DW,3 Q('TL"BL)&gt;R!00TE?1DE855!?2$5!1$52
M+ E00TE?5D5.1$]27TE$7U9)02P)4$-)7T1%5DE#15])1%]624%?.#)#-3@V
M7S,L"7%U:7)K7W9I85]A8W!I('TL"BL)&gt;R!00TE?1DE855!?2$5!1$52+ E0
M0TE?5D5.1$]27TE$7U9)02P)4$-)7T1%5DE#15])1%]624%?.#)#-C@V7S0L
M"7%U:7)K7W9I85]A8W!I('TL"BL)&gt;R!00TE?1DE855!?2$5!1$52+ E00TE?
M5D5.1$]27TE$7TE.5$5,+ E00TE?1$5624-%7TE$7TE.5$5,7S@R,S&lt;Q04)?
M,RP)&lt;75I&lt;FM?&lt;&amp;EI&gt;#1A8W!I('TL"BL)&gt;R!00TE?1DE855!?2$5!1$52+ E0
M0TE?5D5.1$]27TE$7T%,+ E00TE?1$5624-%7TE$7T%,7TTW,3 Q+ D)&lt;75I
M&lt;FM?86QI-S$P,2!]+ H@"7L@,"!]"B!].PH@"F1I9F8@+75R3B O;6YT+V0O
M;&amp;EN=7@O87)C:"]I,S@V+VME&lt;FYE;"]A8W!I+F,@+VQI;G5X+V%R8V@O:3,X
M-B]K97)N96PO86-P:2YC"BTM+2 O;6YT+V0O;&amp;EN=7@O87)C:"]I,S@V+VME
M&lt;FYE;"]A8W!I+F,)5V5D($UA&gt;2 Q," R,#HT.#HP-" R,# P"BLK*R O;&amp;EN
M=7@O87)C:"]I,S@V+VME&lt;FYE;"]A8W!I+F,)5&amp;AU($UA&gt;2 Q,2 Q.#HU.3HP
M," R,# P"D! ("TW,# L-R K-S P+#&lt;@0$ *( EI9B H(2AP;7)E9VUI&lt;V,@
M)B!!0U!)7U!)25@T7U!-24]312DI"B )"7)E='5R;B M14Y/1$56.PH@"0HM
M"6)A&lt;V4@/2!D978M/G)E&lt;V]U&lt;F-E6U!#25]"4DE$1T5?4D533U520T5372YS
M=&amp;%R=" F(%!#25]"05-%7T%$1%)%4U-?24]?34%32SL**PEB87-E(#T@&lt;&amp;-I
M7W)E&lt;V]U&lt;F-E7W-T87)T*&amp;1E=BP@4$-)7T)2241'15]215-/55)#15,I.PH@
M"6EF("@A8F%S92D*( D)&lt;F5T=7)N("U%3D]$158["B *0$ @+3&lt;T-RPW("LW
M-#&lt;L-R! 0 H@&gt;PH@"7-T&lt;G5C="!A8W!I7V9A8W @*F9A8W ["B )=3,R(&amp;)A
M&lt;V4["BT)=3@@=&amp;UP+"!I&lt;G$["BL)=3@@=&amp;UP.PH@"B )&lt;&amp;-I7W)E861?8V]N
M9FEG7V)Y=&amp;4H9&amp;5V+" P&gt;#0Q+" F=&amp;UP*3L*( EI9B H(2AT;7 @)B P&gt;#@P
M*2D*0$ @+3&lt;U.2PY("LW-3DL-B! 0 H@"0EI9B H(6)A&lt;V4I"B )"0ER971U
M&lt;FX@+45.3T1%5CL*( E]"BT)8F%S92 F/2!00TE?0D%315]!1$1215-37TE/
M7TU!4TL["BT*+0EP8VE?&lt;F5A9%]C;VYF:6=?8GET92AD978L(#!X-#(L("9I
M&lt;G$I.PH@"B )&lt;')I;G1K*$M%4DY?24Y&amp;3R B04-023H@9F]U;F0@)7,@870@
M,'@E,#1X7&amp;XB+"!D978M/FYA;64L(&amp;)A&lt;V4I.PH@"D! ("TW-S,L-R K-S&lt;P
M+#&lt;@0$ *( EF86-P+3YH9'(N&lt;VEG;F%T=7)E(#T@04-025]&amp;04-07U-)1SL*
M( EF86-P+3YH9'(N;&amp;5N9W1H(#T@&lt;VEZ96]F*'-T&lt;G5C="!A8W!I7V9A8W I
M.PH@"69A8W M/FEN=%]M;V1E;" ]($%#4$E?5DE!7TE.5%]-3T1%3#L*+0EF
M86-P+3YS8VE?:6YT(#T@:7)Q.PHK"69A8W M/G-C:5]I;G0@/2!D978M/FER
M&lt;3L*( EF86-P+3YS;6E?8VUD(#T@8F%S92 K($%#4$E?5DE!7U--25]#340[
M"B )9F%C&lt;"T^86-P:5]E;F%B;&amp;4@/2!!0U!)7U9)05]!0U!)7T5.04),13L*
M( EF86-P+3YA8W!I7V1I&lt;V%B;&amp;4@/2!!0U!)7U9)05]!0U!)7T1)4T%"3$4[
!"@``
`
end


-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at http://www.tux.org/lkml/

</body></email><email><emailId>20000513165831</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-05-13 16:58:31-0400</timestampReceived><subject>[Acpi] Re: [PATCH] PCI quirk for ACPI devices (fwd)</subject><body>

&gt;From the lkml.

   Simon

---------- Forwarded message ----------
Date: Sat, 13 May 2000 14:41:43 +0200
From: Martin Mares &lt;mj@suse.cz&gt;
Cc: Linux kernel mailng list. &lt;linux-kernel@vger.rutgers.edu&gt;
Subject: Re: [PATCH] PCI quirk for ACPI devices

Hello!

&gt; this is updated PCI quirk for ACPI devices.
&gt; Changes from previous post:
&gt;         - fixup type changed PCI_FIXUP_FINAL -&gt; PCI_FIXUP_HEADER;
&gt;         - added IRQ setting for Intel and VIA devices;

   I'm not sure at all how does ACPI IRQ routing work on machines other than
PC's or even on SMP PC's. Doing things like `dev-&gt;irq = 9' in platform independent
code smells of problems.

   You should either decide ACPI is not used outside the PC world and move the
quirks to arch/i386/pci-pc.c or do the IRQ fixups in the ACPI driver which is
i386 specific as well.

&gt; Also one question:
&gt;         why dev-&gt;irq != dev-&gt;irq_resource[0].start in pci_dev structure ?
&gt;         IMHO it cause some ugly lines of code in drivers supporting both PCI
&gt;         and ISA PnP devices (look at /linux/drivers/char/serial.c for example).

   It's basically because I wanted to avoid keeping track of two IRQ number
variables in the core code and the simplification of such combo drivers is
too small to outweigh the core changes.

				Have a nice fortnight
-- 
Martin `MJ' Mares &lt;mj@ucw.cz&gt; &lt;mj@suse.cz&gt; http://atrey.karlin.mff.cuni.cz/~mj/
"A bug in the code is worth two in the documentation."

-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at http://www.tux.org/lkml/

</body></email><email><emailId>20000514030441</emailId><senderName>Dieter =?iso-8859-1?Q?N=FCtzel?=</senderName><senderEmail>dieter.nuetzel@myokay.net</senderEmail><timestampReceived>2000-05-14 03:04:41-0400</timestampReceived><subject>Re: [Acpi] ACPI now works on Irongate C4 but huge slow down with pppd?!</subject><body>

Andy Henroid wrote:

&gt; --- Dieter NÃ¼tzel &lt;dieter.nuetzel@myokay.net&gt; wrote:
&gt;
&gt; &gt; System can power down normally and sleep wen I do
&gt; &gt; "echo 0|1 &gt;
&gt; &gt; /proc/sys/acpi/sleep".
&gt; &gt; But after the system goes sleeping I have to press
&gt; &gt; the poweron button to
&gt; &gt; wake it up again. Now it goes directly to poweroff?
&gt; &gt; :-(
&gt;
&gt; Hmm..  I wonder if that is bounce?  (physical,
&gt; electrical, etc.)  You can test this by
&gt; rebooting without acpid, then
&gt;
&gt;   # turn the power button event on
&gt;   echo 0x100 &gt; /proc/sys/acpi/pm1_enable
&gt;   # wait for the power button event
&gt;   cat /proc/sys/acpi/event
&gt;   # in another window or console, initiate sleep
&gt;   echo 1 &gt; /proc/sys/acpi/sleep
&gt;
&gt; Now, what do you get back from the "cat" ?
&gt; You should see a single line
&gt;
&gt;   0x00000100 0x00000000 0x1
&gt;          ^                ^
&gt;          power button     occured while in S1
&gt;
&gt; If you get back multiple lines, that could
&gt; very well be bounce and we'll have to see
&gt; about fixing that in software.  If you
&gt; don't see "0x1" (occurred during S1) that
&gt; would also be a problem.

SunWave1&gt;echo 0x100 &gt;/proc/sys/acpi/pm1_enable

SunWave1&gt;cat /proc/sys/acpi/event
0x00000100 0x00000000 0x0
0x00000100 0x00000000 0x0
0x00000100 0x00000000 0x0
0x00000100 0x00000000 0x0
0x00000100 0x00000000 0x0

I get only one line per power button press (I pressed it 5 times ---
right, I guess).
But 0x0 is wrong?

&gt; &gt; Second.
&gt; &gt;
&gt; &gt; After the acpid has started I get only ~1 KB/sec
&gt; &gt; with pppd. My ppp
&gt; &gt; connections are so slow that I can't use them
&gt; &gt; together with acpid
&gt; &gt; running. To solve the situation I have to reboot
&gt; &gt; without starting acpid,
&gt; &gt; again.
&gt;
&gt; Strange.  Unlikely, but it could be possible that
&gt; C-states are interfering with PPP processing
&gt; Ie. your system really isn't idle, it is waiting
&gt; for PPP data, and the latency involved in going
&gt; in and out of C2 or C3 is messing up PPP timeouts.

You are right. See above.

&gt; You could try disabling C-states and see if your
&gt; bandwidth improves.  Add "acpi=no-c2,no-c3" to
&gt; your kernel command line and let us know what
&gt; you see.

Andy,

you are the man!

SunWave1&gt;cat /proc/cmdline
BOOT_IMAGE=linux ro root=803 reboot=warm acpi=no-c2,no-c3
SunWave1&gt;cat /proc/sys/acpi/s5_slp_typ
0x00000001
SunWave1&gt;ps aux | grep acpid
root       146  0.0  0.3  1680  784 ?        S    04:42   0:00 acpid
root       147  0.0  0.1  1484  336 ?        S    04:42   0:00 acpid
root       419  0.0  0.2  1488  512 pts/2    S    05:01   0:00 grep
acpid

ppp is back to normal :-)

Thanks,
	Dieter


--
Dieter NÃ¼tzel
Graduate Student, Computer Science

University of Hamburg
Department of Computer Science
Cognitive Systems Group
Vogt-KÃ¶lln-StraÃe 30
D-22527 Hamburg, Germany

email: nuetzel@kogs.informatik.uni-hamburg.de
@home: dieter.nuetzel@myokay.net

</body></email><email><emailId>20000515175524</emailId><senderName>"Timur Tabi"</senderName><senderEmail>ttabi@interactivesi.com</senderEmail><timestampReceived>2000-05-15 17:55:24-0400</timestampReceived><subject>[Acpi] ACPI, 2.3.x kernel, and INT 15 extensions</subject><body>

Could someone explain to me the relationship between the ACPI code in the
2.3.x kernels and the INT 15 extension?  First off, which INT 15 extension
are we talking about, E820?  If so, I noticed that the information from E820
is obtained first in setup.S and then dumped into a memory map.  Is this
done ONLY for ACPI support, or is there another reason?  Also, what kind of
"memory holes" are we talking about?  I've only seen reference to the
640k-1MB hole, are there other holes?

I only need to learn about the memory layout, not ACPI as a whole, which is
why I little reluctant to spend days pouring over the source code and ACPI
spec.  I'd appreciate anyone's indulgence in this matter.

--
Timur Tabi - ttabi@interactivesi.com
Interactive Silicon - http://www.interactivesi.com

</body></email><email><emailId>20000515201941</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-15 20:19:41-0400</timestampReceived><subject>[Acpi] Re: ACPI, 2.3.x kernel, and INT 15 extensions</subject><body>

"Timur Tabi" writes:
&gt;Could someone explain to me the relationship between the ACPI code in the
&gt;2.3.x kernels and the INT 15 extension?  First off, which INT 15 extension
&gt;are we talking about, E820?

Correct.

&gt;If so, I noticed that the information from E820
&gt;is obtained first in setup.S and then dumped into a memory map.  Is this
&gt;done ONLY for ACPI support, or is there another reason?

E820 support in the Linux kernel was originally done without ACPI in mind
at all -- it was just the most reliable way to detect large amounts of
memory in a machine.  It is also required on machines with memory holes
to boot reliably -- what if the kernel was copied into, or partially
into, a hole?  Oops!

&gt;Also, what kind of
&gt;"memory holes" are we talking about?  I've only seen reference to the
&gt;640k-1MB hole, are there other holes?

There can be arbitrary holes, at the hardware vendor's discretion.

&gt;I only need to learn about the memory layout, not ACPI as a whole, which is
&gt;why I little reluctant to spend days pouring over the source code and ACPI
&gt;spec.  I'd appreciate anyone's indulgence in this matter.

Then don't bother with the ACPI "specification".  I don't know where to
get the original spec for the E820 extension, but I'm pretty sure that
it's not the ACPI spec.  Have you searched Intel's developer web site?
Read Ralph Brown's interrupt list?  E820 is really only tangentially
related to ACPI in that it helps us find the ACPI tables.  Beyond
that, ACPI really doesn't care about it.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000516202630</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-05-16 20:26:30-0400</timestampReceived><subject>Re: [Acpi] ECs improperly limited in acpica</subject><body>

--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:

&gt; Looks perfectly sane to me.
[snip]
&gt; 00003771:             minbase 0x66, maxbase 0x66,
&gt; align 0x1, count 0x1
&gt; 00003771:             Bad checksum 0x9d, should be 0

Hmm.. I wonder if the problem is this bad checksum?

&gt; (Andy, if you want more than that, you have
&gt; my entire EC0 definition in an earlier email
&gt; from when we were talking about the suspend
&gt; key handling on my machine, which is done by
&gt; EC0.  This explains, in part, my interest in
&gt; getting ECs working...)

OK, the current EC driver is really only to do
battery and thermal.  It will need to be grown
to support button handling.  In any case, I
will take a closer look and see what the source
of your problem is.

&gt; Here's a snippet from the trace where I see
&gt; the complaint:
&gt; 
&gt; ....
&gt; acpid: AmlReadFieldData: OpRegion EmbeddedControl at
&gt; 0000003e width 8
&gt; acpid: evregion-0278: 
&gt; acpid:  19 Entered Function: EvAddressSpaceDispatch
&gt; acpid: evregion-0288: 
&gt; acpid: Dispatch address access region 0x80F3AC8, no
&gt; handler
&gt; acpid: evregion-0289: 
&gt; acpid:  19 Exiting Function: EvAddressSpaceDispatch,
&gt; AE_EXIST
&gt; acpid:  iefread-0116: 
&gt; acpid: AmlReadFieldData: **** Unknown OpRegion
&gt; SpaceID 3
&gt; acpid: OsdBreakpoint: Fatal error encountered

The problem is EcInit failed so it doesn't get a
chance to register an address space handler for
OpRegions of type 3 (embedded-controller).  When the
interpreter attempts to access an EC OpRegion,
it fails.

&gt; Because I see in
&gt; acpica/control/ec/ec.c:EcInitialize()
&gt; the line
&gt;     FUNCTION_TRACE("EcInitialize");
&gt; I expected to be able to search for EcInitialize in
&gt; the
&gt; trace output, but
&gt; [johnsonm@bastable acpid]$ grep EcInit acpitrace.ec
&gt; [johnsonm@bastable acpid]$ 
&gt; 
&gt; Does that support my analysis?

Hmm...  EcInit should be called from acpid/bm.c
Remember to turn on full debug output (acpid -dt)

&gt; Even if ACPI 2.0 supports, say, PowerPC devices
&gt; with no I/O space at all?
&gt; 
&gt; &gt;A memory mapped interface would be too costly
&gt; &gt;for an EC.
&gt; 
&gt; Why?  How could memory mapping be more costly
&gt; than I/O mapping?

I'm definitely no hardware guy but I do know
that DMA, bus mastering, etc. cost you.  Check
out the divergence between USB OHCI and UHCI
to see an example of favoring I/O, presumably
for cost.

&gt; &gt;And even if someone did implement a
&gt; &gt;mem-mapped EC, they would be foolish to use the
&gt; &gt;standard EC protocol to access it.
&gt; 
&gt; Why?

The EC protocol is a mess.  It requires polling
and well-known delays in order to work.  There
is a way to make the EC interrupt (GPE) driven,
but it was all but unworkable on my test systems.

&gt; If they wanted to use existing hardware on a
&gt; non-intel machine, wouldn't memory-mapped
&gt; access be the cheapest and easiest way to do
&gt; it?

ACPI support necessitates changes down to the
processor and chipset level.  The EC is a
small issue comparatively.  Another architecture
could easily roll their own interface to batteries,
thermal, etc. and expose it through AML.


-Andy


__________________________________________________
Do You Yahoo!?
Send instant messages &amp; get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

</body></email><email><emailId>20000516215542</emailId><senderName>Aki M Laukkanen</senderName><senderEmail>amlaukka@cc.helsinki.fi</senderEmail><timestampReceived>2000-05-16 21:55:42-0400</timestampReceived><subject>[Acpi] acpid troubles on BP6</subject><body>

Just toying with the ACPI stuff but no go. This system is

Linux stellar.pp.htv.fi 2.3.99-pre9 #1 SMP

running bp6_qq01b BIOS. The actual version of kernel is pre9-2.

dmesg:
ACPI: "ABIT" found at 0x000f7550
apm: BIOS version 1.2 Flags 0x07 (Driver version 1.13)
apm: disabled - APM is not SMP safe.                                                     

acpid -d output attached.
acpidmp output attached.

-- 
D.

["acpid" (TEXT/PLAIN)]

acpid: started
acpid: FACP loaded from /proc/sys/acpi/
acpid: DSDT loaded from /proc/sys/acpi/
acpid: Parsing Methods:
acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c1ce4 [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c2174 [_CRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c2624 [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c2644 [_CRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c26a4 [_PRT] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c35fc [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c3aec [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c3b0c [_PRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c3b2c [_DIS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c3b4c [_CRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c3b6c [_SRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c48dc [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c48fc [_PRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c491c [_DIS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c493c [_CRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c495c [_SRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c568c [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c56ac [_PRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c56cc [_DIS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c56ec [_CRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c570c [_SRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c643c [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c645c [_PRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c647c [_DIS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c649c [_CRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c64bc [_SRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c81c4 [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c81e4 [_DIS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c8204 [_CRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c8244 [_SRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c8f94 [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c8fb4 [_DIS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c8fd4 [_CRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c9014 [_SRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c9afc [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c9b1c [_DIS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c9b3c [_CRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c9b7c [_SRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80ca644 [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80ca664 [_DIS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80ca684 [_CRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80ca6c4 [_SRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c8d6c [CKID] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80cb414 [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80cb434 [_DIS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80cb454 [_CRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80cb494 [_SRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80cbf7c [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80cbf9c [_DIS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80cbfbc [_CRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80cbffc [_SRS] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80ccac4 [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80ccf54 [_STA] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c08fc [_PSV] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c091c [_CRT] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c093c [_TMP] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c095c [_SCP] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80c097c [STMP] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80cd994 [ENF1] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: dsobject-0089: 
acpid: DsInitOneObject: Method 0x80cd9b4 [EXF1] parse failed! AE_NULL_OBJECT
acpid: OsdBreakpoint: Fatal error encountered

acpid: 
76 Control Methods found and parsed
acpid: nsapinam-0093: 
acpid: **** ACPI Namespace successfully loaded at root 0x0x809bb74
acpid: S0 SLP_TYP (0x0505)
acpid: S1 SLP_TYP (0x0404)
acpid: S2 not supported
acpid: S3 not supported
acpid:   cmsize-0087: 
acpid: CmGetSimpleObjectSize: Unsupported Reference opcode=0x0 in object 0x80ce5c8
acpid: OsdBreakpoint: Fatal error encountered

acpid: S4 not supported
acpid:   cmsize-0087: 
acpid: CmGetSimpleObjectSize: Unsupported Reference opcode=0x0 in object 0x80ce850
acpid: OsdBreakpoint: Fatal error encountered

acpid: S5 not supported
acpid: P_BLK 0 @ 0x0000:0
acpid: P_BLK 1 @ 0x0000:0
acpid: no usable processor block
acpid: exiting

["log.gz" (APPLICATION/octet-stream)]

</body></email><email><emailId>20000517075332</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-17 07:53:32-0400</timestampReceived><subject>[Acpi] Re: ECs improperly limited in acpica</subject><body>

Andy Henroid writes:
&gt;Hmm.. I wonder if the problem is this bad checksum?

Not unless they added checksum calculation in this
last version of acpica; remember I looked for it in
the first place and you said that correctly-calculated
checksums were nearly unheard-of, which was why there
was no resource descriptor checksum calculation in
acpica.

[johnsonm@bastable acpid]$ grep -i checksum acpitrace.ec
acpid:  03 Entered Function: TbVerifyTableChecksum
acpid:  03 Exiting Function: TbVerifyTableChecksum, AE_OK
acpid:  03 Entered Function: TbVerifyTableChecksum
acpid:  03 Exiting Function: TbVerifyTableChecksum, AE_OK

Certainly none noted in the trace...

Frankly, I'm not surprised, on reflection, that checksums
on resource descriptors aren't often there -- when, as
often happens, a template resource descriptor buffer has
details filled in with AML code, it seems a waste of space
to write AML code to carefully construct a checksum value
that is then checked in the calling code...

&gt;OK, the current EC driver is really only to do
&gt;battery and thermal.  It will need to be grown
&gt;to support button handling.  In any case, I
&gt;will take a closer look and see what the source
&gt;of your problem is.

But I haven't tried to add any button handling
yet, for the moment just using the EC driver to
do anything would be a start.

&gt;The problem is EcInit failed so it doesn't get a
&gt;chance to register an address space handler for
&gt;OpRegions of type 3 (embedded-controller).  When the
&gt;interpreter attempts to access an EC OpRegion,
&gt;it fails.

Would you like me to send you the entire trace from
acpid without my modifications to bm.c, just the #if 0
changed to #if 1?

&gt;Hmm...  EcInit should be called from acpid/bm.c
&gt;Remember to turn on full debug output (acpid -dt)

I did!

Remember, with an unaltered acpid, we never got to
EcInitialize because of the failure in BmInitialize.
We never returned from BmInitialize; it halted after
the error that I quoted before:
acpid: AmlReadFieldData: **** Unknown OpRegion SpaceID 3
The fact that it failed when trying to access the
EC from within BmInitialize was what made me think
that it wanted EcInitialize called first.  (Silly me...)

&gt;No, actually BmInitialize should be called first
&gt;followed by EcInitialize, BtInitialize (battery),
&gt;TzInitialize (thermal).  Each of the components
&gt;(EC, battery, thermal) then register with the
&gt;bus manager (Bm) and AddDevice is called for each
&gt;instance of battery, EC, or thermal zone found.
&gt;
&gt;This architecture is very plug-n-play-like.

Well, I understand now that that is what is intended,
but the fact that BmInitialize is failing because
the handler for OpRegion SpaceID 3 has not yet been
registered leads me to think that the architecture
is a little convoluted.  :-)


Thanks for the explanation about why you think that
the EC will only ever be accessed via I/O space.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000517211121</emailId><senderName>Patrick Dreker</senderName><senderEmail>patrick@dreker.de</senderEmail><timestampReceived>2000-05-17 21:11:21-0400</timestampReceived><subject>[Acpi] acpid-051000 Compilation Failure</subject><body>

Hello...

I just downloaded acpid-051000.

After doing ./configure and make I get

gcc -DHAVE_CONFIG_H -I. -I. -I../../.. -I../../../acpid \
                -I../../../acpica/subsystem/include -g -O2 -c evglock.c -o evglock.o
evglock.c: In function `EvGlobalLockHandler':
evglock.c:66: Invalid `asm' statement:
evglock.c:66: fixed or forbidden register 2 (cx) was spilled for class CREG.
evglock.c: In function `EvAcquireGlobalLock':
evglock.c:134: Invalid `asm' statement:
evglock.c:134: fixed or forbidden register 2 (cx) was spilled for class CREG.
evglock.c: In function `EvReleaseGlobalLock':
evglock.c:196: Invalid `asm' statement:
evglock.c:196: fixed or forbidden register 2 (cx) was spilled for class CREG.
make[4]: *** [evglock.lo] Error 1
make[4]: Leaving directory \
`/usr/local/src/acpid-051000/acpica/subsystem/events'make[3]: *** [all-recursive] \
Error 1 make[3]: Leaving directory `/usr/local/src/acpid-051000/acpica/subsystem'
make[2]: *** [all-recursive] Error 1
make[2]: Leaving directory `/usr/local/src/acpid-051000/acpica'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory `/usr/local/src/acpid-051000'
make: *** [all-recursive-am] Error 2
Exitcode 2

I tried on two different machines with identical results.
My system is Debian 2.2 (frozen) aka potato with glibc2.1. Compiler is
gcc 2.95.2. Kernel is 2.3.99-pre9-2.

Any hints or suggestions?
-- 
Patrick Dreker (patrick@dreker.de)
---------------------------------------------------------------
GPG (PGP5) Key: wwwkeys(.de).pgp.net ID: 0xE679A27A
Fingerprint: 948C 626C 3306 8AAF 2DF5  7EC4 A29F 4B40 E679 A27A


</body></email><email><emailId>20000519112602</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-05-19 11:26:02-0400</timestampReceived><subject>[Acpi] Re: Organisational stuff and the APIs</subject><body>

I wrote:
&gt;Simon Richter writes:
&gt;&gt;For the binary vs. text stuff: I can see your point. I'll try to switch
&gt;&gt;server.c (and libacpi) over to it, since only one request (sleep) has been
&gt;&gt;implemented yet, this shouldn't be too difficult. I still expect code to
&gt;&gt;grow significantly, though.
&gt;
&gt;Can I please request that you post a formal definition of that text
&gt;protocol here before you set it in stone?  If you don't want your
&gt;protocol to limit you in the future, peer review is the only way to
&gt;avoid that.

Any progress on this?

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000520142105</emailId><senderName>Crispin Flowerday</senderName><senderEmail>cehf2@hermes.cam.ac.uk</senderEmail><timestampReceived>2000-05-20 14:21:05-0400</timestampReceived><subject>Re: [Acpi] MS5169</subject><body>

&gt; acpianalyze: found Processor #1 \_PR_.CPU1 (PBLK 0x00004010 - 0x00004016)
&gt; acpianalyze: found S0 support (SLP_TYP 0x4 0x0)
&gt; acpianalyze: found S1 support (SLP_TYP 0x3 0x0)
&gt; acpianalyze: found S5 support (SLP_TYP 0x0 0x0)
&gt;                                              ^
&gt;                                     does this look suspicious?

There seems to be a bug in apicd causing it not to parse S states with
0x0 0x0 as their value. A patch was posted a while back but as far as I
know Andy has not merged/checked it.

Andy - for your information acpid -d on my Abit BH6 gives the following
output:

acpid: started
acpid: FACP loaded from /proc/sys/acpi/
acpid: DSDT loaded from /proc/sys/acpi/
acpid: Parsing Methods:
acpid: 
60 Control Methods found and parsed
acpid: nsapinam-0093: 
acpid: **** ACPI Namespace successfully loaded at root 0x0x8096fe4
acpid: S0 SLP_TYP (0x0505)
acpid: S1 SLP_TYP (0x0404)
acpid: S2 not supported
acpid: S3 not supported
acpid:   cmsize-0087: 
acpid: CmGetSimpleObjectSize: Unsupported Reference opcode=0x0 in object
0x80bd908
acpid: OsdBreakpoint: Fatal error encountered

acpid: S4 not supported
acpid:   cmsize-0087: 
acpid: CmGetSimpleObjectSize: Unsupported Reference opcode=0x0 in object
0x80bdb90
acpid: OsdBreakpoint: Fatal error encountered

acpid: S5 not supported
acpid: P_BLK 1 @ 0x4010:6
(debug) quit
acpid: exiting
 nsutils-0488: *** Success: Entire namespace and objects deleted
tbremove-0167: *** Error: _CmFree: Trying to delete a NULL address.
tbremove-0167: *** Error: _CmFree: Trying to delete a NULL address.
 cmalloc-0340: Outstanding allocations:
 cmalloc-0348: 0x8093208 Len 0074     tbget-146
 cmalloc-0348: 0x8095130 Len 1E65     tbget-146
 cmalloc-0387: Total number of unfreed allocations = 2
acpid: OsdWaitSemaphore: semop: Identifier removed
acpid: OsdSignalSemaphore: semop: Invalid argument


I assume that the errors in the setup stage are caused by the parsing
problem in acpid, while the other program to parse acpid namespcae gives
the correct values of 0x0 for S4 and S5. (acpidmp DSDT | acpianalyze)

 -- 
Crispin

*Windows leads to anger, Anger leads to hate, Hate leads to Linux*

</body></email><email><emailId>20000523025516</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-05-23 02:55:16-0400</timestampReceived><subject>Re: [Acpi] acpid update (052200)</subject><body>

On Mon, 22 May 2000, James Mastros wrote:

&gt; &gt; A new version of acpid is available now from
&gt; &gt; http://www.geocities.com/SiliconValley/Hardware/3165/

&gt; Minor procedureal question: are these in sync with the phobos CVS tree?
&gt; (IE which should I track?)

For acpid and pmtools, the phobos CVS tree is only provided as an upgrade
convenience, the version on Andy's site is the definitive. CVS just makes
creating patches easier here. For acpipolicy, CVS is the current version.

I usually update the CVS tree after a couple of hours, should be done when
the binaries have shown up on the download page on phobos and there are no
more locks in the repository. :-)

You can subscribe to acpi-cvs if you want to be notified of checkins (I
haven't added this to the main page because the list tends to cause a high
system load (60-80) when huge changes are committed (it's still a 486...).

   Simon

-- 
PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

</body></email><email><emailId>20000524012812</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-05-24 01:28:12-0400</timestampReceived><subject>[Acpi] Re: Linux 2.3.99pre9-2 JOB list (fwd)</subject><body>

&gt;From the lkml.

   Simon

---------- Forwarded message ----------
Date: 23 May 2000 11:50:19 -0700
From: Linus Torvalds &lt;torvalds@transmeta.com&gt;
Subject: Re: Linux 2.3.99pre9-2 JOB list

In article &lt;E12uDoD-000369-00@the-village.bc.nu&gt;,
Alan Cox  &lt;alan@lxorguk.ukuu.org.uk&gt; wrote:
&gt;
&gt;Different sort of flood. When the resume kicks in the IRQ line is locked
&gt;solid and the box hangs. If I disable that IRQ line before suspend and 
&gt;put it back on resume after setting the controller up its happier but not
&gt;perfect.

I suspect the right behaviour is to have something like

	/*
	 * Sleep sequence for ACPI/APM/whatever
	 */
	pm_callback(PM_SLEEP);
	cli();
	/* real sleep here */
	pm_callback(PM_WAKEUP);
	sti();

so that we have all interrupts disabled until _all_ devices have been
re-initialized again. Otherwise we get tons of strange ordering things.

The reason I don't like disable/enable_irq here is that if each device
driver does a "disable_irq()"/"enable_irq()", then you cannot know in
your sleep routines whether interrupts are enabled or not.  Imagine that
you have a disk controller and a mouse sharing the same irq.  Depending
on which order they happen to have in the PM callback list, either of
the two will run with interrupts disabled before it goes to sleep, and
they won't be enabled until both have woken up. So wakeup behaviour is
repeatable, but the behaviour on sleep is dependent on random factors.

Imagine that the harddisk needs its interrupts in order to go to sleep
nicely (for example, doing a internal "sync everything" and needing the
interrupt to tell when it's all done).  And imagine that the mouse
disabled the irq before we even get to the harddisk driver sleep
function..  BAD.

With my suggested "global" irq setup above, you at least have totally
repeatable behaviour.  It will work the same whether there are shared
interrupts or not.  Which will make it less likely that we'll have
problems that only happen on certain machines - the nasty kind to
debug.. We may have other problems (it requires that all devices can be
re-initialized without interrupts, but that should be fine), but at
least they'll be more repeatable.

		Linus


-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at http://www.tux.org/lkml/

</body></email><email><emailId>20000524193004</emailId><senderName>Luca Del Vecchio</senderName><senderEmail>l.delvecchio@libero.it</senderEmail><timestampReceived>2000-05-24 19:30:04-0400</timestampReceived><subject>[Acpi] Apropos namespace</subject><body>

Hi....
I'm new to this ml, and also I'm new to ACPI....
so please excusme if my questions are too trivial.

I've just downloaded the latest version of acpid (052200), I've compiled it...
everything go all right.
There's still a problem... when I launch acpid it say that:

acpid: started
acpid: ACPI Subsystem version [May 24 2000]
acpid: FACP loaded from /proc/sys/acpi/
acpid:  tbutils-0240: 
acpid: *** Error: Invalid ACPI table checksum
acpid: nsapinam-0058: 
acpid: DSDT is not in memory
acpid: OsdBreakpoint: Fatal error encountered
acpid: cannot load ACPI namespace

my kernel is 2.3.99-pre8 ( and while booting it 
says "ACPI: found PIIX4 at 0x4000) , 
I have a motherboard EPOX KP6-BS with  dual
Pentium II 400MHz, chipset 440BX 

the contents of /proc/sys/acpi is:

/proc/sys/acpi/dsdt
/proc/sys/acpi/enter_lvl2_lat
/proc/sys/acpi/enter_lvl3_lat
/proc/sys/acpi/event
/proc/sys/acpi/facp
/proc/sys/acpi/gpe_enable
/proc/sys/acpi/gpe_level
/proc/sys/acpi/p_blk
/proc/sys/acpi/p_lvl2_lat
/proc/sys/acpi/p_lvl3_lat
/proc/sys/acpi/pm1_enable
/proc/sys/acpi/s0_slp_typ
/proc/sys/acpi/s1_slp_typ
/proc/sys/acpi/s5_slp_typ
/proc/sys/acpi/sleep

I've already patched my BIOS with the latest release... 
the README included says that there was a problem with ACPI unser SCO
Unix... so I thought to upgrade.
But the problem persists

Have you any idea?
I forgot to set some device/parameter? or simply my BIOS or my motherboard are
broken or unsupported?

Thanks

Luca.

</body></email><email><emailId>20000525180238</emailId><senderName>BERNARD Sebastien</senderName><senderEmail>sebastien.bernard@cegetel.fr</senderEmail><timestampReceived>2000-05-25 18:02:38-0400</timestampReceived><subject>[Acpi] Suggestion  about acpi_enable</subject><body>

Since last time I post, I had an idea about acpi_enable.
for now, initialization of the acpi is like this :

check acpi_tables,
map tables
map io ports
set acpi irq

my problems is that setting irq without acpi_enable hangs the machine.
I was wondering why have we got to set the irq while acpi is not enabled ?
Could we remove the request_irq call in the acpi_init and move it to the
acpi_enable function.
Then we add another call to leave the irq in the acpi_disable function and
we have irq used only if acpi is enabled
(like the irq with the NIC cards which is used only when the interface is
up).

What do you think about that ?
I'll try tonight and will give you some feedback after.

</body></email><email><emailId>20000525180745</emailId><senderName>BERNARD Sebastien</senderName><senderEmail>sebastien.bernard@cegetel.fr</senderEmail><timestampReceived>2000-05-25 18:07:45-0400</timestampReceived><subject>[Acpi] Something subttle is avoiding me</subject><body>

I reported some time ago problems with the 440MX chipset from Intel.

I did'nt really look hard at this problem.
I had been able to make acpi work by enabling the acpi in the acpi_init
function.
But then, others things got broken (like NIC card).
I though it was IRQ related, but I checked and all IRQs are the same as if I
boot with acpi=off flag.
Now I don't know what could be wrong.
Do you know some way to get debug information from kernel ?
I'm now scratching my head. I think I have to put again some printk to check
where the hangs happens in the NIC card activation.
I'll have to check.

</body></email><email><emailId>20000526215407</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-05-26 21:54:07-0400</timestampReceived><subject>[Acpi] ACPI docs available</subject><body>

There is documentation available now from Intel's
website which should be of interest to ACPI4Linux

  http://developer.intel.com/technology/iapc/tech.htm

Specifically, check out the "ACPI-CA Documentation
Package v1.0".  This PDF documents the AML
interpreter and ACPI core code currently nestled
inside acpid (in the acpid/acpica/ directory)

-Andy



__________________________________________________
Do You Yahoo!?
Kick off your party with Yahoo! Invites.
http://invites.yahoo.com/

</body></email><email><emailId>20000527150121</emailId><senderName>SÃ©bastien Bernard</senderName><senderEmail>bernarbs@club-internet.fr</senderEmail><timestampReceived>2000-05-27 15:01:21-0400</timestampReceived><subject>Re: [Acpi] 400MX Some good news some bad</subject><body>

Andy Henroid wrote:

&gt; &gt; I just wanted to give some report about my
&gt; &gt; investigation.
&gt; &gt; As I expected, putting the request_irq in the
&gt; &gt; acpi_enable worked for me.
&gt;
&gt; Hmm..  I might be tempted to leave the request_irq
&gt; in acpi_init.  This allows the ACPI driver to detect
&gt; interrupt conflicts when it initializes, rather than
&gt; much later when it goes to turn on ACPI.
&gt;
&gt; If the problem is what I think, this should also
&gt; work
&gt;
&gt;   ...
&gt;   int acpi_enabled = 0;
&gt;   ...
&gt;   static void acpi_irq(...)
&gt;   {
&gt;      if (!acpi_enabled)
&gt;        return;
&gt;      ...
&gt;   }
&gt;   ...
&gt;   static int acpi_enable(...)
&gt;   {
&gt;      ...
&gt;      acpi_enabled = 1;
&gt;      ...
&gt;   }

Nope, according to what I saw, the irq_handler is called in an infinite
loop when irq is set and acpi is not enabled.
So this change won't solve anything (the infinite loop is shorter,
that's all).
Is there a way in linux kernel to announce that we need an irq, that we
accept to share it but we do not set the handler yet.
Something like an irq reservation ?? This would helps to solve the
conlict.

&gt; So, I forget, the ACPI interrupt is being shared
&gt; with your ethernet card?  If so, I would expect a
&gt; lot of interrupts to come in from the ethernet
&gt; card.  Perhaps your ACPI implementation doesn't
&gt; like to be polled (to see if ACPI is the source
&gt; of the interrupt) before it is enabled?  If so,
&gt; the above patch should fix.

No. The irq for the NIC is 10. The irq for acpi is 9. They do not
collide.
Moreover, this driver is ACPI aware for the chip builtin my laptop. It's
running correctly when using the APM.
The behaviour is not the same when acpi. Here's an extract :

static void tulip_up(struct net_device *dev)
{
    ...

    /* Wake the chip from sleep/snooze mode. */
    if (tp-&gt;flags &amp; HAS_ACPI)
        pci_write_config_dword(tp-&gt;pdev, 0x40, 0);
    ...
 }
I tried to remove the ACPI awareness to check if there was a
misbehaviour of the ACPI code.
But I got the same behaviour.
I maybe should post this on the regular kernel mailing list.

&gt;
&gt;
&gt; Let me know.
&gt;
&gt; Thanks,
&gt; Andy
&gt;
&gt; __________________________________________________
&gt; Do You Yahoo!?
&gt; Kick off your party with Yahoo! Invites.
&gt; http://invites.yahoo.com/

</body></email><email><emailId>20000529072350</emailId><senderName>John-Marc Chandonia</senderName><senderEmail>jmc@cmpharm.ucsf.edu</senderEmail><timestampReceived>2000-05-29 07:23:50-0400</timestampReceived><subject>[Acpi] acpi poweroff on k7v?</subject><body>

Hi,
	I'm having a problem with acpi support in the 2.4.0-test1
kernel.  I am using the 052200 acpid (although whether the daemon
is running or not doesn't affect this bug), on an ASUS K7V system.

   The problem:  shutdown gets to the point where it prints
"power off" but does not actually power off the machine.  With acpid
running, a press on the power button is correctly detected and the system
shuts down.  However, when it gets to the point where it should
power off the machine, the screen goes black (but the monitor does
not go into suspend mode) and the machine does not turn off.

    I'm sending a full bug report to Andy, but please let me know if
anybody else has a suggestion!

motherboard:  ASUS K7V
chipset:  VIA KX-133
BIOS:  1005a
vendor:  homemade

Thanks,
JMC
-- 
John-Marc Chandonia (jmc@cmpharm.ucsf.edu)              We're everywhere...
Cohen Lab, University of California San Francisco       for your convenience.
http://yuri.harvard.edu/~jmc                                -- Psi Corps &lt;*&gt;

</body></email><email><emailId>20000422103331</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-22 10:33:31-0400</timestampReceived><subject>[Acpi] random ACPI bugs on Dell Inspiron 7500</subject><body>

I've cleverly worded the subject to avoid assigning blame for the bugs;
I don't know whose fault they are.

Here is what I have seen so far:

 o  Once only, acpid -d blanked the screen and the screeen would not
    come to life again without a complete reboot.  With some random
    key pressing, I managed to do a clean reboot, but didn't know
    that until I saw the fsck show cleanly unmounted filesystems on
    the next boot.  The blanked screen effect wasn't sleeping, because
    pressing the power button did not bring the screen back; normally,
    when I have put the machine to sleep (which I can only do right
    now with the "echo 1 &gt; /proc/sys/acpi/sleep" trick), pressing
    the power button wakes it up properly.

 o  If I press the power button immediately after starting acpid,
    it does a proper shutdown, but if I suspend first (with the
    echo trick mentioned above) and then bring the machine back to
    life with the power button, acpid reports all further presses
    of the power button but doesn't do anything about it.  I would
    guess this is because it is confused about what state the
    machine is in, but I have not investigated further.

 o  The suspend key, which works without any assistance (from text
    mode, anyway) without acpid running, quits working entirely when
    acpid is running.  I would have assumed that it is the sleep
    button, but I guess not.  What event would you expect the suspend
    key to be?  (In my case, the "suspend key" is Fn+ESC.)  I notice
    that acpid does not report any events when this key is pressed;
    I presume that acpid does not enable handling this event.

 o  Entering sleep does not spin down the hard drive.  I don't know
    where this bug lies; when the BIOS suspends the machine, the hard
    drive spins down, but when I use hdparm to try to tell the hard
    drive to spin down, there is no effect.  (This is true whether I
    set it to spin down after a delay or immediately.)

Any suggestions about how to track these down (or implement the suspend
key handling) would be greatly appreciated.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000424220519</emailId><senderName>Tony Hoyle</senderName><senderEmail>tmh@magenta-logic.com</senderEmail><timestampReceived>2000-04-24 22:05:19-0400</timestampReceived><subject>[Acpi] ACPI Problems...</subject><body>

Hi,

Has the ACPI parsing bug been fixed yet?  I notice the CVS tree hasn't
been updated for some time, and I would like to use ACPI on my mobo
(BP6).

Also, I notice that acpi 'power off' doesn't seem to work properly.  I
echo 1 &gt;/proc/sys/acpi/s5_slp_typ, and it
successfully powers off...  for about half an hour, then it powers up
again.  I have switched off all the 'wake up on..'
options in the BIOS.  I'm guessing a BIOS bug rather than an ACPI one,
though.

Tony

</body></email><email><emailId>20000422101809</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-22 10:18:09-0400</timestampReceived><subject>[Acpi] Replacing APM</subject><body>

I've been thinking about what ACPI needs to be able to do to replace
APM for people used to APM under Linux.  As I see it, we need at least:
 o  Lid events
 o  Suspend key(s) handling
 o  Battery status reporting, via
    - CMBatt
    - Smart Battery
Is there anything else missing that people are used to getting with APM
for Linux that ACPI for Linux doesn't yet provide?

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000425090502</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-25 09:05:02-0400</timestampReceived><subject>[Acpi] disassembler enhancements</subject><body>

Has anyone worked on making the disassembler more useful by interpreting
some of the fields that are currently presented only in numeric format?
For example, it would be easier to read Field's FieldFlags and OpRegion's
RegionSpace if they were spelled out in the output.

I'm not sure how to fit this into the architecture.  I have tried two
different approaches to breaking out FieldFlags and haven't been
successful because I tried to do it quickly without grokking the whole
structure...  :-)

Andy, this is your code; any suggestions on how to do this cleanly?  I
am not sure that it makes sense to create fake ops and args for each
of these types of objects.  Perhaps I need a new construct of some
sort?  If acpi_sprint_op could eat following ops, I could do all the
mangling there -- e.g. if FIELD, then eat the following BYTECONST and
print it my own way.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000425094218</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-25 09:42:18-0400</timestampReceived><subject>[Acpi] Re: disassembler enhancements</subject><body>

"Michael K. Johnson" writes:
&gt;I'm not sure how to fit this into the architecture.  I have tried two
&gt;different approaches to breaking out FieldFlags and haven't been
&gt;successful because I tried to do it quickly without grokking the whole
&gt;structure...  :-)

Well, I knew that confessing that I was missing something would make me
find it...  I was missing a single case statement in ns.c; otherwise my
patch worked perfectly.

Andy, what do you think of the attached patch as a way of dealing with
this?  If you like it, wait to apply it, because I'll give you a more
complete patch with more things implemented later.  If you don't like
it, let me know how you would like it changed and I'll change the other
things to fit whatever pattern you suggest.

Thanks,

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/


diff -u --recursive pmtools/acpidisasm/amlop.c pmtools.new/acpidisasm/amlop.c
--- pmtools/acpidisasm/amlop.c	Thu Nov 18 00:33:57 1999
+++ pmtools.new/acpidisasm/amlop.c	Mon Apr 24 22:51:43 2000
@@ -97,7 +97,7 @@
     {AML_DEBUG, "Debug", NULL},
     {AML_FATAL, "Fatal", "bdt"},
     {AML_OPREGION, "OpRegion", "nbtt"},
-    {AML_FIELD, "Field", "pnbF"},
+    {AML_FIELD, "Field", "pnLF"},
     {AML_DEVICE, "Device", "pnP"},
     {AML_PROCESSOR, "Processor", "pnbdbP"},
     {AML_POWERRES, "PowerRes", "pnbwP"},
diff -u --recursive pmtools/acpidisasm/amlop.h pmtools.new/acpidisasm/amlop.h
--- pmtools/acpidisasm/amlop.h	Thu Nov 18 00:33:57 1999
+++ pmtools.new/acpidisasm/amlop.h	Mon Apr 24 22:51:43 2000
@@ -47,6 +47,7 @@
 #define AML_EXTOP 0x005b
 #define AML_FATAL 0x5b32
 #define AML_FIELD 0x5b81
+#define AML_FIELDFLAGS 0x004c
 #define AML_FINDSETLEFTBIT 0x0081
 #define AML_FINDSETRIGHTBIT 0x0082
 #define AML_FROMBCD 0x5b28
@@ -129,6 +130,7 @@
 #define AML_DWORDDATA_ARG 'd'
 #define AML_DATAOBJECT_ARG 'o'
 #define AML_DATAOBJECTLIST_ARG 'O'
+#define AML_FIELDFLAGS_ARG 'L'
 #define AML_FIELDLIST_ARG 'F'
 #define AML_NAMESTRING_ARG 'n'
 #define AML_OBJECTLIST_ARG 'P'
diff -u --recursive pmtools/acpidisasm/amlop.txt pmtools.new/acpidisasm/amlop.txt
--- pmtools/acpidisasm/amlop.txt	Thu Nov 18 00:33:57 1999
+++ pmtools.new/acpidisasm/amlop.txt	Mon Apr 24 22:51:43 2000
@@ -26,6 +26,7 @@
 0x33* ByteList
 0x34* StaticString
 0x35* MethodCall
+0x4c* FieldFlags
 0x5b* ExtOp
 0x5b01 Mutex NameString ByteData
 0x5b02 Event NameString
@@ -46,7 +47,7 @@
 0x5b31 Debug
 0x5b32 Fatal ByteData DWordData TermArg
 0x5b80 OpRegion NameString ByteData TermArg TermArg
-0x5b81 Field PkgLength NameString ByteData FieldList
+0x5b81 Field PkgLength NameString FieldFlags FieldList
 0x5b82 Device PkgLength NameString ObjectList
 0x5b83 Processor PkgLength NameString ByteData DWordData ByteData ObjectList
 0x5b84 PowerRes PkgLength NameString ByteData WordData ObjectList
diff -u --recursive pmtools/acpidisasm/mkaml pmtools.new/acpidisasm/mkaml
--- pmtools/acpidisasm/mkaml	Thu Nov 18 00:33:57 1999
+++ pmtools.new/acpidisasm/mkaml	Mon Apr 24 22:33:57 2000
@@ -22,6 +22,7 @@
 		"TermList"=&gt;"T",
 		"DataObjectList"=&gt;"O",
 		"ObjectList"=&gt;"P",
+		"FieldFlags"=&gt;"L",
 		"FieldList"=&gt;"F",
 		"ByteList"=&gt;"B",
 		"SuperName"=&gt;"s",
diff -u --recursive pmtools/acpidisasm/ns.c pmtools.new/acpidisasm/ns.c
--- pmtools/acpidisasm/ns.c	Mon Apr 24 23:14:36 2000
+++ pmtools.new/acpidisasm/ns.c	Tue Apr 25 11:32:43 2000
@@ -27,6 +27,7 @@
     case AML_DWORDCONST:
     case AML_STRING:
     case AML_STATICSTRING:
+    case AML_FIELDFLAGS:
 
     case AML_NAMEPATH:
     case AML_NAMEDFIELD:
diff -u --recursive pmtools/acpidisasm/parse.c pmtools.new/acpidisasm/parse.c
--- pmtools/acpidisasm/parse.c	Thu Mar 16 03:18:07 2000
+++ pmtools.new/acpidisasm/parse.c	Tue Apr 25 11:37:08 2000
@@ -507,6 +507,13 @@
         state-&gt;pkg_end = acpi_next_pkg_end(state);
         break;
 
+    case AML_FIELDFLAGS_ARG:
+	arg = acpi_alloc_op(AML_BYTECONST);
+	arg-&gt;opcode = AML_FIELDFLAGS;
+	arg-&gt;value.integer = (u32) readb(state-&gt;aml);
+	state-&gt;aml++;
+	break;
+
     case AML_FIELDLIST_ARG:
         if(state-&gt;aml &lt; state-&gt;pkg_end)
         {
@@ -588,6 +595,9 @@
             *arg_count = ACPI_VAR_ARGS;
         }
         break;
+    default:
+	// Forgot to add a case above after modifying amlop.txt and mkaml
+	*((int *)0) = 0;
     }
 
     return arg;
diff -u --recursive pmtools/acpidisasm/util.c pmtools.new/acpidisasm/util.c
--- pmtools/acpidisasm/util.c	Thu Mar 16 03:34:27 2000
+++ pmtools.new/acpidisasm/util.c	Tue Apr 25 11:35:07 2000
@@ -342,6 +342,39 @@
         case AML_ACCESSFIELD:
             size = acpi_safe_sprintf(buffer, buffer_size, 0, "AccessField");
             break;
+
+	case AML_FIELDFLAGS:
+	    {
+		char *access_type, *lock_rule, *update_rule;
+		switch(0xF &amp; (u8) op-&gt;value.integer)
+		{
+		    case 0: access_type = "AnyAcc";
+		    case 1: access_type = "ByteAcc";
+		    case 2: access_type = "WordAcc";
+		    case 3: access_type = "DWordAcc";
+		    case 4: access_type = "BlockAcc";
+		    case 5: access_type = "SMBSendRecvAcc";
+		    case 6: access_type = "SMBQuickAcc";
+		}
+		switch(0x10 &amp; (u8) op-&gt;value.integer)
+		{
+		    case 0: lock_rule = "NoLock";
+		    case 1: lock_rule = "Lock";
+		}
+		switch(0x60 &amp; (u8) op-&gt;value.integer)
+		{
+		    case 0: update_rule = "Preserve";
+		    case 1: update_rule = "WriteAsOnes";
+		    case 2: update_rule = "WriteAsZeros";
+		}
+		size = acpi_safe_sprintf(buffer, buffer_size, 0, 
+		    "AccessType: %s; "
+		    "LockRule: %s; "
+		    "UpdateRule: %s",
+		    access_type, lock_rule, update_rule);
+	    }
+	    break;
+
         case AML_BYTELIST:
 	    {
 		    struct acpi_extra_op *extra

</body></email><email><emailId>20000425080638</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-25 08:06:38-0400</timestampReceived><subject>[Acpi] Re: Replacing APM</subject><body>

Andy Henroid writes:
&gt;To be a complete replacement for APM, ACPI
&gt;additionally needs
&gt;  o Suspend to RAM (S1, S2, or S3 depending)

But we already have this; I was concentrating on what we don't have.

&gt;  o Suspend to disk (S4)

As nice as that is, and as much as I want it, most laptops do not seem
to have this working reliably under Linux with APM so I count this as
less critical.  It's at least far lower on my priority list than suspend
to RAM.  It's also much harder to get right.

&gt;  o Video blank

Again, my laptop blanks the video.  (Heh, even when it's not supposed
to sometimes, as you saw from my bug report)  What's missing here?

&gt;The kernel-side support for Lid is already
&gt;there.  It's just a matter of looking up which
&gt;GPE correlates to the Lid for your system and
&gt;enabling it.

Yes, I don't really care where the work needs to be done -- I'm just
trying to list the jobs and prioritize them a bit.

&gt;Oh, and to my list let me add battery status,
&gt;of course.

Of course.  It (in both forms) was on the list to which you were
responding.  Unless the list you are referring to is the already
complete list.

BTW, how important is it to implement the SMBus functionality?  If
it is important, it doesn't look too hard; the only thing I'm worried
about is bus enumeration.  The i2c code in the kernel has what looks
like a nice interface that we can use for acpid and which will easily
convert to a kernel interface once the aml interpreter moves into the
kernel.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000425192436</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-25 19:24:36-0400</timestampReceived><subject>[Acpi] Re: acpid and pmtools release</subject><body>

Andy Henroid writes:
&gt;New versions of acpid and pmtools are available

Way cool!  Re-indented to make patch application difficult!  ;-)

Enclosed please find the latest disassembler enhancement patch,
since I didn't see any objection to the way I did it before.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

diff -u --recursive pmtools/acpidisasm/amlop.txt pmtools.new/acpidisasm/amlop.txt
--- pmtools/acpidisasm/amlop.txt	Tue Apr 25 16:37:11 2000
+++ pmtools.new/acpidisasm/amlop.txt	Tue Apr 25 21:04:57 2000
@@ -16,7 +16,7 @@
 0x10 Scope PkgLength Name TermList
 0x11 Buffer PkgLength TermArg ByteList
 0x12 Package PkgLength ByteData DataObjectList
-0x14 Method PkgLength Name ByteData TermList
+0x14 Method PkgLength Name MethodFlags TermList
 0x2d* NamePath
 0x2e* DualNamePath
 0x2f* MultiNamePath
@@ -26,8 +26,12 @@
 0x33* ByteList
 0x34* StaticString
 0x35* MethodCall
+0x4c* FieldFlags
+0x4d* MethodFlags
+0x52* RegionSpace
+0x53* SyncFlags
 0x5b* ExtOp
-0x5b01 Mutex Name ByteData
+0x5b01 Mutex Name SyncFlags
 0x5b02 Event Name
 0x5b12 CondRefOf SuperName SuperName
 0x5b13 CreateField TermArg TermArg TermArg Name
@@ -45,8 +49,8 @@
 0x5b30 Revision
 0x5b31 Debug
 0x5b32 Fatal ByteData DWordData TermArg
-0x5b80 OpRegion Name ByteData TermArg TermArg
-0x5b81 Field PkgLength NameString ByteData FieldList
+0x5b80 OpRegion Name RegionSpace TermArg TermArg
+0x5b81 Field PkgLength NameString FieldFlags FieldList
 0x5b82 Device PkgLength Name ObjectList
 0x5b83 Processor PkgLength Name ByteData DWordData ByteData ObjectList
 0x5b84 PowerRes PkgLength Name ByteData WordData ObjectList
diff -u --recursive pmtools/acpidisasm/mkaml pmtools.new/acpidisasm/mkaml
--- pmtools/acpidisasm/mkaml	Tue Apr 25 16:37:11 2000
+++ pmtools.new/acpidisasm/mkaml	Tue Apr 25 21:08:36 2000
@@ -12,22 +12,27 @@
 $AML_LNOT_HASH_OFFSET = 19;
 $AML_EXTOP_HASH_OFFSET = 22;
 
-%arg_to_code = ("PkgLength"=&gt;"p",
-		"Name"=&gt;"N",
-		"NameString"=&gt;"n",
-		"ByteData"=&gt;"b",
-		"WordData"=&gt;"w",
+# Keep this alphabetical to make it easier to add new items
+%arg_to_code = ("ByteData"=&gt;"b",
 		"DWordData"=&gt;"d",
-		"TermArg"=&gt;"t",
+		"Target"=&gt;"l",
+		"NameString"=&gt;"n",
 		"DataObject"=&gt;"o",
-		"TermList"=&gt;"T",
+		"PkgLength"=&gt;"p",
+		"SuperName"=&gt;"s",
+		"TermArg"=&gt;"t",
+		"WordData"=&gt;"w",
+		"AsciiCharList"=&gt;"A",
+		"ByteList"=&gt;"B",
+		"FieldList"=&gt;"F",
+		"FieldFlags"=&gt;"L",
+		"MethodFlags"=&gt;"M",
+		"Name"=&gt;"N",
 		"DataObjectList"=&gt;"O",
 		"ObjectList"=&gt;"P",
-		"FieldList"=&gt;"F",
-		"ByteList"=&gt;"B",
-		"SuperName"=&gt;"s",
-		"Target"=&gt;"l",
-		"AsciiCharList"=&gt;"A");
+		"RegionSpace"=&gt;"R",
+		"SyncFlags"=&gt;"S",
+		"TermList"=&gt;"T");
 
 @opcode_to_name = ();
 @opcode_to_args = ();
diff -u --recursive pmtools/acpidisasm/ns.c pmtools.new/acpidisasm/ns.c
--- pmtools/acpidisasm/ns.c	Tue Apr 25 16:37:11 2000
+++ pmtools.new/acpidisasm/ns.c	Tue Apr 25 21:09:32 2000
@@ -27,6 +27,10 @@
 	case AML_DWORDCONST:
 	case AML_STRING:
 	case AML_STATICSTRING:
+	case AML_FIELDFLAGS:
+	case AML_REGIONSPACE:
+	case AML_METHODFLAGS:
+	case AML_SYNCFLAGS:
 
 	case AML_NAMEPATH:
 	case AML_NAMEDFIELD:
diff -u --recursive pmtools/acpidisasm/parse.c pmtools.new/acpidisasm/parse.c
--- pmtools/acpidisasm/parse.c	Tue Apr 25 16:37:11 2000
+++ pmtools.new/acpidisasm/parse.c	Tue Apr 25 21:12:51 2000
@@ -369,6 +369,27 @@
 		arg-&gt;opcode = AML_NAMEPATH;
 		arg-&gt;value.name = acpi_next_namestring(state);
 		break;
+
+	case AML_FIELDFLAGS_ARG:
+		arg-&gt;opcode = AML_FIELDFLAGS;
+		arg-&gt;value.integer = (u32) readb(state-&gt;aml);
+		state-&gt;aml++;
+		break;
+	case AML_REGIONSPACE_ARG:
+		arg-&gt;opcode = AML_REGIONSPACE;
+		arg-&gt;value.integer = (u32) readb(state-&gt;aml);
+		state-&gt;aml++;
+		break;
+	case AML_METHODFLAGS_ARG:
+		arg-&gt;opcode = AML_METHODFLAGS;
+		arg-&gt;value.integer = (u32) readb(state-&gt;aml);
+		state-&gt;aml++;
+		break;
+	case AML_SYNCFLAGS_ARG:
+		arg-&gt;opcode = AML_SYNCFLAGS;
+		arg-&gt;value.integer = (u32) readb(state-&gt;aml);
+		state-&gt;aml++;
+		break;
 	}
 }
 
@@ -500,6 +521,10 @@
 	case AML_ASCIICHARLIST_ARG:
 	case AML_NAMESTRING_ARG:
 	case AML_NAME_ARG:
+	case AML_REGIONSPACE_ARG:
+	case AML_FIELDFLAGS_ARG:
+	case AML_METHODFLAGS_ARG:
+	case AML_SYNCFLAGS_ARG:
 		// constants, strings, and namestrings are all the same size
 		arg = acpi_alloc_op(AML_BYTECONST);
 		if(arg)
@@ -601,6 +626,9 @@
 			*arg_count = ACPI_VAR_ARGS;
 		}
 		break;
+	default:
+		// Missing a case above after modifying amlop.txt and mkaml
+		*((int *)0) = 0;
 	}
 
 	return arg;
diff -u --recursive pmtools/acpidisasm/util.c pmtools.new/acpidisasm/util.c
--- pmtools/acpidisasm/util.c	Tue Apr 25 16:37:11 2000
+++ pmtools.new/acpidisasm/util.c	Tue Apr 25 21:20:06 2000
@@ -352,6 +352,81 @@
 						 0,
 						 "AccessField");
 			break;
+
+		case AML_FIELDFLAGS:
+		{
+			char *access_type, *lock_rule, *update_rule;
+			switch(0xF &amp; (u8) op-&gt;value.integer)
+			{
+				case 0: access_type = "AnyAcc"; break;
+				case 1: access_type = "ByteAcc"; break;
+				case 2: access_type = "WordAcc"; break;
+				case 3: access_type = "DWordAcc"; break;
+				case 4: access_type = "BlockAcc"; break;
+				case 5: access_type = "SMBSendRecvAcc"; break;
+				case 6: access_type = "SMBQuickAcc"; break;
+			}
+			switch((0x10 &amp; (u8) op-&gt;value.integer) &gt;&gt; 4)
+			{
+				case 0: lock_rule = "NoLock"; break;
+				case 1: lock_rule = "Lock"; break;
+			}
+			switch((0x60 &amp; (u8) op-&gt;value.integer) &gt;&gt; 5)
+			{
+				case 0: update_rule = "Preserve"; break;
+				case 1: update_rule = "WriteAsOnes"; break;
+				case 2: update_rule = "WriteAsZeros"; break;
+			}
+			size = acpi_safe_sprintf(buffer, buffer_size, 0, 
+				"AccessType: %s; "
+				"LockRule: %s; "
+				"UpdateRule: %s",
+				access_type, lock_rule, update_rule);
+			break;
+		}
+
+		case AML_REGIONSPACE:
+		{
+			char *region;
+			switch(op-&gt;value.integer)
+			{
+				case 0: region = "SystemMemory"; //no break;
+				case 1: region = "SystemIO"; //no break;
+				case 2: region = "PCI_Config"; //no break;
+				case 3: region = "EmbeddedControl"; //no break;
+				case 4: region = "SMBus"; //no break;
+				size = acpi_safe_sprintf(buffer, buffer_size, 0, region);
+				break;
+				default:
+				size = acpi_safe_sprintf(buffer, buffer_size, 0, 
+				"User-defined: 0x%x", op-&gt;value.integer &amp; 0xff);
+				break;
+			}
+			break;
+		}
+
+		case AML_METHODFLAGS:
+		{
+			int arg_count;
+			char *serialize;
+
+			arg_count = (0x7 &amp; (u8) op-&gt;value.integer);
+
+			if (0x8 &amp; (u8) op-&gt;value.integer)
+				serialize = "Serialized";
+			else
+				serialize = "NotSerialized";
+
+			size = acpi_safe_sprintf(buffer, buffer_size, 0, 
+				"ArgCount %d; %s", arg_count, serialize);
+			break;
+		}
+
+		case AML_SYNCFLAGS:
+			size = acpi_safe_sprintf(buffer, buffer_size, 0, 
+				"SyncLevel 0x%x", 0xf &amp; op-&gt;value.integer);
+			break;
+
 		case AML_BYTELIST:
 			{
 				struct acpi_extra_op *extra

</body></email><email><emailId>20000423223154</emailId><senderName>SÃ©bastien Bernard</senderName><senderEmail>bernarbs@club-internet.fr</senderEmail><timestampReceived>2000-04-23 22:31:54-0400</timestampReceived><subject>[Acpi] API With 440MX works!!! (at last)</subject><body>

Andy, accept my apologies: you were right.
The ACPI was not enabled.
I had to add in the acpi code and explicit call to acpi_enable.
What I do not understand is how can it work in the other place. I had a
look at the acpi definitions and at page 177 they
says about turning on ACPI :
'When a platform initialize from a cold boot (mechanical off or from S4
state), the hardware platform is assumed to
be configured in a legacy configuration. From these states, the BIOS
software initializes the computer as it would for a
legacy operating system. When control is passed to the operating system,
the OS will then enable the ACPI mode by first
scanning memory for ACPI tables, and then generates a write of the
ACPI_ENABLE value to the SMI_CMD port
(as described by the FACP table). The hardware platform will set the
SCI_EN bit to indicate to the OS that the hardware platform is now
configured for ACPI.'
So according to this specification:
1) all the machines are supposed to boot into APM modes (which is the
legacy state)
2) it's up to the OS to emit the acpi_enable ( facp ) if the machine is
not in acpi state (as it can be from a s2 or s3 wakeup)

I couldn't find how the acpi_enable register is set at kernel startup.
Am I missing something or the call is missing ?
I have another problem which is more simple.
When powering off my laptop, the machine shutdown correctly, then powers
down itself.
Now, what is not normal, is that just after powering down, it goes up
again.
Have you already met such behaviour ??

If you wand it here's the patch :
-----------------
    if (facp-&gt;p_lvl3_lat
        &amp;&amp; facp-&gt;p_lvl3_lat &lt;= ACPI_MAX_P_LVL3_LAT
        &amp;&amp; !acpi_verify_mod(ACPI_P_LVL3_LAT)) {
        acpi_p_lvl3_lat = ACPI_uS_TO_TMR_TICKS(facp-&gt;p_lvl3_lat);
        acpi_enter_lvl3_lat
            = ACPI_uS_TO_TMR_TICKS(facp-&gt;p_lvl3_lat * 5);
    }

    if (acpi_claim_ioports(facp)) {
        printk(KERN_ERR "ACPI: I/O port allocation failed\n");
        goto err_out;
    }
+
+    if (!acpi_is_enabled(facp))
+        acpi_enable(facp);

    if (facp-&gt;sci_int
        &amp;&amp; acpi_sci_enabled()
        &amp;&amp; request_irq(facp-&gt;sci_int,
               acpi_irq,
               SA_INTERRUPT | SA_SHIRQ,
               "acpi",
               &amp;acpi_facp)) {
----------------------

</body></email><email><emailId>20000426120327</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-26 12:03:27-0400</timestampReceived><subject>[Acpi] confusing code</subject><body>

I'm pretty sure that I've seen quite a few pieces of code like this,
but I'll refer only to the example I'm looking at now.

In acpidisasm/util.c:acpi_show(), we have:

acpi_show(const struct acpi_op *origin)
{
	...
        const struct acpi_op *op = origin;
        if(op)
        {
		// do stuff with op
		...
	}
	else
	{
		if(acpi_sprint_op(buffer, sizeof(buffer), op) &gt; 0)
                {
                        printf("%s\n", buffer);
                }

	}
}

But if !op, i.e. op == NULL, what do you expect is being printed?
Is this vestigial code, or are my brains falling out?

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000426131823</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-26 13:18:23-0400</timestampReceived><subject>[Acpi] disassembler namespace printing patch</subject><body>

Here's a patch against the latest pmtools that makes it easier to see
the namespace in acpidisasm output, by printing out the full name of
named objects.

Andy, I'm in some doubt about which parts of this you want to apply.
There are two completely separate parts to this patch.  One adds
the (currently commented-out) capability to just print out a namespace
tree with nothing else in it; the other adds full path information to
named objects in the normal acpidisasm output.  (Except for *Fields in
a Field; those I left out explicitly because acpi_sprint_path reasonably
enough doesn't deal with that case and I wasn't sure that it is worth
changing it to do so; indeed, I'm not sure it is even right to do so.)

With my changes to the normal acpidisasm output, the commented-out
portion can be reproduced by modifying acpidisasm output with awk, sed,
or perl, so I'm not sure how useful that change is.  I left it commented
out in part because it wants a command-line option and I don't know which
command-line option handling package you would want to use; I tend to
use popt because it is one of the only packages that works recursively
but that doesn't mean you agree with me...

So I'd like you to apply the first two chunks of the util.c diff, but
the rest of them are completely at your discretion.  Try uncommenting
the line in disasm.c and see what you think of the output as a quick
reference to the namespace.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/


diff -u --recursive pmtools.fields/acpidisasm/acpi.h pmtools.new/acpidisasm/acpi.h
--- pmtools.fields/acpidisasm/acpi.h	Tue Apr 25 16:37:11 2000
+++ pmtools.new/acpidisasm/acpi.h	Wed Apr 26 14:05:14 2000
@@ -127,6 +127,7 @@
 int acpi_sprint_path(char *str, int size, const struct acpi_op *op);
 int acpi_sprint_op(char *str, int size, const struct acpi_op *op);
 void acpi_show(const struct acpi_op *op);
+void acpi_show_namespace(const struct acpi_op *op);
 
 /*
  *
diff -u --recursive pmtools.fields/acpidisasm/disasm.c pmtools.new/acpidisasm/disasm.c
--- pmtools.fields/acpidisasm/disasm.c	Tue Apr 25 16:37:11 2000
+++ pmtools.new/acpidisasm/disasm.c	Wed Apr 26 15:05:29 2000
@@ -58,6 +58,8 @@
 			int aml_size = dsdt_size - sizeof(struct acpi_dsdt);
 			struct acpi_op *root = acpi_parse(aml, aml_size);
 			acpi_show(acpi_get_child(root));
+			// should depend on a command-line variable, I suppose
+			//acpi_show_namespace(root);
 			free(dsdt);
 		}
 	}
diff -u --recursive pmtools.fields/acpidisasm/util.c pmtools.new/acpidisasm/util.c
--- pmtools.fields/acpidisasm/util.c	Wed Apr 26 14:00:22 2000
+++ pmtools.new/acpidisasm/util.c	Wed Apr 26 15:02:10 2000
@@ -569,6 +569,7 @@
 acpi_show(const struct acpi_op *origin)
 {
 	static char buffer[MAX_SHOW_ENTRY];
+	static char namebuffer[MAX_SHOW_ENTRY];
 	const struct acpi_op *op = origin;
 	if(op)
 	{
@@ -630,7 +631,19 @@
 				}
 				else
 				{
-					printf("%s\n", buffer);
+					if (acpi_is_named_op(op-&gt;opcode)
+					    &amp;&amp; (op-&gt;opcode != AML_NAMEDFIELD)
+					    &amp;&amp; (op-&gt;opcode != AML_RESERVEDFIELD)
+					    &amp;&amp; (op-&gt;opcode != AML_ACCESSFIELD)
+					    )
+					{
+						acpi_sprint_path(namebuffer, sizeof(namebuffer), op);
+						printf("%s (\\%s)\n", buffer, namebuffer);
+					}
+					else
+					{
+						printf("%s\n", buffer);
+					}
 				}
 			}
 
@@ -643,6 +656,62 @@
 		if(acpi_sprint_op(buffer, sizeof(buffer), op) &gt; 0)
 		{
 			printf("%s\n", buffer);
+		}
+	}
+}
+
+
+/*
+ * Print whole namespace -- only intended to start from root node
+ */
+void
+acpi_show_namespace(const struct acpi_op *origin)
+{
+	static char opbuffer[MAX_SHOW_ENTRY];
+	static char namebuffer[MAX_SHOW_ENTRY];
+	const struct acpi_op *op = origin;
+
+	while(op)
+	{
+		const struct acpi_op *depth;
+		int count = 0;
+
+		op = acpi_get_depth_next(acpi_to_nonconst_op(origin),
+					 acpi_to_nonconst_op(op));
+
+		if (!op || !acpi_is_named_op(op-&gt;opcode)) continue;
+
+		// indentation
+		for(depth = op-&gt;parent; depth; depth = depth-&gt;parent)
+		{
+			const struct acpi_op *arg
+				= acpi_get_arg(
+					acpi_to_nonconst_op(depth), 0);
+			while(arg &amp;&amp; arg != origin)
+			{
+				arg = arg-&gt;next;
+			}
+			if(arg)
+			{
+				break;
+			}
+			count++;
+		}
+    
+		if (acpi_sprint_op(opbuffer, sizeof(opbuffer), op) &gt; 0)
+		{
+			char *space;
+
+			// cut off name
+			space = strrchr(opbuffer, ' ');
+			if (!space) break;
+			*space='\0';
+
+			// replace name with full path
+			acpi_sprint_path(namebuffer, sizeof(namebuffer), op);
+			while (--count)
+				printf("  ");
+			printf("%s \\%s\n", opbuffer, namebuffer);
 		}
 	}
 }

</body></email><email><emailId>20000426135017</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-26 13:50:17-0400</timestampReceived><subject>[Acpi] Re: disassembler namespace printing patch</subject><body>

"Michael K. Johnson" writes:
&gt;With my changes to the normal acpidisasm output, the commented-out
&gt;portion can be reproduced by modifying acpidisasm output with awk, sed,
&gt;or perl, so I'm not sure how useful that change is.

In fact, this script is probably even more useful than the commented-out
portion in terms of making easily readable output.

#!/bin/bash
# namespace - turn acpidisasm output into a convenient tree

grep '(\\' | sed 's/.*://
  s/[^ ]* (//
  s/)//' | sort -k 2 -b | sed 's/_*\././g' | \
  while read name path ; do printf '\\%-35s %s\n' $path $name ; done

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000426152331</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-26 15:23:31-0400</timestampReceived><subject>[Acpi] Parsing _{C,P,S}RS Buffer ByteLists</subject><body>

In order to make the disassembler output for the _{C,P,S}RS Buffer ByteLists
a bit more readable (see section 6.4), I may need a bit more infrastructure.
It's trivial for me to change to being able to print out more than one line
per object and maintain indentation; I've figured that out.  Would it be
considered kosher for me to change the printing in util.c to look up the
parent of the parent of a bytelist and see if its name is _{C,P,S}RS, and if
so, to interpret the bytelist accordingly?

BTW, if I make the changes to print more than one line per object, I can
make it possible to print all ByteLists in their entirety and leave off
the elipses...

Andy, any opinions about this?

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000425082025</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-25 08:20:25-0400</timestampReceived><subject>[Acpi] Re: random ACPI bugs on Dell Inspiron 7500</subject><body>

Andy Henroid writes:
&gt;Well, the fix will probably have to come from the
&gt;software side anyway so you might as well assign
&gt;blame there by default.

If we find a real undisputable bug in the bios, I expect Dell
will be willing to fix it and issue a flash update, though on
their own time schedule, I expect.

&gt;&gt; Here is what I have seen so far:
&gt;&gt; 
&gt;&gt;  o  Once only, acpid -d blanked the screen and the
&gt;&gt; screeen would not
&gt;&gt;     come to life again without a complete reboot. 
&gt;
&gt;Now that is very odd.  Is this with the experimental
&gt;S1 support turned on?

Yes.

&gt;The code paths for blanking
&gt;the screen from ACPI are not even accessible unless
&gt;you turn that on and even so will not be run unless
&gt;you do an explicit 'echo 1 &gt; /proc/sys/acpi/sleep'

It has only happened once, so it's clearly not an
intentional code path...  :-)  I'll let you know if
it happens again.

&gt;Could this be related to your APM BIOS oddity
&gt;metioned below?

I don't think it's an APM BIOS oddity at all;
see below.

&gt;I will send out a patch shortly.

OK, thanks.

&gt;Hmm...  Without acpid running, ACPI certainly is
&gt;not doing the suspend.  It sounds like APM is
&gt;actually doing your suspend.  How can that be
&gt;if APM is not engaged?  Strange (illegal?)
&gt;behavior of the APM BIOS.

Huh?  You don't need to enable APM BIOS in Linux in order to use
APM features, it just makes Linux able to find out what you have
done...  Many laptops with a suspend feature will suspend just
fine with Linux running but no APM support in Linux; Linux will
just be confused about the time when it wakes up because it will
not know that it went to sleep.

So, of course the APM bios is doing the suspend, even though I
have no enabled APM bios support in the kernel.  This is not
unusual or unexpected or buggy behaviour; I just wanted to
point out that in APM mode, the suspend key works, therefore I
would expect that in ACPI mode the suspend key would generate an
event.

Thanks for explaining how to figure out what event it is; I'll
try it.  Unfortunately, I've got other problems with the 2.3.99
kernels on this machine that prevent me from doing any real work
with it (my modem/ethernet card isn't supported, for example) so
I have to alternate between working on the kernel and dealing
with email.  :-(

&gt;Running in ACPI mode, the BIOS expects the OS
&gt;(drivers) to spin down the harddrive whereas
&gt;with APM, the BIOS takes care of all of that.
&gt;For ACPI we need additional driver support
&gt;for suspend/resume including HD/IDE/PCI
&gt;PM work.

OK, I wasn't sure if the AML code explicitly tried to do all that
or not.

I'm a little worried about this because our standard hard drive
spin down code does not work.  I think that it might just be
turning off power to the drive somehow, though I haven't spent
enough time with the disassembled AML to be sure.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000425181340</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-25 18:13:40-0400</timestampReceived><subject>[Acpi] acpid and pmtools release</subject><body>

New versions of acpid and pmtools are available
now from

 
http://www.geocities.com/SiliconValley/Hardware/3165/

and soon after at the main ACPI4Linux website.

New in acpid-042500
* AML parsing bug fixes (This should fix the problem
  with the BP6 that has been outstanding since the
  last release.  Let me know if it doesn't)
* Many assorted interpreter enhancements
* Battery/thermal code added (intially disabled)
* acpi renamed to acpictl
* README added to doc/ by Yung-Hsiang Lu
* Build converted to automake, autoconf, libtool
  by Jeff Garzik
* RPM spec file added to doc/ by Jeff Garzik

New in pmtools-042500
* Minor Field/BankField/IndexField parsing bug fixed
  in acpidisasm
* Simple ACPI capability analyzer added (currently
  just a toy)


__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com

</body></email><email><emailId>20000426181955</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-26 18:19:55-0400</timestampReceived><subject>[Acpi] Re: Parsing _{C,P,S}RS Buffer ByteLists</subject><body>

Takanori Watanabe writes:
&gt;PnP Encoding.

The problem is not how the bytestream should be interpreted.  If you
had followed my reference to section 6.4, you would have seen that it
is documented there.

The problem is that these _{C,P,S}RS objects are control methods that
when run return a bytestream.

Here's the problem:
1) The disassembler can't run the control methods.
2) The standard does not say how the _{C,P,S}RS methods should be
   coded.
Therefore, any attempts to decode these will HAVE to be heuristic attempts;
from what I see in the AML on my machine, I can look for a Record inside a
control method and guess that it will contain a bytestream to be so
interpreted.  But it is impossible to know for certain.

So there are two questions:
1) Is it worthwhile to try to parse these streams in the disassembler?
   I think so, especially because that there are standard ASL macros that
   create recognizable objects specifically for the purpose of creating
   these control methods.
2) Does Andy mind me mangling his disassembler to perform these functions?

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000420192626</emailId><senderName>Dietmar Nowack</senderName><senderEmail>di.nowak@fh-wolfenbuettel.de</senderEmail><timestampReceived>2000-04-20 19:26:26-0400</timestampReceived><subject>[Acpi] linux &amp; acpi</subject><body>

I'm sorry if this post is rather trivial or answers have been given in
former posts, but I browsed the archive and found nothing appropriate,
at least not for a non-developer like me. 

I enabled acpi support (kernel is 2.3.99-pre2), and there is the
/proc/sys/acpi tree, but obviously it is all non-functional. Neither
would the system power off on shutdown nor is there any way to set it to
sleep or hibernation. I tried "echo 1 &gt; .." with all proc entries that
seemed relevant, but the result was all negative. 

Now my questions would be, what precautions are to be taken or which
conditions have to be met in order to make acpi modes operate in Linux?


System data (I don't know what is actually relevant)

Athlon CPU
Asus K7V Mainboard, ACPI BIOS REV 1003
AWARD medaillon bios v6.0



I hope someone finds time to lighten my views a little.

best regards,

Dietmar Nowack.

</body></email><email><emailId>20000421234954</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-21 23:49:54-0400</timestampReceived><subject>Re: [Acpi] linux &amp; acpi</subject><body>

--- Dietmar Nowack &lt;Di.Nowak@FH-Wolfenbuettel.DE&gt;
wrote:

&gt; Now my questions would be, what precautions are to
&gt; be taken or which
&gt; conditions have to be met in order to make acpi
&gt; modes operate in Linux?

First, you need to install acpid (available from
the ACPI4Linux website).  Then, run it as

  acpid -d

so that you get debug output to the console.

-Andy

__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com

</body></email><email><emailId>20000426202604</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-26 20:26:04-0400</timestampReceived><subject>[Acpi] Re: Parsing _{C,P,S}RS Buffer ByteLists</subject><body>

"Michael K. Johnson" writes:
&gt;I do the ByteList parsing code.  Probably tomorrow, as
&gt;it's getting late here in .nl and I've got a fencepost
&gt;error somewhere.

OK, fencepost was trivial.

This patch is against yesterday's pmtools but it applies
without failures to today's pmtools.  Further patches
will be against today's pmtools with this patch applied
unless I have more feedback from you when I wake up in
the morning.

Thanks,

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000427024649</emailId><senderName>Takanori Watanabe</senderName><senderEmail>takawata@shidahara1.planet.sci.kobe-u.ac.jp</senderEmail><timestampReceived>2000-04-27 02:46:49-0400</timestampReceived><subject>Re: [Acpi] Re: Parsing _{C,P,S}RS Buffer ByteLists</subject><body>

In message &lt;200004261819.UAA01702@bastable.devel.redhat.com&gt;, "Michael K. Johns
on" wrote:
&gt;
&gt;The problem is not how the bytestream should be interpreted.  If you
&gt;had followed my reference to section 6.4, you would have seen that it
&gt;is documented there.

OK.sorry.


&gt;So there are two questions:
&gt;1) Is it worthwhile to try to parse these streams in the disassembler?
&gt;   I think so, especially because that there are standard ASL macros that
&gt;   create recognizable objects specifically for the purpose of creating
&gt;   these control methods.
&gt;2) Does Andy mind me mangling his disassembler to perform these functions?
&gt;

I think it is not disassembler's job,but AML interpreter shell's 
(AML debugger's) job. Bytestreem interpretation exists in  
different layer from AML interpretation.

Name(_CRS,Buffer{...}) type may be interpreted in disassembler.

But the type such as 
Name(CRSR,Buffer{.....})
Method(_CRS){
	CreateWordfield(CRSR,0x1,AAAA)
	Store(42,AAAA)
	return(CRSR)
}

or 
Method(_CRS)
{
	Name(BUFF,Buffer{....})
	CreateWordField(BUFF,0x4,BBBB)
	Store(8192,BBBB)
	return(BUFF)
}
is difficult.

More over,

Method(_SRS,1){
	CreateWordField(Arg0,0x1,CCCC)
	Store(119,CCCC)
}

needs to give Arg0 buffer filled with PnP Encoded data.

Takanori Watanabe
&lt;a href="http://www.planet.sci.kobe-u.ac.jp/~takawata/key.html"&gt;
Public Key&lt;/a&gt;
Key fingerprint =  2C 51 E2 78 2C E1 C5 2D  0F F1 20 A3 11 3A 62 2A 

</body></email><email><emailId>20000426001819</emailId><senderName>Jon Evans</senderName><senderEmail>jon.evans@pobox.com</senderEmail><timestampReceived>2000-04-26 00:18:19-0400</timestampReceived><subject>Re: [Acpi] acpid and pmtools release</subject><body>

On Tue, 25 Apr 2000, Andy Henroid wrote:

&gt; New versions of acpid and pmtools are available
&gt; now from
&gt; 
&gt; http://www.geocities.com/SiliconValley/Hardware/3165/

&gt; * AML parsing bug fixes (This should fix the problem
&gt;   with the BP6 that has been outstanding since the
&gt;   last release.  Let me know if it doesn't)

Just a quick note because I was about to get some sleep when I noticed
your announcement.

After downloading, installing and running acpid gets a sig 11.

[root@evansoft /root]# gdb /usr/sbin/acpid core
GNU gdb 19991004
Copyright 1998 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you
are
welcome to change it and/or distribute copies of it under certain
conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for
details.
This GDB was configured as "i386-redhat-linux"...
Core was generated by `acpid -d'.
Program terminated with signal 11, Segmentation fault.
Reading symbols from /lib/libc.so.6...done.
Reading symbols from /lib/ld-linux.so.2...done.
#0  DsParseMethod (ObjHandle=0x8079a64) at dsmethod.c:64
64          if ((ObjDesc-&gt;Method.Concurrency != INFINITE_CONCURRENCY) &amp;&amp;
(gdb) q
[root@evansoft /root]# /usr/sbin/acpid -v
acpid-042500


System is Redhat 6.1 upgraded to 6.2, with kernel 1.3.99-pre6-6, a dual
not-overclocked BP6 with two Celeron 400's.

I'll look into this further tomorrow evening I'm sure...

Jon.

</body></email><email><emailId>20000425190005</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-25 19:00:05-0400</timestampReceived><subject>Re: [Acpi] Re: random ACPI bugs on Dell Inspiron 7500</subject><body>

--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:

&gt; Huh?  You don't need to enable APM BIOS in Linux in
&gt; order to use
&gt; APM features, it just makes Linux able to find out
&gt; what you have
&gt; done...  Many laptops with a suspend feature will
&gt; suspend just
&gt; fine with Linux running but no APM support in Linux;
&gt; Linux will
&gt; just be confused about the time when it wakes up
&gt; because it will
&gt; not know that it went to sleep.

OK.  I was thinking APM would not handle the suspend
key unless explicitly engaged.  I've been known
to be wrong...

&gt; This is not
&gt; unusual or unexpected or buggy behaviour; I just
&gt; wanted to
&gt; point out that in APM mode, the suspend key works,
&gt; therefore I
&gt; would expect that in ACPI mode the suspend key would
&gt; generate an
&gt; event.

OK, on a configured system, acpid would be started
at boot, immediately disabling APM suspend and
hopefully enabling handling through ACPI, so this
shouldn't really be an issue.  I might still
consider fully enabling ACPI a boot time though.
The behavior of the system is going to be very
confusing if someone builds in ACPI and APM
support but doesn't start up acpid (neither the
ACPI or the APM driver handles the suspend key)

-Andy


__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com

</body></email><email><emailId>20000425193352</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-25 19:33:52-0400</timestampReceived><subject>[Acpi] Re: random ACPI bugs on Dell Inspiron 7500</subject><body>

Andy Henroid writes:
&gt;OK, on a configured system, acpid would be started
&gt;at boot, immediately disabling APM suspend and
&gt;hopefully enabling handling through ACPI, so this
&gt;shouldn't really be an issue.

Huh?  I said that the suspend key works under APM which
means that we ought to be able to get at the event some
way or another.  I'm glad you don't think that there will
be an issue, but I can't imagine what issue you are talking
about here.  What is the antecedent to "this"?

&gt;I might still
&gt;consider fully enabling ACPI a boot time though.
&gt;The behavior of the system is going to be very
&gt;confusing if someone builds in ACPI and APM
&gt;support but doesn't start up acpid (neither the
&gt;ACPI or the APM driver handles the suspend key)

The APM driver does NOT handle the suspend key.  The
APM bios does that if ACPI is not enabled.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000425195911</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-25 19:59:11-0400</timestampReceived><subject>[Acpi] Re: random ACPI bugs on Dell Inspiron 7500</subject><body>

"Michael K. Johnson" writes:
&gt;The APM driver does NOT handle the suspend key.  The
&gt;APM bios does that if ACPI is not enabled.

Perhaps "does NOT handle" is misleading.  What I'm trying to
say is that the existence of APM support on the Linux kernel
doesn't have anything to do with whether the suspend key
tries to suspend when the APM bios is active.  That should
be clearer...

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000425223548</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-25 22:35:48-0400</timestampReceived><subject>Re: [Acpi] Re: random ACPI bugs on Dell Inspiron 7500</subject><body>

--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:
&gt; 
&gt; Andy Henroid writes:
&gt; &gt;OK, on a configured system, acpid would be started
&gt; &gt;at boot, immediately disabling APM suspend and
&gt; &gt;hopefully enabling handling through ACPI, so this
&gt; &gt;shouldn't really be an issue.
&gt; 
&gt; Huh?  I said that the suspend key works under APM
&gt; which
&gt; means that we ought to be able to get at the event
&gt; some
&gt; way or another.  I'm glad you don't think that there
&gt; will
&gt; be an issue, but I can't imagine what issue you are
&gt; talking
&gt; about here.  What is the antecedent to "this"?

I suspect we cannot get at the suspend key event
before turning on ACPI as the APM BIOS handles it
transparently.  When we turn on ACPI, the suspend
key will stop being handled by the APM BIOS and,
hopefully, begin generating an ACPI event.  If
the suspend key generates an ACPI event then, yes,
we can make it suspend the system (or really do
whatever you want).

-Andy


__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com

</body></email><email><emailId>20000428100259</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-28 10:02:59-0400</timestampReceived><subject>[Acpi] _HID query and patch</subject><body>

The standard says, in section 6.1.4, that a _HID object evaluates
either to a string or to a 32-bit EISA ID.  I find this fragment
in my AML disassembly:

0000365a:       Device PIC_ (\_SB_.PCI0.PX40.PIC_)
00003661:         Name _HID (\_SB_.PCI0.PX40.PIC_._HID)
00003666:           0xd041

Clearly, that's not a DwordObject, nor is it a string.

Am I justified in reporting this to Dell as a bug, or is there
something I don't know?

I notice that plenty of the EISA IDs are ???d041 on this machine.

I also notice some HIDs with non-ascii characters; particularly
nulls, which show up as @'s when decoded:

000008c2:   Device MEM_ (\_SB_.MEM_)
000008ca:     Name _HID (\_SB_.MEM_._HID)
000008cf:       @HLd041 (0x010cd041)

I'm pretty sure that my decoding is correct, unless I have misunderstood
something in the PnP BIOS specification fragment that I posted here.

Can anyone enlighten me?

Thanks!

Oh, and for Takanori Watanabe when you read this patch: yes, I'm
quite aware that a _HID can also be a method that evaluates to an
EISA ID or a string -- I'm not trying to catch every instance,
just trying to make reading your average acpidisasm output easier.
So you don't need to tell me that a _HID object can be a method
and that my check here will not give me the EISA ID for every
possible _HID object; I know that already.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/


diff -u --recursive pmtools.checksum/acpidisasm/util.c pmtools.eisaid/acpidisasm/util.c
--- pmtools.checksum/acpidisasm/util.c	Thu Apr 27 22:21:04 2000
+++ pmtools.eisaid/acpidisasm/util.c	Fri Apr 28 11:55:03 2000
@@ -256,12 +256,37 @@
 						 op-&gt;value.integer &amp; 0xffff);
 			break;
 		case AML_DWORDCONST:
-			size = acpi_safe_sprintf(buffer,
-						 buffer_size,
-						 10,
-						 "0x%08x",
-						 op-&gt;value.integer);
+		{
+			char name[5];
+			// This might be a PnP identifier...
+			if (op-&gt;parent &amp;&amp;
+			    op-&gt;parent-&gt;opcode == AML_NAME &amp;&amp;
+			    acpi_sprint_name(name, 5,
+					     acpi_get_name(op-&gt;parent)) &amp;&amp;
+			    !strncmp(name, "_HID", 4))
+			{
+				// Parent is a Name named _HID; this
+				// must be a PnP identifier
+				size = acpi_safe_sprintf(buffer,
+					 buffer_size,
+					 18,
+					 "%c%c%c%04x (0x%08x)",
+					 ((op-&gt;value.integer &gt;&gt; 26) &amp; 0x1f) + 0x40,
+					 ((op-&gt;value.integer &gt;&gt; 21) &amp; 0x1f) + 0x40,
+					 ((op-&gt;value.integer &gt;&gt; 16) &amp; 0x1f) + 0x40,
+					 op-&gt;value.integer &amp; 0xffff,
+					 op-&gt;value.integer);
+			}
+			else
+			{
+				size = acpi_safe_sprintf(buffer,
+							 buffer_size,
+							 10,
+							 "0x%08x",
+							 op-&gt;value.integer);
+			}
 			break;
+		}
 		case AML_STRING:
 			if(op-&gt;value.string)
 			{

</body></email><email><emailId>20000428102140</emailId><senderName>Takanori Watanabe</senderName><senderEmail>takawata@shidahara1.planet.sci.kobe-u.ac.jp</senderEmail><timestampReceived>2000-04-28 10:21:40-0400</timestampReceived><subject>Re: [Acpi] _HID query and patch</subject><body>

In message &lt;200004281002.MAA02601@bastable.devel.redhat.com&gt;, "Michael K. Johns
on" wrote:
&gt;
&gt;The standard says, in section 6.1.4, that a _HID object evaluates
&gt;either to a string or to a 32-bit EISA ID.  I find this fragment
&gt;in my AML disassembly:
&gt;
&gt;0000365a:       Device PIC_ (\_SB_.PCI0.PX40.PIC_)
&gt;00003661:         Name _HID (\_SB_.PCI0.PX40.PIC_._HID)
&gt;00003666:           0xd041
&gt;
&gt;Clearly, that's not a DwordObject, nor is it a string.

Should'nt it be treated as 0x0000d041?(PNP0000).I think there is 
single strage class for number in ACPI spec 
,though it is represented in many forms to save memory.
(Zero object,One object, Ones object,Byte,Word,Dword)

&gt;Am I justified in reporting this to Dell as a bug, or is there
&gt;something I don't know?
&gt;
&gt;I notice that plenty of the EISA IDs are ???d041 on this machine.
&gt;
&gt;I also notice some HIDs with non-ascii characters; particularly
&gt;nulls, which show up as @'s when decoded:
&gt;
&gt;000008c2:   Device MEM_ (\_SB_.MEM_)
&gt;000008ca:     Name _HID (\_SB_.MEM_._HID)
&gt;000008cf:       @HLd041 (0x010cd041)
&gt;                               

PNP0C01: System Board resource.
You probably caught in endian problem.

Takanori Watanabe
&lt;a href="http://www.planet.sci.kobe-u.ac.jp/~takawata/key.html"&gt;
Public Key&lt;/a&gt;
Key fingerprint =  2C 51 E2 78 2C E1 C5 2D  0F F1 20 A3 11 3A 62 2A 

</body></email><email><emailId>20000426081823</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-26 08:18:23-0400</timestampReceived><subject>[Acpi] Re: random ACPI bugs on Dell Inspiron 7500</subject><body>

This is a multipart MIME message.


I wrote:
&gt;Andy Henroid writes:
&gt;&gt;I will send out a patch shortly.
&gt;
&gt;OK, thanks.

Confirmed, patch works here.  Not that you were in any doubt.

&gt;Thanks for explaining how to figure out what event it is; I'll
&gt;try it.

And the suspend key is:
0x00000000 0x00000200 0x0
_SB.PCI0.PX40.EC0._GPE is 9, which matches (if I did my math correctly
for once).  I'm attaching a gzipped section of the disassembled AML
code for the EC0 device since it's only about 2k that way; if you need
more, I can send the whole thing to you privately.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/


["suspendkey.amldump.gz" (application/x-gzip)]

</body></email><email><emailId>20000426084105</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-26 08:41:05-0400</timestampReceived><subject>[Acpi] Re: random ACPI bugs on Dell Inspiron 7500</subject><body>

Andy Henroid writes:
&gt;I suspect we cannot get at the suspend key event
&gt;before turning on ACPI as the APM BIOS handles it
&gt;transparently.

Oh, that.  I don't think that matters.  I can't
imagine who cares if suspend works correctly
during system boot time.  I expect that acpid
will be started early in the boot process anyway,
so I don't think it matters very much one way or
another.

I wasn't reporting that as a bug, which was why
I was confused when you treated at as one.  :-)

&gt;If the suspend key generates an ACPI event then, yes,
&gt;we can make it suspend the system (or really do
&gt;whatever you want).

And, as mentioned elsewhere, it does.

I wonder if it would make sense to eventually do something
like have people press suspend twice in one second for
suspend to disk (if configured), and once only in order to
suspend to ram?  I suppose that might be too complex an
interface for some people.  :-)

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000426181438</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-26 18:14:38-0400</timestampReceived><subject>Re: [Acpi] Re: random ACPI bugs on Dell Inspiron 7500</subject><body>

--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:

&gt; And the suspend key is:
&gt; 0x00000000 0x00000200 0x0
&gt; _SB.PCI0.PX40.EC0._GPE is 9, which matches (if I did
&gt; my math correctly
&gt; for once).  I'm attaching a gzipped section of the
&gt; disassembled AML
&gt; code for the EC0 device since it's only about 2k
&gt; that way; if you need
&gt; more, I can send the whole thing to you privately.

Interesting, it looks like your suspend key is
handled through your embedded controller which
owns GPE 9.  The embedded controller also takes
care of battery on your system and other things
so upon receiving a GPE 9, we are going to have
to query the EC to determine if the event was
the suspend key, a battery event, or some other
EC event.

-Andy


__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com

</body></email><email><emailId>20000426181719</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-26 18:17:19-0400</timestampReceived><subject>Re: [Acpi] Re: random ACPI bugs on Dell Inspiron 7500</subject><body>

--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:

&gt; I wonder if it would make sense to eventually do
&gt; something like have people press suspend twice in
&gt; one second for suspend to disk (if configured), and
&gt; once only in order to suspend to ram?  I suppose
&gt; that might be too complex an interface for some
&gt; people.  :-)

Hey, if people can learn to double click a mouse
button, who knows the possibilities...

-Andy


__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com

</body></email><email><emailId>20000426183259</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-26 18:32:59-0400</timestampReceived><subject>[Acpi] Re: random ACPI bugs on Dell Inspiron 7500</subject><body>

Andy Henroid writes:
&gt;Interesting, it looks like your suspend key is
&gt;handled through your embedded controller which
&gt;owns GPE 9.  The embedded controller also takes
&gt;care of battery on your system and other things
&gt;so upon receiving a GPE 9, we are going to have
&gt;to query the EC to determine if the event was
&gt;the suspend key, a battery event, or some other
&gt;EC event.

Do we even have an interface yet for querying the
embedded controller?  I noticed that when I enabled
the battery code in the new acpid just for kicks,
it hung when I tried to query it with acpictl.  I
didn't get around to doing any debugging or
investigation yet.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000426200559</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-26 20:05:59-0400</timestampReceived><subject>Re: [Acpi] Re: random ACPI bugs on Dell Inspiron 7500</subject><body>

--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:

&gt; Do we even have an interface yet for querying the
&gt; embedded controller?  I noticed that when I enabled
&gt; the battery code in the new acpid just for kicks,
&gt; it hung when I tried to query it with acpictl.  I
&gt; didn't get around to doing any debugging or
&gt; investigation yet.

The EC is generally going to always be accessed
through control methods (the AML interpreter).
Whenever a control method accesses an OpRegion
marked as EC, the interpreter calls into the
EC driver.  All of that code is there now
but, as you see, I'm still kicking out a few
problems.

-Andy


__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com

</body></email><email><emailId>20000426152732</emailId><senderName>Takanori Watanabe</senderName><senderEmail>takawata@shidahara1.planet.sci.kobe-u.ac.jp</senderEmail><timestampReceived>2000-04-26 15:27:32-0400</timestampReceived><subject>Re: [Acpi] Parsing _{C,P,S}RS Buffer ByteLists</subject><body>

In message &lt;200004261523.RAA01126@bastable.devel.redhat.com&gt;, "Michael K. Johns
on" :
&gt;
&gt;In order to make the disassembler output for the _{C,P,S}RS Buffer ByteLists
&gt;a bit more readable (see section 6.4), I may need a bit more infrastructure.
&gt;It's trivial for me to change to being able to print out more than one line
&gt;per object and maintain indentation; I've figured that out.  Would it be
&gt;considered kosher for me to change the printing in util.c to look up the
&gt;parent of the parent of a bytelist and see if its name is _{C,P,S}RS, and if
&gt;so, to interpret the bytelist accordingly?
&gt;

PnP Encoding.

Takanori Watanabe
&lt;a href="http://www.planet.sci.kobe-u.ac.jp/~takawata/key.html"&gt;
Public Key&lt;/a&gt;
Key fingerprint =  2C 51 E2 78 2C E1 C5 2D  0F F1 20 A3 11 3A 62 2A 

</body></email><email><emailId>20000426195540</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-26 19:55:40-0400</timestampReceived><subject>Re: [Acpi] Parsing _{C,P,S}RS Buffer ByteLists</subject><body>

--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:

&gt; that out.  Would it be
&gt; considered kosher for me to change the printing in
&gt; util.c to look up the
&gt; parent of the parent of a bytelist and see if its
&gt; name is _{C,P,S}RS, and if
&gt; so, to interpret the bytelist accordingly?

There are many systems that do something like this

  Name RCRS
    Buffer
      &lt;size&gt;
      ByteList &lt;...&gt;
  Method _CRS
    ArgCount 0; NotSerialized
    return
      RCRS

and this case would not be caught by the above
algorithm.  It's too bad we can't make an
intelligent guess from the contents of a buffer
whether it contains resources or not.

In any case, yes, it would be nice to make
a guess and output resources.  A command line
argument to acpidisasm should probably be used
to enable that.

&gt; BTW, if I make the changes to print more than one
&gt; line per object, I can
&gt; make it possible to print all ByteLists in their
&gt; entirety and leave off
&gt; the elipses...

Yes, sounds good.  Add a depth parameter or something
to acpi_sprint_op.  Oh, and better yet, get rid of
sprintf (and buffer_size) entirely and change them
to printf's or fprintf's.  That's getting to be
a big pain.

-Andy


__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com

</body></email><email><emailId>20000426182057</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-26 18:20:57-0400</timestampReceived><subject>Re: [Acpi] confusing code</subject><body>

--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:

&gt; In acpidisasm/util.c:acpi_show(), we have:
[SNIP]
&gt; But if !op, i.e. op == NULL, what do you expect is
&gt; being printed?
&gt; Is this vestigial code, or are my brains falling
&gt; out?

No, this is actually correct code.  If op is
NULL then acpi_sprint_op prints "&lt;NULL&gt;".
Not unlike

  printf("%s", NULL);

-Andy


__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com

</body></email><email><emailId>20000424205215</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-24 20:52:15-0400</timestampReceived><subject>Re: [Acpi] API With 440MX works!!! (at last)</subject><body>

--- SÃ©bastien Bernard &lt;bernarbs@club-internet.fr&gt;
wrote:

&gt; I couldn't find how the acpi_enable register is set
&gt; at kernel startup.
&gt; Am I missing something or the call is missing ?

acpi_enable is called only when acpid or the
user enables an ACPI event (by modifying
/proc/sys/acpi/gpe_enable or
/proc/sys/acpi/pm1_enable)  Take a look at
acpi_do_event_reg.

The driver doesn't do the enable immediately at
boot time because some broken ACPI implementations
screw up the interrupt remapping when ACPI is
enabled.  It's a lot easier to diagnose problems
and/or a crash post-boot.

If the problem that Michael Johnson has reported
to the list is actually valid behavior for APM,
I might need to do the acpi_enable a boot-time
anyway.  There is now the "acpi=no-sci" kernel
flag to avoid the broken ACPI implementations.
That way, more Linux 2.3 testers would find out
in a hurry if they are running on a system with
broken ACPI.

&gt; I have another problem which is more simple.
&gt; When powering off my laptop, the machine shutdown
&gt; correctly, then powers
&gt; down itself.
&gt; Now, what is not normal, is that just after powering
&gt; down, it goes up
&gt; again.

Does your system really power down completely?
(the power LED goes off, the fan stops)  So,
you are just seeing your system reboot?

-Andy


__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com

</body></email><email><emailId>20000425082731</emailId><senderName>Bernard Sebastien</senderName><senderEmail>sebastien.bernard@cegetel.fr</senderEmail><timestampReceived>2000-04-25 08:27:31-0400</timestampReceived><subject>RE: [Acpi] API With 440MX works!!! (at last)</subject><body>


&gt; -----Message d'origine-----
&gt; De:	Andy Henroid [SMTP:andy_henroid@yahoo.com]
&gt; Date:	lundi 24 avril 2000 22:52
&gt; Ã:	S?bastien" Bernard
&gt; Cc:	acpi@phobos.fachschaften.tu-muenchen.de
&gt; Objet:	Re: [Acpi] API With 440MX works!!! (at last)
&gt; 
&gt; --- SÃ©bastien Bernard &lt;bernarbs@club-internet.fr&gt;
&gt; wrote:
&gt; 
&gt; &gt; I couldn't find how the acpi_enable register is set
&gt; &gt; at kernel startup.
&gt; &gt; Am I missing something or the call is missing ?
&gt; 
&gt; acpi_enable is called only when acpid or the
&gt; user enables an ACPI event (by modifying
&gt; /proc/sys/acpi/gpe_enable or
&gt; /proc/sys/acpi/pm1_enable)  Take a look at
&gt; acpi_do_event_reg.
&gt; 
&gt; The driver doesn't do the enable immediately at
&gt; boot time because some broken ACPI implementations
&gt; screw up the interrupt remapping when ACPI is
&gt; enabled.  It's a lot easier to diagnose problems
&gt;  and/or a crash post-boot.
	[BERNARD Sebastien]  But without acpi_enable, the request_irq is
hanging the machine. So what should we do ?
	Enable the acpi at boot time with the interrrupt or map the
interrupt only when the acpi is enabled ?


&gt; If the problem that Michael Johnson has reported
&gt; to the list is actually valid behavior for APM,
&gt; I might need to do the acpi_enable a boot-time
&gt; anyway.  There is now the "acpi=no-sci" kernel
&gt; flag to avoid the broken ACPI implementations.
&gt; That way, more Linux 2.3 testers would find out
&gt; in a hurry if they are running on a system with
&gt; broken ACPI.
	[BERNARD Sebastien]  What does it do ?
	For me, I claimed victory too early. The acpi activation is giving
some really strange hangs. I cannot use the NIC card for example, it just
hangs the machine when I do an ifconfig (the modules is compiled inside the
kernel).

&gt; &gt; I have another problem which is more simple.
&gt; &gt; When powering off my laptop, the machine shutdown
&gt; &gt; correctly, then powers
&gt; &gt; down itself.
&gt; &gt; Now, what is not normal, is that just after powering
&gt; &gt; down, it goes up
&gt; &gt; again.
&gt; 
&gt; Does your system really power down completely?
&gt; (the power LED goes off, the fan stops)  So,
&gt; you are just seeing your system reboot?
	[BERNARD Sebastien]  Now because when it reboots, the led goes off,
pause for a few seconds then goes on immediatly.
	There, the light goes off but goes on again after a few
milliseconds.
	Maybe I found a quicker way to reboot :-)). Anyway, when I switch to
level 0 when in APM, it powers down correctly.

&gt; -Andy
&gt; 
&gt; 
&gt; __________________________________________________
&gt; Do You Yahoo!?
&gt; Send online invitations with Yahoo! Invites.
&gt; http://invites.yahoo.com
&gt; 
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000425191419</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-25 19:14:19-0400</timestampReceived><subject>RE: [Acpi] API With 440MX works!!! (at last)</subject><body>

--- Bernard Sebastien &lt;sebastien.bernard@cegetel.fr&gt;
wrote:
&gt; 
&gt; [BERNARD Sebastien]  But without acpi_enable, the
&gt; request_irq is
&gt; hanging the machine. So what should we do ?
&gt; 	Enable the acpi at boot time with the
&gt; interrrupt or map the
&gt; interrupt only when the acpi is enabled ?

request_irq hanging seems to mean that an IRQ
is coming in somehow just after, calling 
acpi_irq, and hanging.  If the IRQ is not shared
and ACPI is disabled I wonder where that IRQ
is coming from?  Spurious?

I can put in a simple check to acpi_irq to not
handle any IRQ before acpi_enable is called.
This is probably good for systems that share
interrupts with ACPI anyway.  This hopefully
should fix your hang.

&gt; [BERNARD Sebastien]  What does it do ?

The "acpi=no-sci" flag makes the ACPI driver not
call request_irq or acpi_enable at all.  This is
useful for debug but with it, you get very
limited ACPI support (no ACPI events)

&gt; For me, I claimed victory too early. The acpi
&gt; activation is giving
&gt; some really strange hangs. I cannot use the NIC card
&gt; for example, it just
&gt; hangs the machine when I do an ifconfig (the modules
&gt; is compiled inside the
&gt; kernel).

Is the NIC built into your motherboard?  Or an
external PCI/ISA/etc. card?  Could be interrupt
routing problems.

&gt;&gt; Does your system really power down completely?
&gt;&gt; (the power LED goes off, the fan stops)  So,
&gt;&gt; you are just seeing your system reboot?
&gt;[BERNARD Sebastien]  Now because when it reboots,
&gt; the led goes off,
&gt; pause for a few seconds then goes on immediatly.
&gt; 	There, the light goes off but goes on again
&gt; after a few milliseconds.

I've heard of systems that reboot instead of
power off when they are told to go into S5.
Possibly a bug in your ACPI implementation.

-Andy


__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com

</body></email><email><emailId>20000426074615</emailId><senderName>Bernard Sebastien</senderName><senderEmail>sebastien.bernard@cegetel.fr</senderEmail><timestampReceived>2000-04-26 07:46:15-0400</timestampReceived><subject>RE: [Acpi] API With 440MX works!!! (at last)</subject><body>

&gt; &gt; hanging the machine. So what should we do ?
&gt; &gt; 	Enable the acpi at boot time with the
&gt; &gt; interrrupt or map the
&gt; &gt; interrupt only when the acpi is enabled ?
&gt; 
&gt; request_irq hanging seems to mean that an IRQ
&gt; is coming in somehow just after, calling 
&gt; acpi_irq, and hanging.  If the IRQ is not shared
&gt; and ACPI is disabled I wonder where that IRQ
&gt; is coming from?  Spurious?
&gt; 
&gt; I can put in a simple check to acpi_irq to not
&gt; handle any IRQ before acpi_enable is called.
	[BERNARD Sebastien]  Not good, I think. When the interrupt handler
is called again and again,
	the kernel boot does not progress any more. So I don't think a test
in acpi irq will prevent the hang.
&gt; This is probably good for systems that share
&gt; interrupts with ACPI anyway.  This hopefully
&gt; should fix your hang.
&gt; 
&gt; &gt; [BERNARD Sebastien]  What does it do ?
&gt; 
&gt; The "acpi=no-sci" flag makes the ACPI driver not
&gt; call request_irq or acpi_enable at all.  This is
&gt; useful for debug but with it, you get very
&gt; limited ACPI support (no ACPI events)
&gt; 
&gt; &gt; For me, I claimed victory too early. The acpi
&gt; &gt; activation is giving
&gt; &gt; some really strange hangs. I cannot use the NIC card
&gt; &gt; for example, it just
&gt; &gt; hangs the machine when I do an ifconfig (the modules
&gt; &gt; is compiled inside the
&gt; &gt; kernel).
&gt; 
&gt; Is the NIC built into your motherboard?  Or an
&gt; external PCI/ISA/etc. card?  Could be interrupt
&gt; routing problems.
	[BERNARD Sebastien]  It's built-in. Don't know about interrupt
routing. If I plug a PCMCIA card it hangs,
	I do something sometimes, it tends to hang. Just to say that I got
random hang (once was when the autorepeat
	starts at the end of the buffer in xemacs with a lot of beep - the
beeps are OK, but the hangs maybe come from
	the burst of keyboard irqs). IMHO, it's interrupt related. The acpi
support modify the irq dispatching in a subtle way.

&gt; I've heard of systems that reboot instead of
&gt; power off when they are told to go into S5.
&gt; Possibly a bug in your ACPI implementation.
	[BERNARD Sebastien]  Maybe, how to check ?

&gt; -Andy
&gt; 

</body></email><email><emailId>20000426151030</emailId><senderName>Anthony Jenkins</senderName><senderEmail>anthonyj@ami.com</senderEmail><timestampReceived>2000-04-26 15:10:30-0400</timestampReceived><subject>Re: [Acpi] API With 440MX works!!! (at last)</subject><body>

Bernard Sebastien wrote:

&gt; &gt; Is the NIC built into your motherboard?  Or an
&gt; &gt; external PCI/ISA/etc. card?  Could be interrupt
&gt; &gt; routing problems.
&gt;         [BERNARD Sebastien]  It's built-in. Don't know about interrupt
&gt; routing. If I plug a PCMCIA card it hangs,
&gt;         I do something sometimes, it tends to hang. Just to say that I got
&gt; random hang (once was when the autorepeat
&gt;         starts at the end of the buffer in xemacs with a lot of beep - the
&gt; beeps are OK, but the hangs maybe come from
&gt;         the burst of keyboard irqs). IMHO, it's interrupt related. The acpi
&gt; support modify the irq dispatching in a subtle way.
&gt;
&gt; &gt; I've heard of systems that reboot instead of
&gt; &gt; power off when they are told to go into S5.
&gt; &gt; Possibly a bug in your ACPI implementation.
&gt;         [BERNARD Sebastien]  Maybe, how to check ?

What BIOS/motherboard do you have?  You might check with the mobo/laptop
manufacturer for a BIOS update; sometimes IRQ routing table or
ACPI implementation problems come up which are fixed in later rev.'s.

The PCI interrupt routing table is just a table in the BIOS that describes the
mapping of PCI interrupts to traditional system interrupts.  You can find out
a little more about them in the ACPI spec. v1.0b, sections 5.2.8-5.2.9.

--
Anthony Jenkins             mailto:AnthonyJ@ami.com
American Megatrends Inc.    http://www.ami.com

</body></email><email><emailId>20000426164249</emailId><senderName>Bernard Sebastien</senderName><senderEmail>sebastien.bernard@cegetel.fr</senderEmail><timestampReceived>2000-04-26 16:42:49-0400</timestampReceived><subject>RE: [Acpi] API With 440MX works!!! (at last)</subject><body>


&gt; -----Message d'origine-----
&gt; De:	Anthony Jenkins [SMTP:AnthonyJ@ami.com]
&gt; Date:	mercredi 26 avril 2000 17:11
&gt; Ã:	Bernard Sebastien
&gt; Cc:	'acpi@phobos.fachschaften.tu-muenchen.de'
&gt; Objet:	Re: [Acpi] API With 440MX works!!! (at last)
&gt; 
&gt; Bernard Sebastien wrote:
&gt; 
&gt; &gt; &gt; Is the NIC built into your motherboard?  Or an
&gt; &gt; &gt; external PCI/ISA/etc. card?  Could be interrupt
&gt; &gt; &gt; routing problems.
&gt; &gt;         [BERNARD Sebastien]  It's built-in. Don't know about interrupt
&gt; &gt; routing. If I plug a PCMCIA card it hangs,
&gt; &gt;         I do something sometimes, it tends to hang. Just to say that I
&gt; got
&gt; &gt; random hang (once was when the autorepeat
&gt; &gt;         starts at the end of the buffer in xemacs with a lot of beep -
&gt; the
&gt; &gt; beeps are OK, but the hangs maybe come from
&gt; &gt;         the burst of keyboard irqs). IMHO, it's interrupt related. The
&gt; acpi
&gt; &gt; support modify the irq dispatching in a subtle way.
&gt; &gt;
&gt; &gt; &gt; I've heard of systems that reboot instead of
&gt; &gt; &gt; power off when they are told to go into S5.
&gt; &gt; &gt; Possibly a bug in your ACPI implementation.
&gt; &gt;         [BERNARD Sebastien]  Maybe, how to check ?
&gt; 
	[BERNARD Sebastien]  Motherboard I don't know. The Manufacturer is
Nec. The bios Comes from Phoenix 4.0 v6.0 (yes it is really written like
that in the boot up screen). The machine is a versa Note 2000.
&gt; What BIOS/motherboard do you have?  You might check with the mobo/laptop
&gt; manufacturer for a BIOS update;
	[BERNARD Sebastien]  Already done. Upgraded to v1.0i. Latest
revision known as this day.
&gt;  sometimes IRQ routing table or
&gt; ACPI implementation problems come up which are fixed in later rev.'s.
&gt; 
&gt; 
&gt; The PCI interrupt routing table is just a table in the BIOS that describes
&gt; the
&gt; mapping of PCI interrupts to traditional system interrupts.  You can find
&gt; out
&gt; a little more about them in the ACPI spec. v1.0b, sections 5.2.8-5.2.9.
	[BERNARD Sebastien]   OK! 
&gt; --
&gt; Anthony Jenkins             mailto:AnthonyJ@ami.com
&gt; American Megatrends Inc.    http://www.ami.com

</body></email><email><emailId>20000425193212</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-25 19:32:12-0400</timestampReceived><subject>Re: [Acpi] Re: acpid and pmtools release</subject><body>

--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:
&gt; 
&gt; Andy Henroid writes:
&gt; &gt;New versions of acpid and pmtools are available
&gt; 
&gt; Way cool!  Re-indented to make patch application
&gt; difficult!  ;-)
&gt; 
&gt; Enclosed please find the latest disassembler
&gt; enhancement patch,
&gt; since I didn't see any objection to the way I did it
&gt; before.

OK, looks good.  Yes, creating new fake ops does
seem to be the least painful way to do it considering
non-recursive acpi_show and acpi_sprint_op.

I'll merge these changes into acpidisasm.

Thanks,
Andy



__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com

</body></email><email><emailId>20000425082325</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-25 08:23:25-0400</timestampReceived><subject>[Acpi] Re: Replacing APM</subject><body>

"Yuki Ogawa" writes:
&gt;ThermalZone support for cooling FAN is important.
&gt;Because system shuts down criticaly if temperature is too high.

The fans will be on full-speed-ahead if we don't turn them off,
at least in all implementations I've seen.  Therefore, while
thermal zone support is important, it is not as important as
the other things that I listed.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000425184745</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-25 18:47:45-0400</timestampReceived><subject>Re: [Acpi] Re: Replacing APM</subject><body>

--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:
&gt; 
&gt; Andy Henroid writes:
&gt; &gt;To be a complete replacement for APM, ACPI
&gt; &gt;additionally needs
&gt; &gt;  o Suspend to RAM (S1, S2, or S3 depending)
&gt; 
&gt; But we already have this; I was concentrating on
&gt; what we don't have.

No, we have support for S1 on *some* systems.
We are not currently running the _PTS and _WAK
control methods before going into S1.  Now that the
interpreter is getting more stable with regard to
running control methods, I will be trying that soon.

Anyway, on some systems, you can get away without
running _PTS and _WAK but on others you can't.
This is why S1 support is explicitly marked
as "EXPERIMENTAL" in the kernel and is turned
off by default.

S2 and S3 support is completely lacking.  We need
wide driver power management support before these
work and we need 16 bit resume code.

So, I would definitely not take a "DONE" on
suspend-to-RAM.

&gt; &gt;  o Suspend to disk (S4)
&gt; 
&gt; As nice as that is, and as much as I want it, most
&gt; laptops do not seem
&gt; to have this working reliably under Linux with APM
&gt; so I count this as
&gt; less critical.  It's at least far lower on my
&gt; priority list than suspend
&gt; to RAM.  It's also much harder to get right.

OK, I'll go along with that.  S4 will certainly
be cool once it is working though.

&gt; &gt;  o Video blank
&gt; 
&gt; Again, my laptop blanks the video.  (Heh, even when
&gt; it's not supposed
&gt; to sometimes, as you saw from my bug report)  What's
&gt; missing here?

OK, we have screen blank when in console mode.  We
don't get screen blank when in X or SVGALIB but I
guess APM doesn't either (is that correct?).  When
APM does blank the console (see
apm.c:apm_console_blank) I believe it also turns off
the backlight (for laptops) saving a fair amount
of power.

Some systems provide this to ACPI through _PTS.
Again, this would just need a functioning
interpreter.

&gt; BTW, how important is it to implement the SMBus
&gt; functionality?  If
&gt; it is important, it doesn't look too hard; the only
&gt; thing I'm worried
&gt; about is bus enumeration.  The i2c code in the
&gt; kernel has what looks
&gt; like a nice interface that we can use for acpid and
&gt; which will easily
&gt; convert to a kernel interface once the aml
&gt; interpreter moves into the
&gt; kernel.

SMBus is fairly important to getting full support
for battery and thermal as it will be used to
access smart batteries and thermal sensors on many
systems.  Right, I believe we will be able to use
the i2c code already in the kernel but must admit
I haven't taken a close look yet.

-Andy


__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com

</body></email><email><emailId>20000425094811</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-25 09:48:11-0400</timestampReceived><subject>[Acpi] Re: disassembler enhancements</subject><body>

"Michael K. Johnson" writes:
&gt;Well, I knew that confessing that I was missing something would make me
&gt;find it...  I was missing a single case statement in ns.c; otherwise my
&gt;patch worked perfectly.

...with the appropriate break; statements added to util.c.  &lt;blush&gt;

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000425094325</emailId><senderName>"Yuki Ogawa"</senderName><senderEmail>y-ogawa@dvpj.sony.co.jp</senderEmail><timestampReceived>2000-04-25 09:43:25-0400</timestampReceived><subject>Re: [Acpi] disassembler enhancements</subject><body>

microsoft ACPIVIEW shows lots of information.
http://www.microsoft.com/hwdev/acpihct.htm

----- Original Message ----- 
From: "Michael K. Johnson" &lt;johnsonm@redhat.com&gt;
To: &lt;acpi@phobos.fachschaften.tu-muenchen.de&gt;
Sent: Tuesday, April 25, 2000 6:05 PM
Subject: [Acpi] disassembler enhancements


&gt; 
&gt; Has anyone worked on making the disassembler more useful by interpreting
&gt; some of the fields that are currently presented only in numeric format?
&gt; For example, it would be easier to read Field's FieldFlags and OpRegion's
&gt; RegionSpace if they were spelled out in the output.
&gt; 
&gt; I'm not sure how to fit this into the architecture.  I have tried two
&gt; different approaches to breaking out FieldFlags and haven't been
&gt; successful because I tried to do it quickly without grokking the whole
&gt; structure...  :-)
&gt; 
&gt; Andy, this is your code; any suggestions on how to do this cleanly?  I
&gt; am not sure that it makes sense to create fake ops and args for each
&gt; of these types of objects.  Perhaps I need a new construct of some
&gt; sort?  If acpi_sprint_op could eat following ops, I could do all the
&gt; mangling there -- e.g. if FIELD, then eat the following BYTECONST and
&gt; print it my own way.
&gt; 
&gt; michaelkjohnson
&gt; 
&gt; "Magazines all too frequently lead to books and should be regarded by the
&gt;  prudent as the heavy petting of literature."            -- Fran Lebowitz
&gt;  Linux Application Development     http://people.redhat.com/johnsonm/lad/
&gt; 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; 

</body></email><email><emailId>20000424194042</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-24 19:40:42-0400</timestampReceived><subject>Re: [Acpi] Replacing APM</subject><body>

--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:
&gt; 
&gt; I've been thinking about what ACPI needs to be able
&gt; to do to replace APM for people used to APM under
&gt; Linux.  As I see
&gt; it, we need at least:
&gt;  o  Lid events
&gt;  o  Suspend key(s) handling
&gt;  o  Battery status reporting, via
&gt;     - CMBatt
&gt;     - Smart Battery
&gt; Is there anything else missing that people are used
&gt; to getting with APM for Linux that ACPI for Linux
&gt; doesn't yet provide?

To be a complete replacement for APM, ACPI
additionally needs
  o Suspend to RAM (S1, S2, or S3 depending)
  o Suspend to disk (S4)
  o Video blank

The kernel-side support for Lid is already
there.  It's just a matter of looking up which
GPE correlates to the Lid for your system and
enabling it.

-Andy



__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com

</body></email><email><emailId>20000424194245</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-24 19:42:45-0400</timestampReceived><subject>Re: [Acpi] Replacing APM</subject><body>

--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:
&gt; 
&gt; I've been thinking about what ACPI needs to be able
&gt; to do to replace
&gt; APM for people used to APM under Linux.  As I see

Oh, and to my list let me add battery status,
of course.

-Andy


__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com

</body></email><email><emailId>20000422103846</emailId><senderName>SÃ©bastien Bernard</senderName><senderEmail>bernarbs@club-internet.fr</senderEmail><timestampReceived>2000-04-22 10:38:46-0400</timestampReceived><subject>[Fwd: [Acpi] Back to ACPI]</subject><body>

Il s'agit d'un message multivolet au format MIME.



X-Mozilla-Status2: 00000000
Message-ID: &lt;3901804C.8C0F128B@club-internet.fr&gt;
Date: Sat, 22 Apr 2000 12:34:52 +0200
From: =?iso-8859-1?Q?S=E9bastien?= Bernard &lt;bernarbs@club-internet.fr&gt;
X-Mailer: Mozilla 4.7 [fr] (X11; I; Linux 2.3.99-pre5 i586)
X-Accept-Language: en
To: Andy Henroid &lt;andy_henroid@yahoo.com&gt;
Subject: Re: [Acpi] Back to ACPI
References: &lt;20000421234723.4019.qmail@web1303.mail.yahoo.com&gt;
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: Quoted-Printable

Andy Henroid a =E9crit :

&gt; --- S=E9bastien Bernard &lt;bernarbs@club-internet.fr&gt;
&gt; wrote:
&gt;
&gt; &gt; The hang in my laptop is caused by the acpi_irq
&gt; &gt; which get called over
&gt; &gt; and over without reason.
&gt; &gt; I traced the values from the call :
&gt; &gt; pm1_status 0x00000100 pm1_enable 0x00000001
&gt; &gt; gpe_status0x07000000 gpe_enable 0x0000000
&gt; &gt; I used %08x for printing those values.
&gt;
&gt; &gt;From above, it doesn't look like an ACPI event is
&gt; triggering the IRQ.  Is ACPI sharing an IRQ with
&gt; any other device?  Look at /proc/interrupts.
&gt;
&gt; -Andy
&gt;
&gt; __________________________________________________
&gt; Do You Yahoo!?
&gt; Send online invitations with Yahoo! Invites.
&gt; http://invites.yahoo.com

No, no sharing, this is the first handler installed.
This is irq 9.



</body></email><email><emailId>20000424202550</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-24 20:25:50-0400</timestampReceived><subject>Re: [Acpi] random ACPI bugs on Dell Inspiron 7500</subject><body>

--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:
&gt; 
&gt; I've cleverly worded the subject to avoid assigning
&gt; blame for the bugs;
&gt; I don't know whose fault they are.

Right, ambiguity is useful that way  :)

Well, the fix will probably have to come from the
software side anyway so you might as well assign
blame there by default.

&gt; Here is what I have seen so far:
&gt; 
&gt;  o  Once only, acpid -d blanked the screen and the
&gt; screeen would not
&gt;     come to life again without a complete reboot. 

Now that is very odd.  Is this with the experimental
S1 support turned on?  The code paths for blanking
the screen from ACPI are not even accessible unless
you turn that on and even so will not be run unless
you do an explicit 'echo 1 &gt; /proc/sys/acpi/sleep'

Could this be related to your APM BIOS oddity
metioned below?

&gt;  o  If I press the power button immediately after
&gt; starting acpid,
&gt;     it does a proper shutdown, but if I suspend
&gt; first (with the
&gt;     echo trick mentioned above) and then bring the
&gt; machine back to
&gt;     life with the power button, acpid reports all
&gt; further presses

Ah, yes, this one looks like a bug.  In acpi_enter_sx,
acpi_sleep_state should be returned to 0 following
the wake from S1.  Otherwise, acpid just thinks it
is being woken from S1 repeatedly.  I will send out
a patch shortly.

&gt;  o  The suspend key, which works without any
&gt; assistance (from text
&gt;     mode, anyway) without acpid running, quits
&gt; working entirely when
&gt;     acpid is running.  I would have assumed that it
&gt; is the sleep

Hmm...  Without acpid running, ACPI certainly is
not doing the suspend.  It sounds like APM is
actually doing your suspend.  How can that be
if APM is not engaged?  Strange (illegal?)
behavior of the APM BIOS.

acpid turns ACPI on when it is run (remaps the
SMI to the ACPI SCI and completely disables
APM) and that is why your APM suspend key
stops working.

Now, once ACPI is on, hopefully the suspend key
would generate an ACPI event.  You can
tell this from the disassembled AML or you
can figure it out experimentally as follows

  &lt;clean boot and don't start acpid&gt;
  # enable all fixed and general purpose events
  echo 0xffffffff &gt; /proc/sys/acpi/pm1_enable
  echo 0xffffffff &gt; /proc/sys/acpi/gpe_enable
  cat /proc/sys/acpi/event
  &lt;press suspend key&gt;

Now do you see an event occurring?  Hopefully,
otherwise this will call for modification of
the keyboard driver to support your suspend
key.

&gt;  o  Entering sleep does not spin down the hard
&gt; drive.  I don't know

Running in ACPI mode, the BIOS expects the OS
(drivers) to spin down the harddrive whereas
with APM, the BIOS takes care of all of that.
For ACPI we need additional driver support
for suspend/resume including HD/IDE/PCI
PM work.

-Andy



__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com

</body></email><email><emailId>20000424233617</emailId><senderName>Crispin Flowerday</senderName><senderEmail>cehf2@hermes.cam.ac.uk</senderEmail><timestampReceived>2000-04-24 23:36:17-0400</timestampReceived><subject>Re: [Acpi] ACPI Problems...</subject><body>

this was *possibly* my mistake, my ABIT (BH6) really ought to have 

echo 0 &gt; /proc/sys/acpi/s5_slp_typ

this is based on what Andy said. 

I am assuming the "wake up on..." should not affect the computer at all as
it should be in the S5 state - which is power off, completely.

just a thought.

Crispin

*Windows leads to anger, Anger leads to hate, Hate leads to Linux*

On Mon, 24 Apr 2000, Tony Hoyle wrote:

&gt; Hi,
&gt; 
&gt; Has the ACPI parsing bug been fixed yet?  I notice the CVS tree hasn't
&gt; been updated for some time, and I would like to use ACPI on my mobo
&gt; (BP6).
&gt; 
&gt; Also, I notice that acpi 'power off' doesn't seem to work properly.  I
&gt; echo 1 &gt;/proc/sys/acpi/s5_slp_typ, and it
&gt; successfully powers off...  for about half an hour, then it powers up
&gt; again.  I have switched off all the 'wake up on..'
&gt; options in the BIOS.  I'm guessing a BIOS bug rather than an ACPI one,
&gt; though.
&gt; 
&gt; Tony
&gt; 
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; 

</body></email><email><emailId>20000425012812</emailId><senderName>"Yuki Ogawa"</senderName><senderEmail>y-ogawa@dvpj.sony.co.jp</senderEmail><timestampReceived>2000-04-25 01:28:12-0400</timestampReceived><subject>Re: [Acpi] Replacing APM</subject><body>

ThermalZone support for cooling FAN is important.
Because system shuts down criticaly if temperature is too high.

----- Original Message ----- 
From: "Andy Henroid" &lt;andy_henroid@yahoo.com&gt;
To: "Michael K. Johnson" &lt;johnsonm@redhat.com&gt;
Cc: &lt;acpi@phobos.fachschaften.tu-muenchen.de&gt;
Sent: Tuesday, April 25, 2000 4:42 AM
Subject: Re: [Acpi] Replacing APM


&gt; --- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:
&gt; &gt; 
&gt; &gt; I've been thinking about what ACPI needs to be able
&gt; &gt; to do to replace
&gt; &gt; APM for people used to APM under Linux.  As I see
&gt; 
&gt; Oh, and to my list let me add battery status,
&gt; of course.
&gt; 
&gt; -Andy
&gt; 
&gt; 
&gt; __________________________________________________
&gt; Do You Yahoo!?
&gt; Send online invitations with Yahoo! Invites.
&gt; http://invites.yahoo.com
&gt; 
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; 

</body></email><email><emailId>20000425094941</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-25 09:49:41-0400</timestampReceived><subject>Re: [Acpi] disassembler enhancements</subject><body>

"Yuki Ogawa" writes:
&gt;microsoft ACPIVIEW shows lots of information.

I don't have any microsoft products on this machine, and as long as I
can work with free source code, I don't see why I shouldn't improve
Andy's program...  Thanks, though...

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000425104505</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-25 10:45:05-0400</timestampReceived><subject>[Acpi] Re: disassembler enhancements</subject><body>

There were fewer of these bitfields than I thought; I think I have
added them all now, and I fixed a few more bugs in my previous
patch (I keep forgetting not to use the word "perfectly" in reference
to source code...) and here's the whole thing, which seems to work
fine for me.

I have not included the amlop.{c,h} patches as they will be regenerated
when you run mkaml.

Again, let me know if you think these patches are bad and I can change
them.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

diff -u --recursive pmtools/acpidisasm/amlop.txt pmtools.new/acpidisasm/amlop.txt
--- pmtools/acpidisasm/amlop.txt	Thu Nov 18 00:33:57 1999
+++ pmtools.new/acpidisasm/amlop.txt	Tue Apr 25 12:35:31 2000
@@ -16,7 +16,7 @@
 0x10 Scope PkgLength NameString TermList
 0x11 Buffer PkgLength TermArg ByteList
 0x12 Package PkgLength ByteData DataObjectList
-0x14 Method PkgLength NameString ByteData TermList
+0x14 Method PkgLength NameString MethodFlags TermList
 0x2d* NamePath
 0x2e* DualNamePath
 0x2f* MultiNamePath
@@ -26,8 +26,12 @@
 0x33* ByteList
 0x34* StaticString
 0x35* MethodCall
+0x4c* FieldFlags
+0x4d* MethodFlags
+0x52* RegionSpace
+0x53* SyncFlags
 0x5b* ExtOp
-0x5b01 Mutex NameString ByteData
+0x5b01 Mutex NameString SyncFlags
 0x5b02 Event NameString
 0x5b12 CondRefOf SuperName SuperName
 0x5b13 CreateField TermArg TermArg TermArg NameString
@@ -45,8 +49,8 @@
 0x5b30 Revision
 0x5b31 Debug
 0x5b32 Fatal ByteData DWordData TermArg
-0x5b80 OpRegion NameString ByteData TermArg TermArg
-0x5b81 Field PkgLength NameString ByteData FieldList
+0x5b80 OpRegion NameString RegionSpace TermArg TermArg
+0x5b81 Field PkgLength NameString FieldFlags FieldList
 0x5b82 Device PkgLength NameString ObjectList
 0x5b83 Processor PkgLength NameString ByteData DWordData ByteData ObjectList
 0x5b84 PowerRes PkgLength NameString ByteData WordData ObjectList
diff -u --recursive pmtools/acpidisasm/mkaml pmtools.new/acpidisasm/mkaml
--- pmtools/acpidisasm/mkaml	Thu Nov 18 00:33:57 1999
+++ pmtools.new/acpidisasm/mkaml	Tue Apr 25 12:35:52 2000
@@ -12,21 +12,26 @@
 $AML_LNOT_HASH_OFFSET = 19;
 $AML_EXTOP_HASH_OFFSET = 22;
 
-%arg_to_code = ("PkgLength"=&gt;"p",
-		"NameString"=&gt;"n",
-		"ByteData"=&gt;"b",
-		"WordData"=&gt;"w",
+# Keep this alphabetical to make it easier to add new items
+%arg_to_code = ("ByteData"=&gt;"b",
 		"DWordData"=&gt;"d",
-		"TermArg"=&gt;"t",
+		"Target"=&gt;"l",
+		"NameString"=&gt;"n",
 		"DataObject"=&gt;"o",
-		"TermList"=&gt;"T",
+		"PkgLength"=&gt;"p",
+		"SuperName"=&gt;"s",
+		"TermArg"=&gt;"t",
+		"WordData"=&gt;"w",
+		"AsciiCharList"=&gt;"A",
+		"ByteList"=&gt;"B",
+		"FieldList"=&gt;"F",
+		"FieldFlags"=&gt;"L",
+		"MethodFlags"=&gt;"M",
 		"DataObjectList"=&gt;"O",
 		"ObjectList"=&gt;"P",
-		"FieldList"=&gt;"F",
-		"ByteList"=&gt;"B",
-		"SuperName"=&gt;"s",
-		"Target"=&gt;"l",
-		"AsciiCharList"=&gt;"A");
+		"RegionSpace"=&gt;"R",
+		"SyncFlags"=&gt;"S",
+		"TermList"=&gt;"T");
 
 @opcode_to_name = ();
 @opcode_to_args = ();
diff -u --recursive pmtools/acpidisasm/ns.c pmtools.new/acpidisasm/ns.c
--- pmtools/acpidisasm/ns.c	Mon Apr 24 23:14:36 2000
+++ pmtools.new/acpidisasm/ns.c	Tue Apr 25 12:36:33 2000
@@ -27,6 +27,10 @@
     case AML_DWORDCONST:
     case AML_STRING:
     case AML_STATICSTRING:
+    case AML_FIELDFLAGS:
+    case AML_REGIONSPACE:
+    case AML_METHODFLAGS:
+    case AML_SYNCFLAGS:
 
     case AML_NAMEPATH:
     case AML_NAMEDFIELD:
diff -u --recursive pmtools/acpidisasm/parse.c pmtools.new/acpidisasm/parse.c
--- pmtools/acpidisasm/parse.c	Thu Mar 16 03:18:07 2000
+++ pmtools.new/acpidisasm/parse.c	Tue Apr 25 12:37:17 2000
@@ -367,6 +367,27 @@
         arg-&gt;opcode = AML_NAMEPATH;
         arg-&gt;value.name = acpi_next_namestring(state);
         break;
+
+    case AML_FIELDFLAGS_ARG:
+	arg-&gt;opcode = AML_FIELDFLAGS;
+	arg-&gt;value.integer = (u32) readb(state-&gt;aml);
+	state-&gt;aml++;
+	break;
+    case AML_REGIONSPACE_ARG:
+	arg-&gt;opcode = AML_REGIONSPACE;
+	arg-&gt;value.integer = (u32) readb(state-&gt;aml);
+	state-&gt;aml++;
+	break;
+    case AML_METHODFLAGS_ARG:
+	arg-&gt;opcode = AML_METHODFLAGS;
+	arg-&gt;value.integer = (u32) readb(state-&gt;aml);
+	state-&gt;aml++;
+	break;
+    case AML_SYNCFLAGS_ARG:
+	arg-&gt;opcode = AML_SYNCFLAGS;
+	arg-&gt;value.integer = (u32) readb(state-&gt;aml);
+	state-&gt;aml++;
+	break;
     }
 }
 
@@ -494,6 +515,10 @@
     case AML_DWORDDATA_ARG:
     case AML_ASCIICHARLIST_ARG:
     case AML_NAMESTRING_ARG:
+    case AML_REGIONSPACE_ARG:
+    case AML_FIELDFLAGS_ARG:
+    case AML_METHODFLAGS_ARG:
+    case AML_SYNCFLAGS_ARG:
         // constants, strings, and namestrings are all the same size
         arg = acpi_alloc_op(AML_BYTECONST);
         if(arg)
@@ -588,6 +613,9 @@
             *arg_count = ACPI_VAR_ARGS;
         }
         break;
+    default:
+	// Forgot to add a case above after modifying amlop.txt and mkaml
+	*((int *)0) = 0;
     }
 
     return arg;
diff -u --recursive pmtools/acpidisasm/util.c pmtools.new/acpidisasm/util.c
--- pmtools/acpidisasm/util.c	Thu Mar 16 03:34:27 2000
+++ pmtools.new/acpidisasm/util.c	Tue Apr 25 12:38:57 2000
@@ -342,6 +342,82 @@
         case AML_ACCESSFIELD:
             size = acpi_safe_sprintf(buffer, buffer_size, 0, "AccessField");
             break;
+
+	case AML_FIELDFLAGS:
+	    {
+		char *access_type, *lock_rule, *update_rule;
+		switch(0xF &amp; (u8) op-&gt;value.integer)
+		{
+		    case 0: access_type = "AnyAcc"; break;
+		    case 1: access_type = "ByteAcc"; break;
+		    case 2: access_type = "WordAcc"; break;
+		    case 3: access_type = "DWordAcc"; break;
+		    case 4: access_type = "BlockAcc"; break;
+		    case 5: access_type = "SMBSendRecvAcc"; break;
+		    case 6: access_type = "SMBQuickAcc"; break;
+		}
+		switch((0x10 &amp; (u8) op-&gt;value.integer) &gt;&gt; 4)
+		{
+		    case 0: lock_rule = "NoLock"; break;
+		    case 1: lock_rule = "Lock"; break;
+		}
+		switch((0x60 &amp; (u8) op-&gt;value.integer) &gt;&gt; 5)
+		{
+		    case 0: update_rule = "Preserve"; break;
+		    case 1: update_rule = "WriteAsOnes"; break;
+		    case 2: update_rule = "WriteAsZeros"; break;
+		}
+		size = acpi_safe_sprintf(buffer, buffer_size, 0, 
+		    "AccessType: %s; "
+		    "LockRule: %s; "
+		    "UpdateRule: %s",
+		    access_type, lock_rule, update_rule);
+	    }
+	    break;
+
+	case AML_REGIONSPACE:
+	    {
+		char *region;
+		switch(op-&gt;value.integer)
+		{
+		    case 0: region = "SystemMemory"; //no break;
+		    case 1: region = "SystemIO"; //no break;
+		    case 2: region = "PCI_Config"; //no break;
+		    case 3: region = "EmbeddedControl"; //no break;
+		    case 4: region = "SMBus"; //no break;
+			size = acpi_safe_sprintf(buffer, buffer_size, 0, 
+			    region);
+			break;
+		    default:
+			size = acpi_safe_sprintf(buffer, buffer_size, 0, 
+			    "User-defined: 0x%x", op-&gt;value.integer &amp; 0xff);
+			break;
+		}
+	    }
+	    break;
+
+	case AML_METHODFLAGS:
+	    {
+		int arg_count;
+		char *serialize;
+
+		arg_count = (0x7 &amp; (u8) op-&gt;value.integer);
+
+		if (0x8 &amp; (u8) op-&gt;value.integer)
+		    serialize = "Serialized";
+		else
+		    serialize = "NotSerialized";
+
+		size = acpi_safe_sprintf(buffer, buffer_size, 0, 
+		    "ArgCount %d; %s", arg_count, serialize);
+	    }
+	    break;
+
+	case AML_SYNCFLAGS:
+	    size = acpi_safe_sprintf(buffer, buffer_size, 0, 
+		"SyncLevel 0x%x", 0xf &amp; op-&gt;value.integer);
+	    break;
+
         case AML_BYTELIST:
 	    {
 		    struct acpi_extra_op *extra

</body></email><email><emailId>20000425194510</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-25 19:45:10-0400</timestampReceived><subject>[Acpi] Re: Replacing APM</subject><body>

Andy Henroid writes:
&gt;S2 and S3 support is completely lacking.  We need
&gt;wide driver power management support before these
&gt;work and we need 16 bit resume code.

They are not necessary to sufficiently replace APM in
the Linux context.  I am very explicitly talking about
meeting Linux users' expectations of ACPI that have been
set by APM.  I am trying to avoid talking about a complete
implementation in order to get something sufficiently
working in the short term.

This has nothing to do with marking any feature as "DONE".
This has only to do with marking features "will suffice
for the short term for people used to APM support under
Linux" or "will not satisfy people used to APM support
under Linux".

&gt;OK, we have screen blank when in console mode.  We
&gt;don't get screen blank when in X or SVGALIB but I
&gt;guess APM doesn't either (is that correct?).

Machine-dependent.  Some APM bioses save the video
state sufficiently, others don't.  My wife's VAIO
can save to disk from X mode and restore completely
and correctly, but that's unusual.  It's far more
common to have to switch to a text console before
suspending even to RAM, from what I have heard.

&gt;Some systems provide this to ACPI through _PTS.
&gt;Again, this would just need a functioning
&gt;interpreter.

I'm surprised that they are any that do not provide
this to ACPI.

&gt;SMBus is fairly important to getting full support
&gt;for battery and thermal as it will be used to
&gt;access smart batteries and thermal sensors on many
&gt;systems.  Right, I believe we will be able to use
&gt;the i2c code already in the kernel but must admit
&gt;I haven't taken a close look yet.

The Documentation/i2c directory has documentation that
should be sufficient for this purpose, I think.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000425195400</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-25 19:54:00-0400</timestampReceived><subject>[Acpi] Re: acpid and pmtools release</subject><body>

Andy Henroid writes:
&gt;OK, looks good.  Yes, creating new fake ops does
&gt;seem to be the least painful way to do it considering
&gt;non-recursive acpi_show and acpi_sprint_op.

OK, good.

&gt;I'll merge these changes into acpidisasm.

Oops, my stupidity, please try the enclosed patch instead...

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

diff -u --recursive pmtools/acpidisasm/amlop.txt pmtools.new/acpidisasm/amlop.txt
--- pmtools/acpidisasm/amlop.txt	Tue Apr 25 16:37:11 2000
+++ pmtools.new/acpidisasm/amlop.txt	Tue Apr 25 21:04:57 2000
@@ -16,7 +16,7 @@
 0x10 Scope PkgLength Name TermList
 0x11 Buffer PkgLength TermArg ByteList
 0x12 Package PkgLength ByteData DataObjectList
-0x14 Method PkgLength Name ByteData TermList
+0x14 Method PkgLength Name MethodFlags TermList
 0x2d* NamePath
 0x2e* DualNamePath
 0x2f* MultiNamePath
@@ -26,8 +26,12 @@
 0x33* ByteList
 0x34* StaticString
 0x35* MethodCall
+0x4c* FieldFlags
+0x4d* MethodFlags
+0x52* RegionSpace
+0x53* SyncFlags
 0x5b* ExtOp
-0x5b01 Mutex Name ByteData
+0x5b01 Mutex Name SyncFlags
 0x5b02 Event Name
 0x5b12 CondRefOf SuperName SuperName
 0x5b13 CreateField TermArg TermArg TermArg Name
@@ -45,8 +49,8 @@
 0x5b30 Revision
 0x5b31 Debug
 0x5b32 Fatal ByteData DWordData TermArg
-0x5b80 OpRegion Name ByteData TermArg TermArg
-0x5b81 Field PkgLength NameString ByteData FieldList
+0x5b80 OpRegion Name RegionSpace TermArg TermArg
+0x5b81 Field PkgLength NameString FieldFlags FieldList
 0x5b82 Device PkgLength Name ObjectList
 0x5b83 Processor PkgLength Name ByteData DWordData ByteData ObjectList
 0x5b84 PowerRes PkgLength Name ByteData WordData ObjectList
diff -u --recursive pmtools/acpidisasm/mkaml pmtools.new/acpidisasm/mkaml
--- pmtools/acpidisasm/mkaml	Tue Apr 25 16:37:11 2000
+++ pmtools.new/acpidisasm/mkaml	Tue Apr 25 21:08:36 2000
@@ -12,22 +12,27 @@
 $AML_LNOT_HASH_OFFSET = 19;
 $AML_EXTOP_HASH_OFFSET = 22;
 
-%arg_to_code = ("PkgLength"=&gt;"p",
-		"Name"=&gt;"N",
-		"NameString"=&gt;"n",
-		"ByteData"=&gt;"b",
-		"WordData"=&gt;"w",
+# Keep this alphabetical to make it easier to add new items
+%arg_to_code = ("ByteData"=&gt;"b",
 		"DWordData"=&gt;"d",
-		"TermArg"=&gt;"t",
+		"Target"=&gt;"l",
+		"NameString"=&gt;"n",
 		"DataObject"=&gt;"o",
-		"TermList"=&gt;"T",
+		"PkgLength"=&gt;"p",
+		"SuperName"=&gt;"s",
+		"TermArg"=&gt;"t",
+		"WordData"=&gt;"w",
+		"AsciiCharList"=&gt;"A",
+		"ByteList"=&gt;"B",
+		"FieldList"=&gt;"F",
+		"FieldFlags"=&gt;"L",
+		"MethodFlags"=&gt;"M",
+		"Name"=&gt;"N",
 		"DataObjectList"=&gt;"O",
 		"ObjectList"=&gt;"P",
-		"FieldList"=&gt;"F",
-		"ByteList"=&gt;"B",
-		"SuperName"=&gt;"s",
-		"Target"=&gt;"l",
-		"AsciiCharList"=&gt;"A");
+		"RegionSpace"=&gt;"R",
+		"SyncFlags"=&gt;"S",
+		"TermList"=&gt;"T");
 
 @opcode_to_name = ();
 @opcode_to_args = ();
diff -u --recursive pmtools/acpidisasm/ns.c pmtools.new/acpidisasm/ns.c
--- pmtools/acpidisasm/ns.c	Tue Apr 25 16:37:11 2000
+++ pmtools.new/acpidisasm/ns.c	Tue Apr 25 21:09:32 2000
@@ -27,6 +27,10 @@
 	case AML_DWORDCONST:
 	case AML_STRING:
 	case AML_STATICSTRING:
+	case AML_FIELDFLAGS:
+	case AML_REGIONSPACE:
+	case AML_METHODFLAGS:
+	case AML_SYNCFLAGS:
 
 	case AML_NAMEPATH:
 	case AML_NAMEDFIELD:
diff -u --recursive pmtools/acpidisasm/parse.c pmtools.new/acpidisasm/parse.c
--- pmtools/acpidisasm/parse.c	Tue Apr 25 16:37:11 2000
+++ pmtools.new/acpidisasm/parse.c	Tue Apr 25 21:12:51 2000
@@ -369,6 +369,27 @@
 		arg-&gt;opcode = AML_NAMEPATH;
 		arg-&gt;value.name = acpi_next_namestring(state);
 		break;
+
+	case AML_FIELDFLAGS_ARG:
+		arg-&gt;opcode = AML_FIELDFLAGS;
+		arg-&gt;value.integer = (u32) readb(state-&gt;aml);
+		state-&gt;aml++;
+		break;
+	case AML_REGIONSPACE_ARG:
+		arg-&gt;opcode = AML_REGIONSPACE;
+		arg-&gt;value.integer = (u32) readb(state-&gt;aml);
+		state-&gt;aml++;
+		break;
+	case AML_METHODFLAGS_ARG:
+		arg-&gt;opcode = AML_METHODFLAGS;
+		arg-&gt;value.integer = (u32) readb(state-&gt;aml);
+		state-&gt;aml++;
+		break;
+	case AML_SYNCFLAGS_ARG:
+		arg-&gt;opcode = AML_SYNCFLAGS;
+		arg-&gt;value.integer = (u32) readb(state-&gt;aml);
+		state-&gt;aml++;
+		break;
 	}
 }
 
@@ -500,6 +521,10 @@
 	case AML_ASCIICHARLIST_ARG:
 	case AML_NAMESTRING_ARG:
 	case AML_NAME_ARG:
+	case AML_REGIONSPACE_ARG:
+	case AML_FIELDFLAGS_ARG:
+	case AML_METHODFLAGS_ARG:
+	case AML_SYNCFLAGS_ARG:
 		// constants, strings, and namestrings are all the same size
 		arg = acpi_alloc_op(AML_BYTECONST);
 		if(arg)
@@ -601,6 +626,9 @@
 			*arg_count = ACPI_VAR_ARGS;
 		}
 		break;
+	default:
+		// Missing a case above after modifying amlop.txt and mkaml
+		*((int *)0) = 0;
 	}
 
 	return arg;
diff -u --recursive pmtools/acpidisasm/util.c pmtools.new/acpidisasm/util.c
--- pmtools/acpidisasm/util.c	Tue Apr 25 16:37:11 2000
+++ pmtools.new/acpidisasm/util.c	Tue Apr 25 21:43:20 2000
@@ -352,6 +352,80 @@
 						 0,
 						 "AccessField");
 			break;
+
+		case AML_FIELDFLAGS:
+		{
+			char *access_type, *lock_rule, *update_rule;
+			switch(0xF &amp; (u8) op-&gt;value.integer)
+			{
+				case 0: access_type = "AnyAcc"; break;
+				case 1: access_type = "ByteAcc"; break;
+				case 2: access_type = "WordAcc"; break;
+				case 3: access_type = "DWordAcc"; break;
+				case 4: access_type = "BlockAcc"; break;
+				case 5: access_type = "SMBSendRecvAcc"; break;
+				case 6: access_type = "SMBQuickAcc"; break;
+			}
+			switch((0x10 &amp; (u8) op-&gt;value.integer) &gt;&gt; 4)
+			{
+				case 0: lock_rule = "NoLock"; break;
+				case 1: lock_rule = "Lock"; break;
+			}
+			switch((0x60 &amp; (u8) op-&gt;value.integer) &gt;&gt; 5)
+			{
+				case 0: update_rule = "Preserve"; break;
+				case 1: update_rule = "WriteAsOnes"; break;
+				case 2: update_rule = "WriteAsZeros"; break;
+			}
+			size = acpi_safe_sprintf(buffer, buffer_size, 0, 
+				"AccessType: %s; "
+				"LockRule: %s; "
+				"UpdateRule: %s",
+				access_type, lock_rule, update_rule);
+			break;
+		}
+
+		case AML_REGIONSPACE:
+		{
+			char *region = NULL;
+			switch(op-&gt;value.integer)
+			{
+				case 0: region = "SystemMemory"; break;
+				case 1: region = "SystemIO"; break;
+				case 2: region = "PCI_Config"; break;
+				case 3: region = "EmbeddedControl"; break;
+				case 4: region = "SMBus"; break;
+			}
+			if (region)
+				size = acpi_safe_sprintf(buffer, buffer_size, 0, region);
+			else
+				size = acpi_safe_sprintf(buffer, buffer_size, 0, 
+					"User-defined: 0x%x", op-&gt;value.integer &amp; 0xff);
+			break;
+		}
+
+		case AML_METHODFLAGS:
+		{
+			int arg_count;
+			char *serialize;
+
+			arg_count = (0x7 &amp; (u8) op-&gt;value.integer);
+
+			if (0x8 &amp; (u8) op-&gt;value.integer)
+				serialize = "Serialized";
+			else
+				serialize = "NotSerialized";
+
+			size = acpi_safe_sprintf(buffer, buffer_size, 0, 
+				"ArgCount %d; %s", arg_count, serialize);
+			break;
+		}
+
+		case AML_SYNCFLAGS:
+			size = acpi_safe_sprintf(buffer, buffer_size, 0, 
+				"SyncLevel 0x%x", 0xf &amp; op-&gt;value.integer);
+			break;
+
 		case AML_BYTELIST:
 			{
 				struct acpi_extra_op *extra

</body></email><email><emailId>20000426133047</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-04-26 13:30:47-0400</timestampReceived><subject>[Acpi] [PATCH] PCI quirk for VIA ACPI device (fwd)</subject><body>

---------- Forwarded message ----------
Date: Wed, 26 Apr 2000 12:28:55 +0400
From: Andrey Panin &lt;pazke@orbita.don.sitek.net&gt;
Subject: [PATCH] PCI quirk for VIA ACPI device

Hi all,

this patch (against 2.3.99-pre5) provides PCI quirk for VIA ACPI device (same as for \
Intel and ALI). Also modified PIIX4 and VIA support in /linux/arch/i386/kernel/acpi.c \
to use ioport  base address from pci_dev structure.

Best  wishes,
                    Andrey

diff -urN /mnt/d/linux/drivers/pci/quirks.c /linux/drivers/pci/quirks.c
--- /mnt/d/linux/drivers/pci/quirks.c   Fri Apr 21 19:00:22 2000
+++ /linux/drivers/pci/quirks.c Tue Apr  4 00:47:22 2000
@@ -164,6 +164,23 @@
 }

 /*
+ * VIA ACPI: One IO region pointed to by longword at
+ *     0x48 or 0x20 (256 bytes of ACPI registers)
+ */
+static void __init quirk_via_acpi(struct pci_dev *dev)
+{
+       u8 rev;
+       u32 region;
+
+       pci_read_config_byte(dev, PCI_CLASS_REVISION, &amp;rev);
+       rev = (rev &amp; 0x10 ? 0x48 : 0x20);
+
+       pci_read_config_dword(dev, rev, &amp;region);
+       region &amp;= PCI_BASE_ADDRESS_IO_MASK;
+       quirk_io_region(dev, region, 256, PCI_BRIDGE_RESOURCES);
+}
+
+/*
  *  The main table of quirks.
  */

@@ -192,6 +209,8 @@
        { PCI_FIXUP_FINAL,      PCI_VENDOR_ID_INTEL,    \
                PCI_DEVICE_ID_INTEL_82443BX_2,  quirk_natoma },
        { PCI_FIXUP_FINAL,      PCI_VENDOR_ID_SI,       PCI_DEVICE_ID_SI_5597,        \
                quirk_nopcipci },
        { PCI_FIXUP_FINAL,      PCI_VENDOR_ID_SI,       PCI_DEVICE_ID_SI_496,         \
quirk_nopcipci }, +       { PCI_FIXUP_FINAL,      PCI_VENDOR_ID_VIA,      \
PCI_DEVICE_ID_VIA_82C586_3,     quirk_via_acpi }, +       { PCI_FIXUP_FINAL,      \
                PCI_VENDOR_ID_VIA,      PCI_DEVICE_ID_VIA_82C686_4,     \
                quirk_via_acpi },
        { PCI_FIXUP_FINAL,      PCI_VENDOR_ID_INTEL,    \
                PCI_DEVICE_ID_INTEL_82371AB_3,  quirk_piix4acpi },
        { PCI_FIXUP_FINAL,      PCI_VENDOR_ID_AL,       PCI_DEVICE_ID_AL_M7101,       \
quirk_ali7101 },  { 0 }
diff -urN /mnt/d/linux/arch/i386/kernel/acpi.c /linux/arch/i386/kernel/acpi.c
--- /mnt/d/linux/arch/i386/kernel/acpi.c        Fri Apr 21 19:00:44 2000
+++ /linux/arch/i386/kernel/acpi.c      Wed Apr 19 23:47:57 2000
@@ -629,11 +629,7 @@
        if (!(pmregmisc &amp; ACPI_PIIX4_PMIOSE))
                return -ENODEV;

-       pci_read_config_dword(dev, 0x40, &amp;base);
-       if (!(base &amp; PCI_BASE_ADDRESS_SPACE_IO))
-               return -ENODEV;
-
-       base &amp;= PCI_BASE_ADDRESS_IO_MASK;
+       base = dev-&gt;resource[PCI_BRIDGE_RESOURCES].start &amp; PCI_BASE_ADDRESS_IO_MASK;
        if (!base)
                return -ENODEV;

@@ -686,14 +682,7 @@
        if (!(tmp &amp; 0x80))
                return -ENODEV;

-       pci_read_config_byte(dev, PCI_CLASS_REVISION, &amp;tmp);
-       tmp = (tmp &amp; 0x10 ? 0x48 : 0x20);
-
-       pci_read_config_dword(dev, tmp, &amp;base);
-       if (!(base &amp; PCI_BASE_ADDRESS_SPACE_IO))
-               return -ENODEV;
-
-       base &amp;= PCI_BASE_ADDRESS_IO_MASK;
+       base = dev-&gt;resource[PCI_BRIDGE_RESOURCES].start &amp; PCI_BASE_ADDRESS_IO_MASK;
        if (!base)
                return -ENODEV;





-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at http://www.tux.org/lkml/


</body></email><email><emailId>20000426150231</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-04-26 15:02:31-0400</timestampReceived><subject>[Acpi] Re: [PATCH] PCI quirk for VIA ACPI device (fwd)</subject><body>

---------- Forwarded message ----------
Date: Wed, 26 Apr 2000 16:08:17 +0200
From: Martin Mares &lt;mj@suse.cz&gt;
Cc: Linux kernel mailng list. &lt;linux-kernel@vger.rutgers.edu&gt;
Subject: Re: [PATCH] PCI quirk for VIA ACPI device

Hello!

&gt; this patch (against 2.3.99-pre5) provides PCI quirk for VIA ACPI device (same as for Intel and ALI).
&gt; Also modified PIIX4 and VIA support in /linux/arch/i386/kernel/acpi.c to use ioport 
&gt; base address from pci_dev structure.

&gt; +       pci_read_config_byte(dev, PCI_CLASS_REVISION, &amp;rev);
&gt; +       rev = (rev &amp; 0x10 ? 0x48 : 0x20);

   This doesn't look well -- in case you select 0x20, you end up with single
resource present in both resource[4] and resource[7], resulting in immediate
resource collision.

				Have a nice fortnight
-- 
Martin `MJ' Mares &lt;mj@ucw.cz&gt; &lt;mj@suse.cz&gt; http://atrey.karlin.mff.cuni.cz/~mj/
"29A, the hexadecimal of the Beast."

-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at http://www.tux.org/lkml/

</body></email><email><emailId>20000426180137</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-26 18:01:37-0400</timestampReceived><subject>RE: [Acpi] API With 440MX works!!! (at last)</subject><body>

--- Bernard Sebastien &lt;sebastien.bernard@cegetel.fr&gt;
wrote:
&gt; 
&gt;&gt; I can put in a simple check to acpi_irq to not
&gt;&gt; handle any IRQ before acpi_enable is called.
&gt; [BERNARD Sebastien]  Not good, I think. When the
&gt; interrupt handler is called again and again,
&gt; the kernel boot does not progress any more. So I
&gt; don't think a test in acpi irq will prevent the
hang.

Right, this doesn't look good if we are getting many
spurious interrupts on the ACPI IRQ.

&gt; the burst of keyboard irqs). IMHO, it's interrupt
&gt; related. The acpi
&gt; support modify the irq dispatching in a subtle way.

Yes, it sounds interrupt related.  The ACPI driver
isn't really doing anything that would affect
interrupt
dispatch besides registering to handle the
ACPI IRQ (request_irq).  This causes Linux to
unmask that interrupt so if it is spurious, that's
why you are seeing the problem after the request_irq.
So, if you build without ACPI (or APM for the heck
of it), do you get a "spurious interrupt" message
from the kernel?

&gt; &gt; I've heard of systems that reboot instead of
&gt; &gt; power off when they are told to go into S5.
&gt; &gt; Possibly a bug in your ACPI implementation.
&gt; [BERNARD Sebastien]  Maybe, how to check ?

Hmm..  Possibly look for an errata list from
your system vendor or a BIOS upgrade fixing
it.  That's about the best you can do.  You
could see what other operating systems that
support ACPI do on shutdown, if you have
them.

-Andy


__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com

</body></email><email><emailId>20000426182536</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-26 18:25:36-0400</timestampReceived><subject>Re: [Acpi] confusing code</subject><body>

Andy Henroid writes:
&gt;No, this is actually correct code.  If op is
&gt;NULL then acpi_sprint_op prints "&lt;NULL&gt;".

Um, why would op ever be null?  It's a pointer to a structure,
not op-&gt;opcode, so this isn't a ZeroOp handling method.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000426193702</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-26 19:37:02-0400</timestampReceived><subject>Re: [Acpi] disassembler namespace printing patch</subject><body>

--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:
&gt; 
&gt; Here's a patch against the latest pmtools that makes
&gt; it easier to see
&gt; the namespace in acpidisasm output, by printing out
&gt; the full name of
&gt; named objects.

Yes, that all looks good.  I went with GNU getopt
as it is ubiquitous.  Does '-n' for namespace
printing sound good?

The results are at

 
http://www.geocities.com/SiliconValley/Hardware/3165/

-Andy


__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com

</body></email><email><emailId>20000426195602</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-26 19:56:02-0400</timestampReceived><subject>[Acpi] Re: disassembler namespace printing patch</subject><body>

Andy Henroid writes:
&gt;Yes, that all looks good.  I went with GNU getopt
&gt;as it is ubiquitous.  Does '-n' for namespace
&gt;printing sound good?

Works for me.  Thanks!

I'm working on ByteList parsing; I've got multi-line output looking
pretty good, just one more bug to nail I think before going on to
actually parsing the ByteLists.  Because it is heuristic, I'm printing
out the ByteLists in any case, and then if my heuristic holds true,
I'll print out my parsing afterwards.

Because I added multi-line printing, I made the output buffer much
bigger.  I needed to do that to have the parsed output show up anyway;
that will get rather large, I'm thinking.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000426200631</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-26 20:06:31-0400</timestampReceived><subject>Re: [Acpi] Parsing _{C,P,S}RS Buffer ByteLists</subject><body>

Andy Henroid writes:
&gt;There are many systems that do something like this
...

OK, that makes sense.  I was kind of hoping that
the ASL macros would make this all a de-facto standard.

&gt;and this case would not be caught by the above
&gt;algorithm.  It's too bad we can't make an
&gt;intelligent guess from the contents of a buffer
&gt;whether it contains resources or not.

Right.  Since I'm printing the ByteLists anyway,
and because they seem to be most common in the context
of resource descriptors, I'll parse them all and print
them if they make sense as resource descriptors.  If
the length tags don't add up to the total length of
the ByteList, then I'll assume that I just wasted some
CPU cycles and not print the list.  That's a better
heuristic anyway.

&gt;In any case, yes, it would be nice to make
&gt;a guess and output resources.  A command line
&gt;argument to acpidisasm should probably be used
&gt;to enable that.

Let's see how well my new heuristic works before
adding a command-line argument.

&gt;Yes, sounds good.  Add a depth parameter or something
&gt;to acpi_sprint_op.  Oh, and better yet, get rid of
&gt;sprintf (and buffer_size) entirely and change them
&gt;to printf's or fprintf's.  That's getting to be
&gt;a big pain.

Hmm, my approach seems simpler to me; take a look when I
finish before I hack it to pieces again.  I'll send the
multi-line patch when I have polished it off, but before
I do the ByteList parsing code.  Probably tomorrow, as
it's getting late here in .nl and I've got a fencepost
error somewhere.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000426205809</emailId><senderName>"Therien, Guy"</senderName><senderEmail>guy.therien@intel.com</senderEmail><timestampReceived>2000-04-26 20:58:09-0400</timestampReceived><subject>RE: [Acpi] Re: random ACPI bugs on Dell Inspiron 7500</subject><body>

As Andy says, the EC will be accessed through the EC driver. The driver
registers as an address space handler and operation region access from the
AML interpreter will be directed to that interface. Also, an EC-SMBus driver
will access the EC through the EC driver interface. SM  Bus device higher
level drivers (e.g. card reader) will therefore access the EC through the
card reader's access to the SM Bus driver. So there are two EC clients AML
and SM Bus.

Guy

-----Original Message-----
From: Andy Henroid [mailto:andy_henroid@yahoo.com]
Sent: Wednesday, April 26, 2000 1:06 PM
To: Michael K. Johnson
Cc: acpi@phobos.fachschaften.tu-muenchen.de
Subject: Re: [Acpi] Re: random ACPI bugs on Dell Inspiron 7500


--- "Michael K. Johnson" &lt;johnsonm@redhat.com&gt; wrote:

&gt; Do we even have an interface yet for querying the
&gt; embedded controller?  I noticed that when I enabled
&gt; the battery code in the new acpid just for kicks,
&gt; it hung when I tried to query it with acpictl.  I
&gt; didn't get around to doing any debugging or
&gt; investigation yet.

The EC is generally going to always be accessed
through control methods (the AML interpreter).
Whenever a control method accesses an OpRegion
marked as EC, the interpreter calls into the
EC driver.  All of that code is there now
but, as you see, I'm still kicking out a few
problems.

-Andy


__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com


_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000426211433</emailId><senderName>Tony Hoyle</senderName><senderEmail>tmh@magenta-logic.com</senderEmail><timestampReceived>2000-04-26 21:14:33-0400</timestampReceived><subject>Re: [Acpi] acpid and pmtools release</subject><body>

Andy Henroid wrote:
&gt;&gt; * AML parsing bug fixes (This should fix the problem
&gt;   with the BP6 that has been outstanding since the
&gt;   last release.  Let me know if it doesn't)

Sorry to be the bearer of bad tidings....

&gt;From the tarball I get a coredump in dsmethod.c/DsParseMethod.  It seems
that Entry-&gt;Object is NULL
and the routine doesn't check for it.  I put in a return 0 in this case
(probably wrong I guess).

Now in debug I get the following:

acpid: started
acpid: FACP loaded from /proc/sys/acpi/
acpid: DSDT loaded from /proc/sys/acpi/
acpid: S0 SLP_TYP (0x0505)
acpid: S1 SLP_TYP (0x0404)
acpid: S2 not supported
acpid: S3 not supported
acpid: S4 not supported
acpid: S5 not supported
acpid: P_BLK 0 @ 0x0000:0
acpid: P_BLK 1 @ 0x0000:0
acpid: no usable processor block
acpid: exiting

...better than before, but still no S5.

Running without -d hangs the system &amp; I need to reboot.

Tony

</body></email><email><emailId>20000426222410</emailId><senderName>SÃ©bastien Bernard</senderName><senderEmail>bernarbs@club-internet.fr</senderEmail><timestampReceived>2000-04-26 22:24:10-0400</timestampReceived><subject>[Acpi] Alternate acpi show function</subject><body>

Just to add some of acpidisasm attention, I just tried to rewrite the
acpi_show function.
It's called acpi_show_alternate (same use as the other one, the second
parameter is the indentation amount,
just can safely put "" inside).
It is composed of two mutualy recursive functions and it's rushed code.
I had a hard to understand the difference between child and arg which is
not really obvious.
I guess I get it right. It's not quit readable for now. Maybe I can do
better.

-------------------
void
acpi_show_alternate(const struct acpi_op *origin,const char
*upper_prefix);

void alternate_print_arg( struct acpi_op *arg_start, char *upper_prefix
) {
  struct acpi_op *arg_current = arg_start;
  char prefix[80];

  sprintf(prefix,"%s  ",upper_prefix);

  printf("(\n");

  while (arg_current) {
    char buffer[MAX_SHOW_ENTRY];
    struct acpi_op *arg_of_arg,*child_of_arg;

    acpi_sprint_op(buffer, sizeof(buffer), arg_current);
    printf ("%s%s ",prefix,buffer);

    if ((arg_of_arg = acpi_get_arg(arg_current,0)) != NULL)
      alternate_print_arg(arg_of_arg,prefix);
    else
      if ((child_of_arg = acpi_get_child(arg_current)) != NULL)
    acpi_show_alternate(child_of_arg,prefix);
    /*      else
        printf("What to do ?\n");*/
    printf("\n");
    arg_current = arg_current-&gt;next;
  }

  printf("%s)\n",prefix);

}

/*
 * Alternate show operation
 */
void
acpi_show_alternate(const struct acpi_op *origin,const char
*upper_prefix) {
  char buffer[MAX_SHOW_ENTRY];
  char prefix[80]; /* Max depth printable */
  const struct acpi_op *op = origin;

  sprintf(prefix,"%s   ",upper_prefix);
  if(op) {
#ifdef ACPI_DEBUG
    const u8 *aml_start = op-&gt;decl;
#endif

    while(op) {
      struct acpi_op *child,*arg;

      /* Print an op */
      acpi_sprint_op(buffer, sizeof(buffer), op);
      printf("\n%s%s",prefix,buffer);

      /* Print arguments */
      if ((arg = acpi_get_arg(op,0)) != NULL)
    alternate_print_arg(arg,prefix);
      else
    /* Start of a tree */
    if ((child = acpi_get_child(op)) != NULL)
      acpi_show_alternate(child,prefix);

      op = op-&gt;next;
    }
  }
}

</body></email><email><emailId>20000427095021</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-27 09:50:21-0400</timestampReceived><subject>[Acpi] Re: Parsing _{C,P,S}RS Buffer ByteLists</subject><body>

Takanori Watanabe writes:
&gt;I think it is not disassembler's job,but AML interpreter shell's 
&gt;(AML debugger's) job.

It's clear that the debugger should have this capability.  No
arguments there.

However, I think that you are unnecessarily polarizing this
discussion.

&gt;Bytestreem interpretation exists in  
&gt;different layer from AML interpretation.

I'm very aware of that, as I think I have made clear.

Nevertheless, it will make our jobs easier when joe random
user has a problem with ACPI on his computer if we don't have
to log in or send him an expect script to interact with his
debugger.  It would be convenient if for at least some, perhaps
most, users, we can just look at their acpidisasm output and
easily see what's going on.

I already myself early in this discussion brought up the point
that you mention: that these resource descriptor bytestreams
can be created by arbitrary AML code.  However, it seems that
they are often put in as static ByteLists, and I'm going to
take a shot at automatically parsing them as resource
descriptors.

If it doesn't work, you can feel free to laugh at me, but in
the meantime I've found a way that I think will work.  You
can ignore it if you like.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000427164543</emailId><senderName>Dietmar Nowack</senderName><senderEmail>di.nowak@fh-wolfenbuettel.de</senderEmail><timestampReceived>2000-04-27 16:45:43-0400</timestampReceived><subject>Re: [Acpi] linux &amp; acpi</subject><body>

Andy Henroid wrote:
&gt; 
&gt; --- Dietmar Nowack &lt;Di.Nowak@FH-Wolfenbuettel.DE&gt;
&gt; wrote:
&gt; 
&gt; &gt; Now my questions would be, what precautions are to
&gt; &gt; be taken or which
&gt; &gt; conditions have to be met in order to make acpi
&gt; &gt; modes operate in Linux?
&gt; 
&gt; First, you need to install acpid (available from
&gt; the ACPI4Linux website).  Then, run it as
&gt; 
&gt;   acpid -d
&gt; 
&gt; so that you get debug output to the console.


Sorry for the late post, I was away.
acpid -d gives

acpid: started
acpid: FACP loaded from /proc/sys/acpi/
acpid: DSDT loaded from /proc/sys/acpi/
acpid: S0 SLP_TYP (0x0000)
acpid: S1 SLP_TYP (0x0303)
acpid: S2 not supported
acpid: S3 not supported
acpid: S4 SLP_TYP (0x0707)
acpid: S5 SLP_TYP (0x0707)
acpid: no processor block     


Thanks alot,

--Dietmar Nowack

</body></email><email><emailId>20000427203127</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-27 20:31:27-0400</timestampReceived><subject>[Acpi] PnP resource printing patch</subject><body>

This is a multipart MIME message.


OK, I've got this working on at least my DSDT, and it's ready for
debugging on other people's.

I was going to say that to apply this, you must have applied the
patch I sent yesterday that implements multi-line printing correctly.
However, I see that I didn't include it.  Therefore, I'm including
both patches as attachments to this mail.  The pmtools.multiline.diff
patch must be applied first, and the pmtools.resource.diff second.

Also, please note that the heuristics seem to work.  Of course, the
ByteLists that are munged before being returned by the control
methods don't get printed; that's as it should be.  All of the
ByteLists that it interprets as PnP resource descriptors really
are PnP resource descriptors; the heuristics work well.  And
that's without checksum calculation enabled -- I disabled it
because a simple u8 checksum failed; should I be using a u16 or
u32 checksum, or is there some other algorithm?  I'm sure it is
in the ACPI standard somewhere, but I haven't found it, so I
would appreciate a reference.  It will be trivial to enable checksum
calculation once I know how; the calculation is simply commented
out for now with a FIXME attached.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/


["pmtools.multiline.diff" (text/plain)]

diff -u --recursive pmtools.printtree/acpidisasm/util.c pmtools/acpidisasm/util.c
--- pmtools.printtree/acpidisasm/util.c	Wed Apr 26 15:02:10 2000
+++ pmtools/acpidisasm/util.c	Wed Apr 26 22:16:30 2000
@@ -433,6 +433,7 @@
 						acpi_to_nonconst_op(op));
 				const u8 *data = extra-&gt;data;
 				int data_size = extra-&gt;data_size;
+				int count = 0;
 
 				size = acpi_safe_sprintf(buffer,
 							 buffer_size,
@@ -450,9 +451,19 @@
 								 (int) *data);
 					data++;
 					data_size--;
+					count++;
+					if (!(count % 8) &amp;&amp; data_size)
+					{
+						buffer += size;
+						buffer_size -= size;
+						size = acpi_safe_sprintf(buffer,
+								 buffer_size,
+								 0,
+								 "\n          ");
+					}
 				}
 		    
-				if(size &lt; 0 &amp;&amp; extra-&gt;data_size &gt; 1)
+				if(size &lt; 0 &amp;&amp; data_size &gt; 0)
 				{
 					buffer -= 5;
 					buffer_size += 5;
@@ -473,6 +484,16 @@
 								 0,
 								 "&gt;");
 				}
+
+#if 0
+				buffer += size;
+				buffer_size -= size;
+				// does nothing and returns 0 if it doesn't
+				// seem to be a resource descriptor
+				size = acpi_sprint_resource(buffer,
+							    buffer_size,
+							    op);
+#endif
 			}
 			break;
 		default:
@@ -560,7 +581,7 @@
  *
  */
 
-#define MAX_SHOW_ENTRY 128
+#define MAX_SHOW_ENTRY 4096
 
 /*
  * Show op and its children
@@ -570,7 +591,9 @@
 {
 	static char buffer[MAX_SHOW_ENTRY];
 	static char namebuffer[MAX_SHOW_ENTRY];
+	static char outbuffer[MAX_SHOW_ENTRY];
 	const struct acpi_op *op = origin;
+
 	if(op)
 	{
 #ifdef ACPI_DEBUG
@@ -580,6 +603,8 @@
 		while(op)
 		{
 			const struct acpi_op *depth;
+			int count = 0, countdown = 0;
+			char *this = NULL, *next = NULL;
 
 #ifdef ACPI_DEBUG
 			printf("%08x: ", op-&gt;decl ? (op-&gt;decl - aml_start):0);
@@ -599,8 +624,10 @@
 				{
 					break;
 				}
-				printf("  ");
+				count++;
 			}
+			for(countdown = count; countdown; countdown--)
+				printf("  ");
 	    
 			if(acpi_sprint_op(buffer, sizeof(buffer), op) &gt; 0)
 			{
@@ -615,18 +642,21 @@
 					if(source)
 					{
 #ifdef ACPI_DEBUG
-						printf("%s (%08x)\n",
-						       buffer,
-						       (source-&gt;decl
-							? (source-&gt;decl
-							   - aml_start):0));
+						acpi_safe_sprintf(outbuffer,
+							    sizeof(outbuffer),
+							    0,
+							    "%s (%08x)",
+							    buffer,
+							    (source-&gt;decl
+							      ? (source-&gt;decl
+							      - aml_start):0));
 #else
-						printf("%s\n", buffer);
+						strcpy(outbuffer, buffer);
 #endif
 					}
 					else
 					{
-						printf("%s\n", buffer);
+						strcpy(outbuffer, buffer);
 					}
 				}
 				else
@@ -638,13 +668,38 @@
 					    )
 					{
 						acpi_sprint_path(namebuffer, sizeof(namebuffer), op);
-						printf("%s (\\%s)\n", buffer, namebuffer);
+						acpi_safe_sprintf(outbuffer,
+							    sizeof(outbuffer),
+							    0,
+							    "%s (\\%s)",
+							    buffer,
+							    namebuffer);
 					}
 					else
 					{
-						printf("%s\n", buffer);
+						strcpy(outbuffer, buffer);
 					}
 				}
+			}
+
+			// Now print, dealing with any embedded \n characters
+			this = outbuffer;
+			while (this)
+			{
+				next = strchr(this, '\n');
+				if (next)
+					*next = '\0';
+				printf("%s\n", this);
+				if (next)
+				{
+#ifdef ACPI_DEBUG
+					printf("%08x: ", op-&gt;decl ? (op-&gt;decl - aml_start):0);
+#endif
+					for(countdown = count; countdown; countdown--)
+						printf("  ");
+					next++;
+				}
+				this = next;
 			}
 
 			op = acpi_get_depth_next(acpi_to_nonconst_op(origin),

["pmtools.resource.diff" (text/plain)]

diff -u --recursive --new-file pmtools.multiline/acpidisasm/Makefile pmtools.new/acpidisasm/Makefile
--- pmtools.multiline/acpidisasm/Makefile	Tue Apr 25 16:37:11 2000
+++ pmtools.new/acpidisasm/Makefile	Thu Apr 27 15:09:23 2000
@@ -3,7 +3,7 @@
 PERL = perl
 
 TARGET = acpidisasm
-OBJS = amlop.o disasm.o ns.o parse.o util.o
+OBJS = amlop.o disasm.o ns.o parse.o util.o resource.o
 
 all: $(TARGET)
 
@@ -18,6 +18,7 @@
 ns.o: ns.c acpi.h amlop.h
 parse.o: parse.c acpi.h amlop.h
 util.o: util.c acpi.h amlop.h
+resource.o: acpi.h amlop.h
 
 clean:
 	$(RM) $(TARGET) $(OBJS)
diff -u --recursive --new-file pmtools.multiline/acpidisasm/acpi.h pmtools.new/acpidisasm/acpi.h
--- pmtools.multiline/acpidisasm/acpi.h	Wed Apr 26 17:07:45 2000
+++ pmtools.new/acpidisasm/acpi.h	Thu Apr 27 11:43:40 2000
@@ -130,6 +130,11 @@
 void acpi_show_namespace(const struct acpi_op *op);
 
 /*
+ * resource.c
+ */
+int acpi_sprint_resource(char *str, int size, const struct acpi_op *op);
+
+/*
  *
  * inlined functions (static to avoid mult definition link error)
  *
diff -u --recursive --new-file pmtools.multiline/acpidisasm/resource.c pmtools.new/acpidisasm/resource.c
--- pmtools.multiline/acpidisasm/resource.c	Thu Jan  1 01:00:00 1970
+++ pmtools.new/acpidisasm/resource.c	Thu Apr 27 22:12:45 2000
@@ -0,0 +1,806 @@
+/*
+ * resource.c - print out suspected PhP resource descriptors
+ *
+ * Copyright (C) 2000 Red Hat, Inc.
+ *
+ * Author: Michael K. Johnson &lt;johnsonm@redhat.com&gt;
+ *
+ * Contains acpi_sprint_resource, which formats a ByteList as
+ * a PnP resource description as documented in section 6.4 of the
+ * ACPI standard, but only if it parses correctly as one.
+ * Returns 0 if it fails.  All the rest of the functions
+ * in this file are static helper functions.
+ *
+ */
+
+#include "acpi.h"
+
+struct resource_context
+{
+	const u8 *data;
+	int data_size;
+	char *buffer;
+	char *buffer_end;
+	u8 checksum;
+	int checksum_good;
+};
+#define buffer_size (c-&gt;buffer_end - c-&gt;buffer)
+
+static int
+consume_data(struct resource_context *c)
+{
+	// FIXME: calculate this correctly
+	//c-&gt;checksum += *(c-&gt;data);
+	c-&gt;data++;
+	c-&gt;data_size--;
+	if (c-&gt;data_size &lt; 0)
+		return -1;
+	else
+		return 0;
+}
+
+static int
+consume_uint(struct resource_context *c, unsigned int *i)
+{
+	int ret = 0;
+
+	*i = *(c-&gt;data);
+	ret |= consume_data(c);
+	*i |= (*(c-&gt;data) &lt;&lt; 8);
+	ret |= consume_data(c);
+	*i |= (*(c-&gt;data) &lt;&lt; 16);
+	ret |= consume_data(c);
+	*i |= (*(c-&gt;data) &lt;&lt; 24);
+	ret |= consume_data(c);
+
+	return ret;
+}
+
+static int
+consume_uword(struct resource_context *c, unsigned int *i)
+{
+	int ret = 0;
+
+	*i = *(c-&gt;data);
+	ret |= consume_data(c);
+	*i |= (*(c-&gt;data) &lt;&lt; 8);
+	ret |= consume_data(c);
+
+	return ret;
+}
+
+static int
+consume_ubyte(struct resource_context *c, unsigned int *i)
+{
+	int ret = 0;
+
+	*i = *(c-&gt;data);
+	ret |= consume_data(c);
+
+	return ret;
+}
+
+static int
+resource_sprintf(struct resource_context *c, const char *fmt, ...)
+{
+	int size;
+	va_list args;
+
+	va_start(args, fmt);
+	size = vsnprintf(c-&gt;buffer, buffer_size, fmt, args);
+	va_end(args);
+	if (size &lt; 0 || size &gt; buffer_size) // vsnprintf has two implementations
+		return -1;
+	c-&gt;buffer += size;
+	return 0;
+}
+
+static int
+resource_printmask(struct resource_context *c, unsigned int mask, int length)
+{
+	int where = length;
+	int ret = 0;
+
+	while (where--)
+	{
+		ret |= resource_sprintf(c, "%1.1d",
+		    (mask &amp; (1 &lt;&lt; (where - 1))) &gt;&gt; (where - 1));
+	}
+	
+	return ret;
+}
+
+
+/* 6.4.2.*: small resource item printing */
+
+/* 6.4.2.1: IRQ Format */
+static int
+irq_format(struct resource_context *c, int length)
+{
+	unsigned int irqs, irqinfo;
+	int ret = 0;
+
+	if (length &lt; 2 || length &gt; 3) return -1;
+
+	ret |= consume_uword(c, &amp;irqs);
+	ret |= resource_sprintf(c, "IRQ mask: ");
+	ret |= resource_printmask(c, irqs, 16);
+
+	if (length == 3)
+	{
+		ret |= consume_ubyte(c, &amp;irqinfo);
+	}
+	else
+	{
+		irqinfo = 0x1; // default: _HE, not shareable
+	}
+
+	ret |= resource_sprintf(c, "\nInfo:");
+	if (irqinfo &amp; 0xe0) return -1;  // reserved
+	if (irqinfo &amp; 0x10)
+		ret |= resource_sprintf(c, " shareable,");
+	if (irqinfo &amp; 0x8)
+		ret |= resource_sprintf(c, " low true level sensitive");
+	if (irqinfo &amp; 0x1)
+		ret |= resource_sprintf(c, " high true edge sensitive");
+	// maybe I ought to return -1 in the next two cases?
+	if (irqinfo &amp; 0x8 &amp;&amp; irqinfo &amp; 0x1)
+		ret |= resource_sprintf(c, " (impossible combination)");
+	if (!(irqinfo &amp; 0x8 || irqinfo &amp; 0x1))
+		ret |= resource_sprintf(c, " (missing sensitivity)");
+	ret |= resource_sprintf(c, "\n");
+
+	return ret;
+}
+
+/* 6.4.2.2:  */
+static int
+dma_format(struct resource_context *c, int length)
+{
+	int channel_speed;
+	int bm;
+	int type;
+	int ret = 0;
+
+	ret |= resource_sprintf(c, "DMA mask: ");
+	ret |= resource_printmask(c, *(c-&gt;data), 8);
+	ret |= consume_data(c);
+
+	if (*(c-&gt;data) &amp; 0x80)  // illegally set reserved bit [7]
+		return -1;
+	channel_speed = (*(c-&gt;data) &amp; 0x60) &gt;&gt; 5;  // bits [6:5]
+	bm = (*(c-&gt;data) &amp; 0x4) &gt;&gt; 2;              // bit  [2]
+	type = *(c-&gt;data) &amp; 0x3;                   // bits [1:0]
+	ret |= consume_data(c);
+
+	ret |= resource_sprintf(c, "\nDMA channel speed:");
+	switch (channel_speed)
+	{
+	case 0x0: ret |= resource_sprintf(c, " compatibility mode;"); break;
+	case 0x1: ret |= resource_sprintf(c, " Type A DMA;"); break;
+	case 0x2: ret |= resource_sprintf(c, " Type B DMA;"); break;
+	case 0x3: ret |= resource_sprintf(c, " Type F;"); break;
+	}
+	if (bm)
+		ret |= resource_sprintf(c, " bus master;");
+	ret |= resource_sprintf(c, " transfer type:");
+	switch (type)
+	{
+	case 0x0: ret |= resource_sprintf(c, " 8-bit"); break;
+	case 0x1: ret |= resource_sprintf(c, " 8/16 bit"); break;
+	case 0x2: ret |= resource_sprintf(c, " 16-bit"); break;
+	case 0x3: return -1; break; //reserved value
+	}
+	ret |= resource_sprintf(c, "\n");
+
+	return ret;
+}
+
+/* 6.4.2.3: Start Dependent Functions */
+static int
+start_dependent_functions(struct resource_context *c, int length)
+{
+	int ret = 0;
+	int priority;
+	int compatibility;
+	int robustness;
+
+	if (length &gt; 1) return -1;
+
+	if (!length)
+	{
+		priority = 0x5; // defaults: acceptable/acceptable
+	}
+	else
+	{
+		ret |= consume_ubyte(c, &amp;priority);
+	}
+
+	if (priority &amp; 0xF0)    // reserved, must be zero
+		return -1;
+
+	compatibility = priority &amp; 0x3;
+	robustness = (priority &amp; 0xC) &gt;&gt; 2;
+
+	ret |= resource_sprintf(c, "Start dependent functions\n");
+	switch (compatibility)
+	{
+	case 0x0: ret |= resource_sprintf(c, "good"); break;
+	case 0x1: ret |= resource_sprintf(c, "acceptable"); break;
+	case 0x2: ret |= resource_sprintf(c, "sub-optimal"); break;
+	case 0x3: return -1; // reserved
+	}
+	ret |= resource_sprintf(c, " compatiblity;");
+	switch (robustness)
+	{
+	case 0x0: ret |= resource_sprintf(c, " good"); break;
+	case 0x1: ret |= resource_sprintf(c, " acceptable"); break;
+	case 0x2: ret |= resource_sprintf(c, " sub-optimal"); break;
+	case 0x3: return -1; // reserved
+	}
+	ret |= resource_sprintf(c, " performance/robustness\n");
+
+	return ret;
+}
+
+/* 6.4.2.4: End Dependent Functions */
+static int
+end_dependent_functions(struct resource_context *c, int length)
+{
+	if (length) return -1;
+
+	return resource_sprintf(c, "End dependent functions\n");
+}
+
+/* 6.4.2.5: I/O Port Descriptor */
+static int
+io_port_descriptor(struct resource_context *c, int length)
+{
+	int ret = 0;
+	int minbase, maxbase, align, count;
+
+	if (length != 7) return -1;
+	ret |= resource_sprintf(c, "I/O Ports:");
+
+	if (*(c-&gt;data) &amp; 0xF0) return -1; // reserved
+
+	if (*(c-&gt;data) &amp; 0x1)
+		ret |= resource_sprintf(c, " 16 bit address decoding,\n");
+	else
+		ret |= resource_sprintf(c, " 10 bit address decoding,\n");
+	ret |= consume_data(c);
+
+	ret |= consume_uword(c, &amp;minbase);
+	ret |= consume_uword(c, &amp;maxbase);
+	ret |= consume_ubyte(c, &amp;align);
+	ret |= consume_ubyte(c, &amp;count);
+	ret |= resource_sprintf(c,
+		"minbase 0x%x, maxbase 0x%x, align 0x%x, count 0x%x\n",
+		minbase, maxbase, align, count);
+
+	return ret;
+}
+
+/* 6.4.2.6: Fixed Location I/O Port Descriptor */
+static int
+fixed_location_io_port_descriptor(struct resource_context *c, int length)
+{
+	int ret = 0;
+	int base, count;
+
+	if (length != 3) return -1;
+
+	ret |= consume_uword(c, &amp;base);
+	ret |= consume_ubyte(c, &amp;count);
+	ret |= resource_sprintf(c, "Fixed I/O Ports: 0x%x @ 0x%x\n",
+		count, base);
+
+	return ret;
+}
+
+/* 6.4.2.7/6.4.3.2: Vendor Defined */
+static int
+vendor_defined(struct resource_context *c, int length)
+{
+	return resource_sprintf(c, "0x%x bytes of vendor-specific data\n", length);
+}
+
+/* 6.4.2.8: End Tag
+ * End of resource data, check checksum
+ */
+static int
+end_tag(struct resource_context *c, int length)
+{
+	if (length != 1) return -1;
+	if (consume_data(c) == -1) return -1;
+	// after consume_data, the checksum ought to be 0
+	if (c-&gt;checksum) return -1;
+	c-&gt;checksum_good = 1;
+	return 0;
+}
+
+
+
+
+/* 6.4.2 */
+static int
+small_resource(struct resource_context *c)
+{
+	int ret = 0;
+	int length = *(c-&gt;data) &amp; 0x07;         // bits [2:0]
+	int name = (*(c-&gt;data) &amp; 0x78) &gt;&gt; 3; // bits [6:3]
+	ret |= consume_data(c);
+
+	switch (name)
+	{
+	case 0x4: ret |= irq_format(c, length); break;
+	case 0x5: ret |= dma_format(c, length); break;
+	case 0x6: ret |= start_dependent_functions(c, length); break;
+	case 0x7: ret |= end_dependent_functions(c, length); break;
+	case 0x8: ret |= io_port_descriptor(c, length); break;
+	case 0x9: ret |= fixed_location_io_port_descriptor(c, length); break;
+	case 0xE: ret |= vendor_defined(c, length); break;
+	case 0xF: ret |= end_tag(c, length); break;
+	default:  ret |= -1; break; // Reserved value, oops!
+	}
+	return ret;
+}
+
+
+
+
+
+/* 6.4.3.*: large resource item printing */
+
+/* 6.4.3.1: 24-Bit Memory Range Descriptor */
+static int
+memory_range_24(struct resource_context *c, int length)
+{
+	int ret = 0;
+	unsigned int rw, minbase, maxbase, align, count;
+
+	if (length != 9) return -1;
+
+	rw = *(c-&gt;data) &amp; 0x1;
+	ret |= consume_data(c);
+
+	ret |= consume_uword(c, &amp;minbase);
+	minbase &lt;&lt;= 8;
+	ret |= consume_uword(c, &amp;maxbase);
+	maxbase &lt;&lt;= 8;
+
+	ret |= consume_uword(c, &amp;align);
+	ret |= consume_uword(c, &amp;count);
+
+	ret |= resource_sprintf(c, "24-bit %s Memory range:\n"
+		"minbase 0x%x, maxbase 0x%x, align 0x%x, count 0x%x\n",
+		rw ? "rw" : "ro",
+		minbase, maxbase, align, count);
+
+	return ret;
+}
+
+/* 6.4.3.3: 32-Bit Memory Range Descriptor */
+static int
+memory_range_32(struct resource_context *c, int length)
+{
+	int ret = 0;
+	unsigned int rw, minbase, maxbase, align, count;
+
+	if (length != 17) return -1;
+
+	rw = *(c-&gt;data) &amp; 0x1;
+	ret |= consume_data(c);
+
+	ret |= consume_uint(c, &amp;minbase);
+	ret |= consume_uint(c, &amp;maxbase);
+	ret |= consume_uint(c, &amp;align);
+	ret |= consume_uint(c, &amp;count);
+
+	ret |= resource_sprintf(c, "32-bit %s Memory range:\n"
+		"minbase 0x%x, maxbase 0x%x, align 0x%x, count 0x%x\n",
+		rw ? "rw" : "ro",
+		minbase, maxbase, align, count);
+
+	return ret;
+}
+
+/* 6.4.3.4: 32-Bit Fixed Location Memory Range Descriptor */
+static int
+memory_range_fixed_32(struct resource_context *c, int length)
+{
+	int ret = 0;
+	unsigned int rw, base, count;
+
+	if (length != 9) return -1;
+
+	rw = *(c-&gt;data) &amp; 0x1;
+	ret |= consume_data(c);
+
+	ret |= consume_uint(c, &amp;base);
+	ret |= consume_uint(c, &amp;count);
+
+	ret |= resource_sprintf(c, "32-bit %s Fixed memory range:\n"
+		"base 0x%x, count 0x%x\n",
+		rw ? "rw" : "ro",
+		base, count);
+
+	return ret;
+}
+
+/* 6.4.3.5.7: Resource Type Specific Flags
+ * used in the following address space descriptor functions
+ */
+static int
+resource_type(struct resource_context *c, int type, int value)
+{
+	int ret = 0;
+
+	switch (type)
+	{
+	case 0:					// Memory
+		if (value &amp; 0xe0) // reserved, must be zero
+			return -1;
+		switch ((value &amp; 0x1e) &gt;&gt; 1)
+		{
+		case 0: ret |= resource_sprintf(c, " noncacheable,"); break;
+		case 1: ret |= resource_sprintf(c, " cacheable,"); break;
+		case 2: ret |= resource_sprintf(c, " write combining,"); break;
+		case 3: ret |= resource_sprintf(c, " prefetchable,"); break;
+		default: return -1; // undefined memory attribute
+		}
+		if (value &amp; 0x1)
+			ret |= resource_sprintf(c, " rw");
+		else
+			ret |= resource_sprintf(c, " ro");
+		break;
+
+	case 1:					// I/O
+		if (value &amp; 0xfc) // reserved, must be zero
+			return -1;
+		if (value &amp; 0x2)
+			ret |= resource_sprintf(c, " ISA I/O addresses only");
+		if (value &amp; 0x1)
+			ret |= resource_sprintf(c, " non-ISA I/O addresses only");
+		break;
+
+	case 2:					// Bus Number
+		if (value) // reserved, must be zero
+			return -1;
+		break;
+
+	default: return -1; // undefined type
+	}
+
+	return ret;
+}
+
+static int
+general_flags(struct resource_context *c, int genflags)
+{
+	int ret = 0;
+
+	if (genflags &amp; 0xf0) return -1; // reserved, must be zero
+	if (genflags &amp; 0x8)
+		ret |= resource_sprintf(c, "max address fixed\n");
+	else
+		ret |= resource_sprintf(c, "max address variable\n");
+	if (genflags &amp; 0x4)
+		ret |= resource_sprintf(c, "min address fixed\n");
+	else
+		ret |= resource_sprintf(c, "min address variable\n");
+	if (genflags &amp; 0x2)
+		ret |= resource_sprintf(c, "address subtractively decoded\n");
+	else
+		ret |= resource_sprintf(c, "address positively decoded\n");
+	if (genflags &amp; 0x1)
+		ret |= resource_sprintf(c, "device consumes this resource\n");
+	else
+		ret |= resource_sprintf(c, "device produces and consumes this resource\n");
+
+	return ret;
+}
+
+/* 6.4.3.5.1: QWORD Address Space Descriptor */
+static int
+qword_address_space(struct resource_context *c, int length)
+{
+	int ret = 0;
+	unsigned int restype, genflags, typeflags;
+	unsigned int gralo, grahi, minlo, minhi, maxlo, maxhi;
+	unsigned int tralo, trahi, lenlo, lenhi;
+	unsigned int resindex;
+
+	if (length &lt; 43) return -1;
+
+	consume_ubyte(c, &amp;restype);
+	consume_ubyte(c, &amp;genflags);
+	consume_ubyte(c, &amp;typeflags);
+
+	ret |= resource_sprintf(c, "QWORD ASD: type ");
+	switch (restype)
+	{
+	case 0: ret |= resource_sprintf(c, "Memory: "); break;
+	case 1: ret |= resource_sprintf(c, "I/O: "); break;
+	case 2: ret |= resource_sprintf(c, "Bus number: "); break;
+	default: return -1; break;  // reserved
+	}
+	ret |= resource_type(c, restype, typeflags);
+	ret |= resource_sprintf(c, "\n");
+
+	ret |= consume_uint(c, &amp;gralo);
+	ret |= consume_uint(c, &amp;grahi);
+	ret |= consume_uint(c, &amp;minlo);
+	ret |= consume_uint(c, &amp;minhi);
+	ret |= consume_uint(c, &amp;maxlo);
+	ret |= consume_uint(c, &amp;maxhi);
+	ret |= consume_uint(c, &amp;tralo);
+	ret |= consume_uint(c, &amp;trahi);
+	ret |= consume_uint(c, &amp;lenlo);
+	ret |= consume_uint(c, &amp;lenhi);
+
+	ret |= resource_sprintf(c, "GRA: ");
+	ret |= resource_printmask(c, gralo, 32);
+	ret |= resource_printmask(c, grahi, 32);
+	ret |= resource_sprintf(c, "\n");
+
+	ret |= resource_sprintf(c,
+		"MIN: 0x%08x%08x  MAX: 0x%08x%08x\n"
+		"TRA: 0x%08x%08x  LEN: 0x%08x%08x\n",
+		minlo, minhi, maxlo, maxhi,
+		tralo, trahi, lenlo, lenhi);
+
+	general_flags(c, genflags);
+
+	if (length &gt; 43)
+	{
+		ret |= consume_ubyte(c, &amp;resindex);
+		ret |= resource_sprintf(c, "resource index 0x%x\n", resindex);
+		// ignore the rest
+		length -= 44;
+		while (length--)
+			ret |= consume_data(c);
+	}
+
+	return ret;
+}
+
+/* 6.4.3.5.3: DWORD Address Space Descriptor */
+static int
+dword_address_space(struct resource_context *c, int length)
+{
+	int ret = 0;
+	unsigned int restype, genflags, typeflags;
+	unsigned int gra, min, max, tra, len;
+	unsigned int resindex;
+
+	if (length &lt; 23) return -1;
+
+	consume_ubyte(c, &amp;restype);
+	consume_ubyte(c, &amp;genflags);
+	consume_ubyte(c, &amp;typeflags);
+
+	ret |= resource_sprintf(c, "DWORD ASD: type ");
+	switch (restype)
+	{
+	case 0: ret |= resource_sprintf(c, "Memory: "); break;
+	case 1: ret |= resource_sprintf(c, "I/O: "); break;
+	case 2: ret |= resource_sprintf(c, "Bus number: "); break;
+	default: return -1; break;  // reserved
+	}
+	ret |= resource_type(c, restype, typeflags);
+	ret |= resource_sprintf(c, "\n");
+
+	ret |= consume_uint(c, &amp;gra);
+	ret |= consume_uint(c, &amp;min);
+	ret |= consume_uint(c, &amp;max);
+	ret |= consume_uint(c, &amp;tra);
+	ret |= consume_uint(c, &amp;len);
+
+	ret |= resource_sprintf(c, "GRA: ");
+	ret |= resource_printmask(c, gra, 32);
+	ret |= resource_sprintf(c, "\n");
+
+	ret |= resource_sprintf(c,
+		"MIN: 0x%08x  MAX: 0x%08x\n"
+		"TRA: 0x%08x  LEN: 0x%08x\n",
+		min, max, tra, len);
+
+	general_flags(c, genflags);
+
+	if (length &gt; 23)
+	{
+		ret |= consume_ubyte(c, &amp;resindex);
+		ret |= resource_sprintf(c, "resource index 0x%x\n", resindex);
+		// ignore the rest
+		length -= 24;
+		while (length--)
+			ret |= consume_data(c);
+	}
+
+	return ret;
+}
+
+/* 6.4.3.5.5: WORD Address Space Descriptor */
+static int
+word_address_space(struct resource_context *c, int length)
+{
+	int ret = 0;
+	unsigned int restype, genflags, typeflags;
+	unsigned int gra, min, max, tra, len;
+	unsigned int resindex;
+
+	if (length &lt; 13) return -1;
+
+	consume_ubyte(c, &amp;restype);
+	consume_ubyte(c, &amp;genflags);
+	consume_ubyte(c, &amp;typeflags);
+
+	ret |= resource_sprintf(c, "WORD ASD: type ");
+	switch (restype)
+	{
+	case 0: ret |= resource_sprintf(c, "Memory: "); break;
+	case 1: ret |= resource_sprintf(c, "I/O: "); break;
+	case 2: ret |= resource_sprintf(c, "Bus number: "); break;
+	default: return -1; break;  // reserved
+	}
+	ret |= resource_type(c, restype, typeflags);
+	ret |= resource_sprintf(c, "\n");
+
+	ret |= consume_uword(c, &amp;gra);
+	ret |= consume_uword(c, &amp;min);
+	ret |= consume_uword(c, &amp;max);
+	ret |= consume_uword(c, &amp;tra);
+	ret |= consume_uword(c, &amp;len);
+
+	ret |= resource_sprintf(c, "GRA: ");
+	ret |= resource_printmask(c, gra, 16);
+	ret |= resource_sprintf(c, "\n");
+
+	ret |= resource_sprintf(c,
+		"MIN: 0x%04x  MAX: 0x%04x\n"
+		"TRA: 0x%04x  LEN: 0x%04x\n",
+		min, max, tra, len);
+
+	general_flags(c, genflags);
+
+	if (length &gt; 13)
+	{
+		ret |= consume_ubyte(c, &amp;resindex);
+		ret |= resource_sprintf(c, "resource index 0x%x\n", resindex);
+		// ignore the rest
+		length -= 14;
+		while (length--)
+			ret |= consume_data(c);
+	}
+
+	return ret;
+}
+
+/* 6.4.3.6: Extended Interrupt Descriptor */
+static int
+extended_irq(struct resource_context *c, int length)
+{
+	int ret = 0;
+	unsigned int vflags, tablelen, countdown, resindex;
+
+	if (length &lt; 6) return -1;
+
+	ret |= resource_sprintf(c, "Extended interrupt descriptor\n");
+	ret |= resource_sprintf(c, "Desc:");
+	ret |= consume_ubyte(c, &amp;vflags);
+	if (vflags &amp; 0xf0) return -1; // reserved, must be zero
+	if (vflags &amp; 0x8)
+		ret |= resource_sprintf(c, " shareable;");
+	else
+		ret |= resource_sprintf(c, " non-shareable;");
+	if (vflags &amp; 0x4)
+		ret |= resource_sprintf(c, " low true level-sensitive;");
+	if (vflags &amp; 0x2)
+		ret |= resource_sprintf(c, " high true level-sensitive;");
+	if ((vflags &amp; 0x4) &amp;&amp; (vflags &amp; 0x2))
+		ret |= resource_sprintf(c, " (impossible, cannot be both!)");
+	if (vflags &amp; 0x1)
+		ret |= resource_sprintf(c, "\nThis device consumes this resource.\n");
+	else
+		ret |= resource_sprintf(c, "\nThis device produces and consumes this resource.\n");
+
+	ret |= consume_ubyte(c, &amp;tablelen);
+	ret |= resource_sprintf(c, "Interrupt table of %d vectors:", tablelen);
+	countdown = tablelen;
+	while (countdown--)
+	{
+		unsigned int interrupt;
+		ret |= consume_uint(c, &amp;interrupt);
+		ret |= resource_sprintf(c, "%d (0x%x)\n", interrupt, interrupt);
+	}
+
+	if (length &gt; tablelen+2)
+	{
+		ret |= consume_ubyte(c, &amp;resindex);
+		ret |= resource_sprintf(c, "resource index 0x%x\n", resindex);
+		// ignore the rest
+		length -= tablelen+3;
+		while (length--)
+			ret |= consume_data(c);
+	}
+
+	return ret;
+}
+
+/* 6.4.3 */
+static int
+large_resource(struct resource_context *c)
+{
+	int ret = 0;
+	unsigned int name, length;
+
+	name = *(c-&gt;data) &amp; 0x7F;     // bits [6:0]
+	ret |= consume_data(c);
+	ret |= consume_uword(c, &amp;length);
+
+	switch (name)
+	{
+	case 0x1: ret |= memory_range_24(c, length); break;
+	case 0x4: ret |= vendor_defined(c, length); break;
+	case 0x5: ret |= memory_range_32(c, length); break;
+	case 0x6: ret |= memory_range_fixed_32(c, length); break;
+	case 0x7: ret |= dword_address_space(c, length); break;
+	case 0x8: ret |= word_address_space(c, length); break;
+	case 0x9: ret |= extended_irq(c, length); break;
+	case 0xa: ret |= qword_address_space(c, length); break;
+	default:  ret |= -1; break; // Reserved value, oops!
+	}
+	return ret;
+}
+
+
+
+/*
+ * Takes a ByteList op and tries to interpret it as a
+ * PnP resource descriptor.  If the ByteList does not
+ * make sense as a resource descriptor (most likely
+ * because the checksum does not match, lengths do not
+ * match, or because a reserved value was used unexpectedly),
+ * returns 0.
+ */
+int
+acpi_sprint_resource(char *buffer_start, int this_buffer_size,
+		     const struct acpi_op *op)
+{
+	struct acpi_extra_op *extra;
+	struct resource_context c;
+	int ret = 0;
+
+	extra = acpi_to_extra_op(acpi_to_nonconst_op(op));
+	c.data = extra-&gt;data;
+	c.data_size = extra-&gt;data_size;
+	c.buffer = buffer_start;
+	c.buffer_end = buffer_start + this_buffer_size;
+	c.checksum = 0;
+	c.checksum_good = 0;
+
+	if(op-&gt;opcode != AML_BYTELIST) return -1;
+	
+	if (resource_sprintf(&amp;c, "\nInterpreted as PnP Resource Descriptor:\n"))
+		return -1;
+
+	while (c.data_size)
+	{
+		if (*(c.data) &amp; 0x80)	// bit [7]
+			ret = large_resource(&amp;c);
+		else
+			ret = small_resource(&amp;c);
+		
+		if (ret)
+		{
+			*buffer_start = '\0';
+			return 0;
+		}
+	}
+
+	if (c.checksum_good)
+		return c.buffer - buffer_start;
+	else
+		return 0;
+}
diff -u --recursive --new-file pmtools.multiline/acpidisasm/util.c pmtools.new/acpidisasm/util.c
--- pmtools.multiline/acpidisasm/util.c	Wed Apr 26 22:16:30 2000
+++ pmtools.new/acpidisasm/util.c	Thu Apr 27 15:18:52 2000
@@ -485,7 +485,6 @@
 								 "&gt;");
 				}
 
-#if 0
 				buffer += size;
 				buffer_size -= size;
 				// does nothing and returns 0 if it doesn't
@@ -493,7 +492,6 @@
 				size = acpi_sprint_resource(buffer,
 							    buffer_size,
 							    op);
-#endif
 			}
 			break;
 		default:


</body></email><email><emailId>20000428112644</emailId><senderName>"Yuki Ogawa"</senderName><senderEmail>y-ogawa@dvpj.sony.co.jp</senderEmail><timestampReceived>2000-04-28 11:26:44-0400</timestampReceived><subject>Re: [Acpi] _HID query and patch</subject><body>

0xd041 is PNP0000.  i.e. AT Interrupt Controller.

You should notice that any XXX0000 PnP ID which will be compliled into WORD.
Also, recently sometime PnP ID is expressed as string. like "ACPI0003" or "*PNP0700".
So, your condition blanch for _HID/_CID should treat DWORD, WORD, and StringPrefix.


Following code fragment may converts a Packed ID in a byte stream to PnPID.
you can use and modify my code freely as public.  It's my sunday code.
But I cannot tell other parts.

DWORD dump_EISAID(BYTE * pAml,DWORD pos, DWORD *p)
{
 DWORD i=0;
 union EISAID id;
 char c1,c2,c3;

 printf("EISAID(\"");
 if(DWordPrefix == pAml[pos])
 {
  i++; // points DWORD as EISAID
  id.AsDWord = convert_endian(*p = READ_DWORD(pAml+pos+i));

  i += sizeof(DWORD);
 } else { // 0xAAAA -- XXX0000
  i++;
  id.AsDWord = convert_endian(*p = READ_WORD(pAml+pos+i));
 
  i += sizeof(WORD);
 }

 c1 = (char)(((id.AsDWord &amp; BIT30_26) &gt;&gt; 26) + 'A' - 1);
 c2 = (char)(((id.AsDWord &amp; BIT25_21) &gt;&gt; 21) + 'A' - 1);
 c3 = (char)(((id.AsDWord &amp; BIT20_16) &gt;&gt; 16) + 'A' - 1);
 printf("%c%c%c%02X%02X", c1,c2,c3, id.AsChar[1],  id.AsChar[0]);

 printf("\")");
#ifdef DEBUG_POS
 printf("/* p-&gt;EISAID = 0x%X */", *p);
#endif 
 return i;
}

----- Original Message ----- 
From: "Takanori Watanabe" &lt;takawata@shidahara1.planet.sci.kobe-u.ac.jp&gt;
To: &lt;acpi@phobos.fachschaften.tu-muenchen.de&gt;
Sent: Friday, April 28, 2000 7:21 PM
Subject: Re: [Acpi] _HID query and patch


&gt; In message &lt;200004281002.MAA02601@bastable.devel.redhat.com&gt;, "Michael K. Johns
&gt; on" wrote:
&gt; &gt;
&gt; &gt;The standard says, in section 6.1.4, that a _HID object evaluates
&gt; &gt;either to a string or to a 32-bit EISA ID.  I find this fragment
&gt; &gt;in my AML disassembly:
&gt; &gt;
&gt; &gt;0000365a:       Device PIC_ (\_SB_.PCI0.PX40.PIC_)
&gt; &gt;00003661:         Name _HID (\_SB_.PCI0.PX40.PIC_._HID)
&gt; &gt;00003666:           0xd041
&gt; &gt;
&gt; &gt;Clearly, that's not a DwordObject, nor is it a string.
&gt; 
&gt; Should'nt it be treated as 0x0000d041?(PNP0000).I think there is 
&gt; single strage class for number in ACPI spec 
&gt; ,though it is represented in many forms to save memory.
&gt; (Zero object,One object, Ones object,Byte,Word,Dword)
&gt; 
&gt; &gt;Am I justified in reporting this to Dell as a bug, or is there
&gt; &gt;something I don't know?
&gt; &gt;
&gt; &gt;I notice that plenty of the EISA IDs are ???d041 on this machine.
&gt; &gt;
&gt; &gt;I also notice some HIDs with non-ascii characters; particularly
&gt; &gt;nulls, which show up as @'s when decoded:
&gt; &gt;
&gt; &gt;000008c2:   Device MEM_ (\_SB_.MEM_)
&gt; &gt;000008ca:     Name _HID (\_SB_.MEM_._HID)
&gt; &gt;000008cf:       @HLd041 (0x010cd041)
&gt; &gt;                               
&gt; 
&gt; PNP0C01: System Board resource.
&gt; You probably caught in endian problem.
&gt; 
&gt; Takanori Watanabe
&gt; &lt;a href="http://www.planet.sci.kobe-u.ac.jp/~takawata/key.html"&gt;
&gt; Public Key&lt;/a&gt;
&gt; Key fingerprint =  2C 51 E2 78 2C E1 C5 2D  0F F1 20 A3 11 3A 62 2A 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; 

</body></email><email><emailId>20000428123630</emailId><senderName>Aashutosh Joshi</senderName><senderEmail>aashutosh@ami.com</senderEmail><timestampReceived>2000-04-28 12:36:30-0400</timestampReceived><subject>RE: [Acpi] [PATCH] ACPI</subject><body>

Andy:

Can you tell me which board(s) is/are not reserving memory correctly? =
If
possible can I get the E820 Dump? Per my knowledge this should not be
happening...
Regards
Ashu

----------------------------------------------------------------------
Ashu Joshi
SW Engineering Manager: Tech Dev

American Megatrends, Inc.
6145 F Northbelt Parkway
Norcross GA 30071 USA
Direct: 770 246 8759
Main: 770 246 8600
Cell:  678 296 7635
www.ami.com
-----------------------------------------------



-----Original Message-----
From: Anthony Jenkins [mailto:AnthonyJ@ami.com]
Sent: Thursday, April 27, 2000 6:42 PM
To: Andy Henroid
Cc: acpi@phobos.fachschaften.tu-muenchen.de
Subject: Re: [Acpi] [PATCH] ACPI


Andy Henroid wrote:

&gt; --- Anthony Jenkins &lt;AnthonyJ@ami.com&gt; wrote:
&gt; &gt; Will this disable Linux ACPI support for _all_ AMI
&gt; &gt; BIOSes matching the
&gt; &gt; AMI entry in acpi_errata_info[ ] ?
&gt;
&gt; No.  If you take a look, the patch is not disabling
&gt; ACPI at all but helping Linux map the ACPI tables
&gt; on some AMI-based systems.
&gt;
&gt; We are seeing some systems that have ACPI tables
&gt; in memory not reserved as ACPI table memory.

I think I understand... just wondering what we can do on our end to get
that resolved in future releases to make it easier on the OS people [he
said as if he had any pull around here :-) ].  Be a simple matter to =
pass
along suggestion to appropriate dept.

&gt; By
&gt; using trust-tables and copy-tables, we are telling
&gt; the ACPI driver that those tables really are there
&gt; (despite the ioremap failure) and just go ahead
&gt; and copy them out of the way (so that Linux doesn't
&gt; squash them).
&gt;
&gt; It should be completely harmless.
&gt;
&gt; -Andy
&gt;
&gt; __________________________________________________
&gt; Do You Yahoo!?
&gt; Talk to your friends online and get email alerts with Yahoo! =
Messenger.
&gt; http://im.yahoo.com/
&gt;
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

--
Anthony Jenkins
American Megatrends Inc.    http://www.ami.com
(770) 246-8600 ext 7241     mailto:AnthonyJ@ami.com


i=CAb(tm)=A8=A5-+-i=CAb=A6=1A=1B=A2=C7=DAr=1B=1C...=A7=EDz{ns=E7=A7r=17=A7=
u=E8m=B6Y=FF=A6=1A=1B=A2=C7=DAr=1B=1C...=A7=EDz{ns=E7=A7r=17=A7u=EF=E6j)=
fj=7F=E5
S=CBb=9D=FA?i=CAb

</body></email><email><emailId>20000429151242</emailId><senderName>Art Boulatov</senderName><senderEmail>aboulato@soros.ksu.ru</senderEmail><timestampReceived>2000-04-29 15:12:42-0400</timestampReceived><subject>[Acpi] Need to disable power button :)</subject><body>

Hi,

I have kinda strange question: 

Is it possible to completely disable the power button
with the help of ACPI?

The reason for that is:

We have 70 workstations running Linux
and much more users who likes to push the power
button in every case they think something goes wrong.

Like when netscape hangs - they push P/B,
when something else hangs - they push P/B,
some of them push P/B instead of just logging out.

The result is corrupted filesystems...

Well, acpid seems to correctly shutdown the system
when the power is pressed, that's great,
but I just don't want the user to be able to reboot/shutdown at all.

Is there any way to make the power button make no action
when it's pressed, may be just write to syslog that poweroff
was attempted?
Don't think that opening up 70 boxes and unplugging the P/B cable :)
is a cute decision.

Thanks a lot,
Art.

</body></email><email><emailId>20000429155637</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-29 15:56:37-0400</timestampReceived><subject>[Acpi] Re: Need to disable power button :)</subject><body>

Art Boulatov writes:
&gt;Is it possible to completely disable the power button
&gt;with the help of ACPI?

Sure.  The easiest way, I think, is to just compile kernels with ACPI
support and then do
echo 0xffffffff &gt; /proc/sys/acpi/event
You can also easily modify acpid to do anything you like, including
system("w | mail sysadmin@wherever -s 'user trying to power machine off, tsk'");
or you can, as you suggest, use syslog there.

Modify
acpid-&lt;version&gt;/acpid/event.c:acpid_pwrbtn()
to your heart's content.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000430125159</emailId><senderName>Art Boulatov</senderName><senderEmail>aboulato@soros.ksu.ru</senderEmail><timestampReceived>2000-04-30 12:51:59-0400</timestampReceived><subject>Re: [Acpi] Re: Need to disable power button :)</subject><body>

"Michael K. Johnson" wrote:
&gt; .........
&gt; Modify
&gt; acpid-&lt;version&gt;/acpid/event.c:acpid_pwrbtn()
&gt; to your heart's content.
&gt; ...............

Yes, that works,
but if I keep the button pressed for more than ~4 seconds,
it immideately poweroffs.
How do I handle that?

Art.

</body></email><email><emailId>20000430132740</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-30 13:27:40-0400</timestampReceived><subject>[Acpi] Re: Need to disable power button :)</subject><body>

Art Boulatov writes:
&gt;Yes, that works,
&gt;but if I keep the button pressed for more than ~4 seconds,
&gt;it immideately poweroffs.
&gt;How do I handle that?

Oops, I was forgetting that.

You can't.

That's a hardware feature, and cannot be overriden by software.

At least you can log who the offending users are more easily, and
not everyone knows to hold the power button down for more than
4 seconds to initiate an unmanaged power-off.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000430041313</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-04-30 04:13:13-0400</timestampReceived><subject>[Acpi] [RFC] Getting rid of useless daemons (fwd)</subject><body>

&gt;From the lkml.

   Simon

---------- Forwarded message ----------
Date: Sat, 29 Apr 2000 20:17:20 -0300
From: Cesar Eduardo Barros &lt;cesarb@web4u.com.br&gt;
Subject: [RFC] Getting rid of useless daemons

We got rid of bdflush. We got rid of kerneld. We got rid of update.

Now I think it's time to get rid of apmd, acpid and devfsd.

apmd could be changed into an executable "callback", like kmod/modprobe. acpid
(as far as I know at least) is like apmd but also parses the ACPI tables (easy
to do within a boot script, at the same spot acpid would be loaded). devfsd is
also mostly a callback-like daemon with some on-load behavior.

Comments?

-- 
Cesar Eduardo Barros
cesarb@web4u.com.br
cesarb@dcc.ufrj.br

-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at http://www.tux.org/lkml/

</body></email><email><emailId>20000430115928</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-30 11:59:28-0400</timestampReceived><subject>[Acpi] Re: _HID query and patch</subject><body>

"Michael K. Johnson" writes:
&gt;Andy, I'll fix this and send out a new patch that supercedes the
&gt;one I just sent.

This one seems to work.  I'm still not sure about the endianness of
numbers as read in by parse.c -- I did all my assembly training on
m68k machines and so get easily confused by little-endian machines
-- but this patch doesn't break anything and does seem to decode
all my non-method _HID objects correctly (I have no _CID objects
on this machine).

Andy, this replaces my previous patch, and applies directly over
my multiline and resource descriptor printing patches.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

diff -u --recursive pmtools.checksum/acpidisasm/util.c pmtools.eisaid/acpidisasm/util.c
--- pmtools.checksum/acpidisasm/util.c	Thu Apr 27 22:21:04 2000
+++ pmtools.eisaid/acpidisasm/util.c	Sun Apr 30 13:50:38 2000
@@ -226,6 +226,51 @@
 	return (buffer - buffer_start);
 }
 
+static int
+acpi_sprint_pnp(char *buffer, int buffer_size, const struct acpi_op *op)
+{
+	char name[5];
+	u32 identifier = 0;
+
+	// This might be a PnP identifier...
+	if (op-&gt;parent &amp;&amp;
+	    op-&gt;parent-&gt;opcode == AML_NAME &amp;&amp;
+	    acpi_sprint_name(name, 5,
+			     acpi_get_name(op-&gt;parent)) &amp;&amp;
+	    (!strncmp(name, "_HID", 4) ||
+	     !strncmp(name, "_CID", 4)))
+	{
+		// Parent is a Name named _[HC]ID; this
+		// must be a PnP identifier
+
+		// Battle with endianness :-(
+		switch (op-&gt;opcode)
+		{
+		case AML_DWORDCONST:
+			identifier |= (op-&gt;value.integer &amp; 0xff0000) &gt;&gt; 8;
+			identifier |= (op-&gt;value.integer &amp; 0xff000000) &gt;&gt; 24;
+			// fall through
+		case AML_WORDCONST:
+			identifier |= (op-&gt;value.integer &amp; 0xff) &lt;&lt; 24;
+			identifier |= (op-&gt;value.integer &amp; 0xff00) &lt;&lt; 8;
+		}
+
+		return acpi_safe_sprintf(buffer,
+			 buffer_size,
+			 18,
+			 "%c%c%c%04x (0x%08x)",
+			 ((identifier &gt;&gt; 26) &amp; 0x1f) + 0x40,
+			 ((identifier &gt;&gt; 21) &amp; 0x1f) + 0x40,
+			 ((identifier &gt;&gt; 16) &amp; 0x1f) + 0x40,
+			 identifier &amp; 0xffff,
+			 op-&gt;value.integer);
+	}
+	else
+	{
+		return 0;
+	}
+}
+
 /*
  * Store printed op in a buffer and return its length
  * (or -1 if out of space)
@@ -249,18 +294,26 @@
 						 op-&gt;value.integer &amp; 0xff);
 			break;
 		case AML_WORDCONST:
-			size = acpi_safe_sprintf(buffer,
-						 buffer_size,
-						 6,
-						 "0x%04x",
-						 op-&gt;value.integer &amp; 0xffff);
+			size = acpi_sprint_pnp(buffer, buffer_size, op);
+			if (!size)
+			{
+				size = acpi_safe_sprintf(buffer,
+							 buffer_size,
+							 6,
+							 "0x%04x",
+							 op-&gt;value.integer &amp; 0xffff);
+			}
 			break;
 		case AML_DWORDCONST:
-			size = acpi_safe_sprintf(buffer,
-						 buffer_size,
-						 10,
-						 "0x%08x",
-						 op-&gt;value.integer);
+			size = acpi_sprint_pnp(buffer, buffer_size, op);
+			if (!size)
+			{
+				size = acpi_safe_sprintf(buffer,
+							 buffer_size,
+							 10,
+							 "0x%08x",
+							 op-&gt;value.integer);
+			}
 			break;
 		case AML_STRING:
 			if(op-&gt;value.string)

</body></email><email><emailId>20000430122043</emailId><senderName>"Michael K. Johnson"</senderName><senderEmail>johnsonm@redhat.com</senderEmail><timestampReceived>2000-04-30 12:20:43-0400</timestampReceived><subject>[Acpi] Re: PnP resource printing patch</subject><body>

Andy Henroid writes:
&gt;No, I think using the compiler to fix broken or
&gt;missing ACPI implementations is entirely the wrong
&gt;idea.  We should push hardware/BIOS vendors to
&gt;ensure that their tables are correct.  With growing
&gt;Linux momentum, I believe it should be quite
&gt;possible for us to say "Hey, your ACPI is broken
&gt;and will not work with Linux" and actually see a
&gt;timely response.  For example, see AMI...

Yes, it is definitely true that more vendors are
taking Linux seriously.

&gt;The value in an open-source compiler would be to
&gt;get vendors to generate the correct AML in the
&gt;first place.

Speaking of correct AML: one of the missing things
for writing a good ASL compiler is a large base
of known-good ASL code from which to start.
This makes the bootstrap process much harder.
The example code that is out there is somewhat
scanty, I think, and in particular I don't recall
that it really exercises all the parts of the
compiler.

&gt;Add plenty of warnings, don't let
&gt;them get away with all of the wrong code that
&gt;the MS compiler passes right through.

Another good point!  We need examples of wrong
code that the MS compiler allows.

And, of course, the compiler needs to do quite
a lot of syntactic analysis to warn about stupid
mistakes that are perfectly legal ASL but will
compile to a broken ACPI implementation, I
expect.

&gt;All of this closed spec work is definitely
&gt;in need of something along the lines of the
&gt;IETF, sample implementation before spec completion.

Absolutely!  The ACPI standard shows in many
ways (I'm sure you are far more aware of this
than I am) that specification proceeded
implementation.  For instance, I'm dead
sure that if anyone had tried to write an
interpreter for AML before they set the
language in stone, they would have made
changes that would have avoided the need
for your "extra op" handling in acpidisasm.

&lt;soapbox&gt;
Unfortunately, it appears that there is zero
interest on the part of the companies that
sponsor the ACPI specification on opening up
the process.  You may remember, Andy, that
when I tried to even drop an informal hint
about one thing that could be improved in the
standard without signing reams and reams of
papers, the member of the standards committee
said that if he listened to my suggestion, they
would be effectively forced NOT to implement
it no matter how good it was because I was
not a member of the cabal.  If you go to the
ACPI web site, they say the same thing right
out; they will not listen to suggestions for
the next draft unless you become a member of
their little clique.

There are much, much more serious problems
here than lack of a free compiler.  Lack of
commitment to truly open standards on the
part of the three main sponsors of the ACPI
standard is a key problem.  I mean, there
are wonderful people like Andy at all three
companies who really understand this, but
they are clearly not high enough up the
corporate ladder to set policy for the ACPI
standard.
&lt;/soapbox&gt;

So I'm not sure what a free compiler would do
to open up the process.  Seems like trying to
put out a forest fire with an eyedropper.

michaelkjohnson

"Magazines all too frequently lead to books and should be regarded by the
 prudent as the heavy petting of literature."            -- Fran Lebowitz
 Linux Application Development     http://people.redhat.com/johnsonm/lad/

</body></email><email><emailId>20000430195941</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-04-30 19:59:41-0400</timestampReceived><subject>Re: [Acpi] Re: Need to disable power button :)</subject><body>

On Sun, 30 Apr 2000, Art Boulatov wrote:

&gt; Yes, that works,
&gt; but if I keep the button pressed for more than ~4 seconds,
&gt; it immideately poweroffs.
&gt; How do I handle that?

This cannot be handled, I'm afraid. :-/ &lt;microsoft&gt;But it's not a bug,
it's a feature! The users who know that pressing the power button for four
seconds will power off anyway are those who know when a lab computer
definitely needs to be rebooted.&lt;/microsoft&gt;

No, seriously, if someone really wants to turn the machine off, he will
pull the plug or something. However, he will first try the power button.
If you display a big red blinking warning message then, you will achieve
more than when you disable the power button completely.

   Simon

-- 
PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

</body></email><email><emailId>20000430232918</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-04-30 23:29:18-0400</timestampReceived><subject>[Acpi] Re: [RFC] Getting rid of useless daemons</subject><body>

On Sun, 30 Apr 2000, Jeff Garzik wrote:

&gt; Parsing tables is way different from parsing AML.  Why does there need
&gt; to be an AML parser in the kernel?  It seems like Andy adequate
&gt; responded to your list of drawbacks at the above link, so I hope you
&gt; mind my request for a clarification of the issue.

The AML interpreter isn't required to be in the kernel for power
management (although I still think we might run into trouble if we send
devices to sleep using AML methods, as we don't currently reinitialize all
devices after acpid has started [for the full discussion, check out the
September 1999 archive at http://phobos.fs.tum.de/pipermail/acpi ]). For
configuration management, this is a different thing, since you need to
execute AML code in order to assign resources to devices. Since you don't
want to reassign resources after the system has booted (and this also
implies that you have access to the harddisks without ACPI enum, which may
not be true for future systems), you need the interpreter in the kernel.

   Simon

-- 
PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

</body></email><email><emailId>20000430234040</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-04-30 23:40:40-0400</timestampReceived><subject>[Acpi] howto get it working? no docs yet? (fwd)</subject><body>

---------- Forwarded message ----------
Date: Mon, 24 Apr 2000 18:52:34 +0200 (CEST)
From: narancs1@mail.externet.hu
To: Max.Berger@phobos.fachschaften.tu-muenchen.de,
     Simon.Richter@phobos.fachschaften.tu-muenchen.de
Subject: howto get it working? no docs yet?

Dear developers!

I was really happy when I first found ACPI support in the kernel.
I didn't thought of user-space daemon for months ;-)
that's my stupidity.

Then I guessed that if apm needs a daemon then acpi will need it too.

So I downloaded the latest from geocities, compiled, I wrote some init scripts
too.

Now I have kernel 2.3.99-pre3. (and pre6-5)
I make lsmod
acpi 9800 0 (unused)
run acpid
and it is still unused.
I see 2 acpid running (i have 2 cpus on abit bp6)

So what?
Is it working?
ACPI only works with acpi compat. cards?
How can I see if my cards are acpi compat?

Thanks for your great work and efforts!
(ps. I could find no docs and readmes. SO that's why I mailind you.)

</body></email><email><emailId>20000301135743</emailId><senderName>Alexander Larsson</senderName><senderEmail>alex@cendio.se</senderEmail><timestampReceived>2000-03-01 13:57:43-0400</timestampReceived><subject>[Acpi] pm_callback return value</subject><body>

According to the doc (pm.txt), pm_callback should return -EINVAL "if the
request is not supported". What does "support" mean in this context? If a
device supports D0 and D2 states, should it return -EINVAL on a D3
request, or should it go to D2 state (nearest higher power state)?

The apm driver (and my code) just calls pm_send_all with state D3 on
suspend. This will not work if some device doesn't support D3 and returns
-EINVAL.

/ Alex

</body></email><email><emailId>20000301194156</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-03-01 19:41:56-0400</timestampReceived><subject>[Acpi] Re: pm_callback return value</subject><body>

--- Alexander Larsson &lt;alex@cendio.se&gt; wrote:

&gt; According to the doc (pm.txt), pm_callback should
&gt; return -EINVAL "if the request is not supported".
&gt; What does "support" mean in this context? If a
&gt; device supports D0 and D2 states, should it return
&gt; -EINVAL on a D3 request, or should it go to D2
&gt; state (nearest higher power state)?

A device that doesn't support D3 should fail the
D3 request.  The power management subsystem will
then know the device does not support D3 and will
try D2 and so on until it finds the deepest state
that the device does support.  (I say "will"
because right now the PM driver just stops at
the first failure.  The driver really needs to
comprehend device dependencies (device X is on
bus Y) before this will work correctly.)

Documentation addition, thanks.

-Andy


__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000301234744</emailId><senderName></senderName><senderEmail>daniel.egger</senderEmail><timestampReceived>2000-03-01 23:47:44-0400</timestampReceived><subject>[Acpi] Re: APM_power_off</subject><body>

On  1 Mar, Andy Henroid wrote:

Mar  2 00:39:59 schleppi acpid: started
Mar  2 00:39:59 schleppi acpid: FACP @ 0x07ff8028
Mar  2 00:39:59 schleppi acpid: DSDT @ 0x07ff80a0
Mar  2 00:39:59 schleppi acpid: S0 SLP_TYP (0x0505)
Mar  2 00:39:59 schleppi acpid: S1 not supported
Mar  2 00:39:59 schleppi acpid: S2 not supported
Mar  2 00:39:59 schleppi acpid: S3 SLP_TYP (0x0101)
Mar  2 00:39:59 schleppi acpid: S4 SLP_TYP (0x0000)
Mar  2 00:39:59 schleppi acpid: S5 SLP_TYP (0x0000)

&gt; You can verify that C-states work by running acpid
&gt; and looking for "ACPI Cx works" in the kernel log.

 Umn, ACPI Cx works?
 
&gt; (Note, this is if your system has ACPI tables,
&gt; otherwise you need to fill in C-state latency
&gt; values for /proc/sys/acpi/p_lvlX_lat.  Sorry,
&gt; this should probably go in the documentation
&gt; somewhere)

 The values are there...
 
 0x00000166 for p_lvl2_lat
 0x000002cc for p_lvl3_lat

&gt; A working S5 is verified by running acpid and
&gt; do "shutdown -h now".  Does you system power-off?
&gt; If not, S5 is not supported (check syslog) or
&gt; S5 is broken.  (This will not work at all unless
&gt; you have ACPI tables)

 Doesn't work, however this could also be a broken init.

&gt; You can verify that ACPI events work by running
&gt; acpid and pressing the power button.  Does the
&gt; system start to shutdown?

 No, nothing no one of the 2 buttons causes any reation.
 Well, pressing them longer will turn off the power....

 Back to apm...

-- 

Servus,
       Daniel

</body></email><email><emailId>20000302193828</emailId><senderName>Simon Richter</senderName><senderEmail>geier@phobos.fs.tum.de</senderEmail><timestampReceived>2000-03-02 19:38:28-0400</timestampReceived><subject>Re: [Acpi] pmtools</subject><body>

On Thu, 2 Mar 2000, Andy Henroid wrote:

&gt; pmtools are available from
&gt; http://www.geocities.com/SiliconValley/Hardware/3165/
&gt; and hopefully soon thereafter from the main ACPI4Linux web page.

Should be online now.

   Simon

PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

</body></email><email><emailId>20000306203544</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-03-06 20:35:44-0400</timestampReceived><subject>[Acpi] new acpid</subject><body>

A new version of acpid is now available from

 
http://www.geocities.com/SiliconValley/Hardware/3165/

and soon after at the main ACPI4Linux website.

The changes from the last acpid release are primarily
internal and will have little user-visible effect
for now (significant parser/interpreter cleanup,
additional interpreter functionality, and better
stability running control methods)

Though not immediately apparent, this is a large
step forward for the interpreter and soon battery
and thermal support will follow.

-Andy


__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000312230952</emailId><senderName>Simon Richter</senderName><senderEmail>geier@phobos.fs.tum.de</senderEmail><timestampReceived>2000-03-12 23:09:52-0400</timestampReceived><subject>[Acpi] ACPI patch for kernel 2.2.14?</subject><body>

Hi,

Sean has posted his patch to the list, but as the file has over 40k (and
would also get inflated by the transfer encoding), I've put up the file
under

http://phobos.fs.tum.de/acpi/download/seans-2.2.14-acpi-patch.gz

for download, his message (minus the attachment) is included below.

   Simon

PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

--- Forwarded message ---
From: Sean Furey &lt;local.linux.acpi@furey.freeserve.co.uk&gt;
To: ACPI Mailing list &lt;acpi@phobos.fachschaften.tu-muenchen.de&gt;
Subject: Re: [Acpi] ACPI patch for kernel 2.2.14?
Date: Sun, 12 Mar 2000 22:04:46 +0000

Hi Andy!

On Sun, 05 Mar 2000, you wrote:
&gt; Yeah, right on, post your patch.  It would be most
&gt; useful if it is a backport of the current 2.3 ACPI
&gt; driver to 2.2 but it could be useful even if not.

Ok, here it is.  Unfortunately it is not a backport.  It is a very simple
adaption of the patch for 2.2.9.  I wouldn't have a clue on how to backport,
I'm just a simple (l)user that wanted poweroff.

Unlike the standard patches it assumes that your source is the linux/, relative
to the current directory.  This was because it was aimed at normal users who
would not have the acpi/linux/ hierarchy setup.

&gt; Thermal and battery can be done up in userspace
&gt; by acpid for now.  Suspend probably won't come
&gt; along until 2.5.

Unfortunately not being at the "cutting edge" of ACPI I really don't know a lot
about this :).  I await kernel 2.4 so that I can be up to date.

-- 
Sean Furey
sean@furey.freeserve.co.uk

</body></email><email><emailId>20000313004640</emailId><senderName>Illuminatus Primus</senderName><senderEmail>vermont@gate.net</senderEmail><timestampReceived>2000-03-13 00:46:40-0400</timestampReceived><subject>Re: [Acpi] controlling fans</subject><body>

First of all, thanks for the reply. It took me a while to look into
it, but here is what I found:

There was no "_TZ_" scope in the dump. However, towards the bottom in
the "_SB_" scope there is

    Device FAN0
      Name _HID
        0x0b0cd041

and that's it! There are no _ON or _OFF methods, nor a _TMP! I know
the system keeps track of the temperature, because it can be displayed
in BIOS. Is lm78 via I2O the only way to get this information?

I'd really like to cut the fans off.. I'll try upgrading the BIOS.

One more thing.. there are two fans, both plugged into the
motherboard: one for the CPU, and one for the case in general. They
have three wires each, which I take to mean that they have built-in
sensors. Only one fan showed up in the dump.

&gt; 
&gt;   acpidmp DSDT | acpidisasm | less
&gt; 
&gt; Look within the "_TZ_" (thermal zones) scope.
&gt; Do you see a device called "FAN_" with HID
&gt; 0x0b0cd041?  Possibly with an attached power
&gt; resource with methods "_ON_" and "_OFF"?
&gt; (hmmm.. I wonder what those do :)  How about
&gt; a method called "_TMP" (current temperature)?
&gt; 
&gt; -Andy
&gt; 
&gt; __________________________________________________
&gt; Do You Yahoo!?
&gt; Talk to your friends online with Yahoo! Messenger.
&gt; http://im.yahoo.com
&gt; 
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000302191519</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-03-02 19:15:19-0400</timestampReceived><subject>[Acpi] pmtools</subject><body>

I'm releasing some power management test and
informational tools that I've put together.

These were formerly called "acpitools" and now
"pmtools" because I've added an application that
is for general power management use (pmtest
which can be used by kernel developers to test
the power management support in their drivers).

acpidmp is unchanged and I've made a fairly
major parsing bug fix to acpidisasm.  pmtools
are available from

 
http://www.geocities.com/SiliconValley/Hardware/3165/

and hopefully soon thereafter from the main
ACPI4Linux web page.

Thank you,
Andy
andy_henroid@yahoo.com


__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000301221637</emailId><senderName>Gordon Peters</senderName><senderEmail>gordpeters@smarttech.com</senderEmail><timestampReceived>2000-03-01 22:16:37-0400</timestampReceived><subject>[Acpi] ACPI patch for kernel 2.2.14?</subject><body>

Does such a patch exist?  Or is there a CVS branch I can grab from somewhere
that contains the ACPI kernel code?  All I can seem to find everywhere are
the ACPI tools.

Thanks.
	Gord

</body></email><email><emailId>20000301223729</emailId><senderName>Simon Richter</senderName><senderEmail>geier@phobos.fs.tum.de</senderEmail><timestampReceived>2000-03-01 22:37:29-0400</timestampReceived><subject>Re: [Acpi] ACPI patch for kernel 2.2.14?</subject><body>

On Wed, 1 Mar 2000, Gordon Peters wrote:

&gt; Does such a patch exist?  Or is there a CVS branch I can grab from somewhere
&gt; that contains the ACPI kernel code?  All I can seem to find everywhere are
&gt; the ACPI tools.

There were a bunch of patches against the 2.2 series, but they were
informational only (basically to help us dump the ACPI tables, so we could
get a view what different ACPI implementations are out there). So the
answer is "no", I'm afraid.

   Simon

PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

</body></email><email><emailId>20000306030406</emailId><senderName>Illuminatus Primus</senderName><senderEmail>vermont@gate.net</senderEmail><timestampReceived>2000-03-06 03:04:06-0400</timestampReceived><subject>[Acpi] controlling fans</subject><body>

Hi - I saw the ACPI presentation at the Atlanta Linux Showcase '99 and
was very impressed.

I would like to control the fans in my desktop machine, which has an
ABIT 440BH motherboard. Apparently, this motherboard is ACPI friendly.
Is controlling the fans possible through ACPI, or should it be done
through some other mechanism?

If I remember correctly, controlling the fans on a laptop was one of
the abilities of ACPI. I hope this is also true of desktops.

Thanks,
Vermont

</body></email><email><emailId>20000306074508</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-03-06 07:45:08-0400</timestampReceived><subject>Re: [Acpi] controlling fans</subject><body>

--- Illuminatus Primus &lt;vermont@gate.net&gt; wrote:

&gt; I would like to control the fans in my desktop
&gt; machine, which has an ABIT 440BH motherboard.
&gt; Apparently, this motherboard is ACPI friendly.
&gt; Is controlling the fans possible through ACPI, or
&gt; should it be done through some other mechanism?

&gt; If I remember correctly, controlling the fans on a
&gt; laptop was one of the abilities of ACPI. I hope
&gt; this is also true of desktops.

Yes, depending on how complete the ACPI
implementation is on your laptop, it is probably
possible to control the fan and do other things
necessary for thermal control (eg. read the
current temperature).

Does the current ACPI driver on Linux support
thermal right now?  Well, unfortunately, no
it does not.  The biggest hurdle to thermal
support is completing the AML interpreter and
we are working on that right now.

Until then, it might be interesting to find out
if your laptop really does have ACPI thermal
support.  If you are curious, grab and build
the pmtools from the ACPI4Linux website
(http://phobos.fs.tum.de/acpi/).  Then dump
your DSDT and disassemble the contained
AML.

  acpidmp DSDT | acpidisasm | less

Look within the "_TZ_" (thermal zones) scope.
Do you see a device called "FAN_" with HID
0x0b0cd041?  Possibly with an attached power
resource with methods "_ON_" and "_OFF"?
(hmmm.. I wonder what those do :)  How about
a method called "_TMP" (current temperature)?

-Andy

__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000306075813</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-03-06 07:58:13-0400</timestampReceived><subject>Re: [Acpi] controlling fans</subject><body>

--- Illuminatus Primus &lt;vermont@gate.net&gt; wrote:

&gt; If I remember correctly, controlling the fans on a
&gt; laptop was one of the abilities of ACPI. I hope
&gt; this is also true of desktops.

I'm sorry, yes and to answer you original
question...  :)  Yes, on a fully ACPI enabled
_desktop_ you will also have thermal support,
including fan control.

System vendors have a lot of flexibility on
what ACPI features they support, so you might
want to check out your system as I describe in
the previous mail.

-Andy


__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000313070712</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-03-13 07:07:12-0400</timestampReceived><subject>[Acpi] acpid fix</subject><body>

A new acpid is available now from

  
http://www.geocities.com/SiliconValley/Hardware/3165/

and soon after at the main ACPI4Linux website.
This should fix any build problems that people
were having on various systems.  Let me know
if it doesn't.

Just a reminder that as of the next development
kernel release (2.3.52), you will need to upgrade
to the latest version of acpid.  People running
2.3.51 and earlier kernels should stick with the
old version of acpid.

Thanks,
Andy


__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000316232448</emailId><senderName>Tony Hoyle</senderName><senderEmail>tmh@magenta-logic.com</senderEmail><timestampReceived>2000-03-16 23:24:48-0400</timestampReceived><subject>[Acpi] acpid failure on 2.3.99-pre1 on BP6</subject><body>

With the latest kernel and latest acpi I note that the BP6 isn't supported.
What info is required to help support this board?

I am using the latest BIOS (QQ-2), and Win2k shows full support for
ACPI, Fans, Poweroff etc.

acpid -d gives the following output:

acpid: started
acpid: FACP loaded from /proc/sys/acpi/
acpid: DSDT loaded from /proc/sys/acpi/
acpid: S0 not supported
acpid: S1 not supported
acpid: S2 not supported
acpid: S3 not supported
acpid: S4 not supported
acpid: S5 not supported
acpid: no processor block

Output from acpidmp DSDT | acpidisasm attached.  This clearly shows
support for S1,S2 and S5, and two processor blocks (if I read the dump
right, anyway).
The previous version of acpid correctly identified S0 and S1 but not S5,
so something has changed which has made it worse...

Tony

(Can't subscribe to the list until Monday, unfortunately as I'm at
home...)

</body></email><email><emailId>20000321103010</emailId><senderName>"Waldram, Andrew"</senderName><senderEmail>andrew.waldram@siemens.co.uk</senderEmail><timestampReceived>2000-03-21 10:30:10-0400</timestampReceived><subject>[Acpi] VIA support in ACPI</subject><body>

This is my first attempt to get ACPI functioning but due to the lack of
documentation I am totally stuck
please help

I am trying to get ACPI to function on my TMCti5vga (via mvp) motherboard

I am running kernel 2.3.51 with ACPI enabled during boot it sees a VIA vp3
chipset

The board has a VP3 (586) Northbridge and an mvp4 Southbridge (686) though I
don't think this should matter in this case.

I have checked /proc/sys/acpi and have what looks like a working ACPI

I have the latest acpid

I then run /opt/acpid/acpid -d

I get

ACPID starting
unable to find ACPI namespace

I've checked the newsgroups but am unable to make any head way

Do I need to add tables somewhere

The board is ACPI compliant and functions correctly in NT2000

&gt; * Email: Andrew.Waldram@siemens.co.uk
&gt; 
Andy Waldram 

</body></email><email><emailId>20000323220500</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-03-23 22:05:00-0400</timestampReceived><subject>[Acpi] Re: acpid</subject><body>

--- Dvir Oren &lt;dviro@lucidvon.com&gt; wrote:

&gt; However, soon after 
&gt; I load acpid, I get hda - lost interrupt, which will
&gt; soon after lock up 
&gt; the system entirely (ctrl-alt-del doesn't work, and

Yes, I've also seen that "hda - lost interrupt"
message after entering C2 or C3 (processor power
states when the system is idle) on my systems.

First, please make sure the lockup is related to
ACPI.  Does it happen with and without the ACPI
driver?

&gt; the power off 
&gt; button doesn't work).  The acpid does get notified
&gt; of pressing the 
&gt; power button, and I did once see it writing INIT: 
&gt; switching to 
&gt; runlevel 0, however it stopped there, and didn't do
&gt; anything else.

Hmm..  It sounds like ACPI events are at least
working for you.  So, it freezes after "INIT:
switching to runlevel 0" ?  That sounds odd
possibly indicative of a problem elsewhere.
If acpi is the culprit, I would expect a freeze
right after the "power off" message (depending
on your Linux distribution)

Does "shutdown -r now" have the same problem?

&gt; All I really need is for the system to shutdown
&gt; correctly when I 
&gt; press the power button.  Is there a way to disable
&gt; everything else 
&gt; (like that hard disk thing)?

One thing to try is...

 1) cat /proc/sys/acpi/s5_slp_typ &gt; s5.txt
 2) Add 'acpi=chipset' to you kernel command line
    Probably just add 'append="acpi=chipset"' to
    your lilo.conf
 3) Reboot (hopefully it finds your ACPI enabled
    chipset)
 4) cat s5.txt &gt; /proc/sys/acpi/s5_slp_typ
 5) Shutdown or whatever

Sorry, kind of a pain.  Or you can just wait and
I'll make it easier to turn off C-states in my
next patch.

I'm still not convinced that C-states (and/or the
missing interrupt) are really the problem.

&gt; Someone posted a patch for 2.2.14.  Is there an
&gt; acpid that would 
&gt; work with that?  Do you keep olrder acpid?

No, actually, that patch was backported from a
fairly old ACPI patch.  It shouldn't really even
need acpid, but then I suspect that patch is also
not going to work for you if the 2.3 support
doesn't

-Andy


__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000323230134</emailId><senderName>"Dvir Oren"</senderName><senderEmail>dviro@lucidvon.com</senderEmail><timestampReceived>2000-03-23 23:01:34-0400</timestampReceived><subject>[Acpi] Re: acpid</subject><body>

&gt; Yes, I've also seen that "hda - lost interrupt"
&gt; message after entering C2 or C3 (processor power
&gt; states when the system is idle) on my systems.
&gt; 
&gt; First, please make sure the lockup is related to
&gt; ACPI.  Does it happen with and without the ACPI
&gt; driver?

It is definitely ACPI related.  It only happends after I run acpid, and 
it happens soon or right after I run acpid.

&gt; Hmm..  It sounds like ACPI events are at least
&gt; working for you.  So, it freezes after "INIT:
&gt; switching to runlevel 0" ?  That sounds odd

I was only able to do it once, so it normally my computer freezes 
before I'm able to do anything (With the hda-lost interrupt 
message).  That one time I was able to press the power button, 
and I saw the INIT message, but then I pressed enter, and I got the 
prompt back.  A second later the computer froze.

&gt; Does "shutdown -r now" have the same problem?

Can't get to do that.  As soon as I run acpid, the computer freezes.


---------
Dvir Oren &lt;dviro@lucidvon.com&gt;
Lucid VON Ltd.     &lt;http://www.lucidvon.com&gt;
9 Saloniki St.,        Tel-Aviv       Israel
Tel:  +972 3 644 3038  Fax:  +972 3 644 3039

</body></email><email><emailId>20000324182240</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-03-24 18:22:40-0400</timestampReceived><subject>[Acpi] Re: VIA vp3 with 686a Southbridge</subject><body>

&gt;-- awaldram &lt;awaldram@samuri.demon.co.uk&gt; wrote:

&gt; If you look at DSDT and FACP it looks like they are
&gt; garbage not what I would
&gt; have expected at all
&gt; 
&gt; Do you tjhink this is related to my hybrid chipset
&gt; (586 Northbridge 686a
&gt; Southbridge) can the program not find my acpi bios.

Right, your DSDT and FACP look like they are in the
wrong format.  The table header do not comply to
the ACPI 1.0 spec at least.  This could very
well be an error on VIA's part.

You might want to try adding "acpi=chipset" to
your kernel command line and then at least you
could get processor power states (C-states) from
the ACPI driver.

-Andy


__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000325215939</emailId><senderName>Kurt Roeckx</senderName><senderEmail>q@ping.be</senderEmail><timestampReceived>2000-03-25 21:59:39-0400</timestampReceived><subject>[Acpi] compile problems</subject><body>

I just downloaded acpid-031700, and when compiling I got this:

gcc -g -O2  -I/usr/src/linux/include  -Iosdependent/linux
-Isubsystem/include -Wall -Wno-unused   -c osdependent/linux/osd.c -o osd.o
osdependent/linux/osd.c:25: sys/io.h: No such file or directory

Any suggestions?


Kurt

</body></email><email><emailId>20000328005144</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-03-28 00:51:44-0400</timestampReceived><subject>Re: [Acpi] compile problems</subject><body>

--- Kurt Roeckx &lt;Q@ping.be&gt; wrote:
&gt; I just downloaded acpid-031700, and when compiling I
&gt; got this:
&gt; 
&gt; gcc -g -O2  -I/usr/src/linux/include 
&gt; -Iosdependent/linux
&gt; -Isubsystem/include -Wall -Wno-unused   -c
&gt; osdependent/linux/osd.c -o osd.o
&gt; osdependent/linux/osd.c:25: sys/io.h: No such file
&gt; or directory
&gt; 
&gt; Any suggestions?

Hmmm..  What Linux distribution are you using
(Debian, RedHat, SUSE, Mandrake, etc..)?

The file /usr/include/sys/io.h probably should
be there.

-Andy


__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000330094655</emailId><senderName>Dvir Oren</senderName><senderEmail>dviro@lucidvon.com</senderEmail><timestampReceived>2000-03-30 09:46:55-0400</timestampReceived><subject>[Acpi] ACPI+APM</subject><body>

I tried the acpi+apm patch, which creates a notifier chain, which will
try to call the apm power off, if the acpi didn't work.

It seems like the newest ACPI breaks the APM power off.  I get a very
nasty protection fault when APM tries to power off.

Anybody know anything about this?

-- 
Dvir Oren               &lt;dviro@lucidvon.com&gt;
Lucid VON Ltd.     &lt;http://www.lucidvon.com&gt;
9 Saloniki St.,        Tel-Aviv       Israel
Tel:  +972 3 644 3038  Fax:  +972 3 644 3039

</body></email><email><emailId>20000330095849</emailId><senderName>"Waldram, Andrew"</senderName><senderEmail>andrew.waldram@siemens.co.uk</senderEmail><timestampReceived>2000-03-30 09:58:49-0400</timestampReceived><subject>RE: [Acpi] ACPI+APM</subject><body>

Hi

I've seen this 

If the protection fault occurs just after run level 0 is reached it is
probably your BIOS not liking protected mode apm calls

Try enabling real mode call in the kernel (under APM)

Hope this helps

-----Original Message-----
From: Dvir Oren [mailto:dviro@lucidvon.com]
Sent: 30 March 2000 10:47
To: ACPI
Subject: [Acpi] ACPI+APM


I tried the acpi+apm patch, which creates a notifier chain, which will
try to call the apm power off, if the acpi didn't work.

It seems like the newest ACPI breaks the APM power off.  I get a very
nasty protection fault when APM tries to power off.

Anybody know anything about this?

-- 
Dvir Oren               &lt;dviro@lucidvon.com&gt;
Lucid VON Ltd.     &lt;http://www.lucidvon.com&gt;
9 Saloniki St.,        Tel-Aviv       Israel
Tel:  +972 3 644 3038  Fax:  +972 3 644 3039


_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000325071435</emailId><senderName>awaldram</senderName><senderEmail>awaldram@samuri.demon.co.uk</senderEmail><timestampReceived>2000-03-25 07:14:35-0400</timestampReceived><subject>[Acpi] Re: VIA vp3 with 686a Southbridge</subject><body>

HI again,

Though in common with most people I want S5 escpecialy as APM is broken on my
machine (no protected mode), GPF's or seg faults machine depending on OS and as
ACPI functions in Mickeys offerings I hoped I could get at least S5 to function
in Linux.

I tried your sugestion just to see if I could start on the path of ACPI4Linux
:-)

But now the circle is complete, after using append=acpi=chipset, trying to start
ACPID results in 'unable to load ACPI namespace'.

I don't know if this will help but as the kernell starts acpi I get the message

&lt;6&gt;ACPI: "VIAVP3" found at 0x000f7170
&lt;3&gt;ACPI: unreserved table memory @ 0x07ff30c0!

What worries me is VIA VP3 as this is only true for my Northbridge

Also during CPU setup I get

&lt;4&gt;e820: 0009fc00 @ 00000000 (usable)
&lt;4&gt;e820: 00000400 @ 0009fc00 (reserved)
&lt;4&gt;e820: 00010000 @ 000f0000 (reserved)
&lt;4&gt;e820: 00010000 @ ffff0000 (reserved)
&lt;4&gt;e820: 07ef0000 @ 00100000 (usable)
&lt;4&gt;e820: 0000d000 @ 07ff3000 (ACPI data)
&lt;4&gt;e820: 00003000 @ 07ff0000 (ACPI NVS)

Which seems to disagree with ACPI about where the data starts

Maybe I'm shooting fish as I have very little experience with ACPI but any help
sugestions (besides burn my motherboard as I've already thought of that) .
 


 On Fri,24 Mar 2000, you wrote: &gt; &gt;-- awaldram &lt;awaldram@samuri.demon.co.uk&gt; wrote:
&gt; 
&gt; &gt; If you look at DSDT and FACP it looks like they are
&gt; &gt; garbage not what I would
&gt; &gt; have expected at all
&gt; &gt; 
&gt; &gt; Do you tjhink this is related to my hybrid chipset
&gt; &gt; (586 Northbridge 686a
&gt; &gt; Southbridge) can the program not find my acpi bios.
&gt; 
&gt; Right, your DSDT and FACP look like they are in the
&gt; wrong format.  The table header do not comply to
&gt; the ACPI 1.0 spec at least.  This could very
&gt; well be an error on VIA's part.
&gt; 
&gt; You might want to try adding "acpi=chipset" to
&gt; your kernel command line and then at least you
&gt; could get processor power states (C-states) from
&gt; the ACPI driver.
&gt; 
&gt; -Andy
&gt; 
&gt; 
&gt; __________________________________________________
&gt; Do You Yahoo!?
&gt; Talk to your friends online with Yahoo! Messenger.
&gt; http://im.yahoo.com

</body></email><email><emailId>20000321193858</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-03-21 19:38:58-0400</timestampReceived><subject>Re: [Acpi] VIA support in ACPI</subject><body>

--- "Waldram, Andrew" &lt;Andrew.Waldram@siemens.co.uk&gt;
wrote:
&gt; This is my first attempt to get ACPI functioning but
&gt; due to the lack of documentation I am totally stuck
&gt; please help

Yes, documentation is somewhat lacking.  There
is some in the kernel source tree
linux/Documentation/pm.txt but it's pretty
minimal at this point.

I've been fairly busy addressing various platform
issues before the door on 2.3 slams shut (and
perhaps it already has).  Anyway, if anyone who
has gone through the process of getting ACPI
working on their system would like to write a
FAQ or something, everyone in the Linux community
would love to have it.

&gt; I get
&gt; 
&gt; ACPID starting
&gt; unable to find ACPI namespace

So, did it say "cannot load ACPI namespace" ?
If so, forward me your DSDT

  cat /proc/sys/acpi/dsdt | mail
andy_henroid@yahoo.com

and I can determine why the namespace load is failing.

&gt; Do I need to add tables somewhere

If, however, you have an empty /proc/sys/acpi/dsdt
that
probably means that your system/motherboard vendor
chose not to support ACPI even though your chipset
supports some ACPI features (notably processor
power states)

-Andy


__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000316232957</emailId><senderName>Tony Hoyle</senderName><senderEmail>tmh@magenta-logic.com</senderEmail><timestampReceived>2000-03-16 23:29:57-0400</timestampReceived><subject>[Acpi] acpid failure on 2.3.99-pre1 on BP6</subject><body>


Oops.. forgot to attach the dump....   Lets try again...

With the latest kernel and latest acpi I note that the BP6 isn't
supported.
What info is required to help support this board?

I am using the latest BIOS (QQ-2), and Win2k shows full support for
ACPI, Fans, Poweroff etc.

acpid -d gives the following output:

acpid: started
acpid: FACP loaded from /proc/sys/acpi/
acpid: DSDT loaded from /proc/sys/acpi/
acpid: S0 not supported
acpid: S1 not supported
acpid: S2 not supported
acpid: S3 not supported
acpid: S4 not supported
acpid: S5 not supported
acpid: no processor block

Output from acpidmp DSDT | acpidisasm attached.  This clearly shows
support for S1,S2 and S5, and two processor blocks (if I read the dump
right, anyway).
The previous version of acpid correctly identified S0 and S1 but not S5,
so something has changed which has made it worse...

Tony

(Can't subscribe to the list until Monday, unfortunately as I'm at
home...)
["dsdt.txt.gz" (application/x-gzip)]

</body></email><email><emailId>20000316235340</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-03-16 23:53:40-0400</timestampReceived><subject>Re: [Acpi] acpid failure on 2.3.99-pre1 on BP6</subject><body>

--- Tony Hoyle &lt;tmh@magenta-logic.com&gt; wrote:

&gt; Output from acpidmp DSDT | acpidisasm attached. 
&gt; This clearly shows support for S1,S2 and S5, and
&gt; two processor blocks

Yes, it looks like you should have S1, S2, and S5.
Can you send me the raw DSDT (just the output of
"acpidmp DSDT")?

Thanks,
Andy


__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000316235653</emailId><senderName>"Crispin Flowerday"</senderName><senderEmail>cehf2@cam.ac.uk</senderEmail><timestampReceived>2000-03-16 23:56:53-0400</timestampReceived><subject>Re: [Acpi] acpid failure on 2.3.99-pre1 on BP6</subject><body>

with my BH6, I get much the same output from

$ acpidmp DSDT | acpidisasm

in terms of S1-5 however apicd shows (at least under 2.3.40 I can't get
later to work properly with my system) S1, S2 work, however S4 and S5 do
not.

We have looked at this in the past and it seems like ABIT bioses are not
quite correct in their acpi implementation, although why windows works fine
is still a mystery.


--
Crispin

*Windows leads to anger. Anger leads to hate. Hate leads to Linux*

----- Original Message -----
From: "Tony Hoyle" &lt;tmh@magenta-logic.com&gt;
To: &lt;acpi@phobos.fachschaften.tu-muenchen.de&gt;
Sent: Thursday, March 16, 2000 11:29 PM
Subject: [Acpi] acpid failure on 2.3.99-pre1 on BP6


&gt; Oops.. forgot to attach the dump....   Lets try again...
&gt;
&gt; With the latest kernel and latest acpi I note that the BP6 isn't
&gt; supported.
&gt; What info is required to help support this board?
&gt;
&gt; I am using the latest BIOS (QQ-2), and Win2k shows full support for
&gt; ACPI, Fans, Poweroff etc.
&gt;
&gt; acpid -d gives the following output:
&gt;
&gt; acpid: started
&gt; acpid: FACP loaded from /proc/sys/acpi/
&gt; acpid: DSDT loaded from /proc/sys/acpi/
&gt; acpid: S0 not supported
&gt; acpid: S1 not supported
&gt; acpid: S2 not supported
&gt; acpid: S3 not supported
&gt; acpid: S4 not supported
&gt; acpid: S5 not supported
&gt; acpid: no processor block
&gt;
&gt; Output from acpidmp DSDT | acpidisasm attached.  This clearly shows
&gt; support for S1,S2 and S5, and two processor blocks (if I read the dump
&gt; right, anyway).
&gt; The previous version of acpid correctly identified S0 and S1 but not S5,
&gt; so something has changed which has made it worse...
&gt;
&gt; Tony
&gt;
&gt; (Can't subscribe to the list until Monday, unfortunately as I'm at
&gt; home...)

</body></email><email><emailId>20000316214050</emailId><senderName>Sven Kirmess</senderName><senderEmail>sven.kirmess@gmx.net</senderEmail><timestampReceived>2000-03-16 21:40:50-0400</timestampReceived><subject>Re: [Acpi] acpid fix</subject><body>

 Monday, March 13, 2000, 8:07:12 AM, Andy wrote:

&gt; Just a reminder that as of the next development kernel release
&gt; (2.3.52), you will need to upgrade to the latest version of acpid.

afaik there will be no 2.3.52. So, what's the acpid for? :-)

&gt; People running 2.3.51 and earlier kernels should stick with the old
&gt; version of acpid.

What about 2.4? Does acpi have chance getting in? Have you heard
anything from Linus?


 Sven

-- 
PGP-Key-ID: 0x881BF222

</body></email><email><emailId>20000306174521</emailId><senderName>"Therien, Guy"</senderName><senderEmail>guy.therien@intel.com</senderEmail><timestampReceived>2000-03-06 17:45:21-0400</timestampReceived><subject>RE: [Acpi] controlling fans</subject><body>

As Andy say, ACPI specifies a thermal model but the policy is very rigid.
The platform is placed in either an "active" or "passive" cooling mode by
the OS-directed power management (OSPM) software that manipulates the APCI
interfaces - this is accomplished by using the _SCP control method. When in
active mode, OSPM must turn on and off active cooling devices (fans) as
indicated by notifications by the platform. In passive cooling mode, OSPM
will apply the thermal equation to reduce processor performance in lieu of
turning on fans to cool the system. If the system continues to get hot, both
active and passive means will be used to cool the system - based on
temperature pasing active and passive trip points.
Guy

-----Original Message-----
From: Illuminatus Primus [mailto:vermont@gate.net]
Sent: Sunday, March 05, 2000 7:04 PM
To: acpi@phobos.fachschaften.tu-muenchen.de
Subject: [Acpi] controlling fans


Hi - I saw the ACPI presentation at the Atlanta Linux Showcase '99 and
was very impressed.

I would like to control the fans in my desktop machine, which has an
ABIT 440BH motherboard. Apparently, this motherboard is ACPI friendly.
Is controlling the fans possible through ACPI, or should it be done
through some other mechanism?

If I remember correctly, controlling the fans on a laptop was one of
the abilities of ACPI. I hope this is also true of desktops.

Thanks,
Vermont


_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000305211631</emailId><senderName>Sean Furey</senderName><senderEmail>local.linux.acpi@furey.freeserve.co.uk</senderEmail><timestampReceived>2000-03-05 21:16:31-0400</timestampReceived><subject>Re: [Acpi] ACPI patch for kernel 2.2.14?</subject><body>

Hi Gord!

&gt; Does such a patch exist?  Or is there a CVS branch I can grab from somewhere
&gt; that contains the ACPI kernel code?  All I can seem to find everywhere are
&gt; the ACPI tools.

I have made I patch against 2.2.14.  If nobody here has any major objections I
would be happy to post it here.

I had suggested making a patch available before, but was told that that this
would be unadvisable as ACPI is very much under development.  Thats fair
enough, I suppose, the developers know best.  I suspect, however, that there
are a lot of simpletons like me who aren't worried about the advanced
functionality that isn't there yet, and just want powerdown support.

For this type of user a patch would be useful.  In my experience it has caused
no adverse effects, and has done exactly as I wanted - to power off.  A patch
could be made available that does this - with a strong disclaimer that it may
not work at all, and that people use it at their peril.

I'm happy to post my pre-prepared patch (based on the 2.2.9 patch) as long as
somebody gives the go-ahead.

-- 
Sean Furey
sean@furey.freeserve.co.uk

</body></email><email><emailId>20000305232450</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-03-05 23:24:50-0400</timestampReceived><subject>Re: [Acpi] ACPI patch for kernel 2.2.14?</subject><body>

--- Sean Furey
&lt;local.linux.acpi@furey.freeserve.co.uk&gt; wrote:

&gt; I have made I patch against 2.2.14.  If nobody here
&gt; has any major objections I would be happy to post
&gt; it here.

Yeah, right on, post your patch.  It would be most
useful if it is a backport of the current 2.3 ACPI
driver to 2.2 but it could be useful even if not.

&gt; I had suggested making a patch available before, but
&gt; was told that that this would be unadvisable as ACPI
&gt; is very much under development.

Personally, I'm happy to see contribution in this
area.  The functionality that is there now in the
2.3 kernel (C-states, S5, and ACPI events) is
probably the same as what will end up in 2.4, so
there is really no good reason to wait if you want
to backport to 2.2.

Thermal and battery can be done up in userspace
by acpid for now.  Suspend probably won't come
along until 2.5.

Thanks,
Andy

__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000306201914</emailId><senderName>Gordon Peters</senderName><senderEmail>gordpeters@smarttech.com</senderEmail><timestampReceived>2000-03-06 20:19:14-0400</timestampReceived><subject>RE: [Acpi] ACPI patch for kernel 2.2.14?</subject><body>

Comments below.

&gt; -----Original Message-----
&gt; From:	Andy Henroid [SMTP:andy_henroid@yahoo.com]
&gt; Sent:	Sunday, March 05, 2000 4:25 PM
&gt; To:	Sean Furey
&gt; Cc:	acpi@phobos.fachschaften.tu-muenchen.DE
&gt; Subject:	Re: [Acpi] ACPI patch for kernel 2.2.14?
&gt; 
&gt; --- Sean Furey
&gt; &lt;local.linux.acpi@furey.freeserve.co.uk&gt; wrote:
&gt; 
&gt; &gt; I have made I patch against 2.2.14.  If nobody here
&gt; &gt; has any major objections I would be happy to post
&gt; &gt; it here.
&gt; 
&gt; Yeah, right on, post your patch.  It would be most
&gt; useful if it is a backport of the current 2.3 ACPI
&gt; driver to 2.2 but it could be useful even if not.
&gt; 
[GP]  Yes, I was looking into backporting it myself, but the version of ACPI
in the latest 2.3 kernel seems to have a lot of dependencies on
features/changes in the 2.3 series (which makes it quite a daunting task to
backport it).  I tried just straight out copying the needed files to the
2.2.14 kernel, but found that it was very quickly turning into a 2.3.48
kernel (the version I was backporting from) because of all the dependencies.
I was hoping to avoid that.

Specifically, I'm looking for a version of the ACPI driver that will allow
for slowing down or stopping the CPU (with the computer still running), so I
don't think Sean's version would have what I need if it only supports power
down.  Does the version of ACPI in the 2.3 kernel series support CPU power
state control?

Thanks.
	Gord

</body></email><email><emailId>20000306205135</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-03-06 20:51:35-0400</timestampReceived><subject>RE: [Acpi] ACPI patch for kernel 2.2.14?</subject><body>

--- Gordon Peters &lt;GordPeters@smarttech.com&gt; wrote:

&gt; Specifically, I'm looking for a version of the ACPI
&gt; driver that will allow for slowing down or stopping
&gt; the CPU (with the computer still running)

&gt; Does the version of ACPI in the 2.3 kernel series
&gt; support CPU power state control?

Yes, processor power state (C-state) control and
policy are in the current 2.3 ACPI driver.  Take
a look at the "acpi_idle" function in
linux/arch/i386/kernel/acpi.c

Just a clarification, C-states are used when the
system is idle and actually stop processor
execution.  If you want to just slow the processor
(to control thermal output) that's called "processor
throttling" and that is not yet supported by the
ACPI driver.

-Andy


__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000316234130</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-03-16 23:41:30-0400</timestampReceived><subject>Re: [Acpi] acpid fix</subject><body>

--- Sven Kirmess &lt;sven.kirmess@gmx.net&gt; wrote:

&gt; afaik there will be no 2.3.52. So, what's the acpid
&gt; for? :-)

Well, I didn't think Linus was going to go from
2.3.52-pre2 to 2.3.99-pre1.  Maybe it's me that
can't count?  :)

&gt; What about 2.4? Does acpi have chance getting in?
&gt; Have you heard anything from Linus?

Yes, the ACPI support that's in 2.3 now will be
in 2.4.  Hopefully, before 2.4 is done we'll also
have some platform errata fixes and more work
finished in acpid up in userspace.

-Andy



__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000317000322</emailId><senderName>Tony Hoyle</senderName><senderEmail>tmh@magenta-logic.com</senderEmail><timestampReceived>2000-03-17 00:03:22-0400</timestampReceived><subject>Re: [Acpi] acpid failure on 2.3.99-pre1 on BP6</subject><body>


Andy Henroid wrote:
&gt; 
&gt; --- Tony Hoyle &lt;tmh@magenta-logic.com&gt; wrote:
&gt; 
&gt; &gt; Output from acpidmp DSDT | acpidisasm attached.
&gt; &gt; This clearly shows support for S1,S2 and S5, and
&gt; &gt; two processor blocks
&gt; 
&gt; Yes, it looks like you should have S1, S2, and S5.
&gt; Can you send me the raw DSDT (just the output of
&gt; "acpidmp DSDT")?
&gt; 
OK here it is...

Tony

(Got my email working at home, 5 minutes after saying I couldn't... Oh
well...)
["dsdt.out.gz" (application/x-gzip)]

</body></email><email><emailId>20000317221737</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-03-17 22:17:37-0400</timestampReceived><subject>[Acpi] acpid update</subject><body>

A new version of acpid is now available from

 
http://www.geocities.com/SiliconValley/Hardware/3165/

Changes
* Added framework for interfacing between userspace
  clients and acpid
* Cleaned up the build process

These changes will have little user visible effect.
I am still in the process of tracking down a parsing
regression on BH6's (S5 was working before but
now is marked as unsupported).  Also, working
towards thermal and battery support.

Thanks,
Andy



__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000320161900</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-03-20 16:19:00-0400</timestampReceived><subject>[Acpi] Policy management</subject><body>

Hi,

I've placed a snapshot of the policy management daemon I'm working on on
the download page. For now it's only framework, but the general idea
should be clear.

Awaiting comments,
   Simon

PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

</body></email><email><emailId>20000322095512</emailId><senderName>"Waldram, Andrew"</senderName><senderEmail>andrew.waldram@siemens.co.uk</senderEmail><timestampReceived>2000-03-22 09:55:12-0400</timestampReceived><subject>RE: [Acpi] VIA support in ACPI</subject><body>

here is the output you requested from DSDT

0x07ff30c0

thanks for your help

-----Original Message-----
From: Andy Henroid [mailto:andy_henroid@YAHOO.COM]
Sent: 21 March 2000 19:39
To: Waldram, Andrew
Cc: acpi@phobos.fachschaften.tu-muenchen.de
Subject: Re: [Acpi] VIA support in ACPI


--- "Waldram, Andrew" &lt;Andrew.Waldram@siemens.co.uk&gt;
wrote:
&gt; This is my first attempt to get ACPI functioning but
&gt; due to the lack of documentation I am totally stuck
&gt; please help

Yes, documentation is somewhat lacking.  There
is some in the kernel source tree
linux/Documentation/pm.txt but it's pretty
minimal at this point.

I've been fairly busy addressing various platform
issues before the door on 2.3 slams shut (and
perhaps it already has).  Anyway, if anyone who
has gone through the process of getting ACPI
working on their system would like to write a
FAQ or something, everyone in the Linux community
would love to have it.

&gt; I get
&gt; 
&gt; ACPID starting
&gt; unable to find ACPI namespace

So, did it say "cannot load ACPI namespace" ?
If so, forward me your DSDT

  cat /proc/sys/acpi/dsdt | mail
andy_henroid@yahoo.com

and I can determine why the namespace load is failing.

&gt; Do I need to add tables somewhere

If, however, you have an empty /proc/sys/acpi/dsdt
that
probably means that your system/motherboard vendor
chose not to support ACPI even though your chipset
supports some ACPI features (notably processor
power states)

-Andy


__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com


_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000323202353</emailId><senderName>"Dvir Oren"</senderName><senderEmail>dviro@lucidvon.com</senderEmail><timestampReceived>2000-03-23 20:23:53-0400</timestampReceived><subject>[Acpi] (Fwd) Re: acpid</subject><body>

------- Forwarded message follows -------
From:           	Dvir Oren &lt;dviro@lucidvon.com&gt;
To:             	Andy Henroid &lt;andy_henroid@yahoo.com&gt;
Subject:        	Re: acpid
Copies to:      	dviro@lucidvon.com
Date sent:      	Thu, 23 Mar 2000 22:13:51 +0200

&gt; No, this doesn't sound like a rookie question to
&gt; me.  It might very well be a bug in acpid.  It
&gt; appears that acpid is having trouble parsing your
&gt; DSDT (one of the ACPI tables).

I now compiled a 2.3.99pre2 kernel, and acpid loaded.  
/proc/sys/acpi/dsdt still seems to output junk.  However, soon after 
I load acpid, I get hda - lost interrupt, which will soon after lock up
the system entirely (ctrl-alt-del doesn't work, and the power off
button doesn't work).  The acpid does get notified of pressing the
power button, and I did once see it writing INIT:  switching to
runlevel 0, however it stopped there, and didn't do anything else.

All I really need is for the system to shutdown correctly when I 
press the power button.  Is there a way to disable everything else 
(like that hard disk thing)?

Someone posted a patch for 2.2.14.  Is there an acpid that would 
work with that?  Do you keep olrder acpid?

I would appreciate your help!

------- End of forwarded message -------
---------
Dvir Oren &lt;dviro@lucidvon.com&gt;
Lucid VON Ltd.     &lt;http://www.lucidvon.com&gt;
9 Saloniki St.,        Tel-Aviv       Israel
Tel:  +972 3 644 3038  Fax:  +972 3 644 3039

</body></email><email><emailId>20000324003726</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-03-24 00:37:26-0400</timestampReceived><subject>[Acpi] Re: acpid</subject><body>

--- Dvir Oren &lt;dviro@lucidvon.com&gt; wrote:
&gt; 
&gt; It is definitely ACPI related.  It only happends
&gt; after I run acpid, and 
&gt; it happens soon or right after I run acpid.

Can you give this patch a try when you get a moment?
It is against 2.3.99-pre3-8 but should apply cleanly
against any recent kernel.

Build and add

  acpi=no-c2,no-c3

to your kernel command line.

Let me know if that works.

Thanks,
Andy



__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com
["acpi_patch-2.3.99-3-8" (text/plain)]

diff -u --recursive --new-file --exclude-from=.mkpatch.exclude \
                v2.3.99-pre3-8/linux/arch/i386/kernel/acpi.c \
                linux/arch/i386/kernel/acpi.c
--- v2.3.99-pre3-8/linux/arch/i386/kernel/acpi.c	Thu Mar 16 22:28:40 2000
+++ linux/arch/i386/kernel/acpi.c	Thu Mar 23 16:28:20 2000
@@ -111,6 +111,14 @@
 
 static int acpi_enabled = ACPI_ENABLED;
 
+enum
+{
+	ACPI_C2_DISABLED,
+	ACPI_C3_DISABLED,
+};
+
+static unsigned long acpi_disabled_features = 0;
+
 // bits 8-15 are SLP_TYPa, bits 0-7 are SLP_TYPb
 static unsigned long acpi_slp_typ[] = 
 {
@@ -1502,12 +1510,14 @@
 	 * control in the /proc interfaces.
 	 */
 	if (facp-&gt;p_lvl2_lat
-	    &amp;&amp; facp-&gt;p_lvl2_lat &lt;= ACPI_MAX_P_LVL2_LAT) {
+	    &amp;&amp; facp-&gt;p_lvl2_lat &lt;= ACPI_MAX_P_LVL2_LAT
+	    &amp;&amp; !(acpi_disabled_features &amp; ACPI_C2_DISABLED)) {
 		acpi_p_lvl2_lat = ACPI_uS_TO_TMR_TICKS(facp-&gt;p_lvl2_lat);
 		acpi_enter_lvl2_lat = ACPI_uS_TO_TMR_TICKS(ACPI_TMR_HZ / 1000);
 	}
 	if (facp-&gt;p_lvl3_lat
-	    &amp;&amp; facp-&gt;p_lvl3_lat &lt;= ACPI_MAX_P_LVL3_LAT) {
+	    &amp;&amp; facp-&gt;p_lvl3_lat &lt;= ACPI_MAX_P_LVL3_LAT
+	    &amp;&amp; !(acpi_disabled_features &amp; ACPI_C3_DISABLED)) {
 		acpi_p_lvl3_lat = ACPI_uS_TO_TMR_TICKS(facp-&gt;p_lvl3_lat);
 		acpi_enter_lvl3_lat
 			= ACPI_uS_TO_TMR_TICKS(facp-&gt;p_lvl3_lat * 5);
@@ -1595,6 +1605,10 @@
 			acpi_enabled = ACPI_CHIPSET_ONLY;
 		else if (strncmp(str, "off", 3) == 0)
 			acpi_enabled = ACPI_DISABLED;
+		else if (strncmp(str, "no-c2", 5) == 0)
+			acpi_disabled_features |= ACPI_C2_DISABLED;
+		else if (strncmp(str, "no-c3", 5) == 0)
+			acpi_disabled_features |= ACPI_C3_DISABLED;
 		str = strpbrk(str, ",");
 		if (str)
 			str += strspn(str, ",");



</body></email><email><emailId>20000324070115</emailId><senderName>awaldram</senderName><senderEmail>awaldram@samuri.demon.co.uk</senderEmail><timestampReceived>2000-03-24 07:01:15-0400</timestampReceived><subject>[Acpi] VIA vp3 with 686a Southbridge</subject><body>


Hi

By updating the kernel to 2.3.99-pre2 I've cleared the 'unable to load namespace
problem' thanks Thomas.
But things go from bad to worse

acpid: started
acpid: FACP loaded from /proc/sys/acpi/
acpis: DSDT loaded from /proc/sys/acpi/
acpid: S0 not supported
acpid: S1 not supported
acpid: S2 not supported
acpid: S3 not supported
acpid: S4 not supported
acpid: S5 not supported
acpid: no processor block

Which on first look appears to sugest the acpi program works and I have no ACPI
except in both win98se2 and NT2000 ACPI functions and at the very least S5
should function.

If you look at DSDT and FACP it looks like they are garbage not what I would
have expected at all

Do you tjhink this is related to my hybrid chipset (586 Northbridge 686a
Southbridge) can the program not find my acpi bios.

 
["dsdt" (application/octet-stream)]
["facp" (application/octet-stream)]

</body></email><email><emailId>20000328003425</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-03-28 00:34:25-0400</timestampReceived><subject>[Acpi] [PATCH] ACPI</subject><body>


This patch is against 2.3.99-pre3

Changes
* Added new kernel/module command line options to
  address ACPI errata for various platforms.
  (In the future, problematic platforms will be
  identified by the ACPI driver and these
  options set automatically.)
* Added support for module command line parsing

-Andy



 

__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com
["acpi_patch-2.3.99-3.gz" (application/x-gzip-compressed)]

</body></email><email><emailId>20000328004725</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-03-28 00:47:25-0400</timestampReceived><subject>[Acpi] Re: VIA vp3 with 686a Southbridge</subject><body>

--- awaldram &lt;awaldram@samuri.demon.co.uk&gt; wrote:

&gt; I don't know if this will help but as the kernell
&gt; starts acpi I get the message
&gt; 
&gt; &lt;6&gt;ACPI: "VIAVP3" found at 0x000f7170
&gt; &lt;3&gt;ACPI: unreserved table memory @ 0x07ff30c0!

Apply the patch I just sent out (or wait for the
next 2.3.99-pre release) and add

  acpi=trust-tables,copy-tables

to your kernel command line.  (Remove any other
ACPI command line options you are currently
using.)

This should at least get you past your "unreserved
table memory" problem.

&gt; Also during CPU setup I get
&gt; 
&gt; &lt;4&gt;e820: 0009fc00 @ 00000000 (usable)
&gt; &lt;4&gt;e820: 00000400 @ 0009fc00 (reserved)
&gt; &lt;4&gt;e820: 00010000 @ 000f0000 (reserved)
&gt; &lt;4&gt;e820: 00010000 @ ffff0000 (reserved)
&gt; &lt;4&gt;e820: 07ef0000 @ 00100000 (usable)
&gt; &lt;4&gt;e820: 0000d000 @ 07ff3000 (ACPI data)
&gt; &lt;4&gt;e820: 00003000 @ 07ff0000 (ACPI NVS)
&gt; 
&gt; Which seems to disagree with ACPI about where the
&gt; data starts

The first message

  ACPI: "VIAVP3" found at 0x000f7170

is for your RSDP and will be in low memory
probably marked as "(reserved)".  The second
message

  ACPI: unreserved table memory @ 0x07ff30c0!

is the ACPI driver searching for your RSDT and
that appears to fall in an "(ACPI data)" area
which is good.

&gt; Maybe I'm shooting fish as I have very little
&gt; experience with ACPI but any help
&gt; sugestions (besides burn my motherboard as I've
&gt; already thought of that) .

Well, give the above fix a try and let me know.
If that works for you, I can add an entry for
your system to the errata list and you will
not have to use kernel command line options
after that.

-Andy


__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000328093451</emailId><senderName>Dvir Oren</senderName><senderEmail>dviro@lucidvon.com</senderEmail><timestampReceived>2000-03-28 09:34:51-0400</timestampReceived><subject>[Acpi] Power Down</subject><body>

I got to the point where acpid will recognize that I'm  pressing the
power button, switch to run-level 0, and run shutdown.

What doesn't yet work is for the machine to turn the power off.  Any
ideas?

How can I check if acpi can power off my computer without rebooting
every time?

Is it possible to create a proc device that you could write "1" to and
it will power off the machine?

I'm using 2.3.99pre2, with the latest acpid that I know of.


-- 
Dvir Oren               &lt;dviro@lucidvon.com&gt;
Lucid VON Ltd.     &lt;http://www.lucidvon.com&gt;
9 Saloniki St.,        Tel-Aviv       Israel
Tel:  +972 3 644 3038  Fax:  +972 3 644 3039

</body></email><email><emailId>20000328093744</emailId><senderName>Dvir Oren</senderName><senderEmail>dviro@lucidvon.com</senderEmail><timestampReceived>2000-03-28 09:37:44-0400</timestampReceived><subject>[Acpi] 2.2.14 patch</subject><body>

I tried the 2.2.14 patch, and it didn't quite work.  I would appreciate
any help about what exactly the patch can and can't do.

All I need, really, is for the machine to shutdown, then poweroff, after
I press the power button.  Is that possible with the patch?

Why doesn't it work?  Do I need acpid for it?

A kernel with the pach doesn't power off after I run shutdown, and
doesn't recognize my power button at all.  acpid will refuse to work
(that's probably because I'm using a newer version of acpid).

-- 
Dvir Oren               &lt;dviro@lucidvon.com&gt;
Lucid VON Ltd.     &lt;http://www.lucidvon.com&gt;
9 Saloniki St.,        Tel-Aviv       Israel
Tel:  +972 3 644 3038  Fax:  +972 3 644 3039

</body></email><email><emailId>20000328133445</emailId><senderName>Dvir Oren</senderName><senderEmail>dviro@lucidvon.com</senderEmail><timestampReceived>2000-03-28 13:34:45-0400</timestampReceived><subject>[Acpi] VIAVP4 - No S-State is supported?</subject><body>

I just realized that when loading acpid, I see that no sleep state is
supported on a VIAVP4 bios.

Why??

-- 
Dvir Oren               &lt;dviro@lucidvon.com&gt;
Lucid VON Ltd.     &lt;http://www.lucidvon.com&gt;
9 Saloniki St.,        Tel-Aviv       Israel
Tel:  +972 3 644 3038  Fax:  +972 3 644 3039

</body></email><email><emailId>20000328151951</emailId><senderName>Kurt Roeckx</senderName><senderEmail>q@ping.be</senderEmail><timestampReceived>2000-03-28 15:19:51-0400</timestampReceived><subject>Re: [Acpi] compile problems</subject><body>

On Mon, Mar 27, 2000 at 04:51:44PM -0800, Andy Henroid wrote:
&gt; 
&gt; Hmmm..  What Linux distribution are you using
&gt; (Debian, RedHat, SUSE, Mandrake, etc..)?
&gt; 
&gt; The file /usr/include/sys/io.h probably should
&gt; be there.

The problem is that I use libc5, which doesn't have an &lt;sys/io.h&gt;. Someone
suggested that I use &lt;asm/io.h&gt; instead (which is bad), and that's
working.

After that I got an other problem with MAP_FAILED being undefined, the
manpage says it should be defined to -1, which should ofcourse be:
(void *) -1. I got no idea why it's not defined.


Kurt

</body></email><email><emailId>20000330103943</emailId><senderName>Dvir Oren</senderName><senderEmail>dviro@lucidvon.com</senderEmail><timestampReceived>2000-03-30 10:39:43-0400</timestampReceived><subject>Re: [Acpi] ACPI+APM</subject><body>

Waldram, Andrew wrote:
&gt; If the protection fault occurs just after run level 0 is 
&gt; reached it is
&gt; probably your BIOS not liking protected mode apm calls
&gt; 
&gt; Try enabling real mode call in the kernel (under APM)

I will try this.  I don't understand though, why APM would work if I
didn't include ACPI in the kernel.

-- 
Dvir Oren               &lt;dviro@lucidvon.com&gt;
Lucid VON Ltd.     &lt;http://www.lucidvon.com&gt;
9 Saloniki St.,        Tel-Aviv       Israel
Tel:  +972 3 644 3038  Fax:  +972 3 644 3039

</body></email><email><emailId>20000204161531</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-02-04 16:15:31-0400</timestampReceived><subject>Re: [Acpi] ACPI woes</subject><body>

--- Francois Menard List Account &lt;fm-listproc@fmmo.ca&gt;
wrote:
&gt; 
&gt; 
&gt; How can I do same than apm -s with ACPI ?

"-s" run a command just before suspending the
system, right?  Suspend (aka S1-S4) is only
partially implemented at this point and will
only work on a limited set of ACPI systems.
And suspend is currently user-initiated (echo 1 &gt;
/proc/sys/acpi/sleep) not system/BIOS initiated
so, if you have a working S1, just run whatever
command before doing the "echo"

&gt; How do I make ACPI free the IRQ that it wants to use

The only way to keep ACPI from grabbing its IRQ
is to turn it off (add "acpi=off" to the kernel
command line or disable ACPI before building the
kernel)  ACPI is friendly about how it grabs the
IRQ and allows it to be shared with other devices
(it's not uncommon to see the ACPI IRQ shared
with other motherboard devices) but you may
see performance problems if ACPI shares with a
device that generates a lot of interrupts.

-Andy

__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000204183137</emailId><senderName>"Mark D. Studebaker"</senderName><senderEmail>mds@eng.paradyne.com</senderEmail><timestampReceived>2000-02-04 18:31:37-0400</timestampReceived><subject>Re: [Acpi] check_region in acpi.c (fwd)</subject><body>


Andy Henroid wrote:
&gt; 
&gt; I'll add the check_regions in the next patch.
&gt; OK, so this will help with debugging but, of course,
&gt; you can't share or grab the ACPI I/O ports.
&gt; 

Right. It's more for bulletproofing than anything else.

For some chips, the ACPI and the SMBus are pretty well separated
and for others we aren't so sure - and it will help
our support to users if there's one more possibility we
can eliminate. Especially since you get port locations
from the BIOS.

thanks for adding the check.
mds

</body></email><email><emailId>20000208180637</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-02-08 18:06:37-0400</timestampReceived><subject>[Acpi] [PATCH] ACPI docs</subject><body>


This patch is against 2.3.43-pre2.

Changes
* Documentation updates for new PM interface


__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com
["acpi_doc-2.3.43-2.gz" (application/x-gzip-compressed)]

</body></email><email><emailId>20000208182014</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-02-08 18:20:14-0400</timestampReceived><subject>[Acpi] [PATCH] ACPI / APM / PM</subject><body>


This patch is against 2.3.43-pre2

Changes
* Moved remaining drivers to new power management
  interface
* Removed remains of old APM driver interface
* Updated VIA chipset support
* Check I/O ports availability before claiming

I apologize for the size and scope of this patch.
There didn't seem to be a less painful way to
complete the transition to the new power management
interface.  If there are patch conflicts, I can
redo the changes that break.

Thanks,
Andy


__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com
["acpi_patch-2.3.43-2.gz" (application/x-gzip-compressed)]

</body></email><email><emailId>20000209211035</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-02-09 21:10:35-0400</timestampReceived><subject>Re: Resource configuration (was: Re: [Acpi] (no subject))</subject><body>

--- Roberto Jung Drebes &lt;drebes@inf.ufrgs.br&gt; wrote:
&gt; On Tue, 8 Feb 2000, Andy Henroid wrote:
&gt;&gt; 
&gt;&gt; Check out the acpitools at
&gt; 
&gt; I had already 'tried' that. But I can't figure out
&gt; how to use it. I can dump the table with acpidmp,
&gt; but I can't use the other utils. I'm not sure
&gt; how to use them, I tried piping them with acpidmp.

Examples:

  ./acpidmp FACP | od -t x1a
  ./acpidmp FACP | ./acpitbl
  ./acpidmp DSDT | ./acpidisasm

&gt; It would be nice to have a README or something.

I'll try to add one with the next acpitools release.

-Andy

__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000213223010</emailId><senderName>Sven Kirmess</senderName><senderEmail>sven.kirmess@gmx.net</senderEmail><timestampReceived>2000-02-13 22:30:10-0400</timestampReceived><subject>Re: Hot to create a patch? (was: [Acpi] (no subject))</subject><body>

 Friday, February 11, 2000, 9:49:59 PM, Sean wrote:

&gt; Also, I would be interested in making a patch against 2.2.14
&gt; available (even if it was the older one that I am using).

ACPI support is very incomplete. I think i doesn't make sense to make
it available for a production kernel.

&gt; Given that I have a 'pure' 2.2.14 kernel source in one directory and
&gt; a patched 'pure' source in another, what command can I use to make
&gt; this patch?

afaik:

diff -r linux-2.2.14 linux-2.2.14-patched


btw: (no subject) is a very, very uninformative subject.


 Sven

-- 
PGP-Key-ID: 0x881BF222

</body></email><email><emailId>20000217013954</emailId><senderName>Iustin Pop</senderName><senderEmail>iusty@geocities.com</senderEmail><timestampReceived>2000-02-17 01:39:54-0400</timestampReceived><subject>Re: [Acpi] Re: Questions regarding ACPI under Linux</subject><body>

Andy Henroid wrote:

&gt; &gt;
&gt; &gt; in linux/arch/i386/kernel/acpi.c,
&gt; &gt; acpi_enter_sx(acpi_sstate_t state):
&gt; &gt;       if state!=ACPI_S0, all devices are ordered
&gt; &gt;       to enter D3 sleep state.
&gt; &gt; Doesn't that mean that no device can wake up the
&gt; &gt; system (e.g. from S1)? Maybe enter D3 only for S3
&gt; &gt; (I recall that D3 is a must for S3/S4)?
&gt; 
&gt; Actually, wake-on support is not yet there so
&gt; it really doesn't matter if we just put all
&gt; devices into D3 for now.  Right, in the future
&gt; we need to be cognizant of what D-state a
&gt; device can be in and still wake the system
&gt; from a specified S-state.  It's even a
&gt; bit more complicated than that when we take
&gt; into account buses.  You end up with a matrix
&gt; of S-state to D-state mappings for each device
&gt; on your system.
	Well, except for the bus thing, I pretty much tought that a database is
needed of the devices and their D-states. I actually understood
something from that spec. Wow!

&gt; 
&gt; &gt; what drawbacks are there because the idle loop for
&gt; &gt; smp systems is not yet done?
&gt; 
&gt; Well, you don't get ACPI C2 and C3 processor
&gt; power states right now on multiprocessor
&gt; systems.  So you don't save as much power as
&gt; you potentially could.  I believe Linus
&gt; initially pulled out this support as he was
&gt; unsure what the implications to SMP are and
&gt; it seemed like the safe thing to do.  I
&gt; might add that back as experimental so that
&gt; people who really want it could enable and
&gt; try it out though.
	I think C1 is enough for most people (my Celerons cool down nicely when
idle).

&gt; &gt; For my board (abit bp6), the flags field in the facp
&gt; &gt; table is 0. This
&gt; &gt; would mean that the RTC can't wake up the system
&gt; &gt; from s4 (soft-off),
&gt; &gt; which it can, and because wbind=0 and flush_s*
&gt; &gt; fields are also 0, it
&gt; &gt; would mean that onyl S0 is valid, but win2k supports
&gt; &gt; sleep while in acpi
&gt; 
&gt; So what makes you think they are doing S2 or S3?
&gt; They could easily be doing S1 which doesn't
&gt; require a cache flush.  No?  It would be hard
&gt; to tell the difference between S1, S2, and S3
&gt; from a user's perspective (ie. without a power
&gt; meter)

	What I meant is that the entire flag field is 0, which means no support
for RTC to wake up the system from S4. But from S5 (soft-off), the RTC
starts my computer; at 3:05 am my local time (01:05 UTC), my computer
started by itself as directed from bios. So S4 is optional, but S5
(S2/S3, as stated by the specs, are mandatory) works? Couldn't find in
the specs info about RTC versus S5.
	Also, I understood that the RTC wakeup is programmed through standard
rtc stuff, e.g. /dev/rtc under linux. But ACPI has extended the alarm
definition of RTC by day,mon, century. The FACP table shows only these
new fields, the /proc/driver/rtc show the hh:mm:ss, but where can you
program the day/mo/cent?

&gt; &gt; wouldn't it be better to inform bios at boot about
&gt; &gt; which interrupt model
&gt; &gt; does linux use through the \_PIC method? Or linux
&gt; &gt; does this already? the
&gt; &gt; acpi specs says that on boot, the bios assumes
&gt; &gt; legacy (at-style
&gt; &gt; interrupt model, 0-15 irqs) mode. maybe the
&gt; &gt; activation of apic by linux
&gt; &gt; informs bios of this and \PIC isn't necessary, and
&gt; &gt; maybe not.
&gt; 
&gt; Right, I believe Linux can already do the correct
&gt; detection.  To use the ACPI \_PIC method at boot
&gt; time, we would need to have an AML interpreter
&gt; running in the kernel.  And that is another [near]
&gt; future hurdle for ACPI support on Linux.
	What I meant was not detection of the APIC, but (as I understood) by
\_PIC the operating systems informs the bios that it has switched to the
APIC mode of operation, as opossed to legacy. What I figure in my head
is this:
Current status:
	1. linux boots
	2. linux detects I/O APIC and switches the hardware part to it
Ideal status:
	+3. linux through acpi informs the ACPI compliant BIOS that it now uses
the APIC
What uses are there for \_PIC? Don't know, maybe ACPI 2.0 (to be
released today) will have some.

&gt; 
&gt; &gt; Sleep S4 by OS would mean complete memory dump onto
&gt; &gt; a file, and on boot
&gt; &gt; a complete memory restoration. Is the linux kernel
&gt; &gt; design up to do this?
&gt; &gt; The restoration part, of course on shutdown cat
&gt; &gt; /dev/kmem &gt;
&gt; &gt; /boot/memory.dump is easy.
&gt; 
&gt; Right, the memory dump and restore is fairly
&gt; trivial.  The bigger problem is getting device
&gt; drivers to save and restore context so that
&gt; when you come back from sleep, your devices
&gt; are still working.  That's what the new
&gt; device power-management interface I've been
&gt; working on (kernel/pm.c) should begin to
&gt; address.
&gt; 
&gt; Thanks for the questions.
&gt; 
&gt; -Andy

	Thanks for the replies
	Iustin

</body></email><email><emailId>20000218203254</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-02-18 20:32:54-0400</timestampReceived><subject>Re: [Acpi] ACPI suspend to disk</subject><body>

--- David Fries &lt;dfries@umr.edu&gt; wrote:
&gt;
&gt; What is the status of suspend to disk?  I have a
&gt; Toshiba laptop and it looks like ACPI is the only
&gt; way to get the laptop to suspend to disk.  At
&gt; least win98 is able to do it.  What is the status of
&gt; ACPI suspend to disk under Linux?

Actually, there is quite a bit of work to do
between now and seeing suspend to disk working,
including
1) finish and integrate the AML interpreter
2) driver support for suspend/wake
3) memory/CPU context to disk (not needed for S4BIOS)

So, yeah, "everything"..  You will probably see
most other ACPI features (battery, thermal,
device PM, etc.) working before suspend to disk
because they are smaller in scope and/or a building
block for suspend.

&gt; I wouldn expect the ACPI suspend to disk and standby
&gt; to leave the hardware in the same state after it
&gt; comes back up.  It seems to me the standby turns
&gt; off all power except to memory, and all the rest of
&gt; the devices would be off just like turning the
&gt; system off.

Right, devices are going to lose context when
the system goes into ACPI S2, S3, and S4/S4BIOS
(suspend to disk) states.  The power management
subsystem needs to make sure that every driver
saves device context before suspend/standby
and restores it on resume.  When you hit the
power/wake button, your system should spring
back to life in the same state as it suspended.

&gt; I haven't looked at the ACPI stuff in a while, is
&gt; the ACPI development tree quite a bit different
&gt; from what the ACPI is in the kernel?

No, the development kernel contains the current
ACPI support.  There is a fair amount of code
and development going on up in userspace right
now.  acpid contains really the bulk of the
ACPI implementation (ie. the AML interpreter)

-Andy

__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000223122410</emailId><senderName>Alexander Larsson</senderName><senderEmail>alex@cendio.se</senderEmail><timestampReceived>2000-02-23 12:24:10-0400</timestampReceived><subject>[Acpi] exporting pm_send()</subject><body>

Hi,

I've looked a bit at the generic power-manager interface in later 2.3
kernels. It looks quite nice, and we will probably use it for some 
embedded linux stuff we're working on.

This stuff will not be acpi or apm though, but rather a custom, more
limited power management driver. One thing it need to do though, is to
power off separate drivers. For this i would like to be able to call
pm_send(), which right now is static. Is there any possibility to export
this function?

/ Alex

</body></email><email><emailId>20000223173642</emailId><senderName>Alexander Larsson</senderName><senderEmail>alex@cendio.se</senderEmail><timestampReceived>2000-02-23 17:36:42-0400</timestampReceived><subject>[Acpi] Another pm comment</subject><body>

I have another comment about the pm.h interface:

After being waked from sleeping mode, or when pm_undoing a failed request
i like for all devices to return to their previous state, not D0. This
would require an "int last_state" in struct pm_dev. (Maybe there needs to
be an exported pm_undo_all() too...)

In this way my user space daemon can have full control of what devices are
enabled at all time, devices don't mysteriously change state under its 
feet. They only change state when told so, or goes to their min power 
state when sleeping (but return when waking up).

What do you think about this? How does it fit in the ACPI model? (I don't
know very much about ACPI.)

/ Alex

</body></email><email><emailId>20000224031239</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-02-24 03:12:39-0400</timestampReceived><subject>[Acpi] [PATCH] ACPI</subject><body>

This patch is against 2.3.48-1

Changes
* Avoid mapping ACPI tables on systems with a
  reported ioremap problem

Hopefully, this will avoid an ACPI crash that
is occurring on some problematic systems and
help identify systems with this problem.

-Andy



__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com
["acpi_patch-2.3.48-1" (text/plain)]

diff -u --recursive --new-file --exclude-from=.mkpatch.exclude \
                v2.3.48-1/linux/arch/i386/kernel/acpi.c linux/arch/i386/kernel/acpi.c
--- v2.3.48-1/linux/arch/i386/kernel/acpi.c	Wed Feb 23 18:37:04 2000
+++ linux/arch/i386/kernel/acpi.c	Wed Feb 23 18:50:34 2000
@@ -34,6 +34,7 @@
 #include &lt;linux/spinlock.h&gt;
 #include &lt;linux/ioport.h&gt;
 #include &lt;linux/slab.h&gt;
+#include &lt;linux/mm.h&gt;
 #include &lt;linux/pci.h&gt;
 #include &lt;asm/uaccess.h&gt;
 #include &lt;asm/io.h&gt;
@@ -379,13 +380,14 @@
 				ioremap((unsigned long) addr, table_size);
 		}
 
-		if (!table) {
-			/* ioremap is a pain, it returns NULL if the
-			 * table starts within mapped physical memory.
-			 * Hopefully, no table straddles a mapped/unmapped
-			 * physical memory boundary, ugh
+		if (!table &amp;&amp; addr &lt; virt_to_phys(high_memory)) {
+			/* sometimes we see ACPI tables in low memory
+			 * and not reserved by the memory map (E820) code,
+			 * who is at fault for this?  BIOS?
 			 */
-			table = (struct acpi_table*) phys_to_virt(addr);
+			printk(KERN_ERR
+			       "ACPI: unreserved table memory @ 0x%p!\n",
+			       (void*) addr);
 		}
 	}
 	return table;



</body></email><email><emailId>20000204001939</emailId><senderName>Simon Richter</senderName><senderEmail>geier@phobos.fs.tum.de</senderEmail><timestampReceived>2000-02-04 00:19:39-0400</timestampReceived><subject>[Acpi] check_region in acpi.c (fwd)</subject><body>

Hi,

I think this was meant for the list...

---------- Forwarded message ----------
Date: Fri, 04 Feb 2000 00:48:02 +0000
From: Mark D. Studebaker &lt;mds@paradyne.com&gt;
To: acpi-project@phobos.fachschaften.tu-muenchen.de
Cc: lm78@stimpy.netroedge.com
Subject: check_region in acpi.c

Hello again from lm_sensors.

In tracking down a bug in one of our lm_sensors drivers,
I noticed that you do not have check_region() calls before each
request_region() call in your acpi_claim_ioports() routine
in drivers/misc/acpi.c.

In the case where your driver was loaded after ours,
it would help us find potential conflicts between our drivers
and yours if you had check_region() calls as we do.

Would you please consider adding them?
thanks
mds

</body></email><email><emailId>20000206151410</emailId><senderName>Roberto Jung Drebes</senderName><senderEmail>drebes@inf.ufrgs.br</senderEmail><timestampReceived>2000-02-06 15:14:10-0400</timestampReceived><subject>Resource configuration (was: Re: [Acpi] (no subject))</subject><body>

On Sun, 6 Feb 2000, Yuki Ogawa wrote:

&gt; In case of resource conflicting, ACPI OS should be a resource arbitator.
&gt; 
&gt; get possible resources from _PRS,
&gt; and find free resources which can be used with the device, (This may be most dificcult point)
&gt; the set appropriate resource by _SRS method.
&gt; then make sure that resource setting is correctly done by _CRS.
&gt; 
&gt; 
&gt; I'm sorry but I don't know current kernel or user space utility supports
&gt; dynamic resource allocation.

Is there any utility which would allow me to view the tables in a formated
form? Something like the ACPIview.exe in MS HCT for ACPI. Also, supposing
I can set the resources with _CRS, should I then configure the device in a
traditional way (that is, via inb on configuration registers) or that
would be enough? I didn't really understand the workings of ACPI yet.

--
Roberto Jung Drebes &lt;drebes@inf.ufrgs.br&gt;
Porto Alegre, RS - Brasil
http://www.inf.ufrgs.br/~drebes/

</body></email><email><emailId>20000217004951</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-02-17 00:49:51-0400</timestampReceived><subject>[Acpi] Re: Questions regarding ACPI under Linux</subject><body>

--- Iustin Pop &lt;iusty@geocities.com&gt; wrote:
&gt; 	Hi!
&gt; 
&gt; I have a few question which popped up after reading
&gt; the acpi
&gt; implementation in linux and the acpi specs (1.0b).
&gt; Here they are, I hope
&gt; you can clarify some things for me:
&gt; 
&gt; in linux/arch/i386/kernel/acpi.c,
&gt; acpi_enter_sx(acpi_sstate_t state):
&gt; 	if state!=ACPI_S0, all devices are ordered
&gt;       to enter D3 sleep state.
&gt; Doesn't that mean that no device can wake up the
&gt; system (e.g. from S1)? Maybe enter D3 only for S3
&gt; (I recall that D3 is a must for S3/S4)?

Actually, wake-on support is not yet there so
it really doesn't matter if we just put all
devices into D3 for now.  Right, in the future
we need to be cognizant of what D-state a
device can be in and still wake the system
from a specified S-state.  It's even a
bit more complicated than that when we take
into account buses.  You end up with a matrix
of S-state to D-state mappings for each device
on your system.

&gt; what drawbacks are there because the idle loop for
&gt; smp systems is not yet done?

Well, you don't get ACPI C2 and C3 processor
power states right now on multiprocessor
systems.  So you don't save as much power as
you potentially could.  I believe Linus
initially pulled out this support as he was
unsure what the implications to SMP are and
it seemed like the safe thing to do.  I
might add that back as experimental so that
people who really want it could enable and
try it out though.

&gt; would a complete acpi implementation for the kernel
&gt; add a new option to
&gt; the kernel, because now we have in General
&gt; Options-&gt;"PCI Support: 1.
&gt; BIOS; 2. Direct; 3. Any", and 4 (not only for PCI)
&gt; ACPI DSDT Table, or
&gt; maybe isa card discovery by acpi, as oposed to pnp?
&gt; the ACPI 1.0b specs
&gt; state that a complete pci discovery _can_ be done by
&gt; acpi, but system
&gt; makers are not required to do so.

Actually, ACPI leaves enumeration and configuration
of devices on self-enumerable buses (eg. PCI) up to
the bus (or bus driver) itself.  So, no, ACPI
configuration will not be used for PCI devices.

ACPI can and will, however, be used for setting up
PCI interrupt routing and enumerating/configuring
devices on non-self-enumerating buses like ISA.

&gt; if FACP/int_model is 0 (=standard dual pic
&gt; implementation), this doesn't
&gt; conflict with the fact that my smp board has an
&gt; apic, and linux uses it
&gt; - which should read as int_model=1? should I again
&gt; suspect an incomplete
&gt; (or broken) bios implementation?

Yeah, I don't know on the specifics of this one.
Incomplete ACPI implementation sounds possible.

&gt; Do you know if Celerons support WBINDV? If the term
&gt; victim cache means
&gt; L2 cache, the support of WBINDV would mean the only
&gt; method of supporting
&gt; S2/S3 on these processors.

Don't know off the top of my head (though I
probably should).  The cache can also be flushed
manually with FLUSH_SIZE and FLUSH_STRIDE.

&gt; For my board (abit bp6), the flags field in the facp
&gt; table is 0. This
&gt; would mean that the RTC can't wake up the system
&gt; from s4 (soft-off),
&gt; which it can, and because wbind=0 and flush_s*
&gt; fields are also 0, it
&gt; would mean that onyl S0 is valid, but win2k supports
&gt; sleep while in acpi

So what makes you think they are doing S2 or S3?
They could easily be doing S1 which doesn't
require a cache flush.  No?  It would be hard
to tell the difference between S1, S2, and S3
from a user's perspective (ie. without a power
meter)

&gt; mode. this could mean:
&gt; 	1. linux doesn't read correctly the flags field or
&gt; flush_stride/flush_size, or 
&gt; 	2. the bios is broken, or
&gt; 	3. win2k sees that I have 2 celerons and deducts
&gt; the flush_size and
&gt; flush_stride accordingly.

#3 is possible but I suspect you are just getting S1

&gt; I didn't exactly understand the s4bios_f flag from
&gt; the facs table. for
&gt; me it is 1, so it means that the hardware can do
&gt; suspend to memory? so i
&gt; can soft-off the computer (no hdd, no vga, no nic,
&gt; no soundcard, no
&gt; keyboard) and still the memory is maintained?

S4BIOS is firmware suspend to disk and is just
an interim solution until all OS's support real S4.
To make it work you usually have to set up a
special partition on your harddisk.  Then, when
initiated, the BIOS takes care of saving and
later restoring system context.

&gt; wouldn't it be better to inform bios at boot about
&gt; which interrupt model
&gt; does linux use through the \_PIC method? Or linux
&gt; does this already? the
&gt; acpi specs says that on boot, the bios assumes
&gt; legacy (at-style
&gt; interrupt model, 0-15 irqs) mode. maybe the
&gt; activation of apic by linux
&gt; informs bios of this and \PIC isn't necessary, and
&gt; maybe not.

Right, I believe Linux can already do the correct
detection.  To use the ACPI \_PIC method at boot
time, we would need to have an AML interpreter
running in the kernel.  And that is another [near]
future hurdle for ACPI support on Linux.

&gt; Sleep S4 by OS would mean complete memory dump onto
&gt; a file, and on boot
&gt; a complete memory restoration. Is the linux kernel
&gt; design up to do this?
&gt; The restoration part, of course on shutdown cat
&gt; /dev/kmem &gt;
&gt; /boot/memory.dump is easy.

Right, the memory dump and restore is fairly
trivial.  The bigger problem is getting device
drivers to save and restore context so that
when you come back from sleep, your devices
are still working.  That's what the new
device power-management interface I've been
working on (kernel/pm.c) should begin to
address.

Thanks for the questions.

-Andy


__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000208190242</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-02-08 19:02:42-0400</timestampReceived><subject>Re: Resource configuration (was: Re: [Acpi] (no subject))</subject><body>

--- Roberto Jung Drebes &lt;drebes@inf.ufrgs.br&gt; wrote:

&gt; Is there any utility which would allow me to view
&gt; the tables in a formated
&gt; form? Something like the ACPIview.exe in MS HCT for
&gt; ACPI. Also, supposing

Check out the acpitools at

 
http://www.geocities.com/SiliconValley/Hardware/3165/

With these you can dump your ACPI tables (acpidmp),
display the fields (acpitbl), and disasemble
the AML in the DSDT (acpidisasm)

&gt; I can set the resources with _CRS, should I then
&gt; configure the device in a
&gt; traditional way (that is, via inb on configuration
&gt; registers) or that
&gt; would be enough? I didn't really understand the
&gt; workings of ACPI yet.

The ACPI driver does not yet do device configuration
so you will have to rely on the default configuration
by the PCI, ISA, ... subsystems or hand configure.
ACPI system/device configuration is definitely in
the works though, and is fairly high priority.

-Andy


__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000208230555</emailId><senderName>Roberto Jung Drebes</senderName><senderEmail>drebes@inf.ufrgs.br</senderEmail><timestampReceived>2000-02-08 23:05:55-0400</timestampReceived><subject>Re: Resource configuration (was: Re: [Acpi] (no subject))</subject><body>

On Tue, 8 Feb 2000, Andy Henroid wrote:

&gt; --- Roberto Jung Drebes &lt;drebes@inf.ufrgs.br&gt; wrote:
&gt; 
&gt; &gt; Is there any utility which would allow me to view
&gt; &gt; the tables in a formated
&gt; &gt; form? Something like the ACPIview.exe in MS HCT for
&gt; &gt; ACPI. Also, supposing
&gt; 
&gt; Check out the acpitools at

I had already 'tried' that. But I can't figure out how to use it. I can
dump the table with acpidmp, but I can't use the other utils. I'm not sure
how to use them, I tried piping them with acpidmp. It would be nice to
have a README or something.

--
Roberto Jung Drebes &lt;drebes@inf.ufrgs.br&gt;
Porto Alegre, RS - Brasil
http://www.inf.ufrgs.br/~drebes/

</body></email><email><emailId>20000204160452</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-02-04 16:04:52-0400</timestampReceived><subject>Re: [Acpi] check_region in acpi.c (fwd)</subject><body>

--- Simon Richter &lt;geier@phobos.fs.tum.de&gt; wrote:
&gt; Hi,
&gt; 
&gt; I think this was meant for the list...
&gt; 
&gt; ---------- Forwarded message ----------
&gt; Date: Fri, 04 Feb 2000 00:48:02 +0000
&gt; From: Mark D. Studebaker &lt;mds@paradyne.com&gt;
&gt; To: acpi-project@phobos.fachschaften.tu-muenchen.de
&gt; Cc: lm78@stimpy.netroedge.com
&gt; Subject: check_region in acpi.c
&gt; 
&gt; Hello again from lm_sensors.
&gt; 
&gt; In tracking down a bug in one of our lm_sensors
&gt; drivers,
&gt; I noticed that you do not have check_region() calls
&gt; before each
&gt; request_region() call in your acpi_claim_ioports()
&gt; routine
&gt; in drivers/misc/acpi.c.
&gt; 
&gt; In the case where your driver was loaded after ours,
&gt; it would help us find potential conflicts between
&gt; our drivers
&gt; and yours if you had check_region() calls as we do.
&gt; 
&gt; Would you please consider adding them?

I'll add the check_regions in the next patch.
OK, so this will help with debugging but, of course,
you can't share or grab the ACPI I/O ports.

-Andy

__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000224100023</emailId><senderName>Simon Richter</senderName><senderEmail>geier@phobos.fs.tum.de</senderEmail><timestampReceived>2000-02-24 10:00:23-0400</timestampReceived><subject>[Acpi] Compiling the userspace tools</subject><body>

Hi,

I've added automatic dependencies to the Makefiles. The rules will only be
activated if the Make variable DEPS is set to a non-NULL value, so if you
set this variable when compiling, make will respect changes to header
files in the correct way. The default for this is off.

   Simon

PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

</body></email><email><emailId>20000228173901</emailId><senderName>Anthony Jenkins</senderName><senderEmail>anthonyj@ami.com</senderEmail><timestampReceived>2000-02-28 17:39:01-0400</timestampReceived><subject>Re: [Acpi] Processor() declaration: what is PBlockAddress?</subject><body>

Thanks, this system is using the PIIX4, and it does have the registers at
base(==0x400)+10 (i82371AB PIIX4 pp. 141-2), but only one set, so I guess the
PIIX4 isn't ACPI-compatible with two processors, at least in this aspect?

David Christensen wrote:

&gt; Most BIOS vendors will use inappropriate values on multiprocessors systems
&gt; as yours seems to be.  The spec requires that all processors have symmetric
&gt; power state support.

Actually the spec provides the single exception that the boot processor may
have a non-zero register block length and all other processors have a zero
length (ACPI v1.0b p. 268) :-) ...which is why we had defined the processors as
such.  But if the OS will disable throttling anyway....


--
Anthony Jenkins
American Megatrends Inc.    http://www.ami.com
(770) 246-8600 ext 7241     mailto:AnthonyJ@ami.com



[Attachment #3 (text/html)]

&lt;!doctype html public "-//w3c//dtd html 4.0 transitional//en"&gt;
&lt;html&gt;
Thanks, this system is using the PIIX4, and it does have the registers
at base(==0x400)+10 (i82371AB PIIX4 pp. 141-2), but only one set, so I
guess the PIIX4 isn't ACPI-compatible with two processors, at least in
this aspect?
&lt;p&gt;David Christensen wrote:
&lt;blockquote TYPE=CITE&gt;Most BIOS vendors will use inappropriate values on
multiprocessors systems
&lt;br&gt;as yours seems to be.Â  The spec requires that all processors have
symmetric
&lt;br&gt;power state support.&lt;/blockquote&gt;
Actually the spec provides the single exception that the boot processor
may have a non-zero register block length and all other processors have
a zero length (ACPI v1.0b p. 268) :-) ...which is why we had defined the
processors as such.Â  But if the OS will disable throttling anyway....
&lt;br&gt;Â 
&lt;pre&gt;--Â 
Anthony Jenkins
American Megatrends Inc.Â Â Â  &lt;A \
HREF="http://www.ami.com"&gt;http://www.ami.com&lt;/A&gt; (770) 246-8600 ext \
7241Â Â Â Â  &lt;A \
HREF="mailto:AnthonyJ@ami.com"&gt;mailto:AnthonyJ@ami.com&lt;/A&gt;&lt;/pre&gt; Â &lt;/html&gt;



</body></email><email><emailId>20000218200423</emailId><senderName>David Fries</senderName><senderEmail>dfries@umr.edu</senderEmail><timestampReceived>2000-02-18 20:04:23-0400</timestampReceived><subject>[Acpi] ACPI suspend to disk</subject><body>

What is the status of suspend to disk?  I have a Toshiba laptop and it
looks like ACPI is the only way to get the laptop to suspend to disk.  At
least win98 is able to do it.  What is the status of ACPI suspend to disk
under Linux?

&gt; Right, the memory dump and restore is fairly
&gt; trivial.  The bigger problem is getting device
&gt; drivers to save and restore context so that
&gt; when you come back from sleep, your devices
&gt; are still working.  That's what the new
&gt; device power-management interface I've been
&gt; working on (kernel/pm.c) should begin to
&gt; address.

I wouldn expect the ACPI suspend to disk and standby to leave the hardware
in the same state after it comes back up.  It seems to me the standby turns
off all power except to memory, and all the rest of the devices would be
off just like turning the system off.

I haven't looked at the ACPI stuff in a while, is the ACPI development tree
quite a bit different from what the ACPI is in the kernel?

-- 
		+---------------------------------+
		|      David Fries                |
		|      dfries@umr.edu             |
		+---------------------------------+

</body></email><email><emailId>20000228155958</emailId><senderName>Anthony Jenkins</senderName><senderEmail>anthonyj@ami.com</senderEmail><timestampReceived>2000-02-28 15:59:58-0400</timestampReceived><subject>[Acpi] Processor() declaration: what is PBlockAddress?</subject><body>

I can't seem to find out what exactly this field is in the processor
declaration (ACPI v1.0b specification, pg. 267).  We have the value
0x410 as the default for PR0 and 0x0 for PR1; this is for
(mostly) Pentium II, Celeron and P III machines.  The one I'm working on
now is a dual-PIII.  The documentation for the PIII lists some
model-specific registers 64 bits wide that I thought might correspond to
this field, but they aren't the requisite 6 bytes long.

Maybe a better question is, what does the OS do with this field for the
processor definition?

Remove the anti-spam header before replying to my address (are mailing
lists susceptible to spam bots?  I'll remove the header if this mailing
list is okay).

Thanks in advance :-)

--
Anthony Jenkins
American Megatrends Inc.    http://www.ami.com
(770) 246-8600              mailto:nospamAnthonyJ@ami.com

</body></email><email><emailId>20000228163929</emailId><senderName>"David Christensen"</senderName><senderEmail>dchrist@home.com</senderEmail><timestampReceived>2000-02-28 16:39:29-0400</timestampReceived><subject>RE: [Acpi] Processor() declaration: what is PBlockAddress?</subject><body>

Depending on the length of the PR0 and PR1 objects, the P_BLK I/O registers
are used to control CPU clock throttling and entry into the C2 and C3 CPU
states.  These registers will likely be in the chipset (such as PIIX4) as
opposed to the CPU.

Most BIOS vendors will use inappropriate values on multiprocessors systems
as yours seems to be.  The spec requires that all processors have symmetric
power state support.  Most chipsets only support CPU throttling and C2/C3 on
single processor systems.  The fact that PR1 uses the value 0x0 indicates
that it doesn't support clock throttling but PR0 does because it has the
value 0x410.  This is asymmetric and the OS will never enable clock
throttling.  The values are OK for a uniprocessor OS but they should both be
0x0 for a multiprocessor OS.

Dave


-----Original Message-----
From: acpi-admin@phobos.fachschaften.tu-muenchen.de
[mailto:acpi-admin@phobos.fachschaften.tu-muenchen.de]On Behalf Of
Anthony Jenkins
Sent: Monday, February 28, 2000 8:00 AM
To: ACPI Mailing List
Subject: [Acpi] Processor() declaration: what is PBlockAddress?


I can't seem to find out what exactly this field is in the processor
declaration (ACPI v1.0b specification, pg. 267).  We have the value
0x410 as the default for PR0 and 0x0 for PR1; this is for
(mostly) Pentium II, Celeron and P III machines.  The one I'm working on
now is a dual-PIII.  The documentation for the PIII lists some
model-specific registers 64 bits wide that I thought might correspond to
this field, but they aren't the requisite 6 bytes long.

Maybe a better question is, what does the OS do with this field for the
processor definition?

Remove the anti-spam header before replying to my address (are mailing
lists susceptible to spam bots?  I'll remove the header if this mailing
list is okay).

Thanks in advance :-)

--
Anthony Jenkins
American Megatrends Inc.    http://www.ami.com
(770) 246-8600              mailto:nospamAnthonyJ@ami.com





_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000106014114</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-01-06 01:41:14-0400</timestampReceived><subject>[Acpi] [PATCH] ACPI</subject><body>


This patch is against 2.3.36

Changes
* Fix latencies bug (convert from uS to ticks)
* ACPI overrides APM if present and not disabled
* Parse ACPI kernel command line options
* Mark S1 on sleep as experimental



__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com
["acpi_patch-2.3.36.gz" (application/x-gzip-compressed)]

</body></email><email><emailId>20000106200824</emailId><senderName>Sven Kirmess</senderName><senderEmail>sven.kirmess@gmx.net</senderEmail><timestampReceived>2000-01-06 20:08:24-0400</timestampReceived><subject>Re: [Acpi] [PATCH] ACPI</subject><body>

 Thursday, January 06, 2000, 2:41:14 AM, Andy wrote:

&gt; This patch is against 2.3.36

I've used it against 2.3.36. :-)

&gt; Changes
&gt; * ACPI overrides APM if present and not disabled

Works perfect on my TX97-XE and P3B-F, but unfortunately... the
systems doen't power off... (as expected).

&gt; * Mark S1 on sleep as experimental

With this option activated, the P3B-F crashes and the TX97-XE
disappears for about 1 s and resumes, fully functional. (echo "1"
&gt;sleep)

With this option unchecked nothing happend after echo "1" &gt;sleep, as
expected.




 Sven

-- 
PGP-Key-ID: 0x881BF222

</body></email><email><emailId>20000106203053</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-01-06 20:30:53-0400</timestampReceived><subject>Re: [Acpi] [PATCH] ACPI</subject><body>

--- Sven Kirmess &lt;sven.kirmess@gmx.net&gt; wrote:
&gt;  Thursday, January 06, 2000, 2:41:14 AM, Andy wrote:
&gt; 
&gt; &gt; Changes
&gt; &gt; * ACPI overrides APM if present and not disabled
&gt; 
&gt; Works perfect on my TX97-XE and P3B-F, but
&gt; unfortunately... the
&gt; systems doen't power off... (as expected).
&gt; 
&gt; &gt; * Mark S1 on sleep as experimental
&gt; 
&gt; With this option activated, the P3B-F crashes and
&gt; the TX97-XE
&gt; disappears for about 1 s and resumes, fully
&gt; functional. (echo "1"
&gt; &gt;sleep)
&gt; 
&gt; With this option unchecked nothing happend after
&gt; echo "1" &gt;sleep, as
&gt; expected.

Right, the patch includes no new functionality
or work-arounds for platform problems so this
all sounds expected.  The goal is really to
fix some changes that Linus made, solidify
the build with ACPI+APM issue (use one or
the other not both), and turn off S1 by
default for safety.

Thanks,
Andy

__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000111231559</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-01-11 23:15:59-0400</timestampReceived><subject>[Acpi] [PATCH] ACPI</subject><body>


This patch is against 2.3.39

Changes
* Includes Andrey Panin's patch to support the
  VIA 82c586 chipset when no ACPI tables are
  present (thanks Andrey)

-Andy




__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com
["acpi_patch-2.3.39.gz" (application/x-gzip-compressed)]

</body></email><email><emailId>20000118065653</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-01-18 06:56:53-0400</timestampReceived><subject>[Acpi] [PATCH] VIA 82c586 ACPI support (VP2, VP3, MVP3) (fwd)</subject><body>

Hi,

Although this is already older, I haven't seen it mentioned on the list so
far.

   Simon

PGP public key available from ftp://phobos.fs.tum.de/pub/pgp/geier.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1

---------- Forwarded message ----------
Date: Mon, 10 Jan 2000 11:47:39 +0300
From: Andrey Panin &lt;pazke@orbita.don.sitek.net&gt;
Cc: Linux kernel mailng list. &lt;linux-kernel@vger.rutgers.edu&gt;,
     VIA Linux mailing list &lt;linux-via@gtf.org&gt;
Subject: [PATCH] VIA 82c586 ACPI support (VP2, VP3, MVP3)

Hi,

This small patch adds support for VIA 82c586 ACPI device.
It is usefull for motherboards with VIA chipsets but without ACPI tables (like
my FIC PA-2012).

This patch was tested on my machine and seems working (C2, C3 states, software
power-down).

Any feedback will be greatly appreciated.

Best wishes,
		Andrey


--- /mnt/d/linux/arch/i386/kernel/acpi.c        Thu Jan  6 21:39:22 2000
+++ /linux/arch/i386/kernel/acpi.c      Thu Jan  6 21:44:26 2000
@@ -496,21 +496,14 @@
 }

 /*
- * Locate PIIX4 device and create a fake FACP
+ * Init PIIX4 device and create a fake FACP
  */
-static int __init acpi_find_piix4(void)
+static int __init acpi_init_piix4(struct pci_dev *dev)
 {
-       struct pci_dev *dev;
        u32 base;
        u16 cmd;
        u8 pmregmisc;

-       dev = pci_find_device(PCI_VENDOR_ID_INTEL,
-                             PCI_DEVICE_ID_INTEL_82371AB_3,
-                             NULL);
-       if (!dev)
-               return -ENODEV;
-
        pci_read_config_word(dev, PCI_COMMAND, &amp;cmd);
        if (!(cmd &amp; PCI_COMMAND_IO))
                return -ENODEV;
@@ -563,6 +556,98 @@
 }

 /*
+ * Init VIA ACPI device and create a fake FACP
+ */
+static int __init acpi_init_via(struct pci_dev *dev)
+{
+       u32 base;
+       u8 tmp, irq;
+
+       pci_read_config_byte(dev, 0x41, &amp;tmp);
+       if (!(tmp &amp; 0x80))
+               return -ENODEV;
+
+       pci_read_config_byte(dev, 8, &amp;tmp);
+       tmp = (tmp &amp; 0x10 ? 0x48 : 0x20);
+
+       pci_read_config_dword(dev, tmp, &amp;base);
+       if (!(base &amp; PCI_BASE_ADDRESS_SPACE_IO))
+               return -ENODEV;
+
+       base &amp;= PCI_BASE_ADDRESS_IO_MASK;
+       if (!base)
+               return -ENODEV;
+
+       pci_read_config_byte(dev, 0x42, &amp;irq);
+
+       printk(KERN_INFO "ACPI: found %s at 0x%04x\n", dev-&gt;name, base);
+
+       acpi_facp = kmalloc(sizeof(struct acpi_facp), GFP_KERNEL);
+       if (!acpi_facp)
+               return -ENOMEM;
+
+       acpi_fake_facp = 1;
+       memset(acpi_facp, 0, sizeof(struct acpi_facp));
+
+       acpi_facp-&gt;int_model = ACPI_VIA_INT_MODEL;
+       acpi_facp-&gt;sci_int = irq;
+       acpi_facp-&gt;smi_cmd = base + ACPI_VIA_SMI_CMD;
+       acpi_facp-&gt;acpi_enable = ACPI_VIA_ACPI_ENABLE;
+       acpi_facp-&gt;acpi_disable = ACPI_VIA_ACPI_DISABLE;
+       acpi_facp-&gt;pm1a_evt = base + ACPI_PIIX4_PM1_EVT;
+       acpi_facp-&gt;pm1a_cnt = base + ACPI_PIIX4_PM1_CNT;
+       acpi_facp-&gt;pm_tmr = base + ACPI_VIA_PM_TMR;
+       acpi_facp-&gt;gpe0 = base + ACPI_VIA_GPE0;
+
+       acpi_facp-&gt;pm1_evt_len = ACPI_VIA_PM1_EVT_LEN;
+       acpi_facp-&gt;pm1_cnt_len = ACPI_VIA_PM1_CNT_LEN;
+       acpi_facp-&gt;pm_tm_len = ACPI_VIA_PM_TM_LEN;
+       acpi_facp-&gt;gpe0_len = ACPI_VIA_GPE0_LEN;
+       acpi_facp-&gt;p_lvl2_lat = (__u16) ACPI_INFINITE_LAT;
+       acpi_facp-&gt;p_lvl3_lat = (__u16) ACPI_INFINITE_LAT;
+
+       acpi_facp-&gt;duty_offset = ACPI_VIA_DUTY_OFFSET;
+       acpi_facp-&gt;duty_width = ACPI_VIA_DUTY_WIDTH;
+
+       acpi_facp-&gt;day_alarm = ACPI_VIA_DAY_ALARM;
+       acpi_facp-&gt;mon_alarm = ACPI_VIA_MON_ALARM;
+       acpi_facp-&gt;century = ACPI_VIA_CENTURY;
+
+       acpi_facp_addr = virt_to_phys(acpi_facp);
+       acpi_dsdt_addr = 0;
+
+       acpi_p_blk = base + ACPI_VIA_P_BLK;
+
+       return 0;
+}
+
+struct pci_acpi_dev {
+       unsigned short vendor;
+       unsigned short device;
+       int (*init_fn)(struct pci_dev *dev);
+};
+
+static struct pci_acpi_dev acpi_devices[] __initdata = {
+       {       PCI_VENDOR_ID_INTEL, PCI_DEVICE_ID_INTEL_82371AB_3,
+               acpi_init_piix4 },
+       {       PCI_VENDOR_ID_VIA, PCI_DEVICE_ID_VIA_82C586_3,
+               acpi_init_via },
+       { 0, }
+};
+
+static int __init acpi_probe_pci(void)
+{
+       struct pci_acpi_dev *tmp;
+       struct pci_dev *dev;
+
+       for (tmp = acpi_devices; tmp-&gt;vendor; tmp++)
+               if ((dev = pci_find_device(tmp-&gt;vendor, tmp-&gt;device, 0)))
+                       if (tmp-&gt;init_fn(dev) == 0)
+                               return 0;
+       return -ENODEV;
+}
+
+/*
  * Handle an ACPI SCI (fixed or general purpose event)
  */
 static void acpi_irq(int irq, void *dev_id, struct pt_regs *regs)
@@ -1160,7 +1245,7 @@
 {
        int pid;

-       if (acpi_find_tables() &amp;&amp; acpi_find_piix4()) {
+       if (acpi_find_tables() &amp;&amp; acpi_probe_pci()) {
                // no ACPI tables and not PIIX4
                return -ENODEV;
        }
--- /mnt/d/linux/include/linux/acpi.h   Thu Jan  6 21:50:59 2000
+++ /linux/include/linux/acpi.h Thu Jan  6 19:28:15 2000
@@ -399,4 +399,32 @@
 #define ACPI_PIIX4_PMREGMISC   0x80
 #define          ACPI_PIIX4_PMIOSE     0x01

+/*
+ * VIA-specific ACPI info (for systems with VT82C586B but no ACPI tables)
+ */
+
+#define ACPI_VIA_INT_MODEL     0x00
+
+#define ACPI_VIA_SMI_CMD       0x002f
+#define ACPI_VIA_ACPI_ENABLE   0xa1
+#define ACPI_VIA_ACPI_DISABLE  0xa0
+
+#define ACPI_VIA_PM1_EVT       0x0000
+#define ACPI_VIA_PM1_CNT       0x0004
+#define ACPI_VIA_PM_TMR        0x0008
+#define ACPI_VIA_GPE0          0x0020
+#define ACPI_VIA_P_BLK         0x0010
+
+#define ACPI_VIA_PM1_EVT_LEN   0x04
+#define ACPI_VIA_PM1_CNT_LEN   0x02
+#define ACPI_VIA_PM_TM_LEN     0x04
+#define ACPI_VIA_GPE0_LEN      0x04
+
+#define ACPI_VIA_DUTY_OFFSET   1
+#define ACPI_VIA_DUTY_WIDTH    3
+
+#define ACPI_VIA_DAY_ALARM     0x7d
+#define ACPI_VIA_MON_ALARM     0x7e
+#define ACPI_VIA_CENTURY       0x7f
+
 #endif /* _LINUX_ACPI_H */

-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.rutgers.edu
Please read the FAQ at http://www.tux.org/lkml/

</body></email><email><emailId>20000117160114</emailId><senderName>Will</senderName><senderEmail>william.palmer@durham.ac.uk</senderEmail><timestampReceived>2000-01-17 16:01:14-0400</timestampReceived><subject>[Acpi] apm hangs</subject><body>

i`ve sent this to both lists as i think it may be relevant.
i`ve also posted it to comp.os.linux.development.system

since 2.3.34/2.3.35 up until 2.3.39 (last tested)
when apm has been configured and the new kernel has
been installed the system seemingly hangs at startup
with the message
"ACPI C?" where ? is a number
the file seems to be arch/i386/kernel/acpi.c
(i think)
pressing a key moves the boot process which is _very_
slow a bit further.  this happens whether acpi is on or 
off and apm is on.  when both acpi and apm are off
it works fine.

where has the option for power off on shutdown gone?
i`ts not in menuconfig anymore but i can see the option
in 2.2.14

cheers
(i`m not on the lists so it`d be nice if someone could
email me if anything comes of this or if you need more info)
-- 
Will
http://compsoc.dur.ac.uk/~wp/

</body></email><email><emailId>20000119002147</emailId><senderName>Dieter =?iso-8859-1?Q?N=FCtzel?=</senderName><senderEmail>dieter.nuetzel@myokay.net</senderEmail><timestampReceived>2000-01-19 00:21:47-0400</timestampReceived><subject>[Acpi] poweroff on AMD IronGate C4 (MSI MS-6167 Rev 1.0b)</subject><body>

Hello,

I have some problems with ACPI and/or apm together with my AMD Athlon on
a MSI MS-6167 Rev 1.0b mobo.

When ever I enable apm I can't poweroff the machine. I've checked the
CONFIG_APM_REAL_MODE_POWER_OFF, too. But no success:-(

Under Win98 (SE) it works...

# CONFIG_ACPI is not set
CONFIG_APM=y
# CONFIG_APM_IGNORE_USER_SUSPEND is not set
CONFIG_APM_DO_ENABLE=y
CONFIG_APM_CPU_IDLE=y
CONFIG_APM_DISPLAY_BLANK=y
# CONFIG_APM_IGNORE_MULTIPLE_SUSPEND is not set
# CONFIG_APM_IGNORE_SUSPEND_BOUNCE is not set
CONFIG_APM_RTC_IS_GMT=y
# CONFIG_APM_ALLOW_INTS is not set
# CONFIG_APM_BAD_ENTRY_OFFSET is not set
# CONFIG_APM_REAL_MODE_POWER_OFF is not set

SunWave1&gt;cat /proc/apm
1.11 1.2 0x07 0x01 0xff 0x80 -1% -1 ?

With apm=debug:

Jan 17 18:20:49 SunWave1 kernel: apm: BIOS version 1.2 Flags 0x07
(Driver version 1.11)
Jan 17 18:20:49 SunWave1 kernel: apm: entry f000:800c cseg16 f000 dseg
fdfa cseg len 0, dseg len 0 cseg16 len f000
Jan 17 18:20:49 SunWave1 kernel: (scsi0) &lt;Adaptec AHA-294X Ultra SCSI
host adapter&gt; found at PCI 9/0
Jan 17 18:20:49 SunWave1 kernel: (scsi0) Wide Channel, SCSI ID=7, 16/255
SCBs
Jan 17 18:20:49 SunWave1 kernel: (scsi0) Warning - detected
auto-termination
Jan 17 18:20:49 SunWave1 kernel: (scsi0) Please verify driver detected
settings are correct.
Jan 17 18:20:49 SunWave1 kernel: (scsi0) If not, then please properly
set the device termination
Jan 17 18:20:49 SunWave1 kernel: (scsi0) in the Adaptec SCSI BIOS by
hitting CTRL-A when prompted
Jan 17 18:20:49 SunWave1 kernel: (scsi0) during machine bootup.
Jan 17 18:20:49 SunWave1 kernel: (scsi0) Cables present (Int-50 NO,
Int-68 YES, Ext-68 YES)
Jan 17 18:20:49 SunWave1 kernel: (scsi0) Downloading sequencer code...
413 instructions downloaded
Jan 17 18:20:49 SunWave1 kernel: apm: Connection version 1.2
Jan 17 18:20:49 SunWave1 kernel: apm: AC on line, battery status
unknown, battery life unknown
Jan 17 18:20:49 SunWave1 kernel: apm: battery flag 0x80, battery life
unknown


If I enable ACPI my machine hangs during system boot.
Are there any problems with shared interrupts and ACPI?
ACPI, my EtherExpress card and the USB device share the IRQ 9.
System hangs during ethernet initialization.

syslog:

Jan 18 17:23:07 SunWave1 kernel: Linux version 2.3.40pre4
(root@SunWave1) (gcc version pgcc-2.95.3 19991209 (release)) #1 Mon Jan
17 18:17:19 CET 2000
Jan 18 17:23:07 SunWave1 kernel: e820: 0009fc00 @ 00000000 (usable)
Jan 18 17:23:07 SunWave1 kernel: e820: 00000400 @ 0009fc00 (reserved)
Jan 18 17:23:07 SunWave1 kernel: e820: 00010000 @ 000f0000 (reserved)
Jan 18 17:23:07 SunWave1 kernel: e820: 00010000 @ ffff0000 (reserved)
Jan 18 17:23:07 SunWave1 kernel: e820: 0fef0000 @ 00100000 (usable)
Jan 18 17:23:07 SunWave1 kernel: e820: 0000d000 @ 0fff3000 (ACPI data)
Jan 18 17:23:07 SunWave1 kernel: e820: 00003000 @ 0fff0000 (ACPI NVS)
Jan 18 17:23:07 SunWave1 kernel: On node 0 totalpages: 00010000
Jan 18 17:23:07 SunWave1 kernel: zone(0): 4096 pages.
Jan 18 17:23:07 SunWave1 kernel: zone(1): 61440 pages.
Jan 18 17:23:07 SunWave1 kernel: zone(2): 0 pages.
Jan 18 17:23:07 SunWave1 kernel: Initializing CPU#0
Jan 18 17:23:07 SunWave1 kernel: Detected 548944675 Hz processor.
Jan 18 17:23:07 SunWave1 kernel: Console: colour VGA+ 80x25
Jan 18 17:23:07 SunWave1 kernel: Calibrating delay loop... 547.23
BogoMIPS
Jan 18 17:23:07 SunWave1 kernel: Memory: 255792k/262144k available (995k
kernel code, 5964k reserved, 79k data, 128k init, 0k highmem)
Jan 18 17:23:07 SunWave1 kernel: Buffer-cache hash table entries: 16384
(order: 4, 65536 bytes)
Jan 18 17:23:07 SunWave1 kernel: Page-cache hash table entries: 65536
(order: 6, 262144 bytes)
Jan 18 17:23:07 SunWave1 kernel: L1 I Cache: 64K  L1 D Cache: 64K
Jan 18 17:23:07 SunWave1 kernel: L2 Cache: 512K
Jan 18 17:23:07 SunWave1 kernel: CPU: AMD AMD-K7(tm) Processor stepping
02
Jan 18 17:23:07 SunWave1 kernel: POSIX conformance testing by UNIFIX
Jan 18 17:23:07 SunWave1 kernel: mtrr: v1.35 (19990512) Richard Gooch
(rgooch@atnf.csiro.au)
Jan 18 17:23:07 SunWave1 kernel: PCI: PCI BIOS revision 2.10 entry at
0xfb430
Jan 18 17:23:07 SunWave1 kernel: PCI: Probing PCI hardware
Jan 18 17:23:07 SunWave1 kernel: IP: routing cache hash table of 2048
buckets, 16Kbytes
Jan 18 17:23:07 SunWave1 kernel: TCP: Hash tables configured
(established 16384 bind 32768)
Jan 18 17:23:07 SunWave1 kernel: Starting kswapd v1.6
Jan 18 17:23:07 SunWave1 kernel: pty: 256 Unix98 ptys configured
Jan 18 17:23:07 SunWave1 kernel: scsi0 : Adaptec AHA274x/284x/294x
(EISA/VLB/PCI-Fast SCSI) 5.1.21/3.2.4
Jan 18 17:23:07 SunWave1 kernel:        &lt;Adaptec AHA-294X Ultra SCSI
host adapter&gt;
Jan 18 17:23:07 SunWave1 kernel: scsi : 1 host.
Jan 18 17:23:07 SunWave1 kernel:   Vendor: IBM       Model:
DDRS-34560W       Rev: S71D
Jan 18 17:23:07 SunWave1 kernel:   Type:
Direct-Access                      ANSI SCSI revision: 02
Jan 18 17:23:07 SunWave1 kernel: Detected scsi disk sda at scsi0,
channel 0, id 0, lun 0
Jan 18 17:23:07 SunWave1 kernel:   Vendor: PIONEER   Model: CD-ROM
DR-U12X    Rev: 1.06
Jan 18 17:23:07 SunWave1 kernel:   Type:
CD-ROM                             ANSI SCSI revision: 02
Jan 18 17:23:07 SunWave1 kernel: scsi : detected 1 SCSI disk total.
Jan 18 17:23:07 SunWave1 kernel: SCSI device sda: hdwr sector= 512
bytes. Sectors= 8925000 [4357 MB] [4.4 GB]
Jan 18 17:23:07 SunWave1 kernel: VFS: Mounted root (ext2 filesystem)
readonly.
Jan 18 17:23:07 SunWave1 kernel: Freeing unused kernel memory: 128k
freed
Jan 18 17:23:07 SunWave1 kernel: eepro100.c: $Revision: 1.18 $
1999/12/29 Modified by Andrey V. Savochkin &lt;saw@msu.ru&gt;

messages:

Jan 18 17:23:06 SunWave1 syslogd 1.3-3: restart.
Jan 18 17:23:06 SunWave1 kernel: klogd 1.3-3, log source = /proc/kmsg
started.
Jan 18 17:23:06 SunWave1 kernel: Inspecting /boot/System.map
Jan 18 17:23:07 SunWave1 kernel: Loaded 10394 symbols from
/boot/System.map.
Jan 18 17:23:07 SunWave1 kernel: Symbols match kernel version 2.3.40.
Jan 18 17:23:07 SunWave1 kernel: Loaded 8 symbols from 1 module.
Jan 18 17:23:07 SunWave1 kernel: Checking 386/387 coupling... OK, FPU
using exception 16 error reporting.
Jan 18 17:23:07 SunWave1 kernel: Checking 'hlt' instruction... OK.
Jan 18 17:23:07 SunWave1 kernel: Linux NET4.0 for Linux 2.3
Jan 18 17:23:07 SunWave1 kernel: Based upon Swansea University Computer
Society NET3.039
Jan 18 17:23:07 SunWave1 kernel: NET4: Unix domain sockets 1.0/SMP for
Linux NET4.0.
Jan 18 17:23:07 SunWave1 kernel: NET4: Linux TCP/IP 1.0 for NET4.0
Jan 18 17:23:07 SunWave1 kernel: IP Protocols: ICMP, UDP, TCP
Jan 18 17:23:07 SunWave1 kernel: apm: BIOS version 1.2 Flags 0x07
(Driver version 1.11)
Jan 18 17:23:07 SunWave1 kernel: (scsi0) &lt;Adaptec AHA-294X Ultra SCSI
host adapter&gt; found at PCI 9/0
Jan 18 17:23:07 SunWave1 kernel: (scsi0) Wide Channel, SCSI ID=7, 16/255
SCBs
Jan 18 17:23:07 SunWave1 kernel: (scsi0) Warning - detected
auto-termination
Jan 18 17:23:07 SunWave1 kernel: (scsi0) Please verify driver detected
settings are correct.
Jan 18 17:23:07 SunWave1 kernel: (scsi0) If not, then please properly
set the device termination
Jan 18 17:23:07 SunWave1 kernel: (scsi0) in the Adaptec SCSI BIOS by
hitting CTRL-A when prompted
Jan 18 17:23:07 SunWave1 kernel: (scsi0) during machine bootup.
Jan 18 17:23:07 SunWave1 kernel: (scsi0) Cables present (Int-50 NO,
Int-68 YES, Ext-68 YES)
Jan 18 17:23:07 SunWave1 kernel: (scsi0) Downloading sequencer code...
413 instructions downloaded
Jan 18 17:23:07 SunWave1 kernel: (scsi0:0:0:0) Synchronous at 40.0
Mbyte/sec, offset 8.
Jan 18 17:23:07 SunWave1 kernel: (scsi0:0:4:0) Synchronous at 10.0
Mbyte/sec, offset 15.
Jan 18 17:23:07 SunWave1 kernel: Partition check:
Jan 18 17:23:07 SunWave1 kernel:  sda: sda1 sda2 sda3 sda4 &lt; sda5 sda6 &gt;

Jan 18 17:23:07 SunWave1 kernel: Real Time Clock Driver v1.09b
Jan 18 17:23:07 SunWave1 kernel: Adding Swap: 200772k swap-space
(priority -1)
Jan 18 17:23:07 SunWave1 kernel: eepro100.c:v1.09j-t 9/29/99 Donald
Becker http://cesdis.gsfc.nasa.gov/linux/drivers/eepro100.html
Jan 18 17:23:07 SunWave1 kernel: eth0: Intel PCI EtherExpress Pro100 at
0xd0822000, 00:A0:C9:8D:71:48, IRQ 9.
Jan 18 17:23:07 SunWave1 kernel:   Board assembly 668081-004, Physical
connectors present: RJ45
Jan 18 17:23:07 SunWave1 kernel:   Primary interface chip i82555 PHY #1.

Jan 18 17:23:07 SunWave1 kernel:   General self-test: passed.
Jan 18 17:23:07 SunWave1 kernel:   Serial sub-system self-test: passed.
Jan 18 17:23:07 SunWave1 kernel:   Internal registers self-test: passed.

Jan 18 17:23:07 SunWave1 kernel:   ROM checksum self-test: passed
(0x3c15c8f1).
Jan 18 17:23:07 SunWave1 kernel:   Receiver lock-up workaround
activated.

What do you need in addition?
I will send whatever you need (apart from the Athlon and mobo:-)

Thanks,
        Dieter

--
Dieter NÃ¼tzel
Graduate Student, Computer Science

University of Hamburg
Department of Computer Science
Cognitive Systems Group
Vogt-KÃ¶lln-StraÃe 30
D-22527 Hamburg, Germany

email: nuetzel@kogs.informatik.uni-hamburg.de
@home: dieter.nuetzel@myokay.net

</body></email><email><emailId>20000116174457</emailId><senderName>David Woodhouse</senderName><senderEmail>dwmw2@infradead.org</senderEmail><timestampReceived>2000-01-16 17:44:57-0400</timestampReceived><subject>[Acpi] Re: Power-off handling.</subject><body>

andy_henroid@yahoo.com writes:
&gt; I like the idea of unifying some of the power off code but don't like the
&gt; dual ACPI/APM power off.

Why? That was the whole point in my writing the patch in the first place - I 
got annoyed with it not powering down because it didn't try the APM 
power-down routine after acpi_power_off_handler() failed to do anything.

It tries ACPI first, but if it's still running after trying that, it reverts 
to the APM routine. What's wrong with that?

(Please Cc me your reply - I only happened to stumble across the list archive 
when I was trying to work out why it acpi_power_off_handler() doesn't succeed 
in powering off my Abit BP6 in the first place.



--
dwmw2

</body></email><email><emailId>20000118204604</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-01-18 20:46:04-0400</timestampReceived><subject>Re: [Acpi] Re: Power-off handling.</subject><body>

--- David Woodhouse &lt;dwmw2@infradead.org&gt; wrote:
&gt; andy_henroid@yahoo.com writes:
&gt; &gt; I like the idea of unifying some of the power off
&gt; code but don't like the
&gt; &gt; dual ACPI/APM power off.

&gt; It tries ACPI first, but if it's still running after
&gt; trying that, it reverts 
&gt; to the APM routine. What's wrong with that?

The fallback to APM poweroff may work on your
machine but I don't believe it is safe for
general use.  APM needs to be engaged before
doing any APM BIOS calls like poweroff and
that will conflict with ACPI being enabled.

-Andy

__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000119083129</emailId><senderName>David Woodhouse</senderName><senderEmail>dwmw2@infradead.org</senderEmail><timestampReceived>2000-01-19 08:31:29-0400</timestampReceived><subject>Re: [Acpi] Re: Power-off handling.</subject><body>

andy_henroid@yahoo.com said:
&gt;  The fallback to APM poweroff may work on your machine but I don't
&gt; believe it is safe for general use.  APM needs to be engaged before
&gt; doing any APM BIOS calls like poweroff and that will conflict with
&gt; ACPI being enabled. 

'engaged'? I thought that all the setup code did was to get the entry point 
information and set up the segment tables accordingly - I didn't think it 
actually made a call into the APM BIOS to tell it that it was going to be used.

This is in SMP mode - smp-power-off only. I agree that full APM shouldn't be 
enabled at the same time as ACPI.

--
dwmw2

</body></email><email><emailId>20000119193256</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-01-19 19:32:56-0400</timestampReceived><subject>Re: [Acpi] Re: Power-off handling.</subject><body>

--- David Woodhouse &lt;dwmw2@infradead.org&gt; wrote:
&gt; 
&gt; 'engaged'? I thought that all the setup code did was
&gt; to get the entry point information and set up the
&gt; segment tables accordingly - I didn't think it 
&gt; actually made a call into the APM BIOS to tell it
&gt; that it was going to be used.

Looking at the APM code, it seems like it does.
&gt;From apm() apm_engage_power_management() is
called which makes a call into the BIOS.

&gt; This is in SMP mode - smp-power-off only. I agree
&gt; that full APM shouldn't be 
&gt; enabled at the same time as ACPI.

I suspect engaging the APM BIOS even without
the separate step of enabling APM is going to
cause problems for ACPI.

-Andy



&gt; 
&gt; --
&gt; dwmw2
&gt; 
&gt; 
&gt; 
__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000120021705</emailId><senderName>Blu3Viper</senderName><senderEmail>david@killerlabs.com</senderEmail><timestampReceived>2000-01-20 02:17:05-0400</timestampReceived><subject>[Acpi] Re: 2.3.40-5 -- "apm" no longer recognizes that I have an APM-enabled kernel.</subject><body>

&gt; &gt; If the ACPI user space tools (e.g. acpid) do
&gt; &gt; anything useful, it isn't documented.
&gt; 
&gt; acpid reads the ACPI tables and uploads important
&gt; information about how to do CPU power states,
&gt; S-states, and handles power/sleep button presses.
&gt; If acpid does not run, the ACPI driver won't
&gt; do much useful.


ok, after a short search...where are the acpi tools?

i'm a wee bit nervous not having battery status on my laptop now :)

-d

</body></email><email><emailId>20000119004525</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-01-19 00:45:25-0400</timestampReceived><subject>Re: [Acpi] poweroff on AMD IronGate C4 (MSI MS-6167 Rev 1.0b)</subject><body>

--- Dieter N=FCtzel &lt;dieter.nuetzel@myokay.net&gt; wrote:

&gt; If I enable ACPI my machine hangs during system
&gt; boot. Are there any problems with shared interrupts
&gt; and ACPI? ACPI, my EtherExpress card and the USB
&gt; device share the IRQ 9. System hangs during
&gt; ethernet initialization.

It's possible your GPE status register won't clear
and the ACPI driver is spinning waiting for it to
clear.  I can add a timeout to the next patch but
still you are going to see an awful performance
hit sharing between ACPI, with relatively slow
register accesses, and any high bandwidth device.

Sharing an interrupt between a net card and
USB controller (especially if UHCI) is
crazy much less also sharing with ACPI.

-Andy

__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000119004905</emailId><senderName>Johannes Erdfelt</senderName><senderEmail>jerdfelt@valinux.com</senderEmail><timestampReceived>2000-01-19 00:49:05-0400</timestampReceived><subject>Re: [Acpi] poweroff on AMD IronGate C4 (MSI MS-6167 Rev 1.0b)</subject><body>

On Tue, Jan 18, 2000, Andy Henroid &lt;andy_henroid@yahoo.com&gt; wrote:
&gt; --- Dieter N?tzel &lt;dieter.nuetzel@myokay.net&gt; wrote:
&gt; 
&gt; &gt; If I enable ACPI my machine hangs during system
&gt; &gt; boot. Are there any problems with shared interrupts
&gt; &gt; and ACPI? ACPI, my EtherExpress card and the USB
&gt; &gt; device share the IRQ 9. System hangs during
&gt; &gt; ethernet initialization.
&gt; 
&gt; It's possible your GPE status register won't clear
&gt; and the ACPI driver is spinning waiting for it to
&gt; clear.  I can add a timeout to the next patch but
&gt; still you are going to see an awful performance
&gt; hit sharing between ACPI, with relatively slow
&gt; register accesses, and any high bandwidth device.
&gt; 
&gt; Sharing an interrupt between a net card and
&gt; USB controller (especially if UHCI) is
&gt; crazy much less also sharing with ACPI.

Why especially if UHCI? Why USB in general?

I share UHCI, Tulip and AIC7xxx all on one IRQ. I even developed the UHCI
driver on this configuration.

PCI was designed to do that.

JE

</body></email><email><emailId>20000119010808</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-01-19 01:08:08-0400</timestampReceived><subject>Re: [Acpi] poweroff on AMD IronGate C4 (MSI MS-6167 Rev 1.0b)</subject><body>

--- Johannes Erdfelt &lt;jerdfelt@valinux.com&gt; wrote:
&gt; On Tue, Jan 18, 2000, Andy Henroid
&gt; 
&gt; Why especially if UHCI? Why USB in general?
&gt; 
&gt; I share UHCI, Tulip and AIC7xxx all on one IRQ. I
&gt; even developed the UHCI
&gt; driver on this configuration.
&gt; 
&gt; PCI was designed to do that.

OK, perhaps "crazy" was a overstatement.  My point
is that it's a bad idea to share interrupts between
high bandwidth devices and slower devices like
ACPI.

I took a closer look and, you are right, the
time required to determine that the UHCI card was
not the source of an interrupt is minimal.  I
suppose I was thinking of the amount of time
to find which TD completed.  My mistake.

-Andy

__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000126021739</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-01-26 02:17:39-0400</timestampReceived><subject>[Acpi] [PATCH] ACPI</subject><body>


This patch is against 2.3.41-pre3

Changes
* Includes Jeff Garzik's repatch to support the
  VIA 82c586 chipset when no ACPI tables are
  present (thanks Jeff and Andrey Panin, for the
  original patch)

-Andy

__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com
["acpi_patch-2.3.41-3.gz" (application/x-gzip-compressed)]

</body></email><email><emailId>20000126212342</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-01-26 21:23:42-0400</timestampReceived><subject>[Acpi] [PATCH] ACPI</subject><body>


The following patch is against 2.3.41-pre3

It begins the process of merging the ACPI and
APM driver interfaces.  If this looks acceptible,
I can submit a second patch doing the APM side of
the merge.

The only APM events that any driver is actually
handling are suspend and resume and
user/sys/critical are always handled as one.
So I believe I can safely map APM_XXX_SUSPEND to
PM_SUSPEND and APM_XXX_RESUME to PM_RESUME
and just discard all of the other APM events.
Or do you forsee the need to propagate any
additional APM events (eg. APM_LOW_BATTERY)?

Thanks,
Andy

__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com
["acpi_patch-2.3.41-3.gz" (application/x-gzip-compressed)]

</body></email><email><emailId>20000127223715</emailId><senderName>Nils Faerber</senderName><senderEmail>nils.faerber@unix-ag.org</senderEmail><timestampReceived>2000-01-27 22:37:15-0400</timestampReceived><subject>Re: [Acpi] [PATCH] ACPI</subject><body>

Hello!

&gt; --- Linus Torvalds &lt;torvalds@transmeta.com&gt; wrote:
&gt; &gt; shut down: I just suspect it should be handled by
&gt; &gt; a UPS-like notification rather than being part of
&gt; &gt; the driver power management thing (ie the APM
&gt; &gt; low-battery event should _not_ be considered to
&gt; &gt; be an event similar to a suspend or resume,
&gt; &gt; it should have a different interface altogether).
&gt; Right, device drivers should only need to know
&gt; the power state for their specific device(s) and
&gt; not need to know what the rest of the system
&gt; is doing.  Low battery can be handled at a higher
&gt; level (eg. by shutting down or suspending the
&gt; system which will result in individual device
&gt; suspends)
&gt; Driver isolation allows for centralized power
&gt; management policy and individual power management
&gt; of devices.
Hmm ... but what about actions that might the kernel take to save power?
Not that we actually know of those kinds of powersaving features in the
kernel's drivers yet but that may just be a matter of short time.
I could think of upcoming portable devices using Linux (transmeta's Crusoe
is for sure only the beginning) that could maybe out some parts of the
system in a more powersaving state like throttling CPU speed or the speed of
other devices/parts that then work at lower performance but give some more
battery life (for example monochrome LCDs couls be switched from many
graylevels to just some graylevels which saves power too).
Sure this could also be handled by a usermode daemon that could throttle
those things by ioctl()s or something. But I doubt that this is a good
choice for, let's say, chipset level functions.
I could think of something like /proc/acpi/warnlevel where a battery level
could be defined when the ACPI/APM driver will issue a "power critical"
signal to registered drivers.

Just an idea ;)

&gt; Thanks,
&gt; Andy
CU
  nils

-- 
Nils Faerber (Linux Nils)        eMail: nils@unix-ag.org
Student of computer science      http://www.si.unix-ag.org/~nils/
Unix user group, University of Siegen, Germany

Siegen ... the arctic rain forest!
--
-- 
Nils Faerber (Linux Nils)        eMail: nils@unix-ag.org
Student of computer science      http://www.si.unix-ag.org/~nils/
Unix user group, University of Siegen, Germany

Siegen ... the arctic rain forest!
--

</body></email><email><emailId>20000209081818</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-02-09 08:18:18-0400</timestampReceived><subject>[Acpi] [PATCH] ACPI</subject><body>

 
 
__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000209082432</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-02-09 08:24:32-0400</timestampReceived><subject>[Acpi] [PATCH] ACPI</subject><body>


This patch is against 2.3.43-5.

Changes
* Resume devices if a suspend request fails
  (restores semantics of APM interface)

Thanks,
Andy


__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com
["acpi_patch-2.3.43-5.gz" (application/x-gzip-compressed)]

</body></email><email><emailId>20000224022321</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-02-24 02:23:21-0400</timestampReceived><subject>[Acpi] [PATCH] ACPI</subject><body>


This patch is against 2.3.48-1

Changes
* Restore devices to their previous state after
  a failed suspend request (instead of just
  resuming all devices)
* Exported pm_send for control of individual drivers
* Changed pm_send_request to pm_send_all
* Documentation update


__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com
["acpi_patch-2.3.48-1.gz" (application/x-gzip-compressed)]

</body></email><email><emailId>20000309200758</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-03-09 20:07:58-0400</timestampReceived><subject>[Acpi] [PATCH] ACPI</subject><body>


This patch is against 2.3.50

Changes
* Removed ACPI kernel thread (device mgmt will
  be handled from the generic PM code in the
  future) 
* Allow ACPI to be compiled as a module
* Added extra kernel command line options



__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com
["acpi_patch-2.3.50.gz" (application/x-gzip-compressed)]

</body></email><email><emailId>20000312033229</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-03-12 03:32:29-0400</timestampReceived><subject>[Acpi] [PATCH] ACPI</subject><body>


This patch is against 2.3.51

Changes
* Updated /proc/sys/acpi/[table] interface to provide
  more flexibility (simple table replacement) and
  fix a problem with acpid being able to map some
  tables directly.  This change requires an update to
  the latest acpid (sorry) and that is available now
  from
         
http://www.geocities.com/SiliconValley/Hardware/3165/

  and soon after at the main ACPI4Linux website.

Thanks,
Andy


__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com
["acpi_patch-2.3.51.gz" (application/x-gzip-compressed)]

</body></email><email><emailId>20000317031112</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-03-17 03:11:12-0400</timestampReceived><subject>[Acpi] [PATCH] ACPI</subject><body>


This patch is against 2.3.99-pre2-3

Changes (fixes)
* Verify that APM is not already running when
  initializing ACPI (Necessary when ACPI is built
  as a module and loaded after APM)
* Do not fallback to chipset-specific support
  when encountering a broken ACPI table (Assume
  the ACPI implementation is broken.  The user
  can override by adding "acpi=chipset" to the
  kernel command line)





__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com
["acpi_patch-2.3.99-2.gz" (application/x-gzip-compressed)]

</body></email><email><emailId>20000417181419</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-17 18:14:19-0400</timestampReceived><subject>[Acpi] [PATCH] ACPI</subject><body>

This patch is against 2.3.99-pre6-3

Bug fix: Detect the FACP correctly even if it is
not the last entry in the RSDT.  This fix is very
important for systems with multiple ACPI tables
(most), including the ASUS P5B.

Thanks go out to Bernard Sebastien for identifying
the problem and creating the fix.

-Andy





__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com
["acpi_patch-2.3.99-6-3" (text/plain)]

diff -u --recursive --new-file --exclude-from=.mkpatch.exclude \
                v2.3.99-pre6-3/linux/arch/i386/kernel/acpi.c \
                linux/arch/i386/kernel/acpi.c
--- v2.3.99-pre6-3/linux/arch/i386/kernel/acpi.c	Wed Apr  5 17:04:37 2000
+++ linux/arch/i386/kernel/acpi.c	Mon Apr 17 10:01:37 2000
@@ -583,6 +583,8 @@
 			dt = acpi_map_table(facp-&gt;dsdt);
 			if (acpi_init_table(&amp;acpi_dsdt, dt, 1))
 				acpi_unmap_table(dt);
+
+			break;
 		}
 		else {
 			acpi_unmap_table(dt);



</body></email><email><emailId>20000425011258</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-25 01:12:58-0400</timestampReceived><subject>[Acpi] [PATCH] ACPI</subject><body>

This patch is against 2.3.99-pre6-5

Bug fix: Restore system state flag to S0 following
an S1 suspend.  Without this fix, any sleep or power
button presses following a suspend and resume will
fail.

-Andy



__________________________________________________
Do You Yahoo!?
Send online invitations with Yahoo! Invites.
http://invites.yahoo.com
["acpi_patch-2.3.99-6-5" (text/plain)]

diff -u --recursive --new-file --exclude-from=.mkpatch.exclude \
                v2.3.99-pre6-5/linux/arch/i386/kernel/acpi.c \
                linux/arch/i386/kernel/acpi.c
--- v2.3.99-pre6-5/linux/arch/i386/kernel/acpi.c	Mon Apr 24 16:07:02 2000
+++ linux/arch/i386/kernel/acpi.c	Mon Apr 24 16:48:17 2000
@@ -1129,6 +1129,7 @@
 	// finished sleeping, update system time
 	acpi_update_clock();
 	acpi_enter_dx(ACPI_D0);
+	acpi_sleep_state = ACPI_S0;
 	
 	return 0;
 }



</body></email><email><emailId>20000427195618</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-27 19:56:18-0400</timestampReceived><subject>[Acpi] [PATCH] ACPI</subject><body>

This patch is against 2.3.99-pre6

Bug fix: Added an errata entry for AMI ACPI support
enabling trust-tables and copy-tables.  This entry
is specifically to fix an MSI6120 but should apply
more widely to systems with AMI BIOSs.

-Andy



__________________________________________________
Do You Yahoo!?
Talk to your friends online and get email alerts with Yahoo! Messenger.
http://im.yahoo.com/
["acpi_patch-2.3.99-6" (text/plain)]

diff -u --recursive --new-file --exclude-from=.mkpatch.exclude \
                v2.3.99-pre6/linux/arch/i386/kernel/acpi.c \
                linux/arch/i386/kernel/acpi.c
--- v2.3.99-pre6/linux/arch/i386/kernel/acpi.c	Mon Apr 24 18:17:52 2000
+++ linux/arch/i386/kernel/acpi.c	Thu Apr 27 11:34:12 2000
@@ -144,14 +144,21 @@
 
 struct acpi_errata_info
 {
-	const char *oem;
-	const char *oem_table;
-	u32 oem_rev;
-	unsigned long options;
+	const char *signature; // table signature (eg. "RSDT")
+	const char *oem;       // OEM name
+	const char *oem_table; // OEM table identifier (optional)
+	u32 oem_rev;           // OEM table revision (optional)
+	unsigned long options; // errata options
 };
 
+/*
+ * We must identify systems that need ACPI_TRUST_TABLES solely from the
+ * RSDP ("RSD PTR ").  All other options should be flagged from the
+ * RSDT ("RSDT") which can be better identified.
+ */
 struct acpi_errata_info acpi_errata[] =
 {
+	{"RSD PTR ", "AMI   ", NULL, 0, ACPI_TRUST_TABLES | ACPI_COPY_TABLES},
 	{NULL, NULL, 0, 0},
 };
 
@@ -521,6 +528,51 @@
 }
 
 /*
+ * Match ACPI table and set options based on platform errata, if any
+ */
+static int __init acpi_find_errata(struct acpi_table *table)
+{
+	struct acpi_errata_info *info;
+	int size;
+
+	for (info = acpi_errata; info-&gt;signature &amp;&amp; info-&gt;oem; info++) {
+		size = strlen(info-&gt;signature);
+		if (memcmp(&amp;table-&gt;signature, info-&gt;signature, size))
+			continue;
+		if (strcmp(info-&gt;signature, "RSD PTR ")) {
+			// ordinary ACPI table
+			size = strlen(info-&gt;oem);
+			if (memcmp(table-&gt;oem, info-&gt;oem, size))
+				continue;
+			if (info-&gt;oem_table) {
+				size = strlen(info-&gt;oem_table);
+				if (memcmp(table-&gt;oem_table,
+					   info-&gt;oem_table,
+					   size))
+					continue;
+			}
+			if (info-&gt;oem_rev &amp;&amp; table-&gt;oem_rev != info-&gt;oem_rev)
+				continue;
+		}
+		else {
+			// special handling for RSDP
+			size = strlen(info-&gt;oem);
+			if (memcmp(((struct acpi_rsdp*) table)-&gt;oem,
+				   info-&gt;oem,
+				   size))
+				continue;
+		}
+
+		printk(KERN_INFO
+		       "ACPI: found platform errata 0x%08lx\n",
+		       info-&gt;options);
+		acpi_opts |= info-&gt;options;
+		return 0;
+	}
+	return -1;
+}
+
+/*
  * Locate and map ACPI tables
  */
 static int __init acpi_find_tables(void)
@@ -556,6 +608,14 @@
 	if (i &gt;= ACPI_BIOS_ROM_END)
 		return -ENODEV;
 
+	// find any errata based on the RSDP
+	if (!acpi_find_errata((struct acpi_table*) rsdp)) {
+		if (acpi_opts &amp; ACPI_DISABLED)
+			return -EINVAL;
+		else if (acpi_opts &amp; ACPI_CHIPSET_ONLY)
+			return -ENODEV;
+	}
+
 	// fetch RSDT from RSDP
 	rsdt = acpi_map_table(rsdp-&gt;rsdt);
 	if (!rsdt) {
@@ -569,6 +629,15 @@
 		acpi_unmap_table(rsdt);
 		return -EINVAL;
 	}
+
+	// find any errata based on the RSDT
+	if (!acpi_find_errata(rsdt)) {
+		if (acpi_opts &amp; ACPI_DISABLED)
+			return -EINVAL;
+		else if (acpi_opts &amp; ACPI_CHIPSET_ONLY)
+			return -ENODEV;
+	}
+
 	// search RSDT for FACP
 	acpi_facp.table = NULL;
 	rsdt_entry = (u32 *) (rsdt + 1);



</body></email><email><emailId>20000427210740</emailId><senderName>Anthony Jenkins</senderName><senderEmail>anthonyj@ami.com</senderEmail><timestampReceived>2000-04-27 21:07:40-0400</timestampReceived><subject>Re: [Acpi] [PATCH] ACPI</subject><body>

Will this disable Linux ACPI support for _all_ AMI BIOSes matching the
AMI entry in acpi_errata_info[ ] ?

Andy Henroid wrote:

&gt; This patch is against 2.3.99-pre6
&gt;
&gt; Bug fix: Added an errata entry for AMI ACPI support
&gt; enabling trust-tables and copy-tables.  This entry
&gt; is specifically to fix an MSI6120 but should apply
&gt; more widely to systems with AMI BIOSs.
&gt;
&gt; -Andy
&gt;
&gt; __________________________________________________
&gt; Do You Yahoo!?
&gt; Talk to your friends online and get email alerts with Yahoo! Messenger.
&gt; http://im.yahoo.com/
&gt;
&gt;   ------------------------------------------------------------------------
&gt;                              Name: acpi_patch-2.3.99-6
&gt;    acpi_patch-2.3.99-6       Type: Plain Text (text/plain)
&gt;                       Description: acpi_patch-2.3.99-6

--
Anthony Jenkins
American Megatrends Inc.    http://www.ami.com
(770) 246-8600 ext 7241     mailto:AnthonyJ@ami.com



</body></email><email><emailId>20000427213006</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-27 21:30:06-0400</timestampReceived><subject>Re: [Acpi] [PATCH] ACPI</subject><body>

--- Anthony Jenkins &lt;AnthonyJ@ami.com&gt; wrote:
&gt; Will this disable Linux ACPI support for _all_ AMI
&gt; BIOSes matching the
&gt; AMI entry in acpi_errata_info[ ] ?

No.  If you take a look, the patch is not disabling
ACPI at all but helping Linux map the ACPI tables
on some AMI-based systems.

We are seeing some systems that have ACPI tables
in memory not reserved as ACPI table memory.  By
using trust-tables and copy-tables, we are telling
the ACPI driver that those tables really are there
(despite the ioremap failure) and just go ahead
and copy them out of the way (so that Linux doesn't
squash them).

It should be completely harmless.

-Andy


__________________________________________________
Do You Yahoo!?
Talk to your friends online and get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

</body></email><email><emailId>20000427224222</emailId><senderName>Anthony Jenkins</senderName><senderEmail>anthonyj@ami.com</senderEmail><timestampReceived>2000-04-27 22:42:22-0400</timestampReceived><subject>Re: [Acpi] [PATCH] ACPI</subject><body>

Andy Henroid wrote:

&gt; --- Anthony Jenkins &lt;AnthonyJ@ami.com&gt; wrote:
&gt; &gt; Will this disable Linux ACPI support for _all_ AMI
&gt; &gt; BIOSes matching the
&gt; &gt; AMI entry in acpi_errata_info[ ] ?
&gt;
&gt; No.  If you take a look, the patch is not disabling
&gt; ACPI at all but helping Linux map the ACPI tables
&gt; on some AMI-based systems.
&gt;
&gt; We are seeing some systems that have ACPI tables
&gt; in memory not reserved as ACPI table memory.

I think I understand... just wondering what we can do on our end to get
that resolved in future releases to make it easier on the OS people [he
said as if he had any pull around here :-) ].  Be a simple matter to pass
along suggestion to appropriate dept.

&gt; By
&gt; using trust-tables and copy-tables, we are telling
&gt; the ACPI driver that those tables really are there
&gt; (despite the ioremap failure) and just go ahead
&gt; and copy them out of the way (so that Linux doesn't
&gt; squash them).
&gt;
&gt; It should be completely harmless.
&gt;
&gt; -Andy
&gt;
&gt; __________________________________________________
&gt; Do You Yahoo!?
&gt; Talk to your friends online and get email alerts with Yahoo! Messenger.
&gt; http://im.yahoo.com/
&gt;
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

--
Anthony Jenkins
American Megatrends Inc.    http://www.ami.com
(770) 246-8600 ext 7241     mailto:AnthonyJ@ami.com



</body></email><email><emailId>20000427231128</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-04-27 23:11:28-0400</timestampReceived><subject>Re: [Acpi] [PATCH] ACPI</subject><body>

--- Anthony Jenkins &lt;AnthonyJ@ami.com&gt; wrote:

&gt; I think I understand... just wondering what we can
&gt; do on our end to get
&gt; that resolved in future releases to make it easier
&gt; on the OS people [he
&gt; said as if he had any pull around here :-) ].  Be a
&gt; simple matter to pass
&gt; along suggestion to appropriate dept.

The original problem was reported on an MSI6120
with AMI 1.9 BIOS but I suspect others will also
see this.  I do not have access to such a system
myself but it sounds like either the E820 BIOS
call is returning the wrong address map (perhaps
the ACPI tables are not marked as ACPI reserved)
or the Linux E820 code is not handling the
address map correctly.

The best AMI could do is verify that the address
map is generated correctly by E820 and then talk
to David Parsons (orc@pell.chi.il.us) and figure
out why his memory detection code is or is not
doing the right thing.

Thanks.  For vendors, being proactive is what is
going to assure that Linux runs best on your
BIOS, hardware, etc. first.

-Andy


__________________________________________________
Do You Yahoo!?
Talk to your friends online and get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

</body></email><email><emailId>20000101002357</emailId><senderName>Pavel Machek</senderName><senderEmail>pavel@suse.cz</senderEmail><timestampReceived>2000-01-01 00:23:57-0400</timestampReceived><subject>Re: [Acpi] AE_TIME error on EC access</subject><body>

Hi!

&gt; If you get an E_TIME failure, increment a timeout value by some amount (up
&gt; to a max) and retry.  If it finally works, use that timeout from then on.

And how is it better than using bigger timeout, always?!
								Pavel
-- 
Philips Velo 1: 1"x4"x8", 300gram, 60, 12MB, 40bogomips, linux, mutt,
details at http://atrey.karlin.mff.cuni.cz/~pavel/velo/index.html.


_______________________________________________
acpi maillist  -  acpi@phobos.fs.tum.de
https://phobos.fs.tum.de/mailman/listinfo/acpi

</body></email><email><emailId>20000101003347</emailId><senderName>Pavel Machek</senderName><senderEmail>pavel@ucw.cz</senderEmail><timestampReceived>2000-01-01 00:33:47-0400</timestampReceived><subject>Re: [Acpi] operating without a display active</subject><body>

Hi!

&gt; While people seem to be hot on this subject, I would like a way to
&gt; conveniently (or otherwise) deactivate my screen as quickly as possible
&gt; and leave it off.  I have no need for the backlit display and would very
&gt; much like to conserve the battery life by not activating the light.  I
&gt; don't care if hte screen itself is on (unless operating it without the
&gt; light would physically hurt it) but I would like the option of turning off
&gt; the light.
&gt; 
&gt; How can I do this using ACPI?

I'd like to know, too. When using ACPI, I found no way to turn off the
screen.
								Pavel
PS: If screen does turn  off for you on blank, just setterm some
very short time before screenblank.
-- 
Philips Velo 1: 1"x4"x8", 300gram, 60, 12MB, 40bogomips, linux, mutt,
details at http://atrey.karlin.mff.cuni.cz/~pavel/velo/index.html.



_______________________________________________
acpi maillist  -  acpi@phobos.fs.tum.de
http://phobos.fs.tum.de/mailman/listinfo/acpi

</body></email><email><emailId>20000101003912</emailId><senderName>Pavel Machek</senderName><senderEmail>pavel@suse.cz</senderEmail><timestampReceived>2000-01-01 00:39:12-0400</timestampReceived><subject>Re: [Acpi] RE: ACPI problems with Compaq notebook - how can I help?</subject><body>


Hi!

&gt; &gt; I have tried from 4ms to 100ms. 10ms worked too and I have left this
&gt; &gt; version as my booting kernel.
&gt; 
&gt; The next release of the EC driver will default to 10ms (versus 2ms, or
&gt; originally 1ms).  Looking into making this dynamic, and/or command-line
&gt; configurable.

Why? Nothing is wrong with 10ms on good hardware, and if bad hardware needs
10msec, it just needs it. No need to configure anything.
								Pavel
-- 
Philips Velo 1: 1"x4"x8", 300gram, 60, 12MB, 40bogomips, linux, mutt,
details at http://atrey.karlin.mff.cuni.cz/~pavel/velo/index.html.


_______________________________________________
acpi maillist  -  acpi@phobos.fs.tum.de
https://phobos.fs.tum.de/mailman/listinfo/acpi

</body></email><email><emailId>20000101005505</emailId><senderName>Pavel Machek</senderName><senderEmail>pavel@suse.cz</senderEmail><timestampReceived>2000-01-01 00:55:05-0400</timestampReceived><subject>Re: [Acpi] Increasing up to 10ms</subject><body>

Hi!

&gt; It works for me now with 10 ms (with 2 didn't) (COMPAQ PRESARIO 1201EA)
&gt; Now I have battery status and thermal status (not very fair thruly)
&gt; Also I've overriden bioses DSDT with fixing (\_SB) things as suggested by 
&gt; Paul.
&gt; 
&gt; Does anyone managed to have sleep working? when I send 1 to sleep, sleep led 
&gt; starts blinking and system freezes and awakes when I press power button but 
&gt; screen still on and hdd on too. So there is no any other sighn that it 
&gt; sleeps. Does anyone have S1 working OK?

Yep, S1 should work okay. I had problems with interrupt controller not 
awakening after S1 resume on my toshiba.
								Pavel
-- 
Philips Velo 1: 1"x4"x8", 300gram, 60, 12MB, 40bogomips, linux, mutt,
details at http://atrey.karlin.mff.cuni.cz/~pavel/velo/index.html.


_______________________________________________
acpi maillist  -  acpi@phobos.fs.tum.de
https://phobos.fs.tum.de/mailman/listinfo/acpi

</body></email><email><emailId>20000101012302</emailId><senderName>Pavel Machek</senderName><senderEmail>pavel@suse.cz</senderEmail><timestampReceived>2000-01-01 01:23:02-0400</timestampReceived><subject>Re: [ACPI] acpi as modules question</subject><body>

Hi!

&gt; &gt; this is highly encouraged, but you have to provide one kernel config
&gt; &gt; that actually works on every machine (not optimized, but that works)
&gt; &gt; (sort of *BSD's GENERIC)
&gt; &gt;
&gt; &gt; You need a working machine to compile your own kernel, don't you?
&gt; 
&gt; but you DON'T need a kernel with APM or ACPI to compile a new kernel.
&gt; 
&gt; *BSD GENERIC is designed to boot your machine so that you can compile a
&gt; new kernel. *all* linux distro kernels are designed to "just use our
&gt; kernel and dont bother compiling your own". That is definitely wrong.

Why? To get 5% speedup? Who cares about 5% on old machine acting as 
Xterminal?
								Pavel
-- 
Philips Velo 1: 1"x4"x8", 300gram, 60, 12MB, 40bogomips, linux, mutt,
details at http://atrey.karlin.mff.cuni.cz/~pavel/velo/index.html.


_______________________________________________
acpi maillist  -  acpi@phobos.fs.tum.de
https://phobos.fs.tum.de/mailman/listinfo/acpi

</body></email><email><emailId>20000101235924</emailId><senderName>Sven Kirmess</senderName><senderEmail>sven.kirmess@gmx.net</senderEmail><timestampReceived>2000-01-01 23:59:24-0400</timestampReceived><subject>[Acpi] Bug or new feature? 2.3.35 finally works. :-)</subject><body>

   CCed to Andy because I don't know when phobos will be up again.


   1.) Happy new year

   2.) I've installed 2.3.35 without any patch.

   When I build the kernel with ACPI support and without APM support
   the power-button or shutdown -h now still don't power off nor blank
   my system (P3B-F and TX97-XE).

   During boot the P3B-F writes

   ACPI: "ASUS" found at 0x000f59c0

   and the TX97-XE

   ACPI: "ASUS" found at 0x000f7a20


   There is no /proc/apm available, neither before nor after loading
   acpid (as expected).


   3.) When I build the kernel with ACPI _and_ APM (only APM, no
   special function activated) support, the power button or shutdown
   -h now powers down the system!


  During boot the P3B-F writes

   ACPI: "ASUS" found at 0x000f59c0
   apm: BIOS version 1.2 Flags 0x03 (Driver version 1.11)

   and the TX97-XE

   ACPI: "ASUS" found at 0x000f7a20
   apm: BIOS version 1.2 Flags 0x03 (Driver version 1.11)



   But, there is a /proc/apm (and a /proc/sys/acpi/*) available.
   Before _and_ after loading acpid! I didn't expect that...



   
   echo "1" &gt;/proc/sys/acpi/sleep

   crashes the P3B-F (power button doesn't work to wake the system)
   and has no effekt on my TX97-XE (the screen blanks for about 1 s).



   conclusion: 2.3.35 has the same functionality as 2.3.25 had. -&gt; it
   works on my system (pressing the power button actually halts and
   powers down my system), but I guess that's a bug... isn't it?

        

 Sven

-- 
PGP-Key-ID: 0x881BF222

</body></email><email><emailId>20000111234501</emailId><senderName>"Crispin Flowerday"</senderName><senderEmail>cehf2@cam.ac.uk</senderEmail><timestampReceived>2000-01-11 23:45:01-0400</timestampReceived><subject>[Acpi] 2.3.39 with patch</subject><body>

Having just got back to uni I have tryed the latest acpi stuff on my ABIT
BH6, with the dodgy acpi implementation, anyway poweroff still, not
surprisingly, does not work, but now

echo 1 &gt; sleep

The screen blanks, not much else happens, the screen remains blanked until I
hit a key when it comes back on, is that what is suppossed to happen? (BTW
does acpid need to be running when you do this?)

--
Crispin

*Windows leads to anger. Anger leads to hate. Hate leads to Linux*

</body></email><email><emailId>20000113235315</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-01-13 23:53:15-0400</timestampReceived><subject>Re: [Acpi] [Fwd: Power off handling.]</subject><body>

--- Sven Kirmess &lt;Sven.Kirmess@gmx.net&gt; wrote:
&gt; Hi Andy
&gt; 
&gt;    I found this patch on the Linux kernel ML. In
&gt; case, you've missed it, I post it here. Any comments
&gt; about that peace of code (I haven't tried it yet)?

Yes, I saw that patch.  I like the idea of unifying
some of the power off code but don't like the
dual ACPI/APM power off.  I also noticed that
Linus didn't end up including the patch in the
following kernel release.

Thanks,
Andy

__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000118205232</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-01-18 20:52:32-0400</timestampReceived><subject>Re: [Acpi] [PATCH] VIA 82c586 ACPI support (VP2, VP3, MVP3) (fwd)</subject><body>

--- Simon Richter &lt;Simon.Richter@phobos.fs.tum.de&gt;
wrote:

&gt; Although this is already older, I haven't seen it
&gt; mentioned on the list so
&gt; far.

&gt; ---------- Forwarded message ----------
&gt; Date: Mon, 10 Jan 2000 11:47:39 +0300
&gt; From: Andrey Panin &lt;pazke@orbita.don.sitek.net&gt;
&gt; Cc: Linux kernel mailng list.
&gt; &lt;linux-kernel@vger.rutgers.edu&gt;,
&gt;      VIA Linux mailing list &lt;linux-via@gtf.org&gt;
&gt; Subject: [PATCH] VIA 82c586 ACPI support (VP2, VP3,
&gt; MVP3)

Yes, I rolled Andrey's patch into the kernel already.
It is there as of 2.3.40-pre1

-Andy

__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000118210701</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-01-18 21:07:01-0400</timestampReceived><subject>Re: [Acpi] apm hangs</subject><body>

--- Will &lt;William.Palmer@durham.ac.uk&gt; wrote:
&gt; 
&gt; since 2.3.34/2.3.35 up until 2.3.39 (last tested)
&gt; when apm has been configured and the new kernel has
&gt; been installed the system seemingly hangs at startup
&gt; with the message
&gt; "ACPI C?" where ? is a number

&gt; pressing a key moves the boot process which is
&gt; _very_ slow a bit further.  this happens whether
&gt; acpi is on or off and apm is on.

Interesting.. As of 2.3.37, if ACPI is present,
APM should be disabled.  What does the kernel/boot
log show for ACPI and APM?

  ACPI: found XXXX at 0xXXXX
  apm: ....

-Andy

__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000119010944</emailId><senderName>Johannes Erdfelt</senderName><senderEmail>jerdfelt@valinux.com</senderEmail><timestampReceived>2000-01-19 01:09:44-0400</timestampReceived><subject>Re: [Acpi] poweroff on AMD IronGate C4 (MSI MS-6167 Rev 1.0b)</subject><body>

On Tue, Jan 18, 2000, Andy Henroid &lt;andy_henroid@yahoo.com&gt; wrote:
&gt; --- Johannes Erdfelt &lt;jerdfelt@valinux.com&gt; wrote:
&gt; &gt; On Tue, Jan 18, 2000, Andy Henroid
&gt; &gt; 
&gt; &gt; Why especially if UHCI? Why USB in general?
&gt; &gt; 
&gt; &gt; I share UHCI, Tulip and AIC7xxx all on one IRQ. I
&gt; &gt; even developed the UHCI
&gt; &gt; driver on this configuration.
&gt; &gt; 
&gt; &gt; PCI was designed to do that.
&gt; 
&gt; OK, perhaps "crazy" was a overstatement.  My point
&gt; is that it's a bad idea to share interrupts between
&gt; high bandwidth devices and slower devices like
&gt; ACPI.
&gt; 
&gt; I took a closer look and, you are right, the
&gt; time required to determine that the UHCI card was
&gt; not the source of an interrupt is minimal.  I
&gt; suppose I was thinking of the amount of time
&gt; to find which TD completed.  My mistake.

Yeah, UHCI just checks a register to see if it generated the IRQ. Checking
for the completed TD would take a while in some situations but we don't
do that anymore.

It's obviously better to not share IRQ's if you can, but this shouldn't
be causing the problems he's seeing.

JE

</body></email><email><emailId>20000119011812</emailId><senderName>Dieter =?iso-8859-1?Q?N=FCtzel?=</senderName><senderEmail>dieter.nuetzel@myokay.net</senderEmail><timestampReceived>2000-01-19 01:18:12-0400</timestampReceived><subject>[Fwd: [Acpi] poweroff on AMD IronGate C4 (MSI MS-6167 Rev 1.0b)]</subject><body>

Thank you Johannes for your reply!

--
Dieter N=FCtzel
Graduate Student, Computer Science

University of Hamburg
Department of Computer Science
Cognitive Systems Group
Vogt-K=F6lln-Stra=DFe 30
D-22527 Hamburg, Germany

email: nuetzel@kogs.informatik.uni-hamburg.de
@home: dieter.nuetzel@myokay.net




X-Mozilla-Status2: 00000000
Message-ID: &lt;3885103B.EA055AB2@myokay.net&gt;
Date: Wed, 19 Jan 2000 02:15:39 +0100
From: Dieter =?iso-8859-1?Q?NÃ¼tzel?= &lt;dieter.nuetzel@myokay.net&gt;
Organization: DN
X-Mailer: Mozilla 4.7 [en] (X11; I; Linux 2.3.40pre4 i686)
X-Accept-Language: de-DE, de, en-US, en-GB, en
To: Andy Henroid &lt;andy_henroid@yahoo.com&gt;
Subject: Re: [Acpi] poweroff on AMD IronGate C4 (MSI MS-6167 Rev 1.0b)
References: &lt;20000119004525.8261.qmail@web1302.mail.yahoo.com&gt;
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: Quoted-Printable

Andy Henroid wrote:

&gt; --- Dieter NÃ¼tzel &lt;dieter.nuetzel@myokay.net&gt; wrote:
&gt;
&gt; &gt; If I enable ACPI my machine hangs during system
&gt; &gt; boot. Are there any problems with shared interrupts
&gt; &gt; and ACPI? ACPI, my EtherExpress card and the USB
&gt; &gt; device share the IRQ 9. System hangs during
&gt; &gt; ethernet initialization.
&gt;
&gt; It's possible your GPE status register won't clear
&gt; and the ACPI driver is spinning waiting for it to
&gt; clear.  I can add a timeout to the next patch but
&gt; still you are going to see an awful performance
&gt; hit sharing between ACPI, with relatively slow
&gt; register accesses, and any high bandwidth device.
&gt;
&gt; Sharing an interrupt between a net card and
&gt; USB controller (especially if UHCI) is
&gt; crazy much less also sharing with ACPI.

Thanks for your fast response:-)

Do you have any hint or tip how I can change the annoying USB/ACPI
interrupt use?
Should I disable it?
Winbloze "tell" me that I can't change them:-(
System is dual boot (only sometimes Win98SE, if some friends need my
help...:-)
I use all (!!!) IRQs:-(

SunWave1&gt;cat /proc/pci
PCI devices found:
  Bus  0, device   0, function  0:
    Host bridge: Advanced Micro Devices [AMD] IronGate Host (rev 35).
      Master Capable.  Latency=32.
      Prefetchable 32 bit memory at 0xc0000000 [0xcfffffff].
      Prefetchable 32 bit memory at 0xe0100000 [0xe0100fff].
      I/O at 0xe000 [0xe003].
  Bus  0, device   1, function  0:
    PCI bridge: PCI device 1022:7007 (Advanced Micro Devices [AMD]) (rev
1).
      Master Capable.  Latency=32.  Min Gnt=14.
  Bus  0, device   7, function  0:
    ISA bridge: Advanced Micro Devices [AMD] Viper ISA (rev 1).
  Bus  0, device   7, function  1:
    IDE interface: Advanced Micro Devices [AMD] Viper IDE (rev 3).
      Master Capable.  Latency=32.
      I/O at 0xf000 [0xf00f].
  Bus  0, device   7, function  3:
    Bridge: Advanced Micro Devices [AMD] Viper ACPI (rev 3).
      Master Capable.  Latency=32.
  Bus  0, device   7, function  4:
    USB Controller: Advanced Micro Devices [AMD] Viper USB (rev 6).
      IRQ 9.
      Master Capable.  Latency=16.  Max Lat=80.
      Non-prefetchable 32 bit memory at 0xe0101000 [0xe0101fff].
  Bus  0, device   8, function  0:
    Ethernet controller: Intel Corporation 82557 [Ethernet Pro 100] (rev
4).
      IRQ 9.
      Master Capable.  Latency=32.  Min Gnt=8.Max Lat=56.
      Prefetchable 32 bit memory at 0xe0103000 [0xe0103fff].
      I/O at 0xe400 [0xe41f].
      Non-prefetchable 32 bit memory at 0xe0000000 [0xe00fffff].
  Bus  0, device   9, function  0:
    SCSI storage controller: Adaptec AIC-7881U (rev 1).
      IRQ 11.
      Master Capable.  Latency=32.  Min Gnt=8.Max Lat=8.
      I/O at 0xe800 [0xe8ff].
      Non-prefetchable 32 bit memory at 0xe0102000 [0xe0102fff].
  Bus  1, device   5, function  0:
    VGA compatible controller: 3Dfx Interactive, Inc. Voodoo 3 (rev 1).
      IRQ 11.
      Non-prefetchable 32 bit memory at 0xd8000000 [0xd9ffffff].
      Prefetchable 32 bit memory at 0xdc000000 [0xddffffff].
      I/O at 0xd000 [0xd0ff].

Damned SCSI and VGA (Voodoo3 3000) share IRQ 11. ACPI (I know from BIOS;
not compiled in, see my previous post...), USB and Ethernet Pro 100
share IRQ 9.

SunWave1&gt;cat /proc/interrupts
           CPU0
  0:    3098760          XT-PIC  timer
  1:      60160          XT-PIC  keyboard
  2:          0          XT-PIC  cascade
  4:     921706          XT-PIC  serial
  5:        733          XT-PIC  ft    (high speed floppy tape)
  6:         11          XT-PIC  floppy
  7:          2          XT-PIC  parport0
  8:          1          XT-PIC  rtc
  9:      15492          XT-PIC  eth0
 10:        772          XT-PIC  soundblaster
 11:     200131          XT-PIC  aic7xxx
 12:     385355          XT-PIC  PS/2 Mouse
 13:          1          XT-PIC  fpu
NMI:          0
ERR:          0

IRQ 3 is free, hurray!? I do not have two serial ports.
Which device can use IRQ 3? PC's are very limited...

Have you any clue?

Regards,
    Dieter

--
Dieter NÃ¼tzel
Graduate Student, Computer Science

University of Hamburg
Department of Computer Science
Cognitive Systems Group
Vogt-KÃ¶lln-StraÃe 30
D-22527 Hamburg, Germany

email: nuetzel@kogs.informatik.uni-hamburg.de
@home: dieter.nuetzel@myokay.net



</body></email><email><emailId>20000119195232</emailId><senderName>David Woodhouse</senderName><senderEmail>dwmw2@infradead.org</senderEmail><timestampReceived>2000-01-19 19:52:32-0400</timestampReceived><subject>Re: [Acpi] Re: Power-off handling.</subject><body>

andy_henroid@yahoo.com said:
&gt;  Looking at the APM code, it seems like it does. From apm()
&gt; apm_engage_power_management() is called which makes a call into the
&gt; BIOS. 

apm_bios_init() doesn't get that far #ifdef CONFIG_SMP. It exits right after 
it finds the entry points. I'd not suggest that CONFIG_ACPI did anything 
different.



--
dwmw2

</body></email><email><emailId>20000120170551</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-01-20 17:05:51-0400</timestampReceived><subject>Re: [Acpi] Re: 2.3.40-5 -- "apm" no longer recognizes that I have an APM-enabled kernel.</subject><body>

--- Blu3Viper &lt;david@killerlabs.com&gt; wrote:
&gt; &gt; &gt; If the ACPI user space tools (e.g. acpid) do
&gt; &gt; &gt; anything useful, it isn't documented.
&gt; &gt; 
&gt; &gt; acpid reads the ACPI tables and uploads important
&gt; &gt; information about how to do CPU power states,
&gt; &gt; S-states, and handles power/sleep button presses.
&gt; &gt; If acpid does not run, the ACPI driver won't
&gt; &gt; do much useful.
&gt; 
&gt; 
&gt; ok, after a short search...where are the acpi tools?
&gt; 
&gt; i'm a wee bit nervous not having battery status on
&gt; my laptop now :)

acpid is available from

 
http://www.geocities.com/SiliconValley/Hardware/3165/

OK, there's clearly a need for an ACPI README or
FAQ here.  If anyone would like to contribute
one I'd be happy to have it.

-Andy

__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000120181801</emailId><senderName>Jamie Lokier</senderName><senderEmail>jamie.lokier@cern.ch</senderEmail><timestampReceived>2000-01-20 18:18:01-0400</timestampReceived><subject>[Acpi] Re: 2.3.40-5 -- "apm" no longer recognizes that I have an APM-ena bled kernel.</subject><body>

Andy Henroid wrote:
&gt; &gt; That's not really informative because power
&gt; &gt; consumption varies so much with what the
&gt; &gt; computer's doing.
&gt; 
&gt; You want to know the idle power saving difference
&gt; between APM and ACPI, so for the test, you would
&gt; need to turn off APM suspend, leave you system idle,
&gt; and control external variables like screen
&gt; brightness.  This would give you some idea of the
&gt; power savings difference between APM and ACPI when
&gt; your system is actually active.

I could do that more easily if I had access to the battery time that
apmd is able to display.  That gives some indication of power
consumption.  Is that information available through ACPI?

I suppose I could simply leave the system completely idle for the ~3.5
hours it takes to discharge when idle, from a full battery, and see when
it gives up.  I've only ever run out of juice once in real use, and that
involved a couple of hours downloading stuff over a network while
compiling kernels.  (These Toshibas are great :-)

I'd have to make it especially idle for a sensible test.  Mount all fses
read only, that sort of thing.  To make sure the disk can spin down.

APM knows to shut down shortly before the battery is exhausted.  If the
"give up" signal is routed through ACPI, that's not going to be such a
helpful comparison is it?

Running a non-idle test is much more difficult.  When I'm actually using
the computer, the battery life figures from apmd jump around by a factor
of two depending on what I've been doing in the last few minutes.

So sustaining comparable non-idle behaivour is going to be very
difficult.

-- Jamie

</body></email><email><emailId>20000125174649</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-01-25 17:46:49-0400</timestampReceived><subject>[Acpi] LinuxWorld BOF</subject><body>

I apologize for the short notice but I've arranged
for an informal ACPI4Linux Birds of a Feather
at LinuxWorld on Thursday Feb 3rd from 5:30-7pm.
If anyone will be at LinuxWorld and is interested,
please come by.

Thanks,
Andy

  
__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000126223141</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-01-26 22:31:41-0400</timestampReceived><subject>[Acpi] Re: [PATCH] ACPI</subject><body>

--- Linus Torvalds &lt;torvalds@transmeta.com&gt; wrote:

&gt; shut down: I just suspect it should be handled by
&gt; a UPS-like notification rather than being part of
&gt; the driver power management thing (ie the APM
&gt; low-battery event should _not_ be considered to
&gt; be an event similar to a suspend or resume,
&gt; it should have a different interface altogether).

Right, device drivers should only need to know
the power state for their specific device(s) and
not need to know what the rest of the system
is doing.  Low battery can be handled at a higher
level (eg. by shutting down or suspending the
system which will result in individual device
suspends)

Driver isolation allows for centralized power
management policy and individual power management
of devices.

Thanks,
Andy

__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000127021930</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-01-27 02:19:30-0400</timestampReceived><subject>[Acpi] Strange days...</subject><body>

Hi,

as you may have noticed, phobos was down the last two days. This was the result
of a combination of two bad things: A script kiddy tried to break in, and the
harddisk ran full. So I took the opportunity to do a complete reinstall.

The mail system is, as you can see, back up. The webserver is to follow today,
when I get access to the backups again (broken FDDI cable between us and the
ADSM server). FTP will need some time, as well as logins and CVS.

The only thing left for me to do is to apologize for the inconvenience.

   Simon

</body></email><email><emailId>20000129023341</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-01-29 02:33:41-0400</timestampReceived><subject>Re: [Acpi] [PATCH] ACPI</subject><body>

On Thu, 27 Jan 2000, Nils Faerber wrote:

&gt; Hmm ... but what about actions that might the kernel take to save power?

The kernel notifies the policy manager daemon? :-)

   Simon

</body></email><email><emailId>20000119212855</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-01-19 21:28:55-0400</timestampReceived><subject>[Acpi] Re: 2.3.40-5 -- "apm" no longer recognizes that I have an APM-ena bled kernel.</subject><body>

&gt; -----Original Message-----
&gt; From: Jamie Lokier
&gt; [mailto:lkd@tantalophile.demon.co.uk] 
&gt; Sent: Tuesday, January 18, 2000 3:18 PM
&gt; To: Miles Lane
&gt; Cc: Linux Kernel
&gt; Subject: Re: 2.3.40-5 -- "apm" no longer recognizes
&gt; that I have an
&gt; APM-enabled kernel.
&gt; 
&gt; 
&gt; Miles Lane wrote:
&gt;&gt; When I run the command "apm", I receive an error
&gt;&gt; stating:
&gt;&gt; 	No APM support in kernel
&gt;&gt; This in spite of having APM enabled in my .config
&gt;&gt; file:
&gt; 
&gt; That's because you've got ACPI enabled too.  ACPI
&gt; now overrides APM if it is compiled in.
&gt; 
&gt; I don't know why it does that -- APM seems to work
&gt; fine with ACPI in earlier kernels, and now suspend
&gt; takes longer and the clock isn't restored properly
&gt; after a suspend.

APM is disabled by ACPI as both can not be enabled
at once.  On some platforms you can get away with
APM engaged (the most common reason is to compensate
for a non-working S5 implementation and fallback to
APM power off) but it's not safe to do. If you want
to use APM, turn off or disable (kernel command
line "acpi=off") ACPI.

&gt; The solution: turn off ACPI.  I can't see what the
&gt; point in using the ACPI support is at the moment. 

On systems with working ACPI implementations,
ACPI gets you CPU power states (saves power
when CPU is idle), S5 (soft off), and power/sleep
button support.  APM additionally provides suspend
and battery status and these features are
currently incomplete for ACPI but on the way.

&gt; If the ACPI user space tools (e.g. acpid) do
&gt; anything useful, it isn't documented.

acpid reads the ACPI tables and uploads important
information about how to do CPU power states,
S-states, and handles power/sleep button presses.
If acpid does not run, the ACPI driver won't
do much useful.

&gt; For me the only effect of acpid is to prevent
&gt; suspends from suspending at all.  Nothing useful
&gt; like battery life estimation, clock updating,
&gt; that sort of thing.

Battery support is coming.  It's a bit more
complicated to do than APM, hence the delay.
You have to have a completely working AML
interpreter and, for many systems, an
embedded controller driver.

&gt; A lot of work is obviously going into the kernel
&gt; ACPI driver.  Of course I'd like to minimise power
&gt; consumption on my laptop.  So I'm wondering, how
&gt; is that kernel driver getting tested? Is there a
&gt; user space tool I haven't found?

Most of the problems we are seeing are just
discovered by people running with ACPI on
various systems.  There is really no better
way to test things like C-states, S-states,
and buttons other than by hand.

-Andy


__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000120083556</emailId><senderName>Jamie Lokier</senderName><senderEmail>lkd@tantalophile.demon.co.uk</senderEmail><timestampReceived>2000-01-20 08:35:56-0400</timestampReceived><subject>[Acpi] Re: 2.3.40-5 -- "apm" no longer recognizes that I have an APM-ena bled kernel.</subject><body>

Andy Henroid wrote:
&gt; &gt; If the ACPI user space tools (e.g. acpid) do
&gt; &gt; anything useful, it isn't documented.
&gt; 
&gt; acpid reads the ACPI tables and uploads important
&gt; information about how to do CPU power states,
&gt; S-states, and handles power/sleep button presses.
&gt; If acpid does not run, the ACPI driver won't
&gt; do much useful.

Ok.  So I run acpid, and I get this:

	acpid: started
	acpid: FACP @ 0x03fe0054
	acpid: DSDT @ 0x03fe00c8
	acpid: S0 SLP_TYP (0x0500)
	acpid: S1 SLP_TYP (0x0700)
	acpid: S2 not supported
	acpid: S3 SLP_TYP (0x0700)
	acpid: S4 SLP_TYP (0x0000)
	acpid: S5 SLP_TYP (0x0700)

Prior to starting acpid, when APM is disabled by ACPI, the laptop does
suspend after 5 seconds or so of beeping).  (In earlier kernels where
APM is not disabled, the laptop suspends immediately and apmd can
restore the clock).

The only visible effect is that the laptop won't suspend any more.
Something obviously got set because when acpid is killed, the laptop
still doesn't suspend.

I didn't find any acpid documentation so if it's doing anything else, I
don't know about it.

&gt; &gt; The solution: turn off ACPI.  I can't see what the
&gt; &gt; point in using the ACPI support is at the moment. 
&gt; 
&gt; On systems with working ACPI implementations,
&gt; ACPI gets you CPU power states (saves power
&gt; when CPU is idle), S5 (soft off), and power/sleep
&gt; button support.  APM additionally provides suspend
&gt; and battery status and these features are
&gt; currently incomplete for ACPI but on the way.

My question is: is there any advantage for me in enabling ACPI in the kernel,
and/or running acpid at the moment?  Will the laptop consume less power
than when it's using APM?

thanks,
-- Jamie

</body></email><email><emailId>20000120172614</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-01-20 17:26:14-0400</timestampReceived><subject>[Acpi] Re: 2.3.40-5 -- "apm" no longer recognizes that I have an APM-ena bled kernel.</subject><body>

--- Jamie Lokier &lt;lkd@tantalophile.demon.co.uk&gt; wrote:

&gt; The only visible effect is that the laptop won't
&gt; suspend any more.
&gt; Something obviously got set because when acpid is
&gt; killed, the laptop
&gt; still doesn't suspend.

Right, APM is not being engaged when it is
overriden by ACPI so I wouldn't expect APM
suspend to work at all.  Further, once acpid
is started, ACPI is enabled in the BIOS.  After
that any attempt to use APM features is going
to fail (yes, even after acpid is killed).

&gt; My question is: is there any advantage for me in
&gt; enabling ACPI in the kernel, and/or running acpid
&gt; at the moment?  Will the laptop consume less power
&gt; than when it's using APM?

Depends on how good of an APM/ACPI implementation
you have.  ACPI C-states definitely save power
and most ACPI laptops support at least C1 and C2
(C3 is the deepest processor power state).  Some
APM implementations allow the CPU to be slowed.

I don't know what the actual power savings of
C-states vs. APM CPU slowing are on your system.
It might be interesting to test it out and see
which causes your battery to last longer.

-Andy

__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000120173553</emailId><senderName>Jamie Lokier</senderName><senderEmail>lkd@tantalophile.demon.co.uk</senderEmail><timestampReceived>2000-01-20 17:35:53-0400</timestampReceived><subject>[Acpi] Re: 2.3.40-5 -- "apm" no longer recognizes that I have an APM-ena bled kernel.</subject><body>

Andy Henroid wrote:
&gt; &gt; The only visible effect is that the laptop won't suspend any more.
&gt; &gt; Something obviously got set because when acpid is killed, the laptop
&gt; &gt; still doesn't suspend.
&gt; 
&gt; Right, APM is not being engaged when it is
&gt; overriden by ACPI so I wouldn't expect APM
&gt; suspend to work at all.

Ah, but it does.  With older kernels it's immediate because of course
APM is enabled.  With newer kernels, when I close the lid the laptop
beeps as it does for a suspend, but carries on beeping for about 5
seconds.  I presume it's waiting for the all-clear from the kernel which
it doesn't get.  Then it suspends anyway.

The clock is screwed of course because apmd is not there to restore it
later.

What's interesting is that after running acpid, the laptop doesn't do
that any more.  Closing the lid makes it beep once and not try to shut
down.  That corresponds to the "don't shut down when I close the lid"
mode that is settable via the keyboard.  Trying to change back to the
"do shut down" mode using the keyboard doesn't work.

&gt; Further, once acpid
&gt; is started, ACPI is enabled in the BIOS.  After
&gt; that any attempt to use APM features is going
&gt; to fail (yes, even after acpid is killed).

Ah, it calls the BIOS.  No wonder the default APM facilities are
deactivated.

&gt; I don't know what the actual power savings of
&gt; C-states vs. APM CPU slowing are on your system.
&gt; It might be interesting to test it out and see
&gt; which causes your battery to last longer.

That's not really informative because power consumption varies so much
with what the computer's doing.  The estimates from apmd vary by a
factor of two depending on how bright the screen is, whether I dragged a
window recently, whether the disk is spun down, that sort of thing.
(I'm not quite sure why the disk ever spins down, what with atimes and
cron, but mysteriously it does ever so occasionally).

-- Jamie

</body></email><email><emailId>20000120173730</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-01-20 17:37:30-0400</timestampReceived><subject>Re: [Acpi] Re: 2.3.40-5 -- "apm" no longer recognizes that I have</subject><body>

On Thu, 20 Jan 2000, Andy Henroid wrote:

&gt; Right, APM is not being engaged when it is
&gt; overriden by ACPI so I wouldn't expect APM
&gt; suspend to work at all.  Further, once acpid
&gt; is started, ACPI is enabled in the BIOS.  After
&gt; that any attempt to use APM features is going
&gt; to fail (yes, even after acpid is killed).

According to the spec, it is possible to go back to legacy mode, if the
system supports legacy at all. If you'd initialize and engage APM after
disabling ACPI, it should work, at least theoretically... :-)

   Simon

PGP public key available from ftp://phobos.fs.tum.de/pub/pgp/geier.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1

</body></email><email><emailId>20000120180526</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-01-20 18:05:26-0400</timestampReceived><subject>[Acpi] Re: 2.3.40-5 -- "apm" no longer recognizes that I have an APM-ena bled kernel.</subject><body>

--- Jamie Lokier &lt;lkd@tantalophile.demon.co.uk&gt; wrote:

&gt;&gt; Further, once acpid
&gt;&gt; is started, ACPI is enabled in the BIOS.  After
&gt;&gt; that any attempt to use APM features is going
&gt;&gt; to fail (yes, even after acpid is killed).
&gt; 
&gt; Ah, it calls the BIOS.  No wonder the default APM
&gt; facilities are deactivated.

Yup.  acpid running causes ACPI mode to be entered.
ACPI events are routed through the ACPI system
control interrupt (eg. power button presses get
sent to the ACPI driver instead of being handled
directly by the system)  This also stops APM
features from working.

&gt;&gt; I don't know what the actual power savings of
&gt;&gt; C-states vs. APM CPU slowing are on your system.
&gt;&gt; It might be interesting to test it out and see
&gt;&gt; which causes your battery to last longer.
&gt; 
&gt; That's not really informative because power
&gt; consumption varies so much with what the
&gt; computer's doing.

You want to know the idle power saving difference
between APM and ACPI, so for the test, you would
need to turn off APM suspend, leave you system idle,
and control external variables like screen
brightness.  This would give you some idea of the
power savings difference between APM and ACPI when
your system is actually active.

-Andy

__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000120181733</emailId><senderName>Andy Henroid</senderName><senderEmail>andy_henroid@yahoo.com</senderEmail><timestampReceived>2000-01-20 18:17:33-0400</timestampReceived><subject>Re: [Acpi] Re: 2.3.40-5 -- "apm" no longer recognizes that I have an APM-ena bled kernel.</subject><body>

--- Simon Richter &lt;Simon.Richter@phobos.fs.tum.de&gt;
wrote:
&gt; On Thu, 20 Jan 2000, Andy Henroid wrote:
&gt; 
&gt; &gt; Right, APM is not being engaged when it is
&gt; &gt; overriden by ACPI so I wouldn't expect APM
&gt; &gt; suspend to work at all.  Further, once acpid
&gt; &gt; is started, ACPI is enabled in the BIOS.  After
&gt; &gt; that any attempt to use APM features is going
&gt; &gt; to fail (yes, even after acpid is killed).
&gt; 
&gt; According to the spec, it is possible to go back to
&gt; legacy mode, if the system supports legacy at all.
&gt; If you'd initialize and engage APM after disabling
&gt; ACPI, it should work, at least theoretically... :-)

Right, you can turn off ACPI and return to legacy
mode.  Unfortunately, I've encountered systems that
are completely broken for ACPI disable.  The lack
of testing for this feature is somewhat understandable
as most times the operating system turns on ACPI and
leaves it on through power off.

-Andy

__________________________________________________
Do You Yahoo!?
Talk to your friends online with Yahoo! Messenger.
http://im.yahoo.com

</body></email><email><emailId>20000126213326</emailId><senderName>Linus Torvalds</senderName><senderEmail>torvalds@transmeta.com</senderEmail><timestampReceived>2000-01-26 21:33:26-0400</timestampReceived><subject>[Acpi] Re: [PATCH] ACPI</subject><body>


On Wed, 26 Jan 2000, Andy Henroid wrote:
&gt;
&gt; The only APM events that any driver is actually
&gt; handling are suspend and resume and
&gt; user/sys/critical are always handled as one.
&gt; So I believe I can safely map APM_XXX_SUSPEND to
&gt; PM_SUSPEND and APM_XXX_RESUME to PM_RESUME
&gt; and just discard all of the other APM events.
&gt; Or do you forsee the need to propagate any
&gt; additional APM events (eg. APM_LOW_BATTERY)?

Right now, I don't believe the LOW_BATTERY etc more esoteric events are
actually _used_ for anything, so it's probably a very secondary concern at
best. But we do want to have some way to gracefully shut down: I just
suspect it should be handled by a UPS-like notification rather than being
part of the driver power management thing (ie the APM low-battery event
should _not_ be considered to be an event similar to a suspend or resume,
it should have a different interface altogether).

		Linus

</body></email><email><emailId>20001201182629</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-12-01 18:26:29-0400</timestampReceived><subject>RE: [Acpi] ACPI on Compaq Presario 1400: experiences</subject><body>

Glad to hear it's mostly working. I should mention that we have not been
working on sleep support. While this is on our todo list, interpreter fixes
have taken higher priority, and probably will continue to do so in the next
few months.

Didn't want anyone to have unrealistic expectations, but I'm glad to hear
that what we *have* been working on is functioning properly.

;-)

Regards -- Andy

&gt; From: Erich Schubert [mailto:erich.schubert@mucl.de]

&gt; Current ACPI works ok:

&gt; - Sleep mode worked after bootup (battery full, on-line).
&gt; - After pulling the power plug sleep mode no longer worked (wakes up
&gt; immedeately)
&gt; - When i turn on power supply it does not work again
&gt; - even when the battery is fully charged again sleep does not work any
&gt; more.
&gt; 
&gt; What i miss most is suspend-to-disk.

</body></email><email><emailId>20000904172717</emailId><senderName>Santiago Garcia Mantinan</senderName><senderEmail>manty@i.am</senderEmail><timestampReceived>2000-09-04 17:27:17-0400</timestampReceived><subject>[Acpi] QDI Titanium I is it posible?</subject><body>

Hi!

I'm trying to make acpi work on one of my systems, what I'd like to know is:
if it would be posible to turn off this board from Linux using acpi, even if
it is not posible right now and I have to work on it myself, I'm putting
here everything I have found out about this using actual 2.4.0-test7
drivers, hope this is enough for you to tell me ;-)

Motherboard is:

QDI Titanium I P51430TX-250, Chipset Intel Triton 82439 TX PIIX4 BIOS maker
is AWARD

This is the grep of my kernel log:

Linux version 2.4.0-test7 (root@mantianito) (gcc version 2.95.2 20000220
 (Debian GNU/Linux)) #3 Thu Aug 31 22:09:21 CEST 2000
 BIOS-e820: 000000000009fc00 @ 0000000000000000 (usable)
 BIOS-e820: 0000000000000400 @ 000000000009fc00 (reserved)
 BIOS-e820: 0000000000010000 @ 00000000000f0000 (reserved)
 BIOS-e820: 0000000000010000 @ 00000000ffff0000 (reserved)
 BIOS-e820: 0000000005f00000 @ 0000000000100000 (usable)
ACPI: found PIIX4 at 0x4f00
scsi0 : sym53c8xx - version 1.6b
Serial driver version 5.02 (2000-08-09) with MANY_PORTS SHARE_IRQ SERIAL_PCI
 ISAPNP enabled
PPP generic driver version 2.4.1

And the problem is that I have tried both the version with the AML
interpreter and without it and none of them works, I believe they cannot
find the DSDT tables, at least that's for sure without the interpreter, with
the interpreter ACPI won't load, so I cannot gather any info.

This is all I have managed to get out of it:

WITHOUT INTERPRETER:

Kernel shows:
ACPI: found PIIX4 at 0x4f00

I get the /proc/sys/acpi, so I start acpid in debug mode, this is the
output:
acpid: started
acpid: ACPI Subsystem version [Aug 31 2000]
acpid: FACP loaded from /proc/sys/acpi/
acpid:  tbutils-0240:
acpid: *** Error: Invalid ACPI table checksum
acpid: nsapinam-0058:
acpid: DSDT is not in memory
acpid: OsdBreakpoint: Fatal error encountered
acpid: cannot load ACPI namespace

This is what the FACP is like:
Signature:        FACP
Length:           116
Revision:         0x00
Checksum:         0x00
OEMID:
OEM Table ID:
OEM Revision:     0x00000000
Creator ID:
Creator Revision: 0x00000000
FIRMWARE_CTRL:    0x00000000
DSDT:             0x00000000
INT_MODEL:        0x00
SCI_INT:          9
SMI_CMD:          0x000000b2
ACPI_ENABLE:      0xf0
ACPI_DISABLE:     0xf1
S4BIOS_REQ:       0xf2
PM1a_EVT_BLK:     0x00004f00
PM1b_EVT_BLK:     0x00000000
PM1a_CNT_BLK:     0x00004f04
PM1b_CNT_BLK:     0x00000000
PM2_CNT_BLK:      0x00000022
PM_TMR_BLK:       0x00004f08
GPE0_BLK:         0x00004f0c
GPE1_BLK:         0x00000000
PM1_EVT_LEN:      4
PM1_CNT_LEN:      2
PM2_CNT_LEN:      1
PM_TM_LEN:        4
GPE0_BLK_LEN:     4
GPE1_BLK_LEN:     0
GPE1_BASE:        0
P_LVL2_LAT:       65535
P_LVL3_LAT:       65535
FLUSH_SIZE:       0
FLUSH_STRIDE:     0
DUTY_OFFSET:      0
DUTY_WIDTH:       0
DAY_ALRM:         0x00
MON_ALRM:         0x00
CENTURY:          0x00
Flags:            0x00000000

WITH INTERPRETER:

Kernel just says:
ACPI:         -0061: &lt;7&gt;ACPI: *** Warning: RSDP structure not found
ACPI: found "Intel Corporation 82371AB PIIX4 ACPI" at 0x4f00
ACPI: enable failed
ACPI:         -0550: &lt;7&gt;ACPI: *** Success: Entire namespace and objects deleted

And I get no /proc/sys/acpi :-(

Well, I'm really interesting in making this work, and I'd like to help, I
have helped with other drivers, so, well, if there is anything I can do,
just tell me!

Regards...
-- 
Manty/BestiaTester -&gt; http://manty.net

</body></email><email><emailId>20001004150145</emailId><senderName>brendan burns</senderName><senderEmail>bburns@wso.williams.edu</senderEmail><timestampReceived>2000-10-04 15:01:45-0400</timestampReceived><subject>[Acpi] Omnibook 2100</subject><body>

Folks,
I've got an HP Omnibook 2100 with 2.4.0-test9-pre7 running on it.  ACPI
works fine for sleeping/restarting the computer but it doesn't see my
battery at all.  I have a great deal of programing experience but I've
never really dealt with ACIPI before can someone give me some pointers to
where I might start debugging this problem?  (the battery is recognized by
apmd.)

Thanks
Brendan

</body></email><email><emailId>20001117192208</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-11-17 19:22:08-0400</timestampReceived><subject>[Acpi] Source Release updated (11-15-2000)</subject><body>

This will be posted tonight 6pm PST at
http://developer.intel.com/technology/iapc/acpi/downloads.htm

Linux-specific changes:
- Power-off should work on more systems.
- User-mode ACPI support has been removed.
- ACPI chipset support has been removed.
- Better boot messages.

The configuration changes will also require an additional patch, which will
also be on the website.

(I'm thinking of releasing all the Linux stuff in patch form only in the
future. Should work better. Sound ok?)

Core changes:
ACPI 2.0 table support with backwards support for ACPI 1.0 and the 0.71
extensions.  Note: although we can read ACPI 2.0 BIOS tables, the AML 
interpreter does NOT have support for the new 2.0 ASL grammar terms
at this time.

All ACPI hardware access is via the GAS structures in the ACPI 2.0 FADT.  

All physical memory addresses across all platforms are now 64 bits wide.
Logical address width remains dependent on the platform (i.e., "void *").

AcpiOsMapMemory interface changed to a 64-bit physical address.

The AML interpreter integer size is now 64 bits, as per the ACPI 2.0
specification.

For backwards compatibility with ACPI 1.0, ACPI tables with a revision
number
less than 2 use 32-bit integers only.

Fixed a problem where the evaluation of OpRegion operands did not always
resolve them to numbers properly.

Regards -- Andy

----------------------------
Andrew Grover
Intel/TRL/MAL
andrew.grover@intel.com

</body></email><email><emailId>20001118224638</emailId><senderName>Jurgen Botz</senderName><senderEmail>jurgen@botz.org</senderEmail><timestampReceived>2000-11-18 22:46:38-0400</timestampReceived><subject>Re: [Acpi] Source Release updated (11-15-2000)</subject><body>

"Grover, Andrew" wrote:
&gt; This will be posted tonight 6pm PST at
&gt; http://developer.intel.com/technology/iapc/acpi/downloads.htm

It hasn't appeared on the page yet, but I got file:

  acpica-linux-debug-20001115.tar.gz

from the ftp directory the page points to.  However,
it doesn't work for me... the kernel fails to links with:

  drivers/acpi/acpi.o(.text+0x28ad1): undefined reference to `acpi_get_rsdp_ptr'

grepping through the source I don't find any definition of
this, just a call in driver.c.

- Jurgen

</body></email><email><emailId>20000920103914</emailId><senderName></senderName><senderEmail>chen.jack-tao@inventec.com</senderEmail><timestampReceived>2000-09-20 10:39:14-0400</timestampReceived><subject>[Acpi] Shut down problem</subject><body>

&gt;  Dear sir:
&gt;  I use kernel 2.4.0, and it can find my ACPI table.
&gt;  It says support S1,..S5.
&gt;  When I want to shutdown my system.
&gt;  I use the command  "init 0"
&gt;  It will shutdown all drivers. Final it display "ACPI: S5 fail".
&gt;  But it still can power off the system.
&gt;  I would like to know what situation the kernel will display "S5 fail".
&gt;  Then I can modify my BIOS code to fix this error.
&gt; 
&gt;                                                                thanks
&gt; 
&gt; 
&gt; 
&gt; 
&gt;   Best Regards
&gt;   Jack Chen   Â³Â¯Â§ÃÂ°Â¶
&gt;  Senior Engineer
&gt;  BIOS Design Dept.  R&amp;D II  PC Division
&gt;  INVENTEC CORPORATION
&gt;  TEL : +886-3-3900000#2433
&gt;  &lt;mailto:chen.jack-tao@inventec.com&gt;
&gt; 
&gt; 
&gt; 
&gt; 

[Attachment #3 (text/html)]

&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN"&gt;
&lt;HTML&gt;
&lt;HEAD&gt;
&lt;META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=big5"&gt;
&lt;META NAME="Generator" CONTENT="MS Exchange Server version 5.5.2448.0"&gt;
&lt;TITLE&gt;Shut down problem&lt;/TITLE&gt;
&lt;/HEAD&gt;
&lt;BODY&gt;
&lt;BR&gt;

&lt;P&gt;&lt;FONT SIZE=2 FACE="Courier New"&gt;Â Dear sir:&lt;/FONT&gt;
&lt;BR&gt;&lt;FONT SIZE=2 FACE="Courier New"&gt;Â I use kernel 2.4.0, and it can find my ACPI \
table.&lt;/FONT&gt; &lt;BR&gt;&lt;FONT SIZE=2 FACE="Courier New"&gt;Â It says support \
S1,..S5.&lt;/FONT&gt; &lt;BR&gt;&lt;FONT SIZE=2 FACE="Courier New"&gt;Â When I want to shutdown my \
system.&lt;/FONT&gt; &lt;BR&gt;&lt;FONT SIZE=2 FACE="Courier New"&gt;Â I use the commandÂ  \
"init 0"&lt;/FONT&gt; &lt;BR&gt;&lt;FONT SIZE=2 FACE="Courier New"&gt;Â It will shutdown \
all drivers. Final it display "&lt;/FONT&gt;&lt;FONT COLOR="#0000FF" SIZE=2 FACE="Courier \
New"&gt;ACPI:&lt;/FONT&gt; &lt;FONT SIZE=2 FACE="Courier New"&gt;S5 fail".&lt;/FONT&gt; &lt;BR&gt;&lt;FONT \
SIZE=2 FACE="Courier New"&gt;Â But it still can power off the system.&lt;/FONT&gt; \
&lt;BR&gt;&lt;FONT SIZE=2 FACE="Courier New"&gt;Â I would like to know what situation the \
kernel will display "S5 fail".&lt;/FONT&gt; &lt;BR&gt;&lt;FONT SIZE=2 FACE="Courier \
New"&gt;Â Then I can modify my BIOS code to fix this error.&lt;/FONT&gt; &lt;/P&gt;

&lt;P&gt;&lt;FONT SIZE=2 FACE="Courier \
New"&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â &amp;nb \
sp;Â Â Â Â Â Â Â Â Â Â Â Â Â Â  \
;Â Â Â Â Â Â Â Â Â Â Â Â Â Â &amp; \
nbsp;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  \
thanks&lt;/FONT&gt; &lt;/P&gt;
&lt;BR&gt;
&lt;BR&gt;
&lt;BR&gt;

&lt;P&gt;&lt;FONT COLOR="#FF0000" FACE="Lucida Handwriting"&gt;Â  Best Regards&lt;/FONT&gt;&lt;BR&gt;
&lt;FONT COLOR="#000000" FACE="Lucida Handwriting"&gt;Â  Jack Chen&lt;/FONT&gt;&lt;FONT \
COLOR="#000000" FACE="Courier New"&gt;Â &lt;/FONT&gt;Â &lt;FONT COLOR="#000000" \
FACE="Lucida Handwriting"&gt;&lt;B&gt;&lt;I&gt;&lt;/I&gt;&lt;/B&gt;&lt;/FONT&gt;&lt;B&gt;&lt;I&gt; &lt;FONT COLOR="#000000" SIZE=4 \
FACE="Â¼ÃÂ·Â¢ÃÃ©"&gt;Â³Â¯Â§ÃÂ°Â¶&lt;/FONT&gt;&lt;BR&gt; &lt;/I&gt;&lt;/B&gt;&lt;I&gt;&lt;/I&gt;&lt;FONT COLOR="#000000" SIZE=2 \
FACE="Courier New"&gt;&lt;/FONT&gt;Â &lt;FONT COLOR="#000000" SIZE=2 FACE="Â²ÃÂ©ÃºÃÃ©"&gt;Senior \
Engineer&lt;BR&gt; &lt;/FONT&gt;&lt;FONT COLOR="#000000" SIZE=2 FACE="Courier \
New"&gt;&lt;/FONT&gt;Â &lt;FONT COLOR="#000000" SIZE=2 FACE="Â²ÃÂ©ÃºÃÃ©"&gt;BIOS Design \
Dept.&lt;/FONT&gt;&lt;FONT COLOR="#000000" SIZE=2 FACE="Courier New"&gt;&lt;/FONT&gt;Â &lt;FONT \
COLOR="#000000" SIZE=2 FACE="Â²ÃÂ©ÃºÃÃ©"&gt; R&amp;D II&lt;/FONT&gt;&lt;FONT COLOR="#000000" SIZE=2 \
FACE="Courier New"&gt;&lt;/FONT&gt;Â &lt;FONT COLOR="#000000" SIZE=2 FACE="Â²ÃÂ©ÃºÃÃ©"&gt; PC \
Division&lt;BR&gt; &lt;/FONT&gt;&lt;FONT COLOR="#000000" SIZE=2 FACE="Courier \
New"&gt;&lt;/FONT&gt;Â &lt;FONT COLOR="#000000" SIZE=2 FACE="Â²ÃÂ©ÃºÃÃ©"&gt;INVENTEC CORPORATION&lt;BR&gt; \
&lt;/FONT&gt;&lt;FONT COLOR="#000000" SIZE=2 FACE="Courier New"&gt;&lt;/FONT&gt;Â &lt;FONT \
COLOR="#000000" SIZE=2 FACE="Â²ÃÂ©ÃºÃÃ©"&gt;TEL : +886-3-3900000#2433&lt;/FONT&gt; &lt;BR&gt;&lt;FONT \
COLOR="#000000" SIZE=2 FACE="Courier New"&gt;&lt;/FONT&gt;&lt;U&gt;&lt;/U&gt;&lt;U&gt;Â &lt;FONT \
COLOR="#0000FF" SIZE=2 FACE="Â²ÃÂ©ÃºÃÃ©"&gt;&lt;&lt;A \
HREF="mailto:chen.jack"&gt;mailto:chen.jack&lt;/A&gt;&lt;/FONT&gt;&lt;FONT COLOR="#0000FF" SIZE=2 \
FACE="Courier New"&gt;-tao&lt;/FONT&gt;&lt;FONT COLOR="#0000FF" SIZE=2 \
FACE="Â²ÃÂ©ÃºÃÃ©"&gt;@inventec.com&gt;&lt;/FONT&gt;&lt;/U&gt;&lt;BR&gt; &lt;BR&gt;

&lt;/P&gt;
&lt;BR&gt;

&lt;/BODY&gt;
&lt;/HTML&gt;



</body></email><email><emailId>20000920170201</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-09-20 17:02:01-0400</timestampReceived><subject>RE: [Acpi] Shut down problem</subject><body>

Hi Jack,
 
This is an issue with the code, not your BIOS. That line appears to be
extraneous, and we can probably just remove it. ;-)
 
Regards -- Andy
 
-----Original Message-----
From: Chen.Jack-Tao@inventec.com [mailto:Chen.Jack-Tao@inventec.com]
Sent: Wednesday, September 20, 2000 3:39 AM
To: 'acpi@phobos.fs.tum.de'
Subject: [Acpi] Shut down problem




 Dear sir: 
 I use kernel 2.4.0, and it can find my ACPI table. 
 It says support S1,..S5. 
 When I want to shutdown my system. 
 I use the command  "init 0" 
 It will shutdown all drivers. Final it display "ACPI: S5 fail". 
 But it still can power off the system. 
 I would like to know what situation the kernel will display "S5 fail". 
 Then I can modify my BIOS code to fix this error. 

                                                               thanks 


[Attachment #3 (text/html)]

&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"&gt;
&lt;HTML&gt;&lt;HEAD&gt;
&lt;META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1252"&gt;
&lt;TITLE&gt;Shut down problem&lt;/TITLE&gt;

&lt;META content="MSHTML 5.00.3103.1000" name=GENERATOR&gt;&lt;/HEAD&gt;
&lt;BODY&gt;
&lt;DIV&gt;&lt;FONT color=#0000ff face=Arial size=2&gt;&lt;SPAN class=750175816-20092000&gt;Hi 
Jack,&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT color=#0000ff face=Arial size=2&gt;&lt;SPAN 
class=750175816-20092000&gt;&lt;/SPAN&gt;&lt;/FONT&gt;Â &lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT color=#0000ff face=Arial size=2&gt;&lt;SPAN class=750175816-20092000&gt;This 
is an issue with the code, not your BIOS. That line appears to be extraneous, 
and we can probably just remove it. ;-)&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT color=#0000ff face=Arial size=2&gt;&lt;SPAN 
class=750175816-20092000&gt;&lt;/SPAN&gt;&lt;/FONT&gt;Â &lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT color=#0000ff face=Arial size=2&gt;&lt;SPAN 
class=750175816-20092000&gt;Regards -- Andy&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;Â &lt;/DIV&gt;
&lt;DIV align=left class=OutlookMessageHeader dir=ltr&gt;&lt;FONT face=Tahoma 
size=2&gt;-----Original Message-----&lt;BR&gt;&lt;B&gt;From:&lt;/B&gt; Chen.Jack-Tao@inventec.com 
[mailto:Chen.Jack-Tao@inventec.com]&lt;BR&gt;&lt;B&gt;Sent:&lt;/B&gt; Wednesday, September 20, 
2000 3:39 AM&lt;BR&gt;&lt;B&gt;To:&lt;/B&gt; 'acpi@phobos.fs.tum.de'&lt;BR&gt;&lt;B&gt;Subject:&lt;/B&gt; [Acpi] 
Shut down problem&lt;BR&gt;&lt;BR&gt;&lt;/FONT&gt;&lt;/DIV&gt;&lt;BR&gt;
&lt;P&gt;&lt;FONT face="Courier New" size=2&gt;Â Dear sir:&lt;/FONT&gt; &lt;BR&gt;&lt;FONT 
face="Courier New" size=2&gt;Â I use kernel 2.4.0, and it can find my ACPI 
table.&lt;/FONT&gt; &lt;BR&gt;&lt;FONT face="Courier New" size=2&gt;Â It says support 
S1,..S5.&lt;/FONT&gt; &lt;BR&gt;&lt;FONT face="Courier New" size=2&gt;Â When I want to 
shutdown my system.&lt;/FONT&gt; &lt;BR&gt;&lt;FONT face="Courier New" size=2&gt;Â I use the 
commandÂ  "init 0"&lt;/FONT&gt; &lt;BR&gt;&lt;FONT face="Courier New" size=2&gt;Â It will 
shutdown all drivers. Final it display "&lt;/FONT&gt;&lt;FONT color=#0000ff 
face="Courier New" size=2&gt;ACPI:&lt;/FONT&gt; &lt;FONT face="Courier New" size=2&gt;S5 
fail".&lt;/FONT&gt; &lt;BR&gt;&lt;FONT face="Courier New" size=2&gt;Â But it still can power 
off the system.&lt;/FONT&gt; &lt;BR&gt;&lt;FONT face="Courier New" size=2&gt;Â I would like to 
know what situation the kernel will display "S5 fail".&lt;/FONT&gt; &lt;BR&gt;&lt;FONT 
face="Courier New" size=2&gt;Â Then I can modify my BIOS code to fix this 
error.&lt;/FONT&gt; &lt;/P&gt;
&lt;P&gt;&lt;FONT face="Courier New" 
size=2&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â &amp; \
nbsp;Â Â Â Â Â Â Â Â Â Â Â Â Â &amp;nb \
sp;Â Â Â Â Â Â Â Â Â Â Â Â Â Â  \
;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  \
 thanks&lt;/FONT&gt; &lt;/P&gt;&lt;/BODY&gt;&lt;/HTML&gt;



</body></email><email><emailId>20001202002310</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-12-02 00:23:10-0400</timestampReceived><subject>[Acpi] Source release updated: (12-01-2000)</subject><body>

This will be posted Monday 6pm PST at
http://developer.intel.com/technology/iapc/acpi/downloads.htm
(Sorry for the delay in posting, but I wanted to send this notice today
regardless)

Linux-specific changes:
--------------------
None

Core changes:
--------------------
Fixed a problem where method invocations within the ASL definition of
both OperationRegions and CreateXXXFields did not work properly.  The
symptom was an AE_AML_OPERAND_TYPE during initialization of the
region/field:

  nsinit-0209: AE_AML_OPERAND_TYPE while getting region arguments [DEBG]
  ammonad-0284: Exec_monadic2_r/Not: bad operand(s) (0x3005)

Fixed a problem where operators with more than one nested subexpression
would fail.  The symptoms were varied, by mostly AE_AML_OPERAND_TYPE
errors.  This was actually a rather serious problem that has gone
unnoticed until now.

  Subtract (Add (1,2), Multiply (3,4))

Fixed a problem where AcpiGetHandle didn't quite get fixed in the previous
build (The prefix part of a relative path was handled incorrectly).

Fixed a problem where Operation Region initialization failed if the
operation region name was a "namepath" instead of a simple "nameseg".
Symptom was an AE_NO_OPERAND error.

Fixed a problem where an assignment to a local variable via the indirect
RefOf mechanism only worked for the first such assignment.  Subsequent
assignments were ignored.

Fixed redundant address handler init resulting in AE_EXIST message (7).

Outstanding issues:
--------------------
Shutdown still doesn't work for everyone.
Potential race because of sleep_on()
oops in ns_get_parent_object()
System sluggish due to an acpi_idle issue?

Regards -- Andy


----------------------------
Andrew Grover
Intel/TRL/MAL
andrew.grover@intel.com

</body></email><email><emailId>20001205060319</emailId><senderName>Takanori Watanabe</senderName><senderEmail>takawata@shidahara1.planet.sci.kobe-u.ac.jp</senderEmail><timestampReceived>2000-12-05 06:03:19-0400</timestampReceived><subject>Re: [Acpi] Source release updated: (12-01-2000)</subject><body>

In message &lt;4148FEAAD879D311AC5700A0C969E8905DE4DE@orsmsx35.jf.intel.com&gt;, "Gro
ver, Andrew" wrote:

&gt;Core changes:
&gt;--------------------
&gt;Fixed a problem where method invocations within the ASL definition of
(Snip)
&gt;Fixed redundant address handler init resulting in AE_EXIST message (7).

What about ToBCD op definition range?(Currently 0-9999)
For 16bit systems? I don't think it is not written explicitly
in the spec. At least my machine do not work unless it is more tolerant.
In my machine, the operation is used to convert Battery S/N , written 
in integer, to string and store in _BIF.

Takanori Watanabe
&lt;a href="http://www.planet.sci.kobe-u.ac.jp/~takawata/key.html"&gt;
Public Key&lt;/a&gt;
Key fingerprint =  2C 51 E2 78 2C E1 C5 2D  0F F1 20 A3 11 3A 62 2A 

</body></email><email><emailId>20001205225356</emailId><senderName>David Woodhouse</senderName><senderEmail>dwmw2@infradead.org</senderEmail><timestampReceived>2000-12-05 22:53:56-0400</timestampReceived><subject>Re: [Acpi] Source release updated: (12-01-2000)</subject><body>

On Fri, 1 Dec 2000, Grover, Andrew wrote:

&gt; Outstanding issues:
&gt; --------------------
&gt; Potential race because of sleep_on()

I'll fix yours if you fix mine :)

My system no longer manages to load the ACPI namespace:

ACPI: System description tables found
    ACPI-0415: *** Warning: Reference \_PR_.CPU0 AML 7B4 not found
    ACPI-0092: *** Error: Acpi_load_tables: Could not load namespace: AE_NOT_FOUND
    ACPI-0101: *** Error: Acpi_load_tables: Could not load tables: AE_NOT_FOUND
ACPI: System description table load failed

The warning about \_PR_.CPU0 was there before. Not the subsequent errors
though. This is an Abit BP6 with RU BIOS - I've posted DSDT dump before
but it's also at http://www.infradead.org/~dwmw2/dsdtdisasm-bp6-rubios.gz

Patch to remove sleep_on() below:

--- drivers/acpi/sys.c.sleep_on	Tue Dec  5 21:51:44 2000
+++ drivers/acpi/sys.c	Tue Dec  5 22:50:48 2000
@@ -129,6 +129,8 @@
 acpi_enter_sx(acpi_sstate_t state)
 {
 	struct acpi_enter_sx_ctx ctx;
+	DECLARE_WAITQUEUE(wait, current);
+	int ret = 0;

 	if ((STRNCMP(acpi_fadt.header.signature, ACPI_FADT_SIGNATURE, ACPI_SIG_LEN) != 0)
 	    || acpi_slptyp[state] == ACPI_INVALID)
@@ -137,14 +139,22 @@
 	init_waitqueue_head(&amp;ctx.wait);
 	ctx.state = state;

+	set_current_state(TASK_INTERRUPTIBLE);
+	add_wait_queue(&amp;ctx.wait, &amp;wait);
+
 	if (acpi_os_queue_for_execution(0, acpi_enter_sx_async, &amp;ctx))
-		return -1;
+		ret = -1;
+
+	if (!ret)
+		schedule();
+
+	set_current_state(TASK_RUNNING);
+	remove_wait_queue(&amp;ctx.wait, &amp;wait);

-	interruptible_sleep_on(&amp;ctx.wait);
-	if (signal_pending(current))
-		return -ERESTARTSYS;
+	if (!ret &amp;&amp; signal_pending(current))
+		ret = -ERESTARTSYS;

-	return 0;
+	return ret;
 }

 int
--- drivers/acpi/driver.c.sleep_on	Tue Dec  5 21:51:26 2000
+++ drivers/acpi/driver.c	Tue Dec  5 22:35:14 2000
@@ -195,6 +195,7 @@

 	for (;;) {
 		unsigned long flags;
+		DECLARE_WAITQUEUE(wait, current);

 		// we need an atomic exchange here
 		spin_lock_irqsave(&amp;acpi_event_lock, flags);
@@ -203,11 +204,15 @@
 		spin_unlock_irqrestore(&amp;acpi_event_lock, flags);
 		event_state = acpi_event_state;

-		if (event_status)
-			break;
+		set_current_state(TASK_INTERRUPTIBLE);
+		add_wait_queue(&amp;acpi_event_wait, &amp;wait);
+
+		if (!event_status)
+			schedule();

-		// wait for an event to arrive
-		interruptible_sleep_on(&amp;acpi_event_wait);
+		remove_wait_queue(&amp;acpi_event_wait, &amp;wait);
+		set_current_state(TASK_RUNNING);
+
 		if (signal_pending(current))
 			return -ERESTARTSYS;
 	}
@@ -474,12 +479,21 @@
 	 * run
 	 */
 	for (;;) {
-		interruptible_sleep_on(&amp;acpi_thread_wait);
+		DECLARE_WAITQUEUE(wait, current);
+
+		set_current_state(TASK_INTERRUPTIBLE);
+		add_wait_queue(&amp;acpi_thread_wait, &amp;wait);
+
+		if (!acpi_thread_run)
+			schedule();
+
+		remove_wait_queue(&amp;acpi_thread_wait, &amp;wait);
+		set_current_state(TASK_RUNNING);
+
 		if (signal_pending(current))
 			break;
-		do {
-			run_task_queue(&amp;acpi_thread_run);
-		} while (acpi_thread_run);
+
+		run_task_queue(&amp;acpi_thread_run);
 	}

 	/*

-- 
dwmw2

</body></email><email><emailId>20001206004400</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-12-06 00:44:00-0400</timestampReceived><subject>RE: [Acpi] Source release updated: (12-01-2000)</subject><body>

Thanks for your fix. I tried your previous patch, and the event generated by
a power button press no longer showed up, but I'll give this one a shot.

Are you using the debug version? That might provide some more info.

The AE_NOT_FOUND looks like the same issue Brendan Burns reported. BTW, can
you send me your binary DSDT? (I think the utilities will do it, or cat
/proc/sys/acpi/dsdt to a file.)*

Regards -- Andy

ps If you or anyone else wanted to implement the stubbed-out semaphore
functions in os.c, that would also be really helpful. Note that we need a
wait_semaphore that takes a timeout. ;-))

* Why do I keep asking people for this? Because we have a Windows utility
(AcpiExec) that runs against an extracted DSDT and catches pure interpreter
errors in a more-debuggable environment. It's part of the Windows source
drop, btw.

&gt; From: David Woodhouse [mailto:dwmw2@infradead.org]
&gt; On Fri, 1 Dec 2000, Grover, Andrew wrote:
&gt; &gt; Outstanding issues:
&gt; &gt; --------------------
&gt; &gt; Potential race because of sleep_on()
&gt; 
&gt; I'll fix yours if you fix mine :)
&gt; 
&gt; My system no longer manages to load the ACPI namespace:
&gt; 
&gt; ACPI: System description tables found
&gt;     ACPI-0415: *** Warning: Reference \_PR_.CPU0 AML 7B4 not found
&gt;     ACPI-0092: *** Error: Acpi_load_tables: Could not load 
&gt; namespace: AE_NOT_FOUND
&gt;     ACPI-0101: *** Error: Acpi_load_tables: Could not load 
&gt; tables: AE_NOT_FOUND
&gt; ACPI: System description table load failed
&gt; 
&gt; The warning about \_PR_.CPU0 was there before. Not the 
&gt; subsequent errors
&gt; though. This is an Abit BP6 with RU BIOS - I've posted DSDT 
&gt; dump before
&gt; but it's also at 
&gt; http://www.infradead.org/~dwmw2/dsdtdisasm-bp6-rubios.gz
&gt; 
&gt; Patch to remove sleep_on() below:
&gt; 
&gt; --- drivers/acpi/sys.c.sleep_on	Tue Dec  5 21:51:44 2000
&gt; +++ drivers/acpi/sys.c	Tue Dec  5 22:50:48 2000
&gt; @@ -129,6 +129,8 @@
&gt;  acpi_enter_sx(acpi_sstate_t state)
&gt;  {
&gt;  	struct acpi_enter_sx_ctx ctx;
&gt; +	DECLARE_WAITQUEUE(wait, current);
&gt; +	int ret = 0;
&gt; 
&gt;  	if ((STRNCMP(acpi_fadt.header.signature, 
&gt; ACPI_FADT_SIGNATURE, ACPI_SIG_LEN) != 0)
&gt;  	    || acpi_slptyp[state] == ACPI_INVALID)
&gt; @@ -137,14 +139,22 @@
&gt;  	init_waitqueue_head(&amp;ctx.wait);
&gt;  	ctx.state = state;
&gt; 
&gt; +	set_current_state(TASK_INTERRUPTIBLE);
&gt; +	add_wait_queue(&amp;ctx.wait, &amp;wait);
&gt; +
&gt;  	if (acpi_os_queue_for_execution(0, acpi_enter_sx_async, &amp;ctx))
&gt; -		return -1;
&gt; +		ret = -1;
&gt; +
&gt; +	if (!ret)
&gt; +		schedule();
&gt; +
&gt; +	set_current_state(TASK_RUNNING);
&gt; +	remove_wait_queue(&amp;ctx.wait, &amp;wait);
&gt; 
&gt; -	interruptible_sleep_on(&amp;ctx.wait);
&gt; -	if (signal_pending(current))
&gt; -		return -ERESTARTSYS;
&gt; +	if (!ret &amp;&amp; signal_pending(current))
&gt; +		ret = -ERESTARTSYS;
&gt; 
&gt; -	return 0;
&gt; +	return ret;
&gt;  }
&gt; 
&gt;  int
&gt; --- drivers/acpi/driver.c.sleep_on	Tue Dec  5 21:51:26 2000
&gt; +++ drivers/acpi/driver.c	Tue Dec  5 22:35:14 2000
&gt; @@ -195,6 +195,7 @@
&gt; 
&gt;  	for (;;) {
&gt;  		unsigned long flags;
&gt; +		DECLARE_WAITQUEUE(wait, current);
&gt; 
&gt;  		// we need an atomic exchange here
&gt;  		spin_lock_irqsave(&amp;acpi_event_lock, flags);
&gt; @@ -203,11 +204,15 @@
&gt;  		spin_unlock_irqrestore(&amp;acpi_event_lock, flags);
&gt;  		event_state = acpi_event_state;
&gt; 
&gt; -		if (event_status)
&gt; -			break;
&gt; +		set_current_state(TASK_INTERRUPTIBLE);
&gt; +		add_wait_queue(&amp;acpi_event_wait, &amp;wait);
&gt; +
&gt; +		if (!event_status)
&gt; +			schedule();
&gt; 
&gt; -		// wait for an event to arrive
&gt; -		interruptible_sleep_on(&amp;acpi_event_wait);
&gt; +		remove_wait_queue(&amp;acpi_event_wait, &amp;wait);
&gt; +		set_current_state(TASK_RUNNING);
&gt; +
&gt;  		if (signal_pending(current))
&gt;  			return -ERESTARTSYS;
&gt;  	}
&gt; @@ -474,12 +479,21 @@
&gt;  	 * run
&gt;  	 */
&gt;  	for (;;) {
&gt; -		interruptible_sleep_on(&amp;acpi_thread_wait);
&gt; +		DECLARE_WAITQUEUE(wait, current);
&gt; +
&gt; +		set_current_state(TASK_INTERRUPTIBLE);
&gt; +		add_wait_queue(&amp;acpi_thread_wait, &amp;wait);
&gt; +
&gt; +		if (!acpi_thread_run)
&gt; +			schedule();
&gt; +
&gt; +		remove_wait_queue(&amp;acpi_thread_wait, &amp;wait);
&gt; +		set_current_state(TASK_RUNNING);
&gt; +
&gt;  		if (signal_pending(current))
&gt;  			break;
&gt; -		do {
&gt; -			run_task_queue(&amp;acpi_thread_run);
&gt; -		} while (acpi_thread_run);
&gt; +
&gt; +		run_task_queue(&amp;acpi_thread_run);
&gt;  	}
&gt; 
&gt;  	/*
&gt; 
&gt; -- 
&gt; dwmw2
&gt; 
&gt; 
&gt; 

</body></email><email><emailId>20001206080310</emailId><senderName>David Woodhouse</senderName><senderEmail>dwmw2@infradead.org</senderEmail><timestampReceived>2000-12-06 08:03:10-0400</timestampReceived><subject>RE: [Acpi] Source release updated: (12-01-2000)</subject><body>

On Tue, 5 Dec 2000, Grover, Andrew wrote:

&gt; Thanks for your fix. I tried your previous patch, and the event generated by
&gt; a power button press no longer showed up, but I'll give this one a shot.

Errr, yeah. Too stupid, sorry. Incremental patch:

--- driver.c.asd	Wed Dec  6 07:57:14 2000
+++ driver.c	Wed Dec  6 07:51:57 2000
@@ -193,19 +193,19 @@
 		return 0;
 	}

-	for (;;) {
+	while(!event_status) {
 		unsigned long flags;
 		DECLARE_WAITQUEUE(wait, current);

+		set_current_state(TASK_INTERRUPTIBLE);
+		add_wait_queue(&amp;acpi_event_wait, &amp;wait);
+
 		// we need an atomic exchange here
 		spin_lock_irqsave(&amp;acpi_event_lock, flags);
 		event_status = acpi_event_status;
 		acpi_event_status = 0;
 		spin_unlock_irqrestore(&amp;acpi_event_lock, flags);
 		event_state = acpi_event_state;
-
-		set_current_state(TASK_INTERRUPTIBLE);
-		add_wait_queue(&amp;acpi_event_wait, &amp;wait);

 		if (!event_status)
 			schedule();


&gt; Are you using the debug version? That might provide some more info.

Not yet. I'll try it.

&gt; The AE_NOT_FOUND looks like the same issue Brendan Burns reported. BTW, can
&gt; you send me your binary DSDT? (I think the utilities will do it, or cat
&gt; /proc/sys/acpi/dsdt to a file.)*

/proc/sys/acpi doesn't exist. Is this because it failed to load the
namespace? If so, that's a little suboptimal. I'll revert to an earlier
kernel and take a copy.

&gt; ps If you or anyone else wanted to implement the stubbed-out semaphore
&gt; functions in os.c, that would also be really helpful. Note that we need a
&gt; wait_semaphore that takes a timeout. ;-))

Hmmm. I reckon we have about a whelk's chance in a supernova of getting a
'real' down_timeout() into 2.4 at this stage. I'll poke that that later
and see if we can fake it.

-- 
dwmw2

</body></email><email><emailId>20001206081718</emailId><senderName>David Woodhouse</senderName><senderEmail>dwmw2@infradead.org</senderEmail><timestampReceived>2000-12-06 08:17:18-0400</timestampReceived><subject>RE: [Acpi] Source release updated: (12-01-2000)</subject><body>

On Tue, 5 Dec 2000, Grover, Andrew wrote:

&gt; Are you using the debug version? That might provide some more info.

Not a lot more.

ACPI Subsystem version [Dec  6 2000]
ACPI: System description tables found
 tbxface-0089: ACPI Tables successfully loaded
dsobject-0454: *** Warning: Reference \_PR_.CPU0 AML 7B4 not found
 tbxface-0097: *** Error: Acpi_load_tables: Could not load namespace: AE_NOT_FOUND
 tbxface-0106: *** Error: Acpi_load_tables: Could not load tables: AE_NOT_FOUND
ACPI: System description table load failed

-- 
dwmw2

</body></email><email><emailId>20001206235535</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-12-06 23:55:35-0400</timestampReceived><subject>RE: [Acpi] Source release updated: (12-01-2000)</subject><body>

Ok, your BIOS reports the mobo as capable of having 2 processors, named CPU_
and CPU1. (Note that both of these are always there, even if only one cpu is
installed.)

Method \_TZ.THRM._PSL references the nonexistent CPU0, and ACPI fails to
load as a result. I was wrong, this is not the same problem Brendan Burns
was having - the AE_NOT_FOUNDs stem from CPU0 not being found, not any sort
of PCI Config problem.

This would be an easy one for a BIOS engineer at Abit to fix. My first
thought would be to contact Abit (technical@abit-usa.com ?) and that would
probably be better coming from the person who actually bought it. ;-)

Regards -- Andy

&gt; From: David Woodhouse [mailto:dwmw2@infradead.org]
&gt; ACPI Subsystem version [Dec  6 2000]
&gt; ACPI: System description tables found
&gt;  tbxface-0089: ACPI Tables successfully loaded
&gt; dsobject-0454: *** Warning: Reference \_PR_.CPU0 AML 7B4 not found
&gt;  tbxface-0097: *** Error: Acpi_load_tables: Could not load 
&gt; namespace: AE_NOT_FOUND
&gt;  tbxface-0106: *** Error: Acpi_load_tables: Could not load 
&gt; tables: AE_NOT_FOUND
&gt; ACPI: System description table load failed

</body></email><email><emailId>20001201182951</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-12-01 18:29:51-0400</timestampReceived><subject>RE: [Acpi] Vaio Z505LS</subject><body>

&gt; From: Christopher J Mason [mailto:cmason@cmu.edu]

&gt; ACPI: support found
&gt; ACPI: PBLK 0 @ 0x8010:0
&gt; ACPI: S1 supported
&gt; ACPI: S5 supported

This seems to indicate that you are not using the latest version of the ACPI
interpreter. Could you try it using the latest stuff?
http://developer.intel.com/technology/iapc/acpi/downloads.htm

Thanks -- Andy

</body></email><email><emailId>20001201183337</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-12-01 18:33:37-0400</timestampReceived><subject>[Acpi] Cardbus / ACPI issues?</subject><body>

I've had second-hand reports of an issue with ACPI and cardbus, but I
haven't enough about this to actually diagnose the problem.

Is anyone experiencing this?

If so, could you please provide some more details, so we can get this fixed
ASAP?

Thanks -- Regards -- Andy

----------------------------
Andrew Grover
Intel/TRL/MAL
andrew.grover@intel.com

</body></email><email><emailId>20001203182344</emailId><senderName>Adam Harrison</senderName><senderEmail>adam@antispin.org</senderEmail><timestampReceived>2000-12-03 18:23:44-0400</timestampReceived><subject>[Acpi] Failure on ASUS K7M w/ 2.4.0-test11</subject><body>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1


Hi,

I've recently been trying to get ACPI working again on my ASUS K7M based 
Athlon system. In the past I have had the no-AML interpreter version working 
with acpid-052200 on 2.4.0-test5 to the extent that the system would power 
itself off on shutdown. I never tested the S1 functionality at that time.

Having installed acpid-071100 I enabled the AML interpreter in 2.4.0-test11, 
installed the new kernel and found that ACPI was not detected (no 
/proc/sys/acpi, acpid reports no ACPI found). After reading the mailing list 
archive I found out about the latest releases, and downloaded 
acpica-linux-debug-20001115.tar.gz and acpi.diff. I replaced 
linux/drivers/acpi as instructed and attempted to apply acpi.diff, which 
failed 1 of 3 hunks. Inspection revealed the patch to 
linux/arch/i386/kernel/acpi.c had failed, so I applied the patch by hand. 
I've included this hacked up file (so it can be verified for correctness) at 
the end of this mail. I also needed to modify line 31 of 
/usr/include/linux/acpi.h to read

__u64 acpi_get_rsdp_ptr(void);

instead of

u64 acpi_get_rsdp_ptr(void);

in order to get acpid to compile.

Here are the ACPI related messages I now receive from the kernel:

BIOS-provided physical RAM map:
 BIOS-e820: 000000000009fc00 @ 0000000000000000 (usable)
 BIOS-e820: 0000000000000400 @ 000000000009fc00 (reserved)
 BIOS-e820: 0000000000010000 @ 00000000000f0000 (reserved)
 BIOS-e820: 000000000fef0000 @ 0000000000100000 (usable)
 BIOS-e820: 0000000000008000 @ 000000000fff0000 (ACPI data)
 BIOS-e820: 0000000000008000 @ 000000000fff8000 (ACPI NVS)                   

ACPI Subsystem version [Dec  3 2000]
ACPI: System description tables found
 tbutils-0196: Table signature at cfff0000 [C151BF04] has invalid characters
breakpoint: Fatal error encountered
 tbutils-0198: *** Warning: Invalid table signature found
   tbget-0520: Get_table_rsdt: Could not get the RSDT, AE_BAD_SIGNATURE
breakpoint: Fatal error encountered
 tbxface-0076: *** Error: Acpi_load_tables: Could not load RSDT: 
AE_BAD_SIGNATURE
 tbxface-0106: *** Error: Acpi_load_tables: Could not load tables: 
AE_BAD_SIGNATURE
ACPI: System description table load failed                                    
  
Please let me know if you'd like me provide more information or perform more 
diagnostics at my end. I'm going to try reflashing my BIOS with the latest 
tomorrow to see if that helps - will keep you posted.

Cheers,

Adam.

- --- HAND PATCHED linux/arch/i386/kernel/acpi.c
/*
 *  acpi.c - Linux ACPI arch-specific functions
 *
 *  Copyright (C) 1999-2000 Andrew Henroid
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program; if not, write to the Free Software
 *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */

/*
 * Changes:
 * Arnaldo Carvalho de Melo &lt;acme@conectiva.com.br&gt; - 2000/08/31
 * - check copy*user return
 * - get rid of check_region
 * - get rid of verify_area
 * Arnaldo Carvalho de Melo &lt;acme@conectiva.com.br&gt; - 2000/09/28
 * - do proper release on failure in acpi_claim_ioports and acpi_init
 * Andrew Grover &lt;andrew.grover@intel.com&gt; - 2000/11/13
 * - Took out support for user-level interpreter. ACPI 2.0 changes preclude
 *   its maintenance.
 */

#include &lt;linux/config.h&gt;
#include &lt;linux/module.h&gt;
#include &lt;linux/init.h&gt;
#include &lt;linux/pm.h&gt;

#define _LINUX
#include &lt;linux/acpi.h&gt;
/* Is there a better way to include this? */
#include &lt;../drivers/acpi/include/acpi.h&gt;
 
ACPI_PHYSICAL_ADDRESS
acpi_get_rsdp_ptr()
{
      ACPI_PHYSICAL_ADDRESS rsdp_phys;

      if(ACPI_SUCCESS(acpi_find_root_pointer(&amp;rsdp_phys)))
              return rsdp_phys;
      else
              return 0;
}                           
- --- EOF

- -- 
"All that is necessary for the triumph of evil is that good men do nothing"
- - Edmunde Burke
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.0.4 (GNU/Linux)
Comment: For info see http://www.gnupg.org

iD8DBQE6Ko+4urtIeT2BVkgRApc6AJ0V981fKeRaGsiF5tN3BsYIgj2k1wCgsMST
1p28k0u0u+SyyhGxuHA4Y/U=
=XZcX
-----END PGP SIGNATURE-----

</body></email><email><emailId>20001204154053</emailId><senderName>Adam Harrison</senderName><senderEmail>adam@antispin.org</senderEmail><timestampReceived>2000-12-04 15:40:53-0400</timestampReceived><subject>[Acpi] Re: Failure on ASUS K7M w/ 2.4.0-test11</subject><body>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On Sunday 03 December 2000 18:23, Adam Harrison wrote:

&gt; Please let me know if you'd like me provide more information or perform
&gt; more diagnostics at my end. I'm going to try reflashing my BIOS with the
&gt; latest tomorrow to see if that helps - will keep you posted.

Hi All,

I've just reflashed my BIOS with the latest from ASUS (km1009.bin) to no 
avail - ACPI fails in exactly the same fashion as reported yesterday. I have, 
however, found something more interesting :-)

I vaguely remember having seen 'ACPI: Sx supported' type messages from the 
kernel in the past, and I know from inspection of the source that only the 
AML-interpreter version generates such strings. I decided to go back to an 
early testXX kernel to see if I could find a working version.

I picked test5, and compiled it with exactly the same settings as I'm using 
with test11+acpica-linux-debug-20001115. Well, almost - normally I compile 
AGP support directly into the kernel, but if I do this with test5 it oopses 
trying to initialise AGP. Booting this kernel results in working ACPI, 
replete with 'ACPI: Sx supported' type messages.

I then tried test7, which failed:

ACPI: support found
ACPI: namespace load failed
ACPI:         -0550: &lt;7&gt;ACPI: *** Success: Entire namespace and objects 
deleted

I then tried test6, which failed:

ACPI: support found
ACPI:         -0531: &lt;7&gt;ACPI: *** Error: Ns_search_and_enter: bad parameter
ACPI: namespace load failed
ACPI:         -0550: &lt;7&gt;ACPI: *** Success: Entire namespace and objects 
deleted

Then I realised that I hadn't disabled AGP when compiling 6 &amp; 7 as I had done 
for 5. To make sure, I recompiled test6 with AGP disabled:

ACPI: support found
ACPI: PBLK 1 @ 0x0810:6
ACPI: S1 supported
ACPI: S5 supported                                                            
 
Oh, that's interesting - it works fine with AGP disabled! The next thing I 
tried was test11+acpica-linux-debug-20001115 without AGP:

ACPI Subsystem version [Dec  3 2000]
ACPI: System description tables found
 tbxface-0089: ACPI Tables successfully loaded
Parsing 
Methods:.....................................................................................
85 Control Methods found and parsed (312 nodes total)
ACPI Namespace successfully loaded at root 0xc03724d8
ACPI: System description tables loaded
evxfevnt-0082: Transition to ACPI mode successful
Executing device _INI methods:.  nsinit-0136: Ns_initialize_devices: 
Walk_namespace failed! 7
breakpoint: Fatal error encountered
 
1 Devices found: 1 _STA, 1 _INI, 1 _HID, 1 PCIRoot
ACPI: Subsystem enable failed                                                 

It still fails, but it gets a lot further along in the process. Is the kernel 
AGP initialisation clobbering the ACPI tables in memory ?

What I'll probably try next is to compile successive kernels without AGP 
support starting with test7 and find the point where it breaks.

Cheers,

Adam.

- -- 
"All that is necessary for the triumph of evil is that good men do nothing"
- - Edmunde Burke
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.0.4 (GNU/Linux)
Comment: For info see http://www.gnupg.org

iD8DBQE6K7sMurtIeT2BVkgRAkk7AJ0brhhL5AaOA/sV8wgkeU+PZL1FBgCgzBKB
vfn0jzlhX+KgUxY4P0syGmo=
=kdKJ
-----END PGP SIGNATURE-----

</body></email><email><emailId>20001205215313</emailId><senderName></senderName><senderEmail>fpn</senderEmail><timestampReceived>2000-12-05 21:53:13-0400</timestampReceived><subject>[Acpi] Athlon CPU Throttling question</subject><body>

I have a question regarding CPU throttling on the Athlon.

I want buy a new Motherboard and wanted to know whether the CPU
throttling on the Athlon depends on the BIOS or just the chip set.

My understanding is that the Siemens Motherboards (Intel though) have a
microcontroller onboard that implements the thermal/noise strategy OS
independant. Shouldn't this be done by the OS (Linux in my case)?

Any sugggestions?

best regards,
 florian nierhaus

P.S.
I am aware that CPU throttling is not supported by ACPI yet...

</body></email><email><emailId>20001205050955</emailId><senderName>brendan burns</senderName><senderEmail>bburns@wso.williams.edu</senderEmail><timestampReceived>2000-12-05 05:09:55-0400</timestampReceived><subject>[Acpi] Startup problems</subject><body>

Folks,
after compiling the latest ACPI version on my Omnibook 2100 (PIIX4)

ACPI enable fails with the following:
ACPI Subsystem version [Dec  4 2000]
ACPI: System description tables found
 tbxface-0089: ACPI Tables successfully loaded
Parsing
Methods:.............................................................................. \
...................................................................................... \
........................................................................................................
 268 Control Methods found and parsed (893 nodes total)
ACPI Namespace successfully loaded at root c030fc38
ACPI: System description tables loaded
 amfldio-0121: Aml_read_field_data: **** Region PCIConfig(2) has no
handler
breakpoint: Fatal error encountered
ACPI: Subsystem enable failed

After a little investigation I see that the parse walk through the tree on
PCI enabling is succeding but the second parse walk (the one that leads to
execution fails with the error AE_NO_EXIST (error #6)  Anyone have any
ideas what might be causing this?

Thanks
Brendan


</body></email><email><emailId>20001204234250</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-12-04 23:42:50-0400</timestampReceived><subject>[Acpi] Re: PM in 2.2</subject><body>

On Tue, 5 Dec 2000, J . A . Magallon wrote:

&gt; I would like to know if there is any back-port of ACPI to 2.2.
&gt; Problem: 2-way machine, so APM does not work.
&gt; I would love my box powers down when I shutdown...just like macs.

No, the current ACPI drivers haven't been backported, and it is neither
planned nor possible, since the drivers rely on the new power management
interface introduced in 2.4 and also all drivers being ported to this
interface.

Power-down should also work with APM on SMP boxen by activating APM just
before shutdown. I don't recall since what version this is in the kernel,
but it might be worth looking at.

   Simon

-- 
GPG public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: DC26 EB8D 1F35 4F44 2934  7583 DBB6 F98D 9198 3292
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

</body></email><email><emailId>20001211213911</emailId><senderName>Alexey Zhuravlev</senderName><senderEmail>alexey@datafoundation.com</senderEmail><timestampReceived>2000-12-11 21:39:11-0400</timestampReceived><subject>[Acpi] Does anyone has Dell Inspiron 3500 working fine with ACPI?</subject><body>

Hi!

$subj

cat /proc/sys/acpi/event is silence every time, ever I close laptop ...

====
dmesg|grep ACPI
 BIOS-e820: 000000000000fc00 @ 0000000007ff0000 (ACPI data)
 BIOS-e820: 0000000000000400 @ 0000000007fffc00 (ACPI NVS)
ACPI: support found
ACPI: PBLK 0 @ 0x8010:0
ACPI: S1 supported
ACPI: S5 supported
====
--

</body></email><email><emailId>20001213220052</emailId><senderName></senderName><senderEmail>kyalpani</senderEmail><timestampReceived>2000-12-13 22:00:52-0400</timestampReceived><subject>[Acpi] quick  acpi question</subject><body>

Hi. I want to install Linux on my laptop (acer 506T) and I want to know if
I have to install it with the ACPI in the kernel enabled, or can I stop
worrying about it? I am not really concerned about how much power I consume.
All I am worried about is that without ACPI the laptop fan won't turn on
anymore and something will burn as a result. Previously I tried to install
linux side-by-side with WIN98 and I damaged my harddisk because WIN98 does its
own power managment (similar to acpi I suppose) and it writes stuff to the
linux partition without warning. Now I replaced my disk and I want to redo
the whole thing (minus disk damage of course, GRRRR! Thanks MS!!) and I just
want to make sure I don't do anything wrong. Can someone help me?

Thanks

Kuros
Munich/Germany

-- 
Sent through GMX FreeMail - http://www.gmx.net

</body></email><email><emailId>20001214175347</emailId><senderName>"Niklas Andersson"</senderName><senderEmail>niklas.a.79@telia.com</senderEmail><timestampReceived>2000-12-14 17:53:47-0400</timestampReceived><subject>[Acpi] Hangs on shutdown</subject><body>

Hi there i run 2.4.0-test11 on slackware.
When i run 'init 0' the machine hangs after the shutdown script finnish
with the message "ACPI: S5 faild".
The shutdown script contains:
    killall5 -15
    sleep 5
    killall5 -9

If i delete these lines the computer halt as it should but the root
partition will not be unmounted because processes are still accessing 
the disc and i will have a fsck on boot.

The problem is that 'killall5' kills [acpi] and acpid.
acpid can i restart after the partition is remounted ro but i cant restart [acpi].
Isn't [acpi] supose to ignore these signals?
If you have a smarter shutdown script that dosn't kill [acpi] cold you
please mail it to me?

[Attachment #3 (text/html)]

&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"&gt;
&lt;HTML&gt;&lt;HEAD&gt;
&lt;META http-equiv=Content-Type content="text/html; charset=iso-8859-1"&gt;
&lt;META content="MSHTML 5.50.4134.600" name=GENERATOR&gt;
&lt;STYLE&gt;&lt;/STYLE&gt;
&lt;/HEAD&gt;
&lt;BODY bgColor=#ffffff&gt;
&lt;DIV&gt;&lt;FONT face=Arial size=2&gt;Hi there i run 2.4.0-test11 on slackware.&lt;BR&gt;When i 
run 'init 0' the machine hangs after the shutdown script finnish&lt;BR&gt;with the 
message "ACPI: S5 faild".&lt;BR&gt;The shutdown script contains:&lt;BR&gt;Â Â Â  
killall5 -15&lt;BR&gt;Â Â Â  sleep 5&lt;BR&gt;Â Â Â  killall5 
-9&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;Â &lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=Arial size=2&gt;If i delete these lines the computer halt as it 
should but the root&lt;BR&gt;partition will not be unmounted because processes are 
still accessing &lt;BR&gt;the disc and i will have a fsck on boot.&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;Â &lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT face=Arial size=2&gt;The problem is that 'killall5' kills [acpi] and 
acpid.&lt;BR&gt;acpid can i restart after the partition is remounted ro but i cant 
restartÂ [acpi].&lt;BR&gt;Isn't [acpi] supose to ignore these signals?&lt;BR&gt;If you 
have a smarter shutdown script that dosn't kill [acpi] cold you&lt;BR&gt;please mail 
it to me?&lt;/FONT&gt;&lt;/DIV&gt;&lt;/BODY&gt;&lt;/HTML&gt;


</body></email><email><emailId>20001211203144</emailId><senderName>Gordon McNutt</senderName><senderEmail>gmcnutt@ridgerun.com</senderEmail><timestampReceived>2000-12-11 20:31:44-0400</timestampReceived><subject>[Acpi] PM_SYS_ARCH_SPECIFIC</subject><body>

Hi,

I wanted to #define this for a new architecture with some unique
devices. But I want to do it in a way that won't conflict with your
future plans.

I thought the most straightforward way would be to add an #include
&lt;asm/pm.h&gt; to linux/pm.h. This would require all the asm-*/ dirs to have
at least an empty pm.h.

Is this what you had in mind for doing once the need arose?

Thanks,

--Gordon

</body></email><email><emailId>20001215222137</emailId><senderName>Gordon McNutt</senderName><senderEmail>gmcnutt@ridgerun.com</senderEmail><timestampReceived>2000-12-15 22:21:37-0400</timestampReceived><subject>[Acpi] resume</subject><body>

After looking at Documentation/pm.txt, arch/i386/kernel/apm.c &amp; acpi.c,
I still haven't figured out how a system wakes up from a sleep state.
Anybody out there familiar with the process?

Thanks,

--Gordon

</body></email><email><emailId>20001215225050</emailId><senderName>Patrick Mochel</senderName><senderEmail>mochel@transmeta.com</senderEmail><timestampReceived>2000-12-15 22:50:50-0400</timestampReceived><subject>Re: [Acpi] resume</subject><body>

The ACPI spec describes this for you, though I wouldn't recommend that
document for anyone that is not a masochist.

So, I will give you the 30-second run down.  Note that this is
ACPI-specific.

When awaking from S2 or S3, all processor context is lost, so it starts
from the reset vector.  The BIOS starts executing and somewhere along the
way, it checks the value of the Firmware Waking Vector in the Firmware
ACPI Control Structure.  If that value is non-zero, it assumes that it
contains an address and jumps to it.

And that's it for the BIOS.  Well, what is that magical address you ask?

Well, that's the wakeup routine that the OS has installed to bring the
rest of the system back up.  The OS is responsible for setting that
magical address value before it goes to sleep.  The routine itself is
kindy nasty because when you come back, you are in Real Mode and all
processor state is lost, so you have to make the switch to Protected Mode,
restore all of the state, then go through and restore all device state
(since every device lost power when going to sleep).  The initial routine
of course doesn't have to do all this, but in order to support those sleep
states, all aspects have to be accounted for, and none of them are
non-trivial.  Which is also why you didn't find any note of them in those
files - no one has implemented them for Linux.  Well, at least finished
them.  I have been working on the wakeup routine and the kernel support
for it.  If anyone else has put time into this, maybe we can swap notes
and get this thing finished.

Also, someone should do an ACPI Spec -&gt; English Translation for the
Documentation directory.  :-)

Does that answer your question?

-pat

On Fri, 15 Dec 2000, Gordon McNutt wrote:

&gt; After looking at Documentation/pm.txt, arch/i386/kernel/apm.c &amp; acpi.c,
&gt; I still haven't figured out how a system wakes up from a sleep state.
&gt; Anybody out there familiar with the process?
&gt; 
&gt; Thanks,
&gt; 
&gt; --Gordon
&gt; 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; 

</body></email><email><emailId>20001218163724</emailId><senderName>Gordon McNutt</senderName><senderEmail>gmcnutt@ridgerun.com</senderEmail><timestampReceived>2000-12-18 16:37:24-0400</timestampReceived><subject>Re: [Acpi] resume</subject><body>

Patrick Mochel wrote:

&gt; The ACPI spec describes this for you, though I wouldn't recommend that
&gt; document for anyone that is not a masochist.

The next time I feel like punishing myself I'll look into it. Thanks.

&gt; So, I will give you the 30-second run down.  Note that this is
&gt; ACPI-specific.
&gt;
&gt; When awaking from S2 or S3, all processor context is lost, so it starts
&gt; from the reset vector.  The BIOS starts executing and somewhere along the
&gt; way, it checks the value of the Firmware Waking Vector in the Firmware
&gt; ACPI Control Structure.  If that value is non-zero, it assumes that it
&gt; contains an address and jumps to it.
&gt;

Ok.
But what makes it decide to wake up from S2 or S3?
Say the system is in one of these states and (I'm guessing here) the CPU is
halted (whatever that means -- probably depends on the CPU). Then I push a
wakeup button. What happens next? Which part of the system gets the signal?
How does it know what to do with it up to the point where it gets the next
CPU address from the Waking Vector? What decides which actions can wake the
system up?
If BIOS firmware is responsible for handling wakeup until we start running
the OS-registered wakeup handler, then is the CPU running the BIOS firmware?
If so, what woke it up and told it to start running the BIOS firmware?

&gt; Does that answer your question?

That helps. It sounds like basically just another interrupt service routine
(but a complicated one). And the standard interrupt vector I take it is
different from the Firmware Waking Vector.

Thanks for your answer
--Gordon

</body></email><email><emailId>20001217171224</emailId><senderName>Jens Taprogge</senderName><senderEmail>taprogge@idg.rwth-aachen.de</senderEmail><timestampReceived>2000-12-17 17:12:24-0400</timestampReceived><subject>[Acpi] ACPI problems with Toshiba laptop</subject><body>

I have trouble getting ACPI to work on a Toshiba Satellite 4000 CDS. I
have tried the old and new ACPI in the 2.4 kernel series (before/after
test13-pre2).

Please find the ACPI messages of the dmesg logs attached.

Any hints what I could do to track down the problem?

Jens

-- 
Jens Taprogge


["dmesg-2.4.0-test10" (text/plain)]

        -0189: *** Warning: Invalid table signature found
        -0084: *** Error: Invalid signature where RSDP indicates RSDT should be located
        -0087: *** Error: Unable to locate RSDT
ACPI: found "Intel Corporation 82371AB PIIX4 ACPI" at 0xfe00
ACPI: APM is already active.


["dmesg-2.4.0-test13pre2" (text/plain)]

ACPI: System description tables found
    ACPI-0191: *** Warning: Invalid table signature found
    ACPI-0073: *** Error: Acpi_load_tables: Could not load RSDT: AE_BAD_SIGNATURE
    ACPI-0101: *** Error: Acpi_load_tables: Could not load tables: AE_BAD_SIGNATURE
ACPI: System description table load failed



</body></email><email><emailId>20001220010058</emailId><senderName>"Adam J. Richter"</senderName><senderEmail>adam@yggdrasil.com</senderEmail><timestampReceived>2000-12-20 01:00:58-0400</timestampReceived><subject>[Acpi] 2.4.0-test13pre3 acpi circular dependency</subject><body>

	Although the stock linux-2.4.0-test13pre3 does not allow
one to build the acpi interpreter as a loadable module, I had
tweaked the Makefiles in previous kernels to do this (the supporting
code is there and it seemed to work, at least for shutting off the
power after a shutdown).  Unfortunately, in 2.4.0-test13pre3, this
is no harder to do, because there is a circular dependency:

drivers/acpi/ references acpi_get_rsdp_ptr in arch/i386/kernel/acpi.c,
				and
arch/i386/kernel/acpi.c references acp_find_root_pointer in drivers/acpi/.


	I would like to recommend that the contents of
arch/i{386,a64}/kernel/acpi.c be merged back somewhere in drivers/acpi/,
and just selected with Makefile options, ifdefs, or perhaps runtime
options (if the ia64 code is potentionally useable to an i386 kernel
that find itself running on an ia64 CPU, which will probably be the case
with most Linux distributions initially installed on ia64 hardware).

	If need be, I would be willing to at least write a quick and
dirty #ifdef-based version of this proposed change.

Adam J. Richter     __     ______________   4880 Stevens Creek Blvd, Suite 104
adam@yggdrasil.com     \ /                  San Jose, California 95129-1034
+1 408 261-6630         | g g d r a s i l   United States of America
fax +1 408 261-6631      "Free Software For The Rest Of Us."

</body></email><email><emailId>20001221113023</emailId><senderName>Jens Taprogge</senderName><senderEmail>taprogge@idg.rwth-aachen.de</senderEmail><timestampReceived>2000-12-21 11:30:23-0400</timestampReceived><subject>[Acpi] Re: Problems with ToPIC97 reappear between test10 and test13pre2</subject><body>

Good call.

Truning off ACPI support fixes the problem.

Jens

On Thu, Dec 21, 2000 at 10:05:46PM +1100, Andrew Morton wrote:
&gt; I started getting similar problems with a TI bridge when the
&gt; recent big ACPI update went in.  Popping the card out and in
&gt; fixes it.
&gt; 
&gt; If you disable ACPI in your config, does the problem go away?
&gt; 
&gt; Jens Taprogge wrote:
&gt; &gt; 
&gt; &gt; I sent a similar message earlier, but it has not shown up on
&gt; &gt; linux-kernel so I guess something went wrong...
&gt; &gt; 
&gt; &gt; I am starting to have problems again with the Cardbus controller
&gt; &gt; somewhere inbetween 2.4.0-test10 (works) and 2.4.0-test13-pre2 (fails).
&gt; &gt; 
&gt; &gt; The problem shows as follows: When I boot the kernel (I have PCMCIA
&gt; &gt; compiled in) only one of my cards gets detected due to the following
&gt; &gt; error:
&gt; &gt; cs: socket c5feb800 timed out during reset.  Try increasing setup_delay.
&gt; &gt; cs: socket c5fb5000 voltage interrogation timed out
&gt; &gt; 
&gt; &gt; I did not have see this error before and increasing setup_delay manually
&gt; &gt; in the source did not help.
&gt; &gt; 
&gt; &gt; Now when I do "cardctl eject; cardctl insert" things work out fine.
&gt; &gt; 
&gt; &gt; I am not sure if this is somehow related to the problems that were
&gt; &gt; fixed with test5pre6, but the sumptoms are kind of similar (one slot
&gt; &gt; works - other does not).
&gt; &gt; 
&gt; &gt; If you want me to try something please let me know.
&gt; &gt; 
&gt; &gt; Jens
&gt; &gt; 
&gt; &gt; ps: attached please find the dmesg output.
&gt; &gt; 
&gt; &gt; --
&gt; &gt; Jens Taprogge
&gt; &gt; 
-- 
Jens Taprogge

</body></email><email><emailId>20001222134455</emailId><senderName></senderName><senderEmail>marc+acpi</senderEmail><timestampReceived>2000-12-22 13:44:55-0400</timestampReceived><subject>[Acpi] Re: ACPI on Sony Vaio</subject><body>

Hi Knut, everyone,

&gt; I luckily own a sony vaio z700tek since a short time and tried to get it to
&gt; work with acpi. I already tried kernel 2.4.0-test12 which booted but did not
&gt; work out when trying to send it in sleep mode. So I patched it with the
&gt; intel patch from 12/15/2000 - since then I am not actually able to boot the
&gt; vaio with acpi enabled. It always locks after loading the system tables. A
&gt; little debugging showed that it does not return from calling the user
&gt; function on level 5 in _ns_walks_namespace.

Like on my vaio z505ls it is probably stuck executing the _STA method of
the _SB_PCI0ISA_EC0_BAT1 device.

I've modified the code to skip execution of this method and a few others
which also hang. See patch below. It is by no means a proper fix, just a
quick hack to let the system boot. Please try it on your system and let 
me know the results.

Can anyone tell us exactly why BAT1's _STA doesn't work?

The disassembler's output of this method definitely looks weird:

00001bf2:           Method _STA (\_SB_.PCI0.ISA_.EC0_.BAT1._STA)
00001bf8:             ArgCount 0; NotSerialized
00001bf9:             And
00001bfa:               &lt;NULL&gt;
00001bfe:               0xdb
00001c00:               0x80
00001c02:             0x0100
00001c05:             Local1

Perhaps it uses opcodes not supported by the current Linux ACPI 
implementation??

I've appended BAT1 sections of both raw acpidmp and "acpidmp DSDT |
acpidisasm" output below. Complete dumps available upon request.

&gt; 
&gt; I tried as well to user test13-pre3 with the latest patch (12/20/2000)
&gt; from Andrew Grover
&gt; but could not extract the patch from the archives (coudl someone maybe
&gt; mail it to me?) and the unpatched kernel seems to be the same as test12
&gt; patched with the mentioned patch from 12/15/2000 - at least it locked up a
&gt; the same point.
&gt; 
&gt; I have to mention that lock up means that the kernel does not lock the hard
&gt; way since the vaio is still soft-resetable.
&gt; 
&gt; Um, and yes, the hardware: z600tek is a european edition - its a pentium III
&gt; - 700 with phoenix bios 4.0 rev 6 and intel chipset.
&gt; 
&gt; I would gladly joing in and help on development if someone could point me to
&gt; where to look for the problem...
&gt; 
&gt; Thanks in advance
&gt; 
&gt; -knut

--- linux-2.4.0-test13-pre4-mb-acpi/drivers/acpi/common/cmeval.c	2000/12/22 04:02:40	1.1
+++ linux-2.4.0-test13-pre4-mb-acpi/drivers/acpi/common/cmeval.c	2000/12/22 13:25:45
@@ -270,6 +270,20 @@
 	ACPI_STATUS             status;
 
 
+	if(	!strncmp("BAT1", (char*)&amp;device_node-&gt;name, 4) ||
+		!strncmp("COMA", (char*)&amp;device_node-&gt;name, 4) ||
+		!strncmp("FIR_", (char*)&amp;device_node-&gt;name, 4) ||
+		!strncmp("LPTA", (char*)&amp;device_node-&gt;name, 4) ||
+		!strncmp("LPTB", (char*)&amp;device_node-&gt;name, 4) ||
+		!strncmp("ECP_", (char*)&amp;device_node-&gt;name, 4) ||
+		!strncmp("EPP_", (char*)&amp;device_node-&gt;name, 4)) {
+		printk(KERN_ERR"acpi_cm_execute_STA SKIP device_node-&gt;name=%.4s\n", (char*)&amp;device_node-&gt;name);
+		*flags = 0x0F;
+		return AE_OK;
+	} else {
+		printk(KERN_ERR"acpi_cm_execute_STA device_node-&gt;name=%.4s\n", (char*)&amp;device_node-&gt;name);
+	}
+
 	/* Execute the method */
 
 	status = acpi_ns_evaluate_relative (device_node,




00001b84:         Device BAT1 (\_SB_.PCI0.ISA_.EC0_.BAT1)
00001b8c:           Name _HID (\_SB_.PCI0.ISA_.EC0_.BAT1._HID)
00001b91:             PNP0c0a (0x0a0cd041)
00001b96:           Name _UID (\_SB_.PCI0.ISA_.EC0_.BAT1._UID)
00001b9b:             0x01
00001b9d:           Name _PCL (\_SB_.PCI0.ISA_.EC0_.BAT1._PCL)
00001ba2:             Package
00001ba4:               0x01
00001ba5:               \_SB_ (00003076)
00001baa:           Name BATI (\_SB_.PCI0.ISA_.EC0_.BAT1.BATI)
00001baf:             Package
00001bb1:               0x0d
00001bb2:               0x00
00001bb4:               0x9650
00001bb7:               0x9650
00001bba:               0x00
00001bbc:               0x39d0
00001bbf:               0x00
00001bc1:               0x78
00001bc3:               0x00
00001bc5:               0x0a
00001bc7:               ""
00001bc9:               ""
00001bcb:               "LION"
00001bd1:               "Sony Corp."
00001bdd:           Name BATS (\_SB_.PCI0.ISA_.EC0_.BAT1.BATS)
00001be2:             Package
00001be4:               0x04
00001be5:               0x02
00001be7:               0xffffffff
00001bec:               0x0d7a
00001bef:               0x3840
00001bf2:           Method _STA (\_SB_.PCI0.ISA_.EC0_.BAT1._STA)
00001bf8:             ArgCount 0; NotSerialized
00001bf9:             And
00001bfa:               &lt;NULL&gt;
00001bfe:               0xdb
00001c00:               0x80
00001c02:             0x0100
00001c05:             Local1
00001c06:             If
00001c08:               Local1
00001c09:               Store
00001c0a:                 0x1f
00001c0c:                 Local0
00001c0d:             Else
00001c0f:               Store
00001c10:                 0x0f
00001c12:                 Local0
00001c13:             Return
00001c14:               Local0
00001c15:           Method _BIF (\_SB_.PCI0.ISA_.EC0_.BAT1._BIF)
00001c1c:             ArgCount 0; NotSerialized
00001c1d:             Store
00001c1e:               &lt;NULL&gt;
00001c22:               0xdb
00001c24:             0xb0
00001c26:             Local1
00001c27:             Multiply
00001c28:               Local1
00001c29:               0x0a
00001c2b:               Index
00001c2c:                 BATI (00001baa)
00001c30:                 0x01
00001c32:                 &lt;NULL&gt;
00001c33:             Store
00001c34:               &lt;NULL&gt;
00001c38:               0xdb
00001c3a:             0xb2
00001c3c:             Local1
00001c3d:             Multiply
00001c3e:               Local1
00001c3f:               0x0a
00001c41:               Index
00001c42:                 BATI (00001baa)
00001c46:                 0x02
00001c48:                 &lt;NULL&gt;
00001c49:             Store
00001c4a:               &lt;NULL&gt;
00001c4e:               0xdb
00001c50:             0xb6
00001c52:             Index
00001c53:               BATI (00001baa)
00001c57:               0x04
00001c59:               &lt;NULL&gt;
00001c5a:             Return
00001c5b:               BATI (00001baa)
00001c5f:           Method _BST (\_SB_.PCI0.ISA_.EC0_.BAT1._BST)
00001c66:             ArgCount 0; NotSerialized
00001c67:             Store
00001c68:               And
00001c69:                 &lt;NULL&gt;
00001c6d:                 0xdb
00001c6f:                 0x84
00001c71:               0xff
00001c73:             Local0
00001c74:             Index
00001c75:               BATS (00001bdd)
00001c79:               0x00
00001c7b:               &lt;NULL&gt;
00001c7c:             Store
00001c7d:               &lt;NULL&gt;
00001c81:               0xdb
00001c83:             0xa4
00001c85:             Local1
00001c86:             If
00001c88:               LLess
00001c89:                 Local1
00001c8a:                 0x8000
00001c8d:               If
00001c8f:                 Local1
00001c90:                 Store
00001c91:                   0xffffffff
00001c96:                   Index
00001c97:                     BATS (00001bdd)
00001c9b:                     0x01
00001c9d:                     &lt;NULL&gt;
00001c9e:               Else
00001ca0:                 Store
00001ca1:                   ZeroOp
00001ca2:                   Index
00001ca3:                     BATS (00001bdd)
00001ca7:                     0x01
00001ca9:                     &lt;NULL&gt;
00001caa:             Else
00001cac:               XOr
00001cad:                 Local1
00001cae:                 0xffff
00001cb1:                 Local1
00001cb2:               Increment
00001cb3:                 Local1
00001cb4:               Multiply
00001cb5:                 Local1
00001cb6:                 0x0a
00001cb8:                 Index
00001cb9:                   BATS (00001bdd)
00001cbd:                   0x01
00001cbf:                   &lt;NULL&gt;
00001cc0:             Multiply
00001cc1:               &lt;NULL&gt;
00001cc5:               0xdb
00001cc7:               0xa2
00001cc9:             0x0a
00001ccb:             Index
00001ccc:               BATS (00001bdd)
00001cd0:               0x02
00001cd2:               &lt;NULL&gt;
00001cd3:             Store
00001cd4:               &lt;NULL&gt;
00001cd8:               0xdb
00001cda:             0xa6
00001cdc:             Index
00001cdd:               BATS (00001bdd)
00001ce1:               0x03
00001ce3:               &lt;NULL&gt;
00001ce4:             Return
00001ce5:               BATS (00001bdd)


  1b80: 6f 69 6e 74 00 5b 31 86 5c 2e 5f 54 5a 5f 41 54  oint.[1.\._TZ_AT
  1b90: 46 30 0a 80 14 13 5f 51 36 30 00 86 5c 2e 5f 53  F0...._Q60..\._S
  1ba0: 42 5f 50 57 52 42 0a 80 5b 82 43 16 42 41 54 31  B_PWRB..[.C.BAT1
  1bb0: 08 5f 48 49 44 0c 41 d0 0c 0a 08 5f 55 49 44 0a  ._HID.A...._UID.
  1bc0: 01 08 5f 50 43 4c 12 07 01 5c 5f 53 42 5f 08 42  .._PCL...\_SB_.B
  1bd0: 41 54 49 12 2d 0d 0a 00 0b 50 96 0b 50 96 0a 00  ATI.-....P..P...
  1be0: 0b d0 39 0a 00 0a 78 0a 00 0a 0a 0d 00 0d 00 0d  ..9...x.........
  1bf0: 4c 49 4f 4e 00 0d 53 6f 6e 79 20 43 6f 72 70 2e  LION..Sony Corp.
  1c00: 00 08 42 41 54 53 12 0f 04 0a 02 0c ff ff ff ff  ..BATS..........
  1c10: 0b 7a 0d 0b 40 38 14 22 5f 53 54 41 00 7b 50 48  .z..@8."_STA.{PH
  1c20: 53 44 0a db 0a 80 0b 00 01 61 a0 06 61 70 0a 1f  SD.......a..ap..
  1c30: 60 a1 05 70 0a 0f 60 a4 60 14 49 04 5f 42 49 46  `..p..`.`.I._BIF
  1c40: 00 70 50 48 53 44 0a db 0a b0 61 77 61 0a 0a 88  .pPHSD....awa...
  1c50: 42 41 54 49 0a 01 00 70 50 48 53 44 0a db 0a b2  BATI...pPHSD....
  1c60: 61 77 61 0a 0a 88 42 41 54 49 0a 02 00 70 50 48  awa...BATI...pPH
  1c70: 53 44 0a db 0a b6 88 42 41 54 49 0a 04 00 a4 42  SD.....BATI....B
  1c80: 41 54 49 14 49 08 5f 42 53 54 00 70 7b 50 48 53  ATI.I._BST.p{PHS
  1c90: 44 0a db 0a 84 0a ff 60 88 42 41 54 53 0a 00 00  D......`.BATS...
  1ca0: 70 50 48 53 44 0a db 0a a4 61 a0 23 95 61 0b 00  pPHSD....a.#.a..
  1cb0: 80 a0 10 61 70 0c ff ff ff ff 88 42 41 54 53 0a  ...ap......BATS.
  1cc0: 01 00 a1 0b 70 00 88 42 41 54 53 0a 01 00 a1 15  ....p..BATS.....
  1cd0: 7f 61 0b ff ff 61 75 61 77 61 0a 0a 88 42 41 54  .a...auawa...BAT
  1ce0: 53 0a 01 00 77 50 48 53 44 0a db 0a a2 0a 0a 88  S...wPHSD.......
  1cf0: 42 41 54 53 0a 02 00 70 50 48 53 44 0a db 0a a6  BATS...pPHSD....
  1d00: 88 42 41 54 53 0a 03 00 a4 42 41 54 53 5b 82 49  .BATS....BATS[.I

</body></email><email><emailId>20001215003849</emailId><senderName>Jerritt Collord</senderName><senderEmail>collord@collord.net</senderEmail><timestampReceived>2000-12-15 00:38:49-0400</timestampReceived><subject>[Acpi] Intel ACPI compile bug?</subject><body>

Greets,

Please advise: for which versions of 2.4testXX-preYY kernel tree is the
Intel ACPI code compilable/valid?  

Thanks,

Jerritt Collord

</body></email><email><emailId>20001215224622</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-12-15 22:46:22-0400</timestampReceived><subject>RE: [Acpi] Intel ACPI compile bug?</subject><body>

The patch should apply cleanly (or with a few offset patches) to test12, as
well as test12-pre3 and above

Are you running into difficulty?

Regards -- Andy

&gt; -----Original Message-----
&gt; From: Jerritt Collord [mailto:collord@collord.net]
&gt; Sent: Thursday, December 14, 2000 4:39 PM
&gt; To: acpi@phobos.fachschaften.tu-muenchen.de
&gt; Subject: [Acpi] Intel ACPI compile bug?
&gt; 
&gt; 
&gt; 
&gt; Greets,
&gt; 
&gt; Please advise: for which versions of 2.4testXX-preYY kernel 
&gt; tree is the
&gt; Intel ACPI code compilable/valid?  
&gt; 
&gt; Thanks,
&gt; 
&gt; Jerritt Collord
&gt; 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; 

</body></email><email><emailId>20001216234616</emailId><senderName>Jerritt Collord</senderName><senderEmail>collord@collord.net</senderEmail><timestampReceived>2000-12-16 23:46:16-0400</timestampReceived><subject>RE: [Acpi] Intel ACPI compile bug?</subject><body>


I had trouble compiling the test12 kernel after the ACPI-CA patch, but no
problem with the test12-pre3.  

For the record, following are the debug statements that were the result of
booting this kernel on my Micron Trek2 (PII, 440BX/PIIX4E) laptop:

buzzer kernel: ACPI Subsystem version [Dec 14 2000]
buzzer kernel: ACPI: System description tables found
buzzer kernel:  tbxface-0089: ACPI Tables successfully loaded
buzzer kernel: Parsing Methods:...
buzzer kernel: 134 Control Methods found and parsed (410 nodes total)
buzzer kernel: ACPI Namespace successfully loaded at root c02ee0f8
buzzer kernel: ACPI: System description tables loaded
buzzer kernel: evxfevnt-0082: Transition to ACPI mode successful
buzzer kernel: Executing device _INI methods:...evregion-0303: \
Ev_address_space_dispatch: AE_ERROR from handler, Space_iD 2 buzzer kernel: \
breakpoint: Fatal error encountered buzzer kernel: amdyadic-0678: \
Exec_dyadic2/LEqual: bad operand(s) (Status=1) buzzer kernel: breakpoint: Fatal error \
encountered buzzer kernel: dswstate-0280: Ds_result_pop_from_bottom: No result \
objects! State=c1122c00 buzzer kernel: breakpoint: Fatal error encountered
buzzer kernel:  dsutils-0431: Ds_create_operand: Missing or null operand, \
AE_STACK_UNDERFLOW buzzer kernel: breakpoint: Fatal error encountered
buzzer kernel:   cmeval-0344: _STA on DCK0 failed with status AE_STACK_UNDERFLOW
buzzer kernel: breakpoint: Fatal error encountered
buzzer kernel:   nsinit-0134: Ns_initialize_devices: Walk_namespace failed! d
buzzer kernel: breakpoint: Fatal error encountered
buzzer kernel: 
buzzer kernel: 38 Devices found: 37 _STA, 0 _INI
buzzer kernel: ACPI: Subsystem enable failed


On Fri, 15 Dec 2000, Grover, Andrew wrote:

&gt; The patch should apply cleanly (or with a few offset patches) to test12, as
&gt; well as test12-pre3 and above
&gt; 
&gt; Are you running into difficulty?
&gt; 
&gt; Regards -- Andy
&gt; 
&gt; &gt; -----Original Message-----
&gt; &gt; From: Jerritt Collord [mailto:collord@collord.net]
&gt; &gt; Sent: Thursday, December 14, 2000 4:39 PM
&gt; &gt; To: acpi@phobos.fachschaften.tu-muenchen.de
&gt; &gt; Subject: [Acpi] Intel ACPI compile bug?
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; Greets,
&gt; &gt; 
&gt; &gt; Please advise: for which versions of 2.4testXX-preYY kernel 
&gt; &gt; tree is the
&gt; &gt; Intel ACPI code compilable/valid?  
&gt; &gt; 
&gt; &gt; Thanks,
&gt; &gt; 
&gt; &gt; Jerritt Collord
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; _______________________________________________
&gt; &gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; &gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; &gt; 
&gt; 
&gt; 


</body></email><email><emailId>20001219005559</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-12-19 00:55:59-0400</timestampReceived><subject>RE: [Acpi] Intel ACPI compile bug?</subject><body>

Can you post your DSDT? The PMTools utility acpidmp should work for this.

(I think your system has the "implicit return" problem, but I can't say for
sure without the DSDT)

Thanks -- Regards -- Andy

&gt; From: Jerritt Collord [mailto:collord@collord.net]

&gt; I had trouble compiling the test12 kernel after the ACPI-CA 
&gt; patch, but no
&gt; problem with the test12-pre3.  
&gt; 
&gt; For the record, following are the debug statements that were 
&gt; the result of
&gt; booting this kernel on my Micron Trek2 (PII, 440BX/PIIX4E) laptop:
&gt; 
&gt; buzzer kernel: ACPI Subsystem version [Dec 14 2000]
&gt; buzzer kernel: ACPI: System description tables found
&gt; buzzer kernel:  tbxface-0089: ACPI Tables successfully loaded
&gt; buzzer kernel: Parsing Methods:...
&gt; buzzer kernel: 134 Control Methods found and parsed (410 nodes total)
&gt; buzzer kernel: ACPI Namespace successfully loaded at root c02ee0f8
&gt; buzzer kernel: ACPI: System description tables loaded
&gt; buzzer kernel: evxfevnt-0082: Transition to ACPI mode successful
&gt; buzzer kernel: Executing device _INI 
&gt; methods:...evregion-0303: Ev_address_space_dispatch: AE_ERROR 
&gt; from handler, Space_iD 2
&gt; buzzer kernel: breakpoint: Fatal error encountered
&gt; buzzer kernel: amdyadic-0678: Exec_dyadic2/LEqual: bad 
&gt; operand(s) (Status=1)
&gt; buzzer kernel: breakpoint: Fatal error encountered
&gt; buzzer kernel: dswstate-0280: Ds_result_pop_from_bottom: No 
&gt; result objects! State=c1122c00
&gt; buzzer kernel: breakpoint: Fatal error encountered
&gt; buzzer kernel:  dsutils-0431: Ds_create_operand: Missing or 
&gt; null operand, AE_STACK_UNDERFLOW
&gt; buzzer kernel: breakpoint: Fatal error encountered
&gt; buzzer kernel:   cmeval-0344: _STA on DCK0 failed with status 
&gt; AE_STACK_UNDERFLOW
&gt; buzzer kernel: breakpoint: Fatal error encountered
&gt; buzzer kernel:   nsinit-0134: Ns_initialize_devices: 
&gt; Walk_namespace failed! d
&gt; buzzer kernel: breakpoint: Fatal error encountered
&gt; buzzer kernel: 
&gt; buzzer kernel: 38 Devices found: 37 _STA, 0 _INI
&gt; buzzer kernel: ACPI: Subsystem enable failed
&gt; 
&gt; 
&gt; On Fri, 15 Dec 2000, Grover, Andrew wrote:
&gt; 
&gt; &gt; The patch should apply cleanly (or with a few offset 
&gt; patches) to test12, as
&gt; &gt; well as test12-pre3 and above
&gt; &gt; 
&gt; &gt; Are you running into difficulty?
&gt; &gt; 
&gt; &gt; Regards -- Andy
&gt; &gt; 
&gt; &gt; &gt; -----Original Message-----
&gt; &gt; &gt; From: Jerritt Collord [mailto:collord@collord.net]
&gt; &gt; &gt; Sent: Thursday, December 14, 2000 4:39 PM
&gt; &gt; &gt; To: acpi@phobos.fachschaften.tu-muenchen.de
&gt; &gt; &gt; Subject: [Acpi] Intel ACPI compile bug?
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; Greets,
&gt; &gt; &gt; 
&gt; &gt; &gt; Please advise: for which versions of 2.4testXX-preYY kernel 
&gt; &gt; &gt; tree is the
&gt; &gt; &gt; Intel ACPI code compilable/valid?  
&gt; &gt; &gt; 
&gt; &gt; &gt; Thanks,
&gt; &gt; &gt; 
&gt; &gt; &gt; Jerritt Collord
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; _______________________________________________
&gt; &gt; &gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; &gt; &gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; &gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; 
&gt; 

</body></email><email><emailId>20001219021221</emailId><senderName>Jerritt Collord</senderName><senderEmail>collord@collord.net</senderEmail><timestampReceived>2000-12-19 02:12:21-0400</timestampReceived><subject>RE: [Acpi] Intel ACPI compile bug?</subject><body>


Attached is DSDT table and, for convenience, acpianalyze and acpitbl
output appear below.

Thanks so much,

Jerritt

acpianalyze: loading DSDTtable.bin
acpianalyze: found Processor #0 \_PR_.CPU0 (PBLK 0x00008010 - 0x00008016)
acpianalyze: found Fan \_TZ_.FAN_
acpianalyze: found Embedded Controller \_SB_.PCI0.ISA_.EC0_
acpianalyze: found Battery #1 \_SB_.BAT1
acpianalyze: found S0 support (SLP_TYP 0x5 0x5)
acpianalyze: found S1 support (SLP_TYP 0x4 0x4)
acpianalyze: found S3 support (SLP_TYP 0x1 0x1)
acpianalyze: found S4 support (SLP_TYP 0x0 0x0)
acpianalyze: found S5 support (SLP_TYP 0x0 0x0)

Signature:        DSDT
Length:           14028
Revision:         0x01
Checksum:         0x4c
OEMID:            ATPLTD
OEM Table ID:     U376
OEM Revision:     0x00000001
Creator ID:       MSFT
Creator Revision: 0x0100000a

["DSDTtable.bin" (APPLICATION/octet-stream)]

</body></email><email><emailId>20001221192555</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-12-21 19:25:55-0400</timestampReceived><subject>RE: [Acpi] Re: Problems with ToPIC97 reappear between test10 and test13pre2</subject><body>

Are acpi and topic97 sharing the same interrupt? cat /proc/interrupts.

(finally, someone can reproduce this! ;-)

Regards -- Andy

&gt; From: Jens Taprogge [mailto:taprogge@idg.rwth-aachen.de]
&gt; Good call.
&gt; 
&gt; Truning off ACPI support fixes the problem.
&gt; 
&gt; Jens
&gt; 
&gt; On Thu, Dec 21, 2000 at 10:05:46PM +1100, Andrew Morton wrote:
&gt; &gt; I started getting similar problems with a TI bridge when the
&gt; &gt; recent big ACPI update went in.  Popping the card out and in
&gt; &gt; fixes it.
&gt; &gt; 
&gt; &gt; If you disable ACPI in your config, does the problem go away?
&gt; &gt; 
&gt; &gt; Jens Taprogge wrote:
&gt; &gt; &gt; 
&gt; &gt; &gt; I sent a similar message earlier, but it has not shown up on
&gt; &gt; &gt; linux-kernel so I guess something went wrong...
&gt; &gt; &gt; 
&gt; &gt; &gt; I am starting to have problems again with the Cardbus controller
&gt; &gt; &gt; somewhere inbetween 2.4.0-test10 (works) and 
&gt; 2.4.0-test13-pre2 (fails).
&gt; &gt; &gt; 
&gt; &gt; &gt; The problem shows as follows: When I boot the kernel (I 
&gt; have PCMCIA
&gt; &gt; &gt; compiled in) only one of my cards gets detected due to 
&gt; the following
&gt; &gt; &gt; error:
&gt; &gt; &gt; cs: socket c5feb800 timed out during reset.  Try 
&gt; increasing setup_delay.
&gt; &gt; &gt; cs: socket c5fb5000 voltage interrogation timed out
&gt; &gt; &gt; 
&gt; &gt; &gt; I did not have see this error before and increasing 
&gt; setup_delay manually
&gt; &gt; &gt; in the source did not help.
&gt; &gt; &gt; 
&gt; &gt; &gt; Now when I do "cardctl eject; cardctl insert" things work 
&gt; out fine.
&gt; &gt; &gt; 
&gt; &gt; &gt; I am not sure if this is somehow related to the problems that were
&gt; &gt; &gt; fixed with test5pre6, but the sumptoms are kind of 
&gt; similar (one slot
&gt; &gt; &gt; works - other does not).
&gt; &gt; &gt; 
&gt; &gt; &gt; If you want me to try something please let me know.
&gt; &gt; &gt; 
&gt; &gt; &gt; Jens
&gt; &gt; &gt; 
&gt; &gt; &gt; ps: attached please find the dmesg output.
&gt; &gt; &gt; 
&gt; &gt; &gt; --
&gt; &gt; &gt; Jens Taprogge
&gt; &gt; &gt; 
&gt; -- 
&gt; Jens Taprogge
&gt; 
&gt; 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fs.tum.de
&gt; http://phobos.fs.tum.de/mailman/listinfo/acpi
&gt; 

</body></email><email><emailId>20001222135409</emailId><senderName>Andrew Morton</senderName><senderEmail>andrewm@uow.edu.au</senderEmail><timestampReceived>2000-12-22 13:54:09-0400</timestampReceived><subject>Re: [Acpi] Re: Problems with ToPIC97 reappear between test10 and test13pre2</subject><body>

[ I removed Linus ]

"Grover, Andrew" wrote:
&gt; 
&gt; Are acpi and topic97 sharing the same interrupt? cat /proc/interrupts.
&gt; 
&gt; (finally, someone can reproduce this! ;-)
&gt; 

I can reproduce it 100% too, although I think it's different from
Jens' problem - he says his machine doesn't support ACPI.  I'm afraid
I haven't had a lot of time to do investigative work.

I can confirm that it started happening when the large ACPI patch went
in a week or two ago.  I specifically backed out that part of Linus'
patch and the problem went away.  When I disable ACPI in config it goes
away.

Tha machine is a recent Dell Latitude.  The bridge is a TI1131.  The symptoms
are when the kernel is booted with the 3CCFE575CT Cardbus NIC in its slot
it is not initialised correctly.  If the NIC ispluged in *after* booting it's
fine.  If the NIC is unplugged and replugged it's fine.  It's just that
first boot.

Here is some dmesg output.  The important part is the "cs:
cb_alloc(bus 2): vendor 0xffff, device 0xffff".  That's where
things start to go wrong.


kernel: Linux PCMCIA Card Services 3.1.22 
kernel:   options:  [pci] [cardbus] [pm] 
kernel: PCI: Found IRQ 11 for device 00:03.0 
kernel: PCI: The same IRQ used for device 00:03.1 
kernel: PCI: The same IRQ used for device 00:07.2 
kernel: PCI: Found IRQ 11 for device 00:03.1 
kernel: PCI: The same IRQ used for device 00:03.0 
kernel: PCI: The same IRQ used for device 00:07.2 
kernel: Intel PCIC probe: not found. 
kernel: Yenta IRQ list 0698, PCI irq11 
kernel: Socket status: 30000020 
kernel: Yenta IRQ list 0698, PCI irq11 
kernel: Socket status: 30000006 
kernel: ACPI: System description tables found 
kernel: ACPI: System description tables loaded 
kernel: ACPI: Subsystem enabled 
kernel: ACPI: System firmware supports: C2 
kernel: ACPI: System firmware supports: S0 S1 S3 S4 S5 
kernel: AC Adapter: found 
kernel: Cmbatt: Battery socket 0 occupied 
kernel: Cmbatt: Battery socket 1 occupied 
kernel: NET4: Linux TCP/IP 1.0 for NET4.0 
kernel: IP Protocols: ICMP, UDP, TCP 
kernel: IP: routing cache hash table of 2048 buckets, 16Kbytes 
kernel: TCP: Hash tables configured (established 16384 bind 16384) 
kernel: NET4: Unix domain sockets 1.0/SMP for Linux NET4.0. 
kernel: cs: cb_alloc(bus 2): vendor 0xffff, device 0xffff 
kernel: PCI: device 02:00.0 has unknown header type 7f, ignoring. 
kernel: PCI: No IRQ known for interrupt pin ? of device 02:00.0. Please try using \
                pci=biosirq. 
kernel: VFS: Mounted root (ext2 filesystem) readonly. 
kernel: Freeing unused kernel memory: 184k freed 
kernel: Adding Swap: 409616k swap-space (priority -1) 
kernel: cs: IO port probe 0x1000-0x17ff: clean. 
kernel: cs: IO port probe 0x0100-0x04ff: excluding 0x170-0x177 0x370-0x37f \
                0x4d0-0x4d7 
kernel: cs: IO port probe 0x0a00-0x0aff: clean. 

Here is where I popped the NC out and then pushed it back:

kernel: cs: cb_free(bus 2) 
kernel: cs: cb_alloc(bus 2): vendor 0x10b7, device 0x5257 
kernel:   got res[1000:107f] for resource 0 of PCI device 10b7:5257 
kernel:   got res[10800000:1080007f] for resource 1 of PCI device 10b7:5257 
kernel:   got res[10800080:108000ff] for resource 2 of PCI device 10b7:5257 
kernel:   got res[10400000:1041ffff] for resource 6 of PCI device 10b7:5257 
kernel: PCI: Enabling device 02:00.0 (0000 -&gt; 0003) 
kernel: PCI: No IRQ known for interrupt pin A of device 02:00.0. Please try using \
                pci=biosirq. 
kernel: 3c59x.c:LK1.1.12 9 Dec 2000  Donald Becker and others. \
                http://www.scyld.com/network/vortex.html $Revision: 1.4 $ 
kernel: See Documentation/networking/vortex.txt 
kernel: eth0: 3Com PCI 3CCFE575CT Tornado CardBus at 0x1000, PCI: Setting latency \
                timer of device 02:00.0 to 64 
kernel:  00:50:da:55:ad:80, IRQ 11 
kernel:   product code 'ZE' rev 10.0 date 09-23-99 
kernel: eth0: CardBus functions mapped 10800080-&gt;d0853080 
kernel:   8K byte-wide RAM 5:3 Rx:Tx split, MII interface. 
kernel:   MII transceiver found at address 0, status 7809. 
kernel:   Enabling bus-master transmits and whole-frame receives. 
kernel: eth0: using default media MII 
kernel: eth0: Setting full-duplex based on MII #0 link partner capability of 41e1. 
kernel: spurious 8259A interrupt: IRQ7.


</body></email><email><emailId>20001220020015</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-12-20 02:00:15-0400</timestampReceived><subject>RE: [Acpi] 2.4.0-test13pre3 acpi circular dependency</subject><body>

I'm thinking arch/i386/kernel/acpi.c should just go away, yes?

Its purpose is probably better served by an ifdef, like you mentioned.

Regards -- Andy


&gt; -----Original Message-----
&gt; From: Adam J. Richter [mailto:adam@yggdrasil.com]
&gt; Sent: Tuesday, December 19, 2000 5:01 PM
&gt; To: acme@conectiva.com.br; acpi@phobos.fachschaften.tu-muenchen.de
&gt; Cc: linux-kernel@vger.kernel.org
&gt; Subject: [Acpi] 2.4.0-test13pre3 acpi circular dependency
&gt; 
&gt; 
&gt; 	Although the stock linux-2.4.0-test13pre3 does not allow
&gt; one to build the acpi interpreter as a loadable module, I had
&gt; tweaked the Makefiles in previous kernels to do this (the supporting
&gt; code is there and it seemed to work, at least for shutting off the
&gt; power after a shutdown).  Unfortunately, in 2.4.0-test13pre3, this
&gt; is no harder to do, because there is a circular dependency:
&gt; 
&gt; drivers/acpi/ references acpi_get_rsdp_ptr in arch/i386/kernel/acpi.c,
&gt; 				and
&gt; arch/i386/kernel/acpi.c references acp_find_root_pointer in 
&gt; drivers/acpi/.
&gt; 
&gt; 
&gt; 	I would like to recommend that the contents of
&gt; arch/i{386,a64}/kernel/acpi.c be merged back somewhere in 
&gt; drivers/acpi/,
&gt; and just selected with Makefile options, ifdefs, or perhaps runtime
&gt; options (if the ia64 code is potentionally useable to an i386 kernel
&gt; that find itself running on an ia64 CPU, which will probably 
&gt; be the case
&gt; with most Linux distributions initially installed on ia64 hardware).
&gt; 
&gt; 	If need be, I would be willing to at least write a quick and
&gt; dirty #ifdef-based version of this proposed change.

</body></email><email><emailId>20001218055118</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-12-18 05:51:18-0400</timestampReceived><subject>RE: [Acpi] ACPI problems with Toshiba laptop</subject><body>

This looks like you have bad tables, from the BIOS.

Do you have the latest BIOS for this machine?

Could you capture your system's ACPI tables, and send them? I don't think
I've seen this particular error before, and I'd be very interested to see
the data we're parsing. (the acpidmp utility in the PMTools package should
capture them, even if the ACPI driver can't load:
http://developer.intel.com/technology/iapc/acpi/downloads/pmtools-060600.tar
.gz )

Thanks -- Regards -- Andy

&gt; -----Original Message-----
&gt; From: Jens Taprogge [mailto:taprogge@idg.rwth-aachen.de]
&gt; Sent: Sunday, December 17, 2000 9:12 AM
&gt; To: Grover, Andrew
&gt; Cc: acpi@phobos.fachschaften.tu-muenchen.de
&gt; Subject: [Acpi] ACPI problems with Toshiba laptop
&gt; 
&gt; 
&gt; I have trouble getting ACPI to work on a Toshiba Satellite 4000 CDS. I
&gt; have tried the old and new ACPI in the 2.4 kernel series (before/after
&gt; test13-pre2).
&gt; 
&gt; Please find the ACPI messages of the dmesg logs attached.
&gt; 
&gt; Any hints what I could do to track down the problem?
&gt; 
&gt; Jens
&gt; 
&gt; -- 
&gt; Jens Taprogge
&gt; 
&gt; 

</body></email><email><emailId>20001218090440</emailId><senderName>Jens Taprogge</senderName><senderEmail>taprogge@idg.rwth-aachen.de</senderEmail><timestampReceived>2000-12-18 09:04:40-0400</timestampReceived><subject>Re: [Acpi] ACPI problems with Toshiba laptop</subject><body>

Thanks for the quick response.

On Sun, Dec 17, 2000 at 09:51:18PM -0800, Grover, Andrew wrote:
&gt; This looks like you have bad tables, from the BIOS.
&gt; 
&gt; Do you have the latest BIOS for this machine?
I am pretty sure I do, but I will check again.
&gt; 
&gt; Could you capture your system's ACPI tables, and send them? I don't think
&gt; I've seen this particular error before, and I'd be very interested to see
&gt; the data we're parsing. (the acpidmp utility in the PMTools package should
&gt; capture them, even if the ACPI driver can't load:
&gt; http://developer.intel.com/technology/iapc/acpi/downloads/pmtools-060600.tar
&gt; .gz )
Here you go:

# ./acpidmp 
RSDP "TOSHIB" @ 0x000f1140
  0000: 52 53 44 20 50 54 52 20 14 54 4f 53 48 49 42 00  RSD PTR .TOSHIB.
  0010: 00 00 ff 05                                      ....

acpidmp: cannot map the RSDT


Regards
Jens

-- 
Jens Taprogge

</body></email><email><emailId>20001219000539</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-12-19 00:05:39-0400</timestampReceived><subject>RE: [Acpi] ACPI problems with Toshiba laptop</subject><body>

How much memory does this system have? Less than 96MB?

Thanks -- Andy

&gt; From: Jens Taprogge [mailto:taprogge@idg.rwth-aachen.de]
&gt; # ./acpidmp 
&gt; RSDP "TOSHIB" @ 0x000f1140
&gt;   0000: 52 53 44 20 50 54 52 20 14 54 4f 53 48 49 42 00  RSD 
&gt; PTR .TOSHIB.
&gt;   0010: 00 00 ff 05                                      ....
&gt; 
&gt; acpidmp: cannot map the RSDT

</body></email><email><emailId>20001219111135</emailId><senderName>Jens Taprogge</senderName><senderEmail>taprogge@idg.rwth-aachen.de</senderEmail><timestampReceived>2000-12-19 11:11:35-0400</timestampReceived><subject>Re: [Acpi] ACPI problems with Toshiba laptop</subject><body>

Exactly 96MB.

$ cat /proc/meminfo 
        total:    used:    free:  shared: buffers:  cached:
Mem:  96350208 93999104  2351104        0 19030016 11894784


Regards
Jens

On Mon, Dec 18, 2000 at 04:05:39PM -0800, Grover, Andrew wrote:
&gt; How much memory does this system have? Less than 96MB?
&gt; 
&gt; Thanks -- Andy
&gt; 
&gt; &gt; From: Jens Taprogge [mailto:taprogge@idg.rwth-aachen.de]
&gt; &gt; # ./acpidmp 
&gt; &gt; RSDP "TOSHIB" @ 0x000f1140
&gt; &gt;   0000: 52 53 44 20 50 54 52 20 14 54 4f 53 48 49 42 00  RSD 
&gt; &gt; PTR .TOSHIB.
&gt; &gt;   0010: 00 00 ff 05                                      ....
&gt; &gt; 
&gt; &gt; acpidmp: cannot map the RSDT
&gt; 

-- 
Jens Taprogge

</body></email><email><emailId>20001218193007</emailId><senderName>"Therien, Guy"</senderName><senderEmail>guy.therien@intel.com</senderEmail><timestampReceived>2000-12-18 19:30:07-0400</timestampReceived><subject>RE: [Acpi] resume</subject><body>

I will try to answer some of these questions.
Guy

-&gt; The ACPI spec describes this for you, though I wouldn't recommend that
-&gt; document for anyone that is not a masochist.
-
-The next time I feel like punishing myself I'll look into it. Thanks.

I spent a lot of time trying to make the spec more readable in 2.0. The 1.0
spec had for the most part an author per chapter so there were problems with
redundancy, inconsistent nomenclature and frankly ordering. I couldn't read
it either so while it's nowhere near perfect.... 2.0 should be much better -
try it.


-Ok.
-But what makes it decide to wake up from S2 or S3?
-Say the system is in one of these states and (I'm guessing here) the CPU is
-halted (whatever that means -- probably depends on the CPU). Then I push a
-wakeup button. What happens next? Which part of the system gets the signal?
-How does it know what to do with it up to the point where it gets the next
-CPU address from the Waking Vector? What decides which actions can wake the
-system up?

ACPI compatible hardware contains "wake logic" as defined by the acpi spec.
ACPI compatible wake capable and enabled devices assert a signal when a wake
event occurs (see ACPI 2.0 section 4.7.2.3). This signal is enabled for
propagation through to the wake logic by writing an acpi specified register
- either a bit in the PM1 Enable (for RTC wake up) or a GPE enable bit (see
ACPI 2.0 section 4.7.4.1.1.1) as specified by _PRW for generic hardware.

A wake event sets the wake status bit in the PM1status register (bit 15).
This is done BY HARDWARE as a direct result of the wake event and causes the
system to transition back into the S0 state. In wake from S1, the chipset
starts clocking the cpu again and the cpu continues from the previous
instruction. In s2-s4, the CPU is reset and the BIOS executes - checking the
firmware waking vector as described and then jumps to that vector.


-If BIOS firmware is responsible for handling wakeup until we start running
-the OS-registered wakeup handler, then is the CPU running the BIOS
firmware?

yes, from the rest vector on S2-S4 but not from S1

-If so, what woke it up and told it to start running the BIOS firmware?

The system's wake logic as described above.


-That helps. It sounds like basically just another interrupt service routine
-(but a complicated one). And the standard interrupt vector I take it is
-different from the Firmware Waking Vector.

The most important thing to remember is that Wake and Interrupt are
completely separate and different. The wake logic causes the chipset to
transition the system back into S0 and this includes allowing the CPU to
resume the execution of instructions either from the reset vector or at the
next instruction after the sleep enable bit write.

Guy

</body></email><email><emailId>20001211220756</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-12-11 22:07:56-0400</timestampReceived><subject>RE: [Acpi] PM_SYS_ARCH_SPECIFIC</subject><body>

&gt; From: Gordon McNutt [mailto:gmcnutt@ridgerun.com]
&gt; I wanted to #define this for a new architecture with some unique
&gt; devices. But I want to do it in a way that won't conflict with your
&gt; future plans.

Can you elaborate on this a little?

&gt; I thought the most straightforward way would be to add an #include
&gt; &lt;asm/pm.h&gt; to linux/pm.h. This would require all the asm-*/ 
&gt; dirs to have
&gt; at least an empty pm.h.
&gt; 
&gt; Is this what you had in mind for doing once the need arose?

Well, it sounds like what you're saying would break every arch's builds. If
this is the case you probably want to mention it on linux-kernel and/or
email the arch maintainers.

&gt;From your initial description, though, I don't see any issues with ACPI -
right now. Hooking ACPI in with Linux's device power management will
probably be one of the last things to happen, due to its scope and
difficulty, I think.

Regards -- Andy

</body></email><email><emailId>20001212005253</emailId><senderName>Gordon McNutt</senderName><senderEmail>gmcnutt@ridgerun.com</senderEmail><timestampReceived>2000-12-12 00:52:53-0400</timestampReceived><subject>Re: [Acpi] PM_SYS_ARCH_SPECIFIC</subject><body>

"Grover, Andrew" wrote:

&gt; &gt; From: Gordon McNutt [mailto:gmcnutt@ridgerun.com]
&gt; &gt; I wanted to #define this for a new architecture with some unique
&gt; &gt; devices. But I want to do it in a way that won't conflict with your
&gt; &gt; future plans.
&gt;
&gt; Can you elaborate on this a little?
&gt;

I can elaborate a lot.

We're porting Linux to a CPU intended for embedded apps. This CPU has a
feature where you can turn the clock off to unused devices for conserving
power. Things like the UART's, for example. The hardware for these devices is
integrated into the chip so they are quite specific to the CPU.

Although we don't know if vendors will be implementing the hardware registers
necessary for ACPI compliance, I thought we could at least provide a default
power management module which implemented the Linux kernel ACPI interface and
used the PM features provided by the CPU. No, this would not be ACPI
compliant, and we wouldn't try to advertise it as such. But it would be nice
to give people something, and if we stick to the ACPI interface then if
vendors do provide the hardware they could use the ACPI module in place of
ours and not break any drivers, etc.

Does this make sense? Anyway, it's simple enough to do. I just have three
things things where I want to be careful so that our module is compatible with
the future direction of ACPI.

1. I need to have pm_access and pm_dev_idle actually _do_ something. Since
what they will be doing is very CPU-specific (namely, writing to a register to
shutdown or turn on a clock) I need to define them in arch-specific code, not
in linux/pm.h.

2. I need to be able to identify the devices which this CPU can turn off.
That's where PM_SYS_ARCH_SPECIFIC seemed to make sense.

3. I may need to change the way some of the standard drivers use pm_access &amp;
pm_dev_idle. For example, it isn't enough for the serial driver to call
pm_access only when accessing the registers. Instead, it needs to call it for
the duration that someone has the driver open, during which time the user
might be expecting data to come in on the line. But perhaps this puts a
different interpretation on pm_access. My thinking is, if a driver isn't in
the pm_access state, then the hardware can get turned off. Maybe this wasn't
the original intention behind this call?

&gt; Well, it sounds like what you're saying would break every arch's builds. If
&gt; this is the case you probably want to mention it on linux-kernel and/or
&gt; email the arch maintainers.
&gt;

The patch would probably just add 0 byte or semantically empty versions of
pm.h to all the other arch's. That way they still build.

&gt;
&gt; &gt;From your initial description, though, I don't see any issues with ACPI -
&gt; right now. Hooking ACPI in with Linux's device power management will
&gt; probably be one of the last things to happen, due to its scope and
&gt; difficulty, I think.

I'd like to hear more about this, if you or anyone else have any thoughts on
the best direction to take.

Thanks,

--Gordon

</body></email><email><emailId>20001212170924</emailId><senderName>Pete Buechler</senderName><senderEmail>peterb@suse.com</senderEmail><timestampReceived>2000-12-12 17:09:24-0400</timestampReceived><subject>Re: [Acpi] PM_SYS_ARCH_SPECIFIC</subject><body>

On Monday 11 December 2000 05:52 pm, Gordon McNutt wrote:

&gt; We're porting Linux to a CPU intended for embedded apps. This CPU has
&gt; a feature where you can turn the clock off to unused devices for
&gt; conserving power. Things like the UART's, for example. The hardware
&gt; for these devices is integrated into the chip so they are quite
&gt; specific to the CPU.

This looks interesting to me. I am trying to figure out how to do the 
power management on the StrongArm 1100. So basically I need to do the 
same thing that you are planning to do. Like you, I was hoping to use 
some of the kernel's ACPI abilities.

May I ask which processor you are working on?

-- 
Pete Buechler
Developer, SuSE Labs
peterb@suse.com
http://www.suse.com/~peterb

</body></email><email><emailId>20001212222757</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-12-12 22:27:57-0400</timestampReceived><subject>RE: [Acpi] PM_SYS_ARCH_SPECIFIC</subject><body>

&gt; From: Gordon McNutt [mailto:gmcnutt@ridgerun.com]
&gt; We're porting Linux to a CPU intended for embedded apps.

[snip]

&gt; Although we don't know if vendors will be implementing the 
&gt; hardware registers
&gt; necessary for ACPI compliance, I thought we could at least 
&gt; provide a default
&gt; power management module which implemented the Linux kernel 
&gt; ACPI interface and
&gt; used the PM features provided by the CPU. No, this would not be ACPI
&gt; compliant, and we wouldn't try to advertise it as such. But 
&gt; it would be nice
&gt; to give people something, and if we stick to the ACPI 
&gt; interface then if
&gt; vendors do provide the hardware they could use the ACPI 
&gt; module in place of
&gt; ours and not break any drivers, etc.

ACPI and OS power management (OSPM) are not the same thing. Please realize
that ACPI is an *interface* -- it's a mechanism for OSPM to do things.
Neither the hardware nor the software parts of this interface are small. Do
you really want to add another 140K to the kernel running on your embedded
processor?

&gt; 1. I need to have pm_access and pm_dev_idle actually _do_ 
&gt; something. Since
&gt; what they will be doing is very CPU-specific (namely, writing 
&gt; to a register to
&gt; shutdown or turn on a clock) I need to define them in 
&gt; arch-specific code, not
&gt; in linux/pm.h.

As far as I can tell, the purpose of pm_access and pm_dev_idle are for the
driver to tell OSPM when it is busy or not, so that OSPM can then optionally
turn around and ask the driver to turn off the device via pm_send, if some
idle threshold has been hit. Linux OSPM doesn't ever do this right now.
Regardless, the code to turn off a device should be in that device's driver,
yes?

You mention below that this type of idle detection is not suitable for
devices such as UARTs that need to remain on when opened. I agree. In the
case of "turn me on when opened, turn me off when closed" the device driver
knows both *when* to perform the power management, and how, so a more
system-wide PM framework may not be needed. Hmm, what do you think?

&gt; 3. I may need to change the way some of the standard drivers 
&gt; use pm_access &amp;
&gt; pm_dev_idle. For example, it isn't enough for the serial 
&gt; driver to call
&gt; pm_access only when accessing the registers. Instead, it 
&gt; needs to call it for
&gt; the duration that someone has the driver open, during which 
&gt; time the user
&gt; might be expecting data to come in on the line. But perhaps 
&gt; this puts a
&gt; different interpretation on pm_access. My thinking is, if a 
&gt; driver isn't in
&gt; the pm_access state, then the hardware can get turned off. 
&gt; Maybe this wasn't
&gt; the original intention behind this call?

Hmm. If I'm right about what I said above, the serial driver should not be
calling pm_access, as timer-based idle detection is not appropriate for
serial devices.

&gt; I'd like to hear more about this, if you or anyone else have 
&gt; any thoughts on the best direction to take.

1. The OS needs to be able to notify any device it needs to turn off
(Reason: suspend)
2. The driver needs to be able to turn itself off when not in use (Reason:
power savings)
3. The OS needs to be able to override a device's transition request
(Reason: other devices may rely on the device. Only the OS knows this.)
4. Drivers should both have the chance to be responsible for their own idle
detection, or allow the OS to do timer-based idle detection, or not ever
power down in S0. (Reason: different devices have different requirements.)

AFAIK the current PM architecture does #1, with some hooks to do the second
part of #4, and doesn't preclude #2.

Regards -- Andy

</body></email><email><emailId>20001213111525</emailId><senderName>David Woodhouse</senderName><senderEmail>dwmw2@infradead.org</senderEmail><timestampReceived>2000-12-13 11:15:25-0400</timestampReceived><subject>Re: [Acpi] PM_SYS_ARCH_SPECIFIC</subject><body>

andrew.grover@intel.com said:

&gt; 1. The OS needs to be able to notify any device it needs to turn off
&gt; (Reason: suspend)

&gt; 2. The driver needs to be able to turn itself off when not in use (Reason:
&gt; power savings)

&gt; 3. The OS needs to be able to override a device's transition request
&gt; (Reason: other devices may rely on the device. Only the OS knows this.)

&gt; 4. Drivers should both have the chance to be responsible for their own idle
&gt; detection, or allow the OS to do timer-based idle detection, or not ever
&gt; power down in S0. (Reason: different devices have different requirements.)

5. The OS needs to know _when_ to turn devices on/off. The mechanism is 
provided by #1. We have to have policy _somewhere_.

I suspect the way to do it is to have a state machine handled in kernel 
space, with an API for that state machine to be uploaded by a userspace 
program.

--
dwmw2

</body></email><email><emailId>20001215010443</emailId><senderName>Gordon McNutt</senderName><senderEmail>gmcnutt@ridgerun.com</senderEmail><timestampReceived>2000-12-15 01:04:43-0400</timestampReceived><subject>Re: [Acpi] PM_SYS_ARCH_SPECIFIC</subject><body>

"Grover, Andrew" wrote:

&gt; As far as I can tell, the purpose of pm_access and pm_dev_idle are for the
&gt; driver to tell OSPM when it is busy or not, so that OSPM can then optionally
&gt; turn around and ask the driver to turn off the device via pm_send, if some
&gt; idle threshold has been hit. Linux OSPM doesn't ever do this right now.
&gt; Regardless, the code to turn off a device should be in that device's driver,
&gt; yes?
&gt;

What if the hardware to turn off a device is not part of that device's
hardware? For example, should the standard serial.c know how to access an
architecture-specific register to unclock the UART? A register which is not
part of the UART? Perhaps serial.c should know how to invoke an
architecture-independent interface to turn off the hardware, but it probably
doesn't need to know how that interface is implemented.

But I do agree now that pm_access() is not meant for this. It probably is meant
to inform the PM module that it needs the hardware to be up. And the purpose of
pm_dev_idle is probably just to inform the PM module that it can turn off the
hardware if it wants to. Currently nobody seems to use it, though.

&gt; You mention below that this type of idle detection is not suitable for
&gt; devices such as UARTs that need to remain on when opened. I agree. In the
&gt; case of "turn me on when opened, turn me off when closed" the device driver
&gt; knows both *when* to perform the power management, and how, so a more
&gt; system-wide PM framework may not be needed. Hmm, what do you think?
&gt;

Although I did not agree that it knows *how* (at least not the details -- it
might know how to tell something else to do it, though), I would agree that it
does know *when*, except that your point #3 below is a good one. The OS may
know when it is *not* a good idea, even if the driver wants to. This argues in
favor of letting a driver request the OSPM module to turn off the hardware,
rather than having the driver do it by itself.

So in this case, the driver decides "now is a good time to turn hardware off --
I don't need it, anyway" and asks the OSPM module to turn it off. This module,
wether it be ACPI or whatever, can either disagree and not turn hardware off,
or it can agree and invoke the arch-specific routines to do so.

The scenario works for turning hardware back on, also.

&gt; 1. The OS needs to be able to notify any device it needs to turn off
&gt; (Reason: suspend)
&gt; 2. The driver needs to be able to turn itself off when not in use (Reason:
&gt; power savings)
&gt; 3. The OS needs to be able to override a device's transition request
&gt; (Reason: other devices may rely on the device. Only the OS knows this.)
&gt; 4. Drivers should both have the chance to be responsible for their own idle
&gt; detection, or allow the OS to do timer-based idle detection, or not ever
&gt; power down in S0. (Reason: different devices have different requirements.)
&gt;

These are good points. I think my ideas cover #1 - #3. Now, what about that
last part of #4? This seems to imply that both the driver and the OSPM module
need to concur on when to turn off the hardware. And I guess it doesn't really
matter which one makes the arch-specific call to actually turn things off, but
whoever does it must get the consent of the other first in order to satisfy all
requirements.

And since the ability to turn off a device's hardware will really end up being
arch-specific, with many archs not being able to do it for many devices, it
seems like it would clutter the driver's less if the only interface they had to
deal with was OSPM. And then the OSPM impl could handle the arch-specific
stuff.

At least, for the arch I'm looking at, this is the case. Perhaps in the future
it will be more common for device hardware to have the means to turn itself
off. But probably for a while it will be easier for OEM's to use standard
hardware with an external clock gate, and this seems very platform-specific.

Any comments?

--Gordon

</body></email><email><emailId>20001216003951</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-12-16 00:39:51-0400</timestampReceived><subject>RE: [Acpi] PM_SYS_ARCH_SPECIFIC</subject><body>

&gt; From: Gordon McNutt [mailto:gmcnutt@ridgerun.com]
&gt; What if the hardware to turn off a device is not part of that device's
&gt; hardware? For example, should the standard serial.c know how 
&gt; to access an
&gt; architecture-specific register to unclock the UART? A 
&gt; register which is not
&gt; part of the UART? Perhaps serial.c should know how to invoke an
&gt; architecture-independent interface to turn off the hardware, 
&gt; but it probably
&gt; doesn't need to know how that interface is implemented.

Well, I took a look at Linux's serial driver code. It appears there are two
options. Option one is, if your hardware is kind-of like a standard serial
port, is to special-case your code in the main serial.c. Option 2 appears to
be splitting your special serial driver out into a separate driver, as the
author of the StrongArm-110 21285 serial driver did. Would either of these
be an option?

[snip]

&gt; These are good points. I think my ideas cover #1 - #3. Now, 
&gt; what about that
&gt; last part of #4? This seems to imply that both the driver and 
&gt; the OSPM module
&gt; need to concur on when to turn off the hardware. And I guess 
&gt; it doesn't really
&gt; matter which one makes the arch-specific call to actually 
&gt; turn things off, but
&gt; whoever does it must get the consent of the other first in 
&gt; order to satisfy all
&gt; requirements.

I think you're close in assuming turning things on and off, but I think it's
more accurate to say it's *bus-specific*. For example, the USB or PCI specs
define powering off devices on their interface. ACPI can be thought of as
providing a PnP bus for all devices that don't have one - namely motherboard
devices. For a motherboard device, the OEM implements _PSx methods for it,
and then running these controls the device's power state.

&gt; And since the ability to turn off a device's hardware will 
&gt; really end up being
&gt; arch-specific, with many archs not being able to do it for 
&gt; many devices, it
&gt; seems like it would clutter the driver's less if the only 
&gt; interface they had to
&gt; deal with was OSPM. And then the OSPM impl could handle the 
&gt; arch-specific
&gt; stuff.

This is exactly right. However, we don't want to have to re-write OSPM for
each platform. So, ACPI is designed to abstract the platform-specific stuff
into control methods, which in turn do the dirty work, when called by OSPM.

&gt; At least, for the arch I'm looking at, this is the case. 
&gt; Perhaps in the future
&gt; it will be more common for device hardware to have the means 
&gt; to turn itself
&gt; off. But probably for a while it will be easier for OEM's to 
&gt; use standard
&gt; hardware with an external clock gate, and this seems very 
&gt; platform-specific.
&gt; 
&gt; Any comments?

As I've tried to describe above, ACPI was implemented to solve this problem,
but it won't solve it today, and it wasn't designed to solve it on embedded
devices (so its size may be prohibitive). That's why my first thought was to
hack up the serial driver in the meantime. ;-)

Regards -- Andy

</body></email><email><emailId>20001206194239</emailId><senderName>Sean Furey</senderName><senderEmail>sean@furey.freeserve.co.uk</senderEmail><timestampReceived>2000-12-06 19:42:39-0400</timestampReceived><subject>Re: [Acpi] Re: PM in 2.2</subject><body>

Hi Simon!

&gt; &gt; I would like to know if there is any back-port of ACPI to 2.2.
&gt; &gt; Problem: 2-way machine, so APM does not work.
&gt; &gt; I would love my box powers down when I shutdown...just like macs.
&gt; 
&gt; No, the current ACPI drivers haven't been backported, and it is neither
&gt; planned nor possible, since the drivers rely on the new power management
&gt; interface introduced in 2.4 and also all drivers being ported to this
&gt; interface.
&gt; 
&gt; Power-down should also work with APM on SMP boxen by activating APM just
&gt; before shutdown. I don't recall since what version this is in the kernel,
&gt; but it might be worth looking at.

Is my 2.2.14 patch still on the website?  That might do the job.
Don't know much about it, except that it has virtually no ACPI
functionality bar poweroff.  Might be worth a try if APM refuses to
work.

-- 
Sean Furey, a happy and satisfied Debian user.
sean@furey.freeserve.co.uk

</body></email><email><emailId>20001205175419</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-12-05 17:54:19-0400</timestampReceived><subject>RE: [Acpi] Startup problems</subject><body>

I have a good idea.

The previous release had a problem where handlers were being over-installed,
resulting in AE_EXIST (error 7). We installed handlers in two places - we
did a namespace walk for all PCI root bridges (based on HID) and installed
one, and then we also, on first access to a region, walk up the tree to see
if there are any PCI bridges between us and the root, and if so, we install
one then, too.

I believed the latter code negated the need for the former, and removed the
former. I'm not too surprised something broke (but it didn't break anything
on my machines ;-)

Can you narrow down where in the init process this is happening? The two
places I would think it would happen (ns_initialize_objects or
ns_initialize_devices) both would emit additional messages if their
respective walk_namespace failed.

Regards -- Andy

&gt; From: brendan burns [mailto:bburns@wso.williams.edu]
&gt; ACPI: System description tables loaded
&gt;  amfldio-0121: Aml_read_field_data: **** Region PCIConfig(2) has no
&gt; handler
&gt; breakpoint: Fatal error encountered
&gt; ACPI: Subsystem enable failed

&gt; After a little investigation I see that the parse walk 
&gt; through the tree on
&gt; PCI enabling is succeding but the second parse walk (the one 
&gt; that leads to
&gt; execution fails with the error AE_NO_EXIST (error #6)  Anyone have any
&gt; ideas what might be causing this?

</body></email><email><emailId>20001204170825</emailId><senderName>Jens Taprogge</senderName><senderEmail>taprogge@idg.rwth-aachen.de</senderEmail><timestampReceived>2000-12-04 17:08:25-0400</timestampReceived><subject>Re: [Acpi] Re: Failure on ASUS K7M w/ 2.4.0-test11 (also on ASUS A7V)</subject><body>

I get a very similar output on an A7V (Duron 700) with 2.4.0test11
patched with apica-linux-debug-20001115.tar.gz. I am using the BIOS
version 1.005_03E.
The major difference is that I get the results with AGP enabled. Here
the dmesg output:


ACPI Subsystem version [Dec  4 2000]
ACPI: System description tables found
tbxface-0089: ACPI Tables successfully loaded
Parsing Methods:.............................................................................................................
 109 Control Methods found and parsed (336 nodes total)
ACPI Namespace successfully loaded at root 0xc0371cb8
ACPI: System description tables loaded
evxfevnt-0082: Transition to ACPI mode successful
Executing device _INI methods:.......  nsinit-0136: Ns_initialize_devices: \
                Walk_namespace failed! 7
breakpoint: Fatal error encountered

7 Devices found: 7 _STA, 0 _INI, 7 _HID, 1 PCIRoot
ACPI: Subsystem enable failed


Jens

On Mon, Dec 04, 2000 at 03:40:53PM +0000, Adam Harrison wrote:
&gt; On Sunday 03 December 2000 18:23, Adam Harrison wrote:
&gt; 
&gt; &gt; Please let me know if you'd like me provide more information or perform
&gt; &gt; more diagnostics at my end. I'm going to try reflashing my BIOS with the
&gt; &gt; latest tomorrow to see if that helps - will keep you posted.
&gt; 
&gt; Hi All,
&gt; 
&gt; I've just reflashed my BIOS with the latest from ASUS (km1009.bin) to no 
&gt; avail - ACPI fails in exactly the same fashion as reported yesterday. I have, 
&gt; however, found something more interesting :-)
&gt; 
&gt; I vaguely remember having seen 'ACPI: Sx supported' type messages from the 
&gt; kernel in the past, and I know from inspection of the source that only the 
&gt; AML-interpreter version generates such strings. I decided to go back to an 
&gt; early testXX kernel to see if I could find a working version.
&gt; 
&gt; I picked test5, and compiled it with exactly the same settings as I'm using 
&gt; with test11+acpica-linux-debug-20001115. Well, almost - normally I compile 
&gt; AGP support directly into the kernel, but if I do this with test5 it oopses 
&gt; trying to initialise AGP. Booting this kernel results in working ACPI, 
&gt; replete with 'ACPI: Sx supported' type messages.
&gt; 
&gt; I then tried test7, which failed:
&gt; 
&gt; ACPI: support found
&gt; ACPI: namespace load failed
&gt; ACPI:         -0550: &lt;7&gt;ACPI: *** Success: Entire namespace and objects 
&gt; deleted
&gt; 
&gt; I then tried test6, which failed:
&gt; 
&gt; ACPI: support found
&gt; ACPI:         -0531: &lt;7&gt;ACPI: *** Error: Ns_search_and_enter: bad parameter
&gt; ACPI: namespace load failed
&gt; ACPI:         -0550: &lt;7&gt;ACPI: *** Success: Entire namespace and objects 
&gt; deleted
&gt; 
&gt; Then I realised that I hadn't disabled AGP when compiling 6 &amp; 7 as I had done 
&gt; for 5. To make sure, I recompiled test6 with AGP disabled:
&gt; 
&gt; ACPI: support found
&gt; ACPI: PBLK 1 @ 0x0810:6
&gt; ACPI: S1 supported
&gt; ACPI: S5 supported                                                            
&gt; 
&gt; Oh, that's interesting - it works fine with AGP disabled! The next thing I 
&gt; tried was test11+acpica-linux-debug-20001115 without AGP:
&gt; 
&gt; ACPI Subsystem version [Dec  3 2000]
&gt; ACPI: System description tables found
&gt; tbxface-0089: ACPI Tables successfully loaded
&gt; Parsing 
&gt; Methods:.....................................................................................
&gt;  85 Control Methods found and parsed (312 nodes total)
&gt; ACPI Namespace successfully loaded at root 0xc03724d8
&gt; ACPI: System description tables loaded
&gt; evxfevnt-0082: Transition to ACPI mode successful
&gt; Executing device _INI methods:.  nsinit-0136: Ns_initialize_devices: 
&gt; Walk_namespace failed! 7
&gt; breakpoint: Fatal error encountered
&gt; 
&gt; 1 Devices found: 1 _STA, 1 _INI, 1 _HID, 1 PCIRoot
&gt; ACPI: Subsystem enable failed                                                 
&gt; 
&gt; It still fails, but it gets a lot further along in the process. Is the kernel 
&gt; AGP initialisation clobbering the ACPI tables in memory ?
&gt; 
&gt; What I'll probably try next is to compile successive kernels without AGP 
&gt; support starting with test7 and find the point where it breaks.
&gt; 
&gt; Cheers,
&gt; 
&gt; Adam.
&gt; 
&gt; -- 
&gt; "All that is necessary for the triumph of evil is that good men do nothing"
&gt; - Edmunde Burke
&gt; 
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

-- 
Jens Taprogge

e-mail:taprogge@idg.rwth-aachen.de
icq: 18040768


</body></email><email><emailId>20001204233710</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-12-04 23:37:10-0400</timestampReceived><subject>[Acpi] PM in 2.2 (fwd)</subject><body>

&gt;From the lkml.

---------- Forwarded message ----------
Date: Tue, 5 Dec 2000 00:19:17 +0100
From: J . A . Magallon &lt;jamagallon@able.es&gt;
Subject: PM in 2.2

Hi everyone.

I would like to know if there is any back-port of ACPI to 2.2.
Problem: 2-way machine, so APM does not work.
I would love my box powers down when I shutdown...just like macs.

-- 
Juan Antonio Magallon Lacarta                                 #&gt; cd /pub
mailto:jamagallon@able.es                                     #&gt; more beer

Linux 2.2.18-pre24-vm #2 SMP Wed Nov 29 02:56:21 CET 2000 i686 unknown

-
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to majordomo@vger.kernel.org
Please read the FAQ at http://www.tux.org/lkml/

</body></email><email><emailId>20001206003435</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-12-06 00:34:35-0400</timestampReceived><subject>RE: [Acpi] Athlon CPU Throttling question</subject><body>

The general model appears to be the OS can do throttling, but the chipset
will also throttle  independently if things get too hot (IIRC Intel chipsets
have a THRM# input signal that indicates this Thermal Override condition.)
so that a hung OS can't damage the processor.

I would think a motherboard that reported no software throttling, but did it
on its own would not be the ideal implementation, but in the real world, not
uncommon.

It's hard to say that's what this mobo is doing, though. And, I didn't think
desktop processors usually throttle much.

Regards -- Andy

&gt; From: fpn@pobox.com [mailto:fpn@pobox.com]
&gt; I have a question regarding CPU throttling on the Athlon.
&gt; 
&gt; I want buy a new Motherboard and wanted to know whether the CPU
&gt; throttling on the Athlon depends on the BIOS or just the chip set.
&gt; 
&gt; My understanding is that the Siemens Motherboards (Intel 
&gt; though) have a
&gt; microcontroller onboard that implements the thermal/noise strategy OS
&gt; independant. Shouldn't this be done by the OS (Linux in my case)?
&gt; 
&gt; Any sugggestions?

</body></email><email><emailId>20001207160611</emailId><senderName>brendan burns</senderName><senderEmail>bburns@wso.williams.edu</senderEmail><timestampReceived>2000-12-07 16:06:11-0400</timestampReceived><subject>RE: [Acpi] Startup problems</subject><body>

Andy et al.
The initialization is failing on in
enable_subsystem
	-&gt;install_default_address_handlers
		-&gt;install_address_handler(ADDRESS_SPACE_PCI_CONFIG)
			-&gt;ns_walk_namespace()

obviously i shorthanded a few of the function names...
if you have any ideas or you need more information please let me know...

Thanks,
Brendan

</body></email><email><emailId>20001207175834</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-12-07 17:58:34-0400</timestampReceived><subject>Re: [Acpi] Re: PM in 2.2</subject><body>

On Wed, 6 Dec 2000, Sean Furey wrote:

&gt; &gt; &gt; I would like to know if there is any back-port of ACPI to 2.2.

[...]

&gt; Is my 2.2.14 patch still on the website?  That might do the job. Don't
&gt; know much about it, except that it has virtually no ACPI functionality
&gt; bar poweroff.  Might be worth a try if APM refuses to work.

Yes, it is, but it's not linked, as it was posted to the list only. The
URL is

 http://phobos.fs.tum.de/acpi/download/seans-2.2.14-acpi-patch.gz

   Simon

-- 
GPG public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: DC26 EB8D 1F35 4F44 2934  7583 DBB6 F98D 9198 3292
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

</body></email><email><emailId>20001211223142</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-12-11 22:31:42-0400</timestampReceived><subject>RE: [Acpi] Does anyone has Dell Inspiron 3500 working fine with ACPI?</subject><body>

Please download the latest source and patches from:
http://developer.intel.com/technology/iapc/acpi/downloads.htm

That said, the latest source will not result in a working lid. This is
because the lid device has yet to be implemented on Linux.

Regards -- Andy

&gt; From: Alexey Zhuravlev [mailto:alexey@datafoundation.com]
&gt; cat /proc/sys/acpi/event is silence every time, ever I close 
&gt; laptop ...
&gt; 
&gt; dmesg|grep ACPI
&gt;  BIOS-e820: 000000000000fc00 @ 0000000007ff0000 (ACPI data)
&gt;  BIOS-e820: 0000000000000400 @ 0000000007fffc00 (ACPI NVS)
&gt; ACPI: support found
&gt; ACPI: PBLK 0 @ 0x8010:0
&gt; ACPI: S1 supported
&gt; ACPI: S5 supported
&gt; ====

</body></email><email><emailId>20001213062631</emailId><senderName>"'Masu' Asgharifard"</senderName><senderEmail>masu@procache.com</senderEmail><timestampReceived>2000-12-13 06:26:31-0400</timestampReceived><subject>[Acpi] Any Backport of ACPI to 2.2.x?</subject><body>

Hi, 

Are there any backports of ACPI from 2.4.x to 2.2.x in progress? Any hint
(read: link) would be appreciated.

Regards, 

Masoud

+--------------------------+----------------------------------+
| Masoud A. Sharabiani     | Ashes, Diamonds, Foe and friend, |
| masu@procache.com        | We are all equal in the end.     |
+--------------------------+----------------------------------+

</body></email><email><emailId>20001213223433</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-12-13 22:34:33-0400</timestampReceived><subject>RE: [Acpi] quick  acpi question</subject><body>

&gt; Hi. I want to install Linux on my laptop (acer 506T) and I 
&gt; want to know if
&gt; I have to install it with the ACPI in the kernel enabled, or 
&gt; can I stop
&gt; worrying about it? I am not really concerned about how much 
&gt; power I consume.

I don't want to make any absolute statements because I don't know the exact
specifics of your laptop. In general, however, laptops continue to support
APM, so there shouldn't be a problem.

Regards -- Andy

</body></email><email><emailId>20001214185700</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-12-14 18:57:00-0400</timestampReceived><subject>RE: [Acpi] Hangs on shutdown</subject><body>

The release at http://developer.intel.com/technology/iapc/acpi/downloads.htm
&lt;http://developer.intel.com/technology/iapc/acpi/downloads.htm&gt;  fixes this
by not terminating acpi when its thread dies. That should work for now, and
longer-term the thread will be going away.
 
Regards -- Andy

-----Original Message-----
From: Niklas Andersson [mailto:niklas.a.79@telia.com]
Sent: Thursday, December 14, 2000 9:54 AM
To: acpi@phobos.fachschaften.tu-muenchen.de
Subject: [Acpi] Hangs on shutdown


Hi there i run 2.4.0-test11 on slackware.
When i run 'init 0' the machine hangs after the shutdown script finnish
with the message "ACPI: S5 faild".
The shutdown script contains:
    killall5 -15
    sleep 5
    killall5 -9
 
If i delete these lines the computer halt as it should but the root
partition will not be unmounted because processes are still accessing 
the disc and i will have a fsck on boot.
 
The problem is that 'killall5' kills [acpi] and acpid.
acpid can i restart after the partition is remounted ro but i cant restart
[acpi].
Isn't [acpi] supose to ignore these signals?
If you have a smarter shutdown script that dosn't kill [acpi] cold you
please mail it to me?


[Attachment #3 (text/html)]

&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"&gt;
&lt;HTML&gt;&lt;HEAD&gt;
&lt;META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1"&gt;


&lt;META content="MSHTML 5.00.3103.1000" name=GENERATOR&gt;
&lt;STYLE&gt;&lt;/STYLE&gt;
&lt;/HEAD&gt;
&lt;BODY bgColor=#ffffff&gt;
&lt;DIV&gt;&lt;FONT color=#0000ff face=Arial size=2&gt;&lt;SPAN class=763225418-14122000&gt;The 
release at &lt;A 
href="http://developer.intel.com/technology/iapc/acpi/downloads.htm"&gt;http://developer.intel.com/technology/iapc/acpi/downloads.htm&lt;/A&gt;Â fixes \
 this by not terminating acpi whenÂ its thread dies. That should work for 
now, and longer-term the thread will be going away.&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT color=#0000ff face=Arial size=2&gt;&lt;SPAN 
class=763225418-14122000&gt;&lt;/SPAN&gt;&lt;/FONT&gt;Â &lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT color=#0000ff face=Arial size=2&gt;&lt;SPAN 
class=763225418-14122000&gt;Regards -- Andy&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;
&lt;BLOCKQUOTE 
style="BORDER-LEFT: #0000ff 2px solid; MARGIN-LEFT: 5px; MARGIN-RIGHT: 0px; \
PADDING-LEFT: 5px"&gt;  &lt;DIV align=left class=OutlookMessageHeader dir=ltr&gt;&lt;FONT \
face=Tahoma   size=2&gt;-----Original Message-----&lt;BR&gt;&lt;B&gt;From:&lt;/B&gt; Niklas Andersson 
  [mailto:niklas.a.79@telia.com]&lt;BR&gt;&lt;B&gt;Sent:&lt;/B&gt; Thursday, December 14, 2000 
  9:54 AM&lt;BR&gt;&lt;B&gt;To:&lt;/B&gt; 
  acpi@phobos.fachschaften.tu-muenchen.de&lt;BR&gt;&lt;B&gt;Subject:&lt;/B&gt; [Acpi] Hangs on 
  shutdown&lt;BR&gt;&lt;BR&gt;&lt;/DIV&gt;&lt;/FONT&gt;
  &lt;DIV&gt;&lt;FONT face=Arial size=2&gt;Hi there i run 2.4.0-test11 on slackware.&lt;BR&gt;When 
  i run 'init 0' the machine hangs after the shutdown script finnish&lt;BR&gt;with the 
  message "ACPI: S5 faild".&lt;BR&gt;The shutdown script 
  contains:&lt;BR&gt;Â Â Â  killall5 -15&lt;BR&gt;Â Â Â  sleep 
  5&lt;BR&gt;Â Â Â  killall5 -9&lt;/FONT&gt;&lt;/DIV&gt;
  &lt;DIV&gt;Â &lt;/DIV&gt;
  &lt;DIV&gt;&lt;FONT face=Arial size=2&gt;If i delete these lines the computer halt as it 
  should but the root&lt;BR&gt;partition will not be unmounted because processes are 
  still accessing &lt;BR&gt;the disc and i will have a fsck on boot.&lt;/FONT&gt;&lt;/DIV&gt;
  &lt;DIV&gt;Â &lt;/DIV&gt;
  &lt;DIV&gt;&lt;FONT face=Arial size=2&gt;The problem is that 'killall5' kills [acpi] and 
  acpid.&lt;BR&gt;acpid can i restart after the partition is remounted ro but i cant 
  restartÂ [acpi].&lt;BR&gt;Isn't [acpi] supose to ignore these signals?&lt;BR&gt;If you 
  have a smarter shutdown script that dosn't kill [acpi] cold you&lt;BR&gt;please mail 
  it to me?&lt;/FONT&gt;&lt;/DIV&gt;&lt;/BLOCKQUOTE&gt;&lt;/BODY&gt;&lt;/HTML&gt;



</body></email><email><emailId>20001218170058</emailId><senderName>Gordon McNutt</senderName><senderEmail>gmcnutt@ridgerun.com</senderEmail><timestampReceived>2000-12-18 17:00:58-0400</timestampReceived><subject>Re: [Acpi] PM_SYS_ARCH_SPECIFIC</subject><body>

"Grover, Andrew" wrote:

&gt; &gt; And since the ability to turn off a device's hardware will
&gt; &gt; really end up being
&gt; &gt; arch-specific, with many archs not being able to do it for
&gt; &gt; many devices, it
&gt; &gt; seems like it would clutter the driver's less if the only
&gt; &gt; interface they had to
&gt; &gt; deal with was OSPM. And then the OSPM impl could handle the
&gt; &gt; arch-specific
&gt; &gt; stuff.
&gt;
&gt; This is exactly right. However, we don't want to have to re-write OSPM for
&gt; each platform. So, ACPI is designed to abstract the platform-specific stuff
&gt; into control methods, which in turn do the dirty work, when called by OSPM.

Ok. It just seems that the current OSPM interface doesn't give the device
driver a way to turn its own device off.

--Gordon

</body></email><email><emailId>20001218220410</emailId><senderName>"Gough, Robert"</senderName><senderEmail>robert.gough@intel.com</senderEmail><timestampReceived>2000-12-18 22:04:10-0400</timestampReceived><subject>RE: [Acpi] resume</subject><body>

Just a minor correction...
Upon waking from S4, the firmware does not jump to the OS waking vector.  In
S4, the OS is responsible for restoring memory, so at the point that the
firmware passes control to the OS, there won't be a valid address in the
FACP for the waking vector.  In the resume from S4 state, the firmware loads
the OS in the same manner that it does when it boots normally.  In most
cases, the OS loader determines that it's resuming from S4 (somehow), and
takes the S4 resume path.
Rob

-----Original Message-----
From: Therien, Guy [mailto:guy.therien@intel.com]
Sent: Monday, December 18, 2000 11:30 AM
To: 'Gordon McNutt'; Patrick Mochel
Cc: acpi@phobos.fachschaften.tu-muenchen.de
Subject: RE: [Acpi] resume


I will try to answer some of these questions.
Guy

-&gt; The ACPI spec describes this for you, though I wouldn't recommend that
-&gt; document for anyone that is not a masochist.
-
-The next time I feel like punishing myself I'll look into it. Thanks.

I spent a lot of time trying to make the spec more readable in 2.0. The 1.0
spec had for the most part an author per chapter so there were problems with
redundancy, inconsistent nomenclature and frankly ordering. I couldn't read
it either so while it's nowhere near perfect.... 2.0 should be much better -
try it.


-Ok.
-But what makes it decide to wake up from S2 or S3?
-Say the system is in one of these states and (I'm guessing here) the CPU is
-halted (whatever that means -- probably depends on the CPU). Then I push a
-wakeup button. What happens next? Which part of the system gets the signal?
-How does it know what to do with it up to the point where it gets the next
-CPU address from the Waking Vector? What decides which actions can wake the
-system up?

ACPI compatible hardware contains "wake logic" as defined by the acpi spec.
ACPI compatible wake capable and enabled devices assert a signal when a wake
event occurs (see ACPI 2.0 section 4.7.2.3). This signal is enabled for
propagation through to the wake logic by writing an acpi specified register
- either a bit in the PM1 Enable (for RTC wake up) or a GPE enable bit (see
ACPI 2.0 section 4.7.4.1.1.1) as specified by _PRW for generic hardware.

A wake event sets the wake status bit in the PM1status register (bit 15).
This is done BY HARDWARE as a direct result of the wake event and causes the
system to transition back into the S0 state. In wake from S1, the chipset
starts clocking the cpu again and the cpu continues from the previous
instruction. In s2-s4, the CPU is reset and the BIOS executes - checking the
firmware waking vector as described and then jumps to that vector.


-If BIOS firmware is responsible for handling wakeup until we start running
-the OS-registered wakeup handler, then is the CPU running the BIOS
firmware?

yes, from the rest vector on S2-S4 but not from S1

-If so, what woke it up and told it to start running the BIOS firmware?

The system's wake logic as described above.


-That helps. It sounds like basically just another interrupt service routine
-(but a complicated one). And the standard interrupt vector I take it is
-different from the Firmware Waking Vector.

The most important thing to remember is that Wake and Interrupt are
completely separate and different. The wake logic causes the chipset to
transition the system back into S0 and this includes allowing the CPU to
resume the execution of instructions either from the reset vector or at the
next instruction after the sleep enable bit write.

Guy



_______________________________________________
acpi maillist  -  acpi@phobos.fs.tum.de
http://phobos.fs.tum.de/mailman/listinfo/acpi

</body></email><email><emailId>20001219112032</emailId><senderName>David Woodhouse</senderName><senderEmail>dwmw2@infradead.org</senderEmail><timestampReceived>2000-12-19 11:20:32-0400</timestampReceived><subject>Re: [Acpi] Source release updated: (12-01-2000)</subject><body>

andrew.grover@intel.com said:
&gt; Method \_TZ.THRM._PSL references the nonexistent CPU0, and ACPI fails
&gt; to load as a result. I was wrong, this is not the same problem Brendan
&gt; Burns was having - the AE_NOT_FOUNDs stem from CPU0 not being found,
&gt; not any sort of PCI Config problem.

&gt; This would be an easy one for a BIOS engineer at Abit to fix. My first
&gt; thought would be to contact Abit (technical@abit-usa.com ?) and that
&gt; would probably be better coming from the person who actually bought
&gt; it. ;-)

Unfortunately, abituktech@compuserve.com is bouncing,
postmaster@abit-usa.com is also bouncing, and technical@abit-usa.com is
populated by people who give idiotic responses such as:

jwang@abit-usa.com said:
&gt; In our BIOS, you can disable the ACPI function in power management
&gt; (page 3-21)
&gt; RU is the latest one already... 

I pointed out that their suggestion would be extremely unlikely to make it
work for me, but they haven't responded :)

Got any alternative suggestions?


--
dwmw2

</body></email><email><emailId>20001219214131</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-12-19 21:41:31-0400</timestampReceived><subject>RE: [Acpi] ACPI problems with Toshiba laptop</subject><body>

I'm thinking your system is actually reporting slightly less than 96MB.

OK, let's debug why acpidmp reports that message.

'cat /dev/mem &gt;file.dat'

How big is file.dat? acpidmp is trying to map offset 100,597,760
(0x05ff0000) so if it's smaller, then that explains its failure. I think
this means that Linux is misinformed as to how much memory your system has.

What does dmesg say regarding memory on boot? Can you post your
BIOS-provided physical ram map?

Thanks -- Andy

&gt; -----Original Message-----
&gt; From: Jens Taprogge [mailto:taprogge@idg.rwth-aachen.de]
&gt; Sent: Tuesday, December 19, 2000 3:12 AM
&gt; To: Grover, Andrew
&gt; Cc: acpi@phobos.fachschaften.tu-muenchen.de
&gt; Subject: Re: [Acpi] ACPI problems with Toshiba laptop
&gt; 
&gt; 
&gt; Exactly 96MB.
&gt; 
&gt; $ cat /proc/meminfo 
&gt;         total:    used:    free:  shared: buffers:  cached:
&gt; Mem:  96350208 93999104  2351104        0 19030016 11894784
&gt; 
&gt; 
&gt; Regards
&gt; Jens
&gt; 
&gt; On Mon, Dec 18, 2000 at 04:05:39PM -0800, Grover, Andrew wrote:
&gt; &gt; How much memory does this system have? Less than 96MB?
&gt; &gt; 
&gt; &gt; Thanks -- Andy
&gt; &gt; 
&gt; &gt; &gt; From: Jens Taprogge [mailto:taprogge@idg.rwth-aachen.de]
&gt; &gt; &gt; # ./acpidmp 
&gt; &gt; &gt; RSDP "TOSHIB" @ 0x000f1140
&gt; &gt; &gt;   0000: 52 53 44 20 50 54 52 20 14 54 4f 53 48 49 42 00  RSD 
&gt; &gt; &gt; PTR .TOSHIB.
&gt; &gt; &gt;   0010: 00 00 ff 05                                      ....
&gt; &gt; &gt; 
&gt; &gt; &gt; acpidmp: cannot map the RSDT
&gt; &gt; 
&gt; 
&gt; -- 
&gt; Jens Taprogge
&gt; 

</body></email><email><emailId>20001220004202</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-12-20 00:42:02-0400</timestampReceived><subject>[Acpi] Source release updated: (12-15-2000)</subject><body>

This will be posted today, ~9pm PST at
http://developer.intel.com/technology/iapc/acpi/downloads.htm

Linux-specific changes:
--------------------
Improved battery support (Brendan Burns)
Fixed sleep_on race (David Woodhouse)

Core changes:
--------------------
Fixed a problem where named references within the ASL definition of both
OperationRegions and CreateXXXFields did not work properly.  The symptom
was an AE_AML_OPERAND_TYPE during initialization of the region/field.
This is similar (but not related internally) to the problem that was
fixed in the last label.

Implemented both 32-bit and 64-bit support for the BCD ASL functions
ToBCD and FromBCD.

Strings in returned packages now have trailing null.

Updated all legal headers to include "2000" in the copyright years.

Regards -- Andy

----------------------------
Andrew Grover
Intel/TRL/MAL
andrew.grover@intel.com

</body></email><email><emailId>20001220010241</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-12-20 01:02:41-0400</timestampReceived><subject>[Acpi] ASL Compiler released</subject><body>

I'd like to mention we're releasing an ASL compiler tonight as well.
Currently only a Windows binary is available, but the source is included in
both the Windows and Unix source packages.

Regards -- Andy

----------------------------
Andrew Grover
Intel/TRL/MAL
andrew.grover@intel.com

</body></email><email><emailId>20001220091456</emailId><senderName>"Adam J. Richter"</senderName><senderEmail>adam@yggdrasil.com</senderEmail><timestampReceived>2000-12-20 09:14:56-0400</timestampReceived><subject>Re: [Acpi] 2.4.0-test13pre3 acpi circular dependency</subject><body>

The following fixes a circular depency problem between
drivers/acpi/ and arch/{i386,ia64}/kernel/acpi.c.  I think the
problem only occurs if you manually tweak the build to make
acpi.o as a module, but it still should be fixed.  This patch
also fixes the Makefiles in drivers/acpi so that they do not
blow up if you try to build drivers/acpi as a module (these
are corrections to some variable names, not a new functional
addition to the Makefiles).

	I have deliberately not included the patch to change
CONFIG_ACPI into a tristate because I wonder if there is some problem
with acpi.o as a module that I am not aware of that is the reason
that CONFIG_ACPI in the stock kernels is configured as a boolean, even
though there is module initialization code in drivers/acpi, that seems
to work just fine, at least for my purposes of deactivating the
power after a shutdown.  Does anybody know if there some known problem
with acpi.o as a module?

	I have attached my kernel patch below.  If this meets with
no obections, can somebody bless this and "send" it to Linus for
integration?

On Tue, Dec 19, 2000 at 06:00:15PM -0800, Grover, Andrew wrote:
&gt; I'm thinking arch/i386/kernel/acpi.c should just go away, yes?
&gt; 
&gt; Its purpose is probably better served by an ifdef, like you mentioned.
[...]
&gt; &gt; From: Adam J. Richter [mailto:adam@yggdrasil.com]
&gt; &gt; 
&gt; &gt; 	Although the stock linux-2.4.0-test13pre3 does not allow
&gt; &gt; one to build the acpi interpreter as a loadable module, I had
&gt; &gt; tweaked the Makefiles in previous kernels to do this (the supporting
&gt; &gt; code is there and it seemed to work, at least for shutting off the
&gt; &gt; power after a shutdown).  Unfortunately, in 2.4.0-test13pre3, this
&gt; &gt; is no harder to do, because there is a circular dependency:
&gt; &gt; 
&gt; &gt; drivers/acpi/ references acpi_get_rsdp_ptr in arch/i386/kernel/acpi.c,
&gt; &gt; 				and
&gt; &gt; arch/i386/kernel/acpi.c references acp_find_root_pointer in 
&gt; &gt; drivers/acpi/.
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 	I would like to recommend that the contents of
&gt; &gt; arch/i{386,a64}/kernel/acpi.c be merged back somewhere in 
&gt; &gt; drivers/acpi/,
&gt; &gt; and just selected with Makefile options, ifdefs, or perhaps runtime
&gt; &gt; options (if the ia64 code is potentionally useable to an i386 kernel
&gt; &gt; that find itself running on an ia64 CPU, which will probably 
&gt; &gt; be the case
&gt; &gt; with most Linux distributions initially installed on ia64 hardware).
&gt; &gt; 
&gt; &gt; 	If need be, I would be willing to at least write a quick and
&gt; &gt; dirty #ifdef-based version of this proposed change.

-- 
Adam J. Richter     __     ______________   4880 Stevens Creek Blvd, Suite 104
adam@yggdrasil.com     \ /                  San Jose, California 95129-1034
+1 408 261-6630         | g g d r a s i l   United States of America
fax +1 408 261-6631      "Free Software For The Rest Of Us."

["acpi.diffs" (text/plain)]

diff --new-file -r -u linux-2.4.0-test13-pre3/drivers/acpi/Makefile \
                linux/drivers/acpi/Makefile
--- linux-2.4.0-test13-pre3/drivers/acpi/Makefile	Wed Dec 20 00:49:37 2000
+++ linux/drivers/acpi/Makefile	Wed Dec 20 00:03:27 2000
@@ -3,6 +3,7 @@
 #
 
 O_TARGET := acpi.o
+obj-m := $(O_TARGET)
 
 export-objs := ksyms.o
 
@@ -25,13 +26,23 @@
 
 subdir-$(CONFIG_ACPI) += $(acpi-subdirs)
 
-obj-$(CONFIG_ACPI) := $(patsubst %,%.o,$(acpi-subdirs))
-obj-$(CONFIG_ACPI) += os.o ksyms.o
+obj-y := $(patsubst %,%.o,$(acpi-subdirs))
+obj-y += os.o ksyms.o
+
+$(patsubst %,%.o,$(acpi-subdirs)):
+	$(MAKE) $(MFLAGS) -C $$(basename $@ .o) ../$@
 
 ifdef CONFIG_ACPI_KERNEL_CONFIG
-  obj-$(CONFIG_ACPI) += acpiconf.o osconf.o
+  obj-y += acpiconf.o osconf.o
 else
-  obj-$(CONFIG_ACPI) += driver.o cmbatt.o cpu.o ec.o ksyms.o sys.o table.o
+  obj-y += driver.o cmbatt.o cpu.o ec.o ksyms.o sys.o table.o
+endif
+
+ifdef CONFIG_X86
+  obj-y += rsdp_x86.o
+endif
+ifdef CONFIG_IA64
+  obj-y += rsdp_ia64.o
 endif
 
 include $(TOPDIR)/Rules.make
diff --new-file -r -u linux-2.4.0-test13-pre3/drivers/acpi/common/Makefile \
                linux/drivers/acpi/common/Makefile
--- linux-2.4.0-test13-pre3/drivers/acpi/common/Makefile	Wed Dec 20 00:49:37 2000
+++ linux/drivers/acpi/common/Makefile	Tue Dec 19 08:58:42 2000
@@ -4,7 +4,7 @@
 
 O_TARGET := ../$(shell basename `pwd`).o
 
-obj-$(CONFIG_ACPI) := $(patsubst %.c,%.o,$(wildcard *.c))
+obj-y := $(patsubst %.c,%.o,$(wildcard *.c))
 
 EXTRA_CFLAGS += -I../include
 
diff --new-file -r -u linux-2.4.0-test13-pre3/drivers/acpi/dispatcher/Makefile \
                linux/drivers/acpi/dispatcher/Makefile
--- linux-2.4.0-test13-pre3/drivers/acpi/dispatcher/Makefile	Wed Dec 20 00:49:37 2000
+++ linux/drivers/acpi/dispatcher/Makefile	Tue Dec 19 08:58:42 2000
@@ -4,7 +4,7 @@
 
 O_TARGET := ../$(shell basename `pwd`).o
 
-obj-$(CONFIG_ACPI) := $(patsubst %.c,%.o,$(wildcard *.c))
+obj-y := $(patsubst %.c,%.o,$(wildcard *.c))
 
 EXTRA_CFLAGS += -I../include
 
diff --new-file -r -u linux-2.4.0-test13-pre3/drivers/acpi/events/Makefile \
                linux/drivers/acpi/events/Makefile
--- linux-2.4.0-test13-pre3/drivers/acpi/events/Makefile	Wed Dec 20 00:49:37 2000
+++ linux/drivers/acpi/events/Makefile	Tue Dec 19 08:58:42 2000
@@ -4,7 +4,7 @@
 
 O_TARGET := ../$(shell basename `pwd`).o
 
-obj-$(CONFIG_ACPI) := $(patsubst %.c,%.o,$(wildcard *.c))
+obj-y := $(patsubst %.c,%.o,$(wildcard *.c))
 
 EXTRA_CFLAGS += -I../include
 
diff --new-file -r -u linux-2.4.0-test13-pre3/drivers/acpi/hardware/Makefile \
                linux/drivers/acpi/hardware/Makefile
--- linux-2.4.0-test13-pre3/drivers/acpi/hardware/Makefile	Wed Dec 20 00:49:37 2000
+++ linux/drivers/acpi/hardware/Makefile	Tue Dec 19 08:58:42 2000
@@ -4,7 +4,7 @@
 
 O_TARGET := ../$(shell basename `pwd`).o
 
-obj-$(CONFIG_ACPI) := $(patsubst %.c,%.o,$(wildcard *.c))
+obj-y := $(patsubst %.c,%.o,$(wildcard *.c))
 
 EXTRA_CFLAGS += -I../include
 
diff --new-file -r -u linux-2.4.0-test13-pre3/drivers/acpi/interpreter/Makefile \
                linux/drivers/acpi/interpreter/Makefile
--- linux-2.4.0-test13-pre3/drivers/acpi/interpreter/Makefile	Wed Dec 20 00:49:37 \
                2000
+++ linux/drivers/acpi/interpreter/Makefile	Tue Dec 19 08:58:42 2000
@@ -4,7 +4,7 @@
 
 O_TARGET := ../$(shell basename `pwd`).o
 
-obj-$(CONFIG_ACPI) := $(patsubst %.c,%.o,$(wildcard *.c))
+obj-y := $(patsubst %.c,%.o,$(wildcard *.c))
 
 EXTRA_CFLAGS += -I../include
 
diff --new-file -r -u linux-2.4.0-test13-pre3/drivers/acpi/ksyms.c \
                linux/drivers/acpi/ksyms.c
--- linux-2.4.0-test13-pre3/drivers/acpi/ksyms.c	Wed Dec 20 00:49:37 2000
+++ linux/drivers/acpi/ksyms.c	Tue Dec 19 09:58:21 2000
@@ -90,3 +90,5 @@
 EXPORT_SYMBOL(acpi_get_processor_cx_info);
 EXPORT_SYMBOL(acpi_set_processor_sleep_state);
 EXPORT_SYMBOL(acpi_processor_sleep);
+
+EXPORT_SYMBOL(acpi_find_root_pointer);
diff --new-file -r -u linux-2.4.0-test13-pre3/drivers/acpi/namespace/Makefile \
                linux/drivers/acpi/namespace/Makefile
--- linux-2.4.0-test13-pre3/drivers/acpi/namespace/Makefile	Wed Dec 20 00:49:37 2000
+++ linux/drivers/acpi/namespace/Makefile	Tue Dec 19 08:58:42 2000
@@ -4,7 +4,7 @@
 
 O_TARGET := ../$(shell basename `pwd`).o
 
-obj-$(CONFIG_ACPI) := $(patsubst %.c,%.o,$(wildcard *.c))
+obj-y := $(patsubst %.c,%.o,$(wildcard *.c))
 
 EXTRA_CFLAGS += -I../include
 
diff --new-file -r -u linux-2.4.0-test13-pre3/drivers/acpi/parser/Makefile \
                linux/drivers/acpi/parser/Makefile
--- linux-2.4.0-test13-pre3/drivers/acpi/parser/Makefile	Wed Dec 20 00:49:37 2000
+++ linux/drivers/acpi/parser/Makefile	Tue Dec 19 08:58:43 2000
@@ -4,7 +4,7 @@
 
 O_TARGET := ../$(shell basename `pwd`).o
 
-obj-$(CONFIG_ACPI) := $(patsubst %.c,%.o,$(wildcard *.c))
+obj-y := $(patsubst %.c,%.o,$(wildcard *.c))
 
 EXTRA_CFLAGS += -I../include
 
diff --new-file -r -u linux-2.4.0-test13-pre3/drivers/acpi/resources/Makefile \
                linux/drivers/acpi/resources/Makefile
--- linux-2.4.0-test13-pre3/drivers/acpi/resources/Makefile	Wed Dec 20 00:49:37 2000
+++ linux/drivers/acpi/resources/Makefile	Tue Dec 19 08:58:43 2000
@@ -4,7 +4,7 @@
 
 O_TARGET := ../$(shell basename `pwd`).o
 
-obj-$(CONFIG_ACPI) := $(patsubst %.c,%.o,$(wildcard *.c))
+obj-y := $(patsubst %.c,%.o,$(wildcard *.c))
 
 EXTRA_CFLAGS += -I../include
 
diff --new-file -r -u linux-2.4.0-test13-pre3/drivers/acpi/rsdp_ia64.c \
                linux/drivers/acpi/rsdp_ia64.c
--- linux-2.4.0-test13-pre3/drivers/acpi/rsdp_ia64.c	Wed Dec 31 16:00:00 1969
+++ linux/drivers/acpi/rsdp_ia64.c	Wed Dec 20 00:03:28 2000
@@ -0,0 +1,289 @@
+/*
+ * Advanced Configuration and Power Interface 
+ *
+ * Based on 'ACPI Specification 1.0b' February 2, 1999 and 
+ * 'IA-64 Extensions to ACPI Specification' Revision 0.6
+ * 
+ * Copyright (C) 1999 VA Linux Systems
+ * Copyright (C) 1999,2000 Walt Drummond &lt;drummond@valinux.com&gt;
+ */
+
+#include &lt;linux/config.h&gt;
+
+#include &lt;linux/init.h&gt;
+#include &lt;linux/kernel.h&gt;
+#include &lt;linux/sched.h&gt;
+#include &lt;linux/smp.h&gt;
+#include &lt;linux/string.h&gt;
+#include &lt;linux/types.h&gt;
+#include &lt;linux/irq.h&gt;
+
+#include &lt;asm/acpi-ext.h&gt;
+#include &lt;asm/efi.h&gt;
+#include &lt;asm/io.h&gt;
+#include &lt;asm/iosapic.h&gt;
+#include &lt;asm/machvec.h&gt;
+#include &lt;asm/page.h&gt;
+#ifdef CONFIG_ACPI_KERNEL_CONFIG
+# include &lt;asm/acpikcfg.h&gt;
+#endif
+
+#undef ACPI_DEBUG		/* Guess what this does? */
+
+/* These are ugly but will be reclaimed by the kernel */
+int __initdata available_cpus;
+int __initdata total_cpus;
+
+void (*pm_idle)(void);
+
+/*
+ * Identify usable CPU's and remember them for SMP bringup later.
+ */
+static void __init
+acpi_lsapic(char *p) 
+{
+	int add = 1;
+
+	acpi_entry_lsapic_t *lsapic = (acpi_entry_lsapic_t *) p;
+
+	if ((lsapic-&gt;flags &amp; LSAPIC_PRESENT) == 0) 
+		return;
+
+	printk("      CPU %d (%.04x:%.04x): ", total_cpus, lsapic-&gt;eid, lsapic-&gt;id);
+
+	if ((lsapic-&gt;flags &amp; LSAPIC_ENABLED) == 0) {
+		printk("Disabled.\n");
+		add = 0;
+	} else if (lsapic-&gt;flags &amp; LSAPIC_PERFORMANCE_RESTRICTED) {
+		printk("Performance Restricted; ignoring.\n");
+		add = 0;
+	}
+	
+#ifdef CONFIG_SMP
+	smp_boot_data.cpu_phys_id[total_cpus] = -1;
+#endif
+	if (add) {
+		printk("Available.\n");
+		available_cpus++;
+#ifdef CONFIG_SMP
+		smp_boot_data.cpu_phys_id[total_cpus] = (lsapic-&gt;id &lt;&lt; 8) | lsapic-&gt;eid;
+#endif /* CONFIG_SMP */
+	}
+	total_cpus++;
+}
+
+/*
+ * Configure legacy IRQ information in iosapic_vector
+ */
+static void __init
+acpi_legacy_irq(char *p)
+{
+	/*
+	 * This is not good.  ACPI is not necessarily limited to CONFIG_IA64_DIG, yet
+	 * ACPI does not necessarily imply IOSAPIC either.  Perhaps there should be
+	 * a means for platform_setup() to register ACPI handlers?
+	 */
+#ifdef CONFIG_IA64_IRQ_ACPI
+	acpi_entry_int_override_t *legacy = (acpi_entry_int_override_t *) p;
+	unsigned char vector; 
+	int i;
+
+	vector = isa_irq_to_vector(legacy-&gt;isa_irq);
+
+	/*
+	 * Clobber any old pin mapping.  It may be that it gets replaced later on
+	 */
+	for (i = 0; i &lt; IA64_MAX_VECTORED_IRQ; i++) {
+		if (i == vector) 
+			continue;
+		if (iosapic_pin(i) == iosapic_pin(vector))
+			iosapic_pin(i) = 0xff;
+        }
+
+	iosapic_pin(vector) = legacy-&gt;pin;
+	iosapic_bus(vector) = BUS_ISA;	/* This table only overrides the ISA devices */
+	iosapic_busdata(vector) = 0;
+	
+	/* 
+	 * External timer tick is special... 
+	 */
+	if (vector != TIMER_IRQ)
+		iosapic_dmode(vector) = IO_SAPIC_LOWEST_PRIORITY;
+	else 
+		iosapic_dmode(vector) = IO_SAPIC_FIXED;
+	
+	/* See MPS 1.4 section 4.3.4 */
+	switch (legacy-&gt;flags) {
+	case 0x5:
+		iosapic_polarity(vector) = IO_SAPIC_POL_HIGH;
+		iosapic_trigger(vector) = IO_SAPIC_EDGE;
+		break;
+	case 0x8:
+		iosapic_polarity(vector) = IO_SAPIC_POL_LOW;
+		iosapic_trigger(vector) = IO_SAPIC_EDGE;
+		break;
+	case 0xd:
+		iosapic_polarity(vector) = IO_SAPIC_POL_HIGH;
+		iosapic_trigger(vector) = IO_SAPIC_LEVEL;
+		break;
+	case 0xf:
+		iosapic_polarity(vector) = IO_SAPIC_POL_LOW;
+		iosapic_trigger(vector) = IO_SAPIC_LEVEL;
+		break;
+	default:
+		printk("    ACPI Legacy IRQ 0x%02x: Unknown flags 0x%x\n", legacy-&gt;isa_irq,
+		       legacy-&gt;flags);
+		break;
+	}
+
+# ifdef ACPI_DEBUG
+	printk("Legacy ISA IRQ %x -&gt; IA64 Vector %x IOSAPIC Pin %x Active %s %s Trigger\n", \
 +	       legacy-&gt;isa_irq, vector, iosapic_pin(vector), 
+	       ((iosapic_polarity(vector) == IO_SAPIC_POL_LOW) ? "Low" : "High"),
+	       ((iosapic_trigger(vector) == IO_SAPIC_LEVEL) ? "Level" : "Edge"));
+# endif /* ACPI_DEBUG */
+#endif /* CONFIG_IA64_IRQ_ACPI */
+}
+
+/*
+ * Info on platform interrupt sources: NMI. PMI, INIT, etc.
+ */
+static void __init
+acpi_platform(char *p)
+{
+	acpi_entry_platform_src_t *plat = (acpi_entry_platform_src_t *) p;
+
+	printk("PLATFORM: IOSAPIC %x -&gt; Vector %lx on CPU %.04u:%.04u\n",
+	       plat-&gt;iosapic_vector, plat-&gt;global_vector, plat-&gt;eid, plat-&gt;id);
+}
+
+/*
+ * Parse the ACPI Multiple SAPIC Table
+ */
+static void __init
+acpi_parse_msapic(acpi_sapic_t *msapic)
+{
+	char *p, *end;
+
+	/* Base address of IPI Message Block */
+	ipi_base_addr = (unsigned long) ioremap(msapic-&gt;interrupt_block, 0);
+
+	p = (char *) (msapic + 1);
+	end = p + (msapic-&gt;header.length - sizeof(acpi_sapic_t));
+
+	while (p &lt; end) {
+		
+		switch (*p) {
+		case ACPI_ENTRY_LOCAL_SAPIC:
+			acpi_lsapic(p);
+			break;
+	
+		case ACPI_ENTRY_IO_SAPIC:
+			platform_register_iosapic((acpi_entry_iosapic_t *) p);
+			break;
+
+		case ACPI_ENTRY_INT_SRC_OVERRIDE:
+			acpi_legacy_irq(p);
+			break;
+		
+		case ACPI_ENTRY_PLATFORM_INT_SOURCE:
+			acpi_platform(p);
+			break;
+		
+		default:
+			break;
+		}
+
+		/* Move to next table entry. */
+#define BAD_ACPI_TABLE
+#ifdef BAD_ACPI_TABLE
+		/*
+		 * Some prototype Lion's have a bad ACPI table
+		 * requiring this fix.  Without this fix, those
+		 * machines crash during bootup.
+		 */
+		if (p[1] == 0)
+			p = end;
+		else
+#endif
+			p += p[1];
+	}
+
+	/* Make bootup pretty */
+	printk("      %d CPUs available, %d CPUs total\n", available_cpus, total_cpus);
+}
+
+int __init 
+acpi_parse(acpi_rsdp_t *rsdp)
+{
+	acpi_rsdt_t *rsdt;
+	acpi_desc_table_hdr_t *hdrp;
+	long tables, i;
+
+	if (!rsdp) {
+		printk("Uh-oh, no ACPI Root System Description Pointer table!\n");
+		return 0;
+	}
+
+	if (strncmp(rsdp-&gt;signature, ACPI_RSDP_SIG, ACPI_RSDP_SIG_LEN)) {
+		printk("Uh-oh, ACPI RSDP signature incorrect!\n");
+		return 0;
+	}
+
+	rsdp-&gt;rsdt = __va(rsdp-&gt;rsdt);
+	rsdt = rsdp-&gt;rsdt;
+	if (strncmp(rsdt-&gt;header.signature, ACPI_RSDT_SIG, ACPI_RSDT_SIG_LEN)) {
+		printk("Uh-oh, ACPI RDST signature incorrect!\n");
+		return 0;
+	}
+
+	printk("ACPI: %.6s %.8s %d.%d\n", rsdt-&gt;header.oem_id, rsdt-&gt;header.oem_table_id, 
+	       rsdt-&gt;header.oem_revision &gt;&gt; 16, rsdt-&gt;header.oem_revision &amp; 0xffff);
+	
+#ifdef CONFIG_ACPI_KERNEL_CONFIG
+	acpi_cf_init(rsdp);
+#endif
+
+	tables = (rsdt-&gt;header.length - sizeof(acpi_desc_table_hdr_t)) / 8;
+	for (i = 0; i &lt; tables; i++) {
+		hdrp = (acpi_desc_table_hdr_t *) __va(rsdt-&gt;entry_ptrs[i]);
+
+		/* Only interested int the MSAPIC table for now ... */
+		if (strncmp(hdrp-&gt;signature, ACPI_SAPIC_SIG, ACPI_SAPIC_SIG_LEN) != 0)
+			continue;
+
+		acpi_parse_msapic((acpi_sapic_t *) hdrp);
+	}
+
+#ifdef CONFIG_ACPI_KERNEL_CONFIG
+       acpi_cf_terminate();
+#endif
+
+#ifdef CONFIG_SMP
+	if (available_cpus == 0) {
+		printk("ACPI: Found 0 CPUS; assuming 1\n");
+		available_cpus = 1; /* We've got at least one of these, no? */
+	}
+	smp_boot_data.cpu_count = available_cpus;
+#endif
+	return 1;
+}
+
+const char *
+acpi_get_sysname (void)
+{       
+	/* the following should go away once we have an ACPI parser: */
+#ifdef CONFIG_IA64_GENERIC
+	return "hpsim";
+#else
+# if defined (CONFIG_IA64_HP_SIM)
+	return "hpsim";
+# elif defined (CONFIG_IA64_SGI_SN1)
+	return "sn1";
+# elif defined (CONFIG_IA64_DIG)
+	return "dig";
+# else
+#	error Unknown platform.  Fix acpi.c.
+# endif
+#endif
+}
diff --new-file -r -u linux-2.4.0-test13-pre3/drivers/acpi/rsdp_x86.c \
                linux/drivers/acpi/rsdp_x86.c
--- linux-2.4.0-test13-pre3/drivers/acpi/rsdp_x86.c	Wed Dec 31 16:00:00 1969
+++ linux/drivers/acpi/rsdp_x86.c	Wed Dec 20 00:03:28 2000
@@ -0,0 +1,53 @@
+/*
+ *  acpi.c - Linux ACPI arch-specific functions
+ *
+ *  Copyright (C) 1999-2000 Andrew Henroid
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2 of the License, or
+ *  (at your option) any later version.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  GNU General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with this program; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+
+/*
+ * Changes:
+ * Arnaldo Carvalho de Melo &lt;acme@conectiva.com.br&gt; - 2000/08/31
+ * - check copy*user return
+ * - get rid of check_region
+ * - get rid of verify_area
+ * Arnaldo Carvalho de Melo &lt;acme@conectiva.com.br&gt; - 2000/09/28
+ * - do proper release on failure in acpi_claim_ioports and acpi_init
+ * Andrew Grover &lt;andrew.grover@intel.com&gt; - 2000/11/13
+ * - Took out support for user-level interpreter. ACPI 2.0 changes preclude
+ *   its maintenance.
+ */
+
+#include &lt;linux/config.h&gt;
+#include &lt;linux/module.h&gt;
+#include &lt;linux/init.h&gt;
+#include &lt;linux/pm.h&gt;
+
+#define _LINUX
+#include &lt;linux/acpi.h&gt;
+/* Is there a better way to include this? */
+#include &lt;../drivers/acpi/include/acpi.h&gt;
+
+ACPI_PHYSICAL_ADDRESS
+acpi_get_rsdp_ptr()
+{
+	ACPI_PHYSICAL_ADDRESS rsdp_phys;
+
+	if(ACPI_SUCCESS(acpi_find_root_pointer(&amp;rsdp_phys)))
+		return rsdp_phys;
+	else
+		return 0;
+}
diff --new-file -r -u linux-2.4.0-test13-pre3/drivers/acpi/tables/Makefile \
                linux/drivers/acpi/tables/Makefile
--- linux-2.4.0-test13-pre3/drivers/acpi/tables/Makefile	Wed Dec 20 00:49:37 2000
+++ linux/drivers/acpi/tables/Makefile	Tue Dec 19 08:58:43 2000
@@ -4,7 +4,7 @@
 
 O_TARGET := ../$(shell basename `pwd`).o
 
-obj-$(CONFIG_ACPI) := $(patsubst %.c,%.o,$(wildcard *.c))
+obj-y := $(patsubst %.c,%.o,$(wildcard *.c))
 
 EXTRA_CFLAGS += -I../include
 
--- linux-2.4.0-test13-pre3/arch/i386/kernel/Makefile	Wed Dec 20 00:49:36 2000
+++ linux/arch/i386/kernel/Makefile	Wed Dec 20 00:03:27 2000
@@ -40,6 +40,5 @@
 obj-$(CONFIG_X86_LOCAL_APIC)	+= apic.o
 obj-$(CONFIG_X86_IO_APIC)	+= io_apic.o mpparse.o
 obj-$(CONFIG_X86_VISWS_APIC)	+= visws_apic.o
-obj-$(CONFIG_ACPI)	+= acpi.o
 
 include $(TOPDIR)/Rules.make
--- linux-2.4.0-test13-pre3/arch/ia64/kernel/Makefile	Mon Oct  9 17:54:53 2000
+++ linux/arch/ia64/kernel/Makefile	Wed Dec 20 00:52:33 2000
@@ -9,7 +9,7 @@
 
 all: kernel.o head.o init_task.o
 
-obj-y := acpi.o entry.o gate.o efi.o efi_stub.o irq.o irq_ia64.o irq_sapic.o \
ivt.o		\ +obj-y := entry.o gate.o efi.o efi_stub.o irq.o irq_ia64.o irq_sapic.o \
ivt.o		\  machvec.o pal.o pci-dma.o process.o perfmon.o ptrace.o sal.o semaphore.o \
setup.o	\  signal.o sys_ia64.o traps.o time.o unaligned.o unwind.o
 
--- linux-2.4.0-test13-pre3/arch/i386/kernel/acpi.c	Wed Dec 20 00:49:36 2000
+++ /dev/null	Wed Dec 31 16:00:00 1969
@@ -1,53 +0,0 @@
-/*
- *  acpi.c - Linux ACPI arch-specific functions
- *
- *  Copyright (C) 1999-2000 Andrew Henroid
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
- */
-
-/*
- * Changes:
- * Arnaldo Carvalho de Melo &lt;acme@conectiva.com.br&gt; - 2000/08/31
- * - check copy*user return
- * - get rid of check_region
- * - get rid of verify_area
- * Arnaldo Carvalho de Melo &lt;acme@conectiva.com.br&gt; - 2000/09/28
- * - do proper release on failure in acpi_claim_ioports and acpi_init
- * Andrew Grover &lt;andrew.grover@intel.com&gt; - 2000/11/13
- * - Took out support for user-level interpreter. ACPI 2.0 changes preclude
- *   its maintenance.
- */
-
-#include &lt;linux/config.h&gt;
-#include &lt;linux/module.h&gt;
-#include &lt;linux/init.h&gt;
-#include &lt;linux/pm.h&gt;
-
-#define _LINUX
-#include &lt;linux/acpi.h&gt;
-/* Is there a better way to include this? */
-#include &lt;../drivers/acpi/include/acpi.h&gt;
-
-ACPI_PHYSICAL_ADDRESS
-acpi_get_rsdp_ptr()
-{
-	ACPI_PHYSICAL_ADDRESS rsdp_phys;
-
-	if(ACPI_SUCCESS(acpi_find_root_pointer(&amp;rsdp_phys)))
-		return rsdp_phys;
-	else
-		return 0;
-}
--- linux-2.4.0-test13-pre3/arch/ia64/kernel/acpi.c	Mon Oct  9 17:54:53 2000
+++ /dev/null	Wed Dec 31 16:00:00 1969
@@ -1,289 +0,0 @@
-/*
- * Advanced Configuration and Power Interface 
- *
- * Based on 'ACPI Specification 1.0b' February 2, 1999 and 
- * 'IA-64 Extensions to ACPI Specification' Revision 0.6
- * 
- * Copyright (C) 1999 VA Linux Systems
- * Copyright (C) 1999,2000 Walt Drummond &lt;drummond@valinux.com&gt;
- */
-
-#include &lt;linux/config.h&gt;
-
-#include &lt;linux/init.h&gt;
-#include &lt;linux/kernel.h&gt;
-#include &lt;linux/sched.h&gt;
-#include &lt;linux/smp.h&gt;
-#include &lt;linux/string.h&gt;
-#include &lt;linux/types.h&gt;
-#include &lt;linux/irq.h&gt;
-
-#include &lt;asm/acpi-ext.h&gt;
-#include &lt;asm/efi.h&gt;
-#include &lt;asm/io.h&gt;
-#include &lt;asm/iosapic.h&gt;
-#include &lt;asm/machvec.h&gt;
-#include &lt;asm/page.h&gt;
-#ifdef CONFIG_ACPI_KERNEL_CONFIG
-# include &lt;asm/acpikcfg.h&gt;
-#endif
-
-#undef ACPI_DEBUG		/* Guess what this does? */
-
-/* These are ugly but will be reclaimed by the kernel */
-int __initdata available_cpus;
-int __initdata total_cpus;
-
-void (*pm_idle)(void);
-
-/*
- * Identify usable CPU's and remember them for SMP bringup later.
- */
-static void __init
-acpi_lsapic(char *p) 
-{
-	int add = 1;
-
-	acpi_entry_lsapic_t *lsapic = (acpi_entry_lsapic_t *) p;
-
-	if ((lsapic-&gt;flags &amp; LSAPIC_PRESENT) == 0) 
-		return;
-
-	printk("      CPU %d (%.04x:%.04x): ", total_cpus, lsapic-&gt;eid, lsapic-&gt;id);
-
-	if ((lsapic-&gt;flags &amp; LSAPIC_ENABLED) == 0) {
-		printk("Disabled.\n");
-		add = 0;
-	} else if (lsapic-&gt;flags &amp; LSAPIC_PERFORMANCE_RESTRICTED) {
-		printk("Performance Restricted; ignoring.\n");
-		add = 0;
-	}
-	
-#ifdef CONFIG_SMP
-	smp_boot_data.cpu_phys_id[total_cpus] = -1;
-#endif
-	if (add) {
-		printk("Available.\n");
-		available_cpus++;
-#ifdef CONFIG_SMP
-		smp_boot_data.cpu_phys_id[total_cpus] = (lsapic-&gt;id &lt;&lt; 8) | lsapic-&gt;eid;
-#endif /* CONFIG_SMP */
-	}
-	total_cpus++;
-}
-
-/*
- * Configure legacy IRQ information in iosapic_vector
- */
-static void __init
-acpi_legacy_irq(char *p)
-{
-	/*
-	 * This is not good.  ACPI is not necessarily limited to CONFIG_IA64_DIG, yet
-	 * ACPI does not necessarily imply IOSAPIC either.  Perhaps there should be
-	 * a means for platform_setup() to register ACPI handlers?
-	 */
-#ifdef CONFIG_IA64_IRQ_ACPI
-	acpi_entry_int_override_t *legacy = (acpi_entry_int_override_t *) p;
-	unsigned char vector; 
-	int i;
-
-	vector = isa_irq_to_vector(legacy-&gt;isa_irq);
-
-	/*
-	 * Clobber any old pin mapping.  It may be that it gets replaced later on
-	 */
-	for (i = 0; i &lt; IA64_MAX_VECTORED_IRQ; i++) {
-		if (i == vector) 
-			continue;
-		if (iosapic_pin(i) == iosapic_pin(vector))
-			iosapic_pin(i) = 0xff;
-        }
-
-	iosapic_pin(vector) = legacy-&gt;pin;
-	iosapic_bus(vector) = BUS_ISA;	/* This table only overrides the ISA devices */
-	iosapic_busdata(vector) = 0;
-	
-	/* 
-	 * External timer tick is special... 
-	 */
-	if (vector != TIMER_IRQ)
-		iosapic_dmode(vector) = IO_SAPIC_LOWEST_PRIORITY;
-	else 
-		iosapic_dmode(vector) = IO_SAPIC_FIXED;
-	
-	/* See MPS 1.4 section 4.3.4 */
-	switch (legacy-&gt;flags) {
-	case 0x5:
-		iosapic_polarity(vector) = IO_SAPIC_POL_HIGH;
-		iosapic_trigger(vector) = IO_SAPIC_EDGE;
-		break;
-	case 0x8:
-		iosapic_polarity(vector) = IO_SAPIC_POL_LOW;
-		iosapic_trigger(vector) = IO_SAPIC_EDGE;
-		break;
-	case 0xd:
-		iosapic_polarity(vector) = IO_SAPIC_POL_HIGH;
-		iosapic_trigger(vector) = IO_SAPIC_LEVEL;
-		break;
-	case 0xf:
-		iosapic_polarity(vector) = IO_SAPIC_POL_LOW;
-		iosapic_trigger(vector) = IO_SAPIC_LEVEL;
-		break;
-	default:
-		printk("    ACPI Legacy IRQ 0x%02x: Unknown flags 0x%x\n", legacy-&gt;isa_irq,
-		       legacy-&gt;flags);
-		break;
-	}
-
-# ifdef ACPI_DEBUG
-	printk("Legacy ISA IRQ %x -&gt; IA64 Vector %x IOSAPIC Pin %x Active %s %s Trigger\n", \
                
-	       legacy-&gt;isa_irq, vector, iosapic_pin(vector), 
-	       ((iosapic_polarity(vector) == IO_SAPIC_POL_LOW) ? "Low" : "High"),
-	       ((iosapic_trigger(vector) == IO_SAPIC_LEVEL) ? "Level" : "Edge"));
-# endif /* ACPI_DEBUG */
-#endif /* CONFIG_IA64_IRQ_ACPI */
-}
-
-/*
- * Info on platform interrupt sources: NMI. PMI, INIT, etc.
- */
-static void __init
-acpi_platform(char *p)
-{
-	acpi_entry_platform_src_t *plat = (acpi_entry_platform_src_t *) p;
-
-	printk("PLATFORM: IOSAPIC %x -&gt; Vector %lx on CPU %.04u:%.04u\n",
-	       plat-&gt;iosapic_vector, plat-&gt;global_vector, plat-&gt;eid, plat-&gt;id);
-}
-
-/*
- * Parse the ACPI Multiple SAPIC Table
- */
-static void __init
-acpi_parse_msapic(acpi_sapic_t *msapic)
-{
-	char *p, *end;
-
-	/* Base address of IPI Message Block */
-	ipi_base_addr = (unsigned long) ioremap(msapic-&gt;interrupt_block, 0);
-
-	p = (char *) (msapic + 1);
-	end = p + (msapic-&gt;header.length - sizeof(acpi_sapic_t));
-
-	while (p &lt; end) {
-		
-		switch (*p) {
-		case ACPI_ENTRY_LOCAL_SAPIC:
-			acpi_lsapic(p);
-			break;
-	
-		case ACPI_ENTRY_IO_SAPIC:
-			platform_register_iosapic((acpi_entry_iosapic_t *) p);
-			break;
-
-		case ACPI_ENTRY_INT_SRC_OVERRIDE:
-			acpi_legacy_irq(p);
-			break;
-		
-		case ACPI_ENTRY_PLATFORM_INT_SOURCE:
-			acpi_platform(p);
-			break;
-		
-		default:
-			break;
-		}
-
-		/* Move to next table entry. */
-#define BAD_ACPI_TABLE
-#ifdef BAD_ACPI_TABLE
-		/*
-		 * Some prototype Lion's have a bad ACPI table
-		 * requiring this fix.  Without this fix, those
-		 * machines crash during bootup.
-		 */
-		if (p[1] == 0)
-			p = end;
-		else
-#endif
-			p += p[1];
-	}
-
-	/* Make bootup pretty */
-	printk("      %d CPUs available, %d CPUs total\n", available_cpus, total_cpus);
-}
-
-int __init 
-acpi_parse(acpi_rsdp_t *rsdp)
-{
-	acpi_rsdt_t *rsdt;
-	acpi_desc_table_hdr_t *hdrp;
-	long tables, i;
-
-	if (!rsdp) {
-		printk("Uh-oh, no ACPI Root System Description Pointer table!\n");
-		return 0;
-	}
-
-	if (strncmp(rsdp-&gt;signature, ACPI_RSDP_SIG, ACPI_RSDP_SIG_LEN)) {
-		printk("Uh-oh, ACPI RSDP signature incorrect!\n");
-		return 0;
-	}
-
-	rsdp-&gt;rsdt = __va(rsdp-&gt;rsdt);
-	rsdt = rsdp-&gt;rsdt;
-	if (strncmp(rsdt-&gt;header.signature, ACPI_RSDT_SIG, ACPI_RSDT_SIG_LEN)) {
-		printk("Uh-oh, ACPI RDST signature incorrect!\n");
-		return 0;
-	}
-
-	printk("ACPI: %.6s %.8s %d.%d\n", rsdt-&gt;header.oem_id, rsdt-&gt;header.oem_table_id, 
-	       rsdt-&gt;header.oem_revision &gt;&gt; 16, rsdt-&gt;header.oem_revision &amp; 0xffff);
-	
-#ifdef CONFIG_ACPI_KERNEL_CONFIG
-	acpi_cf_init(rsdp);
-#endif
-
-	tables = (rsdt-&gt;header.length - sizeof(acpi_desc_table_hdr_t)) / 8;
-	for (i = 0; i &lt; tables; i++) {
-		hdrp = (acpi_desc_table_hdr_t *) __va(rsdt-&gt;entry_ptrs[i]);
-
-		/* Only interested int the MSAPIC table for now ... */
-		if (strncmp(hdrp-&gt;signature, ACPI_SAPIC_SIG, ACPI_SAPIC_SIG_LEN) != 0)
-			continue;
-
-		acpi_parse_msapic((acpi_sapic_t *) hdrp);
-	}
-
-#ifdef CONFIG_ACPI_KERNEL_CONFIG
-       acpi_cf_terminate();
-#endif
-
-#ifdef CONFIG_SMP
-	if (available_cpus == 0) {
-		printk("ACPI: Found 0 CPUS; assuming 1\n");
-		available_cpus = 1; /* We've got at least one of these, no? */
-	}
-	smp_boot_data.cpu_count = available_cpus;
-#endif
-	return 1;
-}
-
-const char *
-acpi_get_sysname (void)
-{       
-	/* the following should go away once we have an ACPI parser: */
-#ifdef CONFIG_IA64_GENERIC
-	return "hpsim";
-#else
-# if defined (CONFIG_IA64_HP_SIM)
-	return "hpsim";
-# elif defined (CONFIG_IA64_SGI_SN1)
-	return "sn1";
-# elif defined (CONFIG_IA64_DIG)
-	return "dig";
-# else
-#	error Unknown platform.  Fix acpi.c.
-# endif
-#endif
-}



</body></email><email><emailId>20001220231847</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-12-20 23:18:47-0400</timestampReceived><subject>[Acpi] [PATCH] ACPI update fixing a bunch of stuff</subject><body>


Hi Linus,

This patch against test13-pre3 fixes the following:

	- missed wakeups (David Woodhouse)
	- circular dependency (Adam J. Richter)
	- Embedded Controller fixes (us)
	- preliminary battery /proc interface (Brendan Burns &amp; me)
	- fixed named references error (us)
	- 32 &amp; 64 bit support for BCD ASL functions (us)
	- Null-terminates strings returned in packages (us)
	- other misc cleanups.

Thanks -- Regards -- Andy

----------------------------
Andrew Grover
Intel/TRL/MAL
andrew.grover@intel.com



["acpi-20001220.diff.gz" (application/octet-stream)]

</body></email><email><emailId>20001221230015</emailId><senderName>Knut Neumann</senderName><senderEmail>kneumann@rz.uni-duesseldorf.de</senderEmail><timestampReceived>2000-12-21 23:00:15-0400</timestampReceived><subject>[Acpi] Sony Vaio Z700TEK</subject><body>

Hi there,

I luckily own a sony vaio z700tek since a short time and tried to get it to
work with acpi. I already tried kernel 2.4.0-test12 which booted but did not
work out when trying to send it in sleep mode. So I patched it with the
intel patch from 12/15/2000 - since then I am not actually able to boot the
vaio with acpi enabled. It always locks after loading the system tables. A
little debugging showed that it does not return from calling the user
function on level 5 in _ns_walks_namespace.

I tried as well to user test13-pre3 with the latest patch (12/20/2000)
from Andrew Grover
but could not extract the patch from the archives (coudl someone maybe
mail it to me?) and the unpatched kernel seems to be the same as test12
patched with the mentioned patch from 12/15/2000 - at least it locked up a
the same point.

I have to mention that lock up means that the kernel does not lock the hard
way since the vaio is still soft-resetable.

Um, and yes, the hardware: z600tek is a european edition - its a pentium III
- 700 with phoenix bios 4.0 rev 6 and intel chipset.

I would gladly joing in and help on development if someone could point me to
where to look for the problem...

Thanks in advance

-knut

knut.neumann@uni-duesseldorf.de

</body></email><email><emailId>20001221232332</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-12-21 23:23:32-0400</timestampReceived><subject>[Acpi] Announce: linux-power mailing list</subject><body>

Hi,

as there has been no official announcement so far, just a new link on the
homepage, here it goes:

We've added a new mailing list, linux-power@phobos.fs.tum.de . The list
topic is power management under Linux in general (which most likely means
the new PM API), to keep that separate from the ACPI-for-Unix stuff.

Subscription goes via the usual message

 To: linux-power-request@phobos.fs.tum.de
 Subject: subscribe

or on the web (http://phobos.fs.tum.de/acpi/ tells you).

   Simon

-- 
GPG public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: DC26 EB8D 1F35 4F44 2934  7583 DBB6 F98D 9198 3292
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

</body></email><email><emailId>20001222205149</emailId><senderName>Jens Taprogge</senderName><senderEmail>taprogge@idg.rwth-aachen.de</senderEmail><timestampReceived>2000-12-22 20:51:49-0400</timestampReceived><subject>Re: [Acpi] Re: Problems with ToPIC97 reappear between test10 and test13pre2</subject><body>

On Sat, Dec 23, 2000 at 12:54:09AM +1100, Andrew Morton wrote:
&gt; [ I removed Linus ]
&gt; 
&gt; "Grover, Andrew" wrote:
&gt; &gt; 
&gt; &gt; Are acpi and topic97 sharing the same interrupt? cat /proc/interrupts.
&gt; &gt; 
&gt; &gt; (finally, someone can reproduce this! ;-)
&gt; &gt; 
&gt; 
&gt; I can reproduce it 100% too, although I think it's different from
&gt; Jens' problem - he says his machine doesn't support ACPI.  I'm afraid
&gt; I haven't had a lot of time to do investigative work.
Actually the machine (Toshiba Satellite 4000CDS does support ACPI. But
it does not work (at least under Linux - not sure about Windows).

&lt;snip&gt;
&gt; it is not initialised correctly.  If the NIC ispluged in *after* booting it's
&gt; fine.  If the NIC is unplugged and replugged it's fine.  It's just that
&gt; first boot.
Same here. Also a modem card does not show the problem.
&gt; 
&gt; Here is some dmesg output.  The important part is the "cs:
&gt; cb_alloc(bus 2): vendor 0xffff, device 0xffff".  That's where
&gt; things start to go wrong.
That part looks a bit different here:
The last line of the dmesg output is where I reinsert the card.


Linux version 2.4.0-test13-pre2 (root@al) (gcc version 2.95.2 20000220 (Debian \
GNU/Linux)) #12 Fri Dec 22 21:17:26 CET 2000 BIOS-provided physical RAM map:
 BIOS-e820: 000000000009fc00 @ 0000000000000000 (usable)
 BIOS-e820: 0000000000000400 @ 000000000009fc00 (reserved)
 BIOS-e820: 0000000000004000 @ 00000000000e8000 (reserved)
 BIOS-e820: 0000000000010000 @ 00000000000f0000 (reserved)
 BIOS-e820: 0000000005ef0000 @ 0000000000100000 (usable)
 BIOS-e820: 0000000000010000 @ 0000000005ff0000 (ACPI data)
 BIOS-e820: 0000000000016e00 @ 00000000100a0000 (reserved)
 BIOS-e820: 0000000000000200 @ 00000000100b6e00 (ACPI NVS)
 BIOS-e820: 0000000000049000 @ 00000000100b7000 (reserved)
 BIOS-e820: 0000000000080000 @ 00000000fff80000 (reserved)
Scan SMP from c0000000 for 1024 bytes.
Scan SMP from c009fc00 for 1024 bytes.
Scan SMP from c00f0000 for 65536 bytes.
Scan SMP from c009fc00 for 4096 bytes.
On node 0 totalpages: 24576
zone(0): 4096 pages.
zone(1): 20480 pages.
zone(2): 0 pages.
mapped APIC to ffffe000 (0119a000)
Kernel command line: root=/dev/hda2 video=vesa vga=771 mem=96M parport=0x378,auto \
pci=biosirq opl3sa2=0x538,5,1,0,0x530,0x388 Initializing CPU#0
Detected 233.292 MHz processor.
Console: colour dummy device 80x25
Calibrating delay loop... 465.31 BogoMIPS
Memory: 93888k/98304k available (1795k kernel code, 4028k reserved, 123k data, 204k \
init, 0k highmem) Dentry-cache hash table entries: 16384 (order: 5, 131072 bytes)
Buffer-cache hash table entries: 4096 (order: 2, 16384 bytes)
Page-cache hash table entries: 32768 (order: 5, 131072 bytes)
Inode-cache hash table entries: 8192 (order: 4, 65536 bytes)
CPU: Before vendor init, caps: 0183f9ff 00000000 00000000, vendor = 0
CPU: L1 I cache: 16K, L1 D cache: 16K
CPU: L2 cache: 512K
Intel machine check architecture supported.
Intel machine check reporting enabled on CPU#0.
CPU: After vendor init, caps: 0183f9ff 00000000 00000000 00000000
CPU: After generic, caps: 0183f9ff 00000000 00000000 00000000
CPU: Common caps: 0183f9ff 00000000 00000000 00000000
CPU: Intel Pentium II (Deschutes) stepping 00
Checking 'hlt' instruction... OK.
POSIX conformance testing by UNIFIX
mtrr: v1.37 (20001109) Richard Gooch (rgooch@atnf.csiro.au)
mtrr: detected mtrr type: Intel
PCI: PCI BIOS revision 2.10 entry at 0xf1927, last bus=21
PCI: Using configuration type 1
PCI: Probing PCI hardware
PCI: Using IRQ router PIIX [8086/7110] at 00:07.0
PCI: Found IRQ 11 for device 00:02.0
PCI: Found IRQ 11 for device 00:02.1
PCI: Cannot allocate resource region 4 of device 00:07.1
  got res[10000000:10000fff] for resource 0 of Toshiba America Info Systems ToPIC97
  got res[10001000:10001fff] for resource 0 of Toshiba America Info Systems ToPIC97 \
(#2)  got res[1000:100f] for resource 4 of Intel Corporation 82371AB PIIX4 IDE
Limiting direct PCI/PCI transfers.
Linux NET4.0 for Linux 2.4
Based upon Swansea University Computer Society NET3.039
IA-32 Microcode Update Driver: v1.08 &lt;tigran@veritas.com&gt;
apm: BIOS version 1.2 Flags 0x02 (Driver version 1.14)
Starting kswapd v1.8
0x378: FIFO is 16 bytes
0x378: writeIntrThreshold is 8
0x378: readIntrThreshold is 8
0x378: PWord is 8 bits
0x378: Interrupts are ISA-Pulses
0x378: ECP port cfgA=0x10 cfgB=0x4b
0x378: ECP settings irq=7 dma=3
parport0: PC-style at 0x378 (0x778), irq 7, using FIFO [PCSPP,TRISTATE,COMPAT,ECP]
parport0: cpp_daisy: aa5500ff(38)
parport0: assign_addrs: aa5500ff(38)
parport0: cpp_daisy: aa5500ff(38)
parport0: assign_addrs: aa5500ff(38)
vesafb: framebuffer at 0xfe000000, mapped to 0xc6800000, size 2048k
vesafb: mode is 800x600x8, linelength=800, pages=0
vesafb: protected mode interface info at c000:96e0
vesafb: scrolling: redraw
Console: switching to colour frame buffer device 100x37
fb0: VESA VGA frame buffer device
pty: 256 Unix98 ptys configured
lp0: using parport0 (interrupt-driven).
Uniform Multi-Platform E-IDE driver Revision: 6.31
ide: Assuming 33MHz system bus speed for PIO modes; override with idebus=xx
PIIX4: IDE controller on PCI bus 00 dev 39
PIIX4: chipset revision 1
PIIX4: not 100% native mode: will probe irqs later
    ide0: BM-DMA at 0x1000-0x1007, BIOS settings: hda:DMA, hdb:pio
    ide1: BM-DMA at 0x1008-0x100f, BIOS settings: hdc:DMA, hdd:pio
hda: TOSHIBA MK4006MAV, ATA DISK drive
hdc: CD-224E, ATAPI CDROM drive
ide0 at 0x1f0-0x1f7,0x3f6 on irq 14
ide1 at 0x170-0x177,0x376 on irq 15
hda: 8007552 sectors (4100 MB), CHS=993/128/63, UDMA(33)
hdc: ATAPI 24X CD-ROM drive, 128kB Cache, DMA
Uniform CD-ROM driver Revision: 3.12
Partition check:
 hda: hda1 hda2 hda3 hda4
Floppy drive(s): fd0 is 1.44M
FDC 0 is an 8272A
NTFS version 000607
Serial driver version 5.02 (2000-08-09) with MANY_PORTS SHARE_IRQ SERIAL_PCI enabled
ttyS00 at 0x03f8 (irq = 4) is a 16550A
Real Time Clock Driver v1.10d
PPP generic driver version 2.4.1
PPP Deflate Compression module registered
Found OPL3-SAx (YMF719)
ad1848/cs4248 codec driver Copyright (C) by Hannu Savolainen 1993-1996
Linux PCMCIA Card Services 3.1.22
  options:  [pci] [cardbus] [pm]
PCI: Found IRQ 11 for device 00:02.0
PCI: Found IRQ 11 for device 00:02.1
Yenta IRQ list 0418, PCI irq11
Socket status: 30000411
Yenta IRQ list 0418, PCI irq11
Socket status: 30000011
ACPI: System description tables found
    ACPI-0191: *** Warning: Invalid table signature found
    ACPI-0073: *** Error: Acpi_load_tables: Could not load RSDT: AE_BAD_SIGNATURE
    ACPI-0101: *** Error: Acpi_load_tables: Could not load tables: AE_BAD_SIGNATURE
ACPI: System description table load failed
NET4: Linux TCP/IP 1.0 for NET4.0
IP Protocols: ICMP, UDP, TCP
IP: routing cache hash table of 512 buckets, 4Kbytes
TCP: Hash tables configured (established 8192 bind 8192)
NET4: Unix domain sockets 1.0/SMP for Linux NET4.0.
cs: socket c5feb800 timed out during reset.  Try increasing setup_delay.
cs: socket c5fb5000 voltage interrogation timed out
VFS: Mounted root (ext2 filesystem) readonly.
Freeing unused kernel memory: 204k freed
Adding Swap: 60384k swap-space (priority -1)
cs: IO port probe 0x0c00-0x0cff: clean.
cs: IO port probe 0x0800-0x08ff: clean.
cs: IO port probe 0x0100-0x04ff: excluding 0x220-0x22f 0x330-0x337 0x4d0-0x4d7
cs: IO port probe 0x0a00-0x0aff: clean.
cs: memory probe 0xa0000000-0xa0ffffff: clean.
ttyS01 at port 0x02f8 (irq = 3) is a 16550A
NET4: Linux IPX 0.42v4 for NET4.0
IPX Portions Copyright (c) 1995 Caldera, Inc.
IPX Portions Copyright (c) 2000 Conectiva, Inc.
Trying to open MFT
PPP BSD Compression module registered
eth0: NE2000 Compatible: io 0x300, irq 10, hw_addr 00:80:C8:B9:1C:A2


-- 
Jens Taprogge


</body></email><email><emailId>20001222231247</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-12-22 23:12:47-0400</timestampReceived><subject>[Acpi] Christmas and stuff</subject><body>

Hi,

to quote Krusty the Klown:

"So have a merry Christmas, Happy Hanukah, Kwazy Kwanzaa, a tip-top Tet,
and a solemn, dignified Ramadan."

I'm taking a few days off, Max and Marcel will (hopefully) take a look at
the list. Another small thing: Please double-check your vacation
autoresponders don't reply to list mail.

See you all in the new millenium,
   Simon

-- 
GPG public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: DC26 EB8D 1F35 4F44 2934  7583 DBB6 F98D 9198 3292
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

</body></email><email><emailId>20001225013606</emailId><senderName>"Yuki Ogawa"</senderName><senderEmail>y-ogawa@dvpj.sony.co.jp</senderEmail><timestampReceived>2000-12-25 01:36:06-0400</timestampReceived><subject>Re: [Acpi] Re: ACPI on Sony Vaio</subject><body>

&gt; Can anyone tell us exactly why BAT1's _STA doesn't work?
&gt; 
&gt; The disassembler's output of this method definitely looks weird:
&gt; 
&gt; 00001bf2:           Method _STA (\_SB_.PCI0.ISA_.EC0_.BAT1._STA)
&gt; 00001bf8:             ArgCount 0; NotSerialized
&gt; 00001bf9:             And
&gt; 00001bfa:               &lt;NULL&gt;
&gt; 00001bfe:               0xdb
&gt; 00001c00:               0x80
&gt; 00001c02:             0x0100
&gt; 00001c05:             Local1

Interpreter is failing with execution of user defined 
control method at 00001bfa.  0xdb and 0x80 are
the argments to the control method.
 
I don't know if interpreter is doing 1path or 2paths to load Namespace.
I think interpreter should do 2 paths (or 1 initialization and runtime evaluation)
to get number of arguments to the user defined control methods.
Because no ANSI C type function prototype statement in ASL.

----- Original Message ----- 
From: &lt;marc+acpi@mbsi.ca&gt;
To: &lt;acpi@phobos.fachschaften.tu-muenchen.de&gt;
Cc: &lt;kneumann@rz.uni-duesseldorf.de&gt;
Sent: Friday, December 22, 2000 10:44 PM
Subject: [Acpi] Re: ACPI on Sony Vaio


&gt; 
&gt; Hi Knut, everyone,
&gt; 
&gt; &gt; I luckily own a sony vaio z700tek since a short time and tried to get it to
&gt; &gt; work with acpi. I already tried kernel 2.4.0-test12 which booted but did not
&gt; &gt; work out when trying to send it in sleep mode. So I patched it with the
&gt; &gt; intel patch from 12/15/2000 - since then I am not actually able to boot the
&gt; &gt; vaio with acpi enabled. It always locks after loading the system tables. A
&gt; &gt; little debugging showed that it does not return from calling the user
&gt; &gt; function on level 5 in _ns_walks_namespace.
&gt; 
&gt; Like on my vaio z505ls it is probably stuck executing the _STA method of
&gt; the _SB_PCI0ISA_EC0_BAT1 device.
&gt; 
&gt; I've modified the code to skip execution of this method and a few others
&gt; which also hang. See patch below. It is by no means a proper fix, just a
&gt; quick hack to let the system boot. Please try it on your system and let 
&gt; me know the results.
&gt; 
&gt; Can anyone tell us exactly why BAT1's _STA doesn't work?
&gt; 
&gt; The disassembler's output of this method definitely looks weird:
&gt; 
&gt; 00001bf2:           Method _STA (\_SB_.PCI0.ISA_.EC0_.BAT1._STA)
&gt; 00001bf8:             ArgCount 0; NotSerialized
&gt; 00001bf9:             And
&gt; 00001bfa:               &lt;NULL&gt;
&gt; 00001bfe:               0xdb
&gt; 00001c00:               0x80
&gt; 00001c02:             0x0100
&gt; 00001c05:             Local1
&gt; 
&gt; Perhaps it uses opcodes not supported by the current Linux ACPI 
&gt; implementation??
&gt; 
&gt; I've appended BAT1 sections of both raw acpidmp and "acpidmp DSDT |
&gt; acpidisasm" output below. Complete dumps available upon request.
&gt; 
&gt; &gt; 
&gt; &gt; I tried as well to user test13-pre3 with the latest patch (12/20/2000)
&gt; &gt; from Andrew Grover
&gt; &gt; but could not extract the patch from the archives (coudl someone maybe
&gt; &gt; mail it to me?) and the unpatched kernel seems to be the same as test12
&gt; &gt; patched with the mentioned patch from 12/15/2000 - at least it locked up a
&gt; &gt; the same point.
&gt; &gt; 
&gt; &gt; I have to mention that lock up means that the kernel does not lock the hard
&gt; &gt; way since the vaio is still soft-resetable.
&gt; &gt; 
&gt; &gt; Um, and yes, the hardware: z600tek is a european edition - its a pentium III
&gt; &gt; - 700 with phoenix bios 4.0 rev 6 and intel chipset.
&gt; &gt; 
&gt; &gt; I would gladly joing in and help on development if someone could point me to
&gt; &gt; where to look for the problem...
&gt; &gt; 
&gt; &gt; Thanks in advance
&gt; &gt; 
&gt; &gt; -knut
&gt; 
&gt; --- linux-2.4.0-test13-pre4-mb-acpi/drivers/acpi/common/cmeval.c 2000/12/22 04:02:40 1.1
&gt; +++ linux-2.4.0-test13-pre4-mb-acpi/drivers/acpi/common/cmeval.c 2000/12/22 13:25:45
&gt; @@ -270,6 +270,20 @@
&gt;   ACPI_STATUS             status;
&gt;  
&gt;  
&gt; + if( !strncmp("BAT1", (char*)&amp;device_node-&gt;name, 4) ||
&gt; + !strncmp("COMA", (char*)&amp;device_node-&gt;name, 4) ||
&gt; + !strncmp("FIR_", (char*)&amp;device_node-&gt;name, 4) ||
&gt; + !strncmp("LPTA", (char*)&amp;device_node-&gt;name, 4) ||
&gt; + !strncmp("LPTB", (char*)&amp;device_node-&gt;name, 4) ||
&gt; + !strncmp("ECP_", (char*)&amp;device_node-&gt;name, 4) ||
&gt; + !strncmp("EPP_", (char*)&amp;device_node-&gt;name, 4)) {
&gt; + printk(KERN_ERR"acpi_cm_execute_STA SKIP device_node-&gt;name=%.4s\n", (char*)&amp;device_node-&gt;name);
&gt; + *flags = 0x0F;
&gt; + return AE_OK;
&gt; + } else {
&gt; + printk(KERN_ERR"acpi_cm_execute_STA device_node-&gt;name=%.4s\n", (char*)&amp;device_node-&gt;name);
&gt; + }
&gt; +
&gt;   /* Execute the method */
&gt;  
&gt;   status = acpi_ns_evaluate_relative (device_node,
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 00001b84:         Device BAT1 (\_SB_.PCI0.ISA_.EC0_.BAT1)
&gt; 00001b8c:           Name _HID (\_SB_.PCI0.ISA_.EC0_.BAT1._HID)
&gt; 00001b91:             PNP0c0a (0x0a0cd041)
&gt; 00001b96:           Name _UID (\_SB_.PCI0.ISA_.EC0_.BAT1._UID)
&gt; 00001b9b:             0x01
&gt; 00001b9d:           Name _PCL (\_SB_.PCI0.ISA_.EC0_.BAT1._PCL)
&gt; 00001ba2:             Package
&gt; 00001ba4:               0x01
&gt; 00001ba5:               \_SB_ (00003076)
&gt; 00001baa:           Name BATI (\_SB_.PCI0.ISA_.EC0_.BAT1.BATI)
&gt; 00001baf:             Package
&gt; 00001bb1:               0x0d
&gt; 00001bb2:               0x00
&gt; 00001bb4:               0x9650
&gt; 00001bb7:               0x9650
&gt; 00001bba:               0x00
&gt; 00001bbc:               0x39d0
&gt; 00001bbf:               0x00
&gt; 00001bc1:               0x78
&gt; 00001bc3:               0x00
&gt; 00001bc5:               0x0a
&gt; 00001bc7:               ""
&gt; 00001bc9:               ""
&gt; 00001bcb:               "LION"
&gt; 00001bd1:               "Sony Corp."
&gt; 00001bdd:           Name BATS (\_SB_.PCI0.ISA_.EC0_.BAT1.BATS)
&gt; 00001be2:             Package
&gt; 00001be4:               0x04
&gt; 00001be5:               0x02
&gt; 00001be7:               0xffffffff
&gt; 00001bec:               0x0d7a
&gt; 00001bef:               0x3840
&gt; 00001bf2:           Method _STA (\_SB_.PCI0.ISA_.EC0_.BAT1._STA)
&gt; 00001bf8:             ArgCount 0; NotSerialized
&gt; 00001bf9:             And
&gt; 00001bfa:               &lt;NULL&gt;
&gt; 00001bfe:               0xdb
&gt; 00001c00:               0x80
&gt; 00001c02:             0x0100
&gt; 00001c05:             Local1
&gt; 00001c06:             If
&gt; 00001c08:               Local1
&gt; 00001c09:               Store
&gt; 00001c0a:                 0x1f
&gt; 00001c0c:                 Local0
&gt; 00001c0d:             Else
&gt; 00001c0f:               Store
&gt; 00001c10:                 0x0f
&gt; 00001c12:                 Local0
&gt; 00001c13:             Return
&gt; 00001c14:               Local0
&gt; 00001c15:           Method _BIF (\_SB_.PCI0.ISA_.EC0_.BAT1._BIF)
&gt; 00001c1c:             ArgCount 0; NotSerialized
&gt; 00001c1d:             Store
&gt; 00001c1e:               &lt;NULL&gt;
&gt; 00001c22:               0xdb
&gt; 00001c24:             0xb0
&gt; 00001c26:             Local1
&gt; 00001c27:             Multiply
&gt; 00001c28:               Local1
&gt; 00001c29:               0x0a
&gt; 00001c2b:               Index
&gt; 00001c2c:                 BATI (00001baa)
&gt; 00001c30:                 0x01
&gt; 00001c32:                 &lt;NULL&gt;
&gt; 00001c33:             Store
&gt; 00001c34:               &lt;NULL&gt;
&gt; 00001c38:               0xdb
&gt; 00001c3a:             0xb2
&gt; 00001c3c:             Local1
&gt; 00001c3d:             Multiply
&gt; 00001c3e:               Local1
&gt; 00001c3f:               0x0a
&gt; 00001c41:               Index
&gt; 00001c42:                 BATI (00001baa)
&gt; 00001c46:                 0x02
&gt; 00001c48:                 &lt;NULL&gt;
&gt; 00001c49:             Store
&gt; 00001c4a:               &lt;NULL&gt;
&gt; 00001c4e:               0xdb
&gt; 00001c50:             0xb6
&gt; 00001c52:             Index
&gt; 00001c53:               BATI (00001baa)
&gt; 00001c57:               0x04
&gt; 00001c59:               &lt;NULL&gt;
&gt; 00001c5a:             Return
&gt; 00001c5b:               BATI (00001baa)
&gt; 00001c5f:           Method _BST (\_SB_.PCI0.ISA_.EC0_.BAT1._BST)
&gt; 00001c66:             ArgCount 0; NotSerialized
&gt; 00001c67:             Store
&gt; 00001c68:               And
&gt; 00001c69:                 &lt;NULL&gt;
&gt; 00001c6d:                 0xdb
&gt; 00001c6f:                 0x84
&gt; 00001c71:               0xff
&gt; 00001c73:             Local0
&gt; 00001c74:             Index
&gt; 00001c75:               BATS (00001bdd)
&gt; 00001c79:               0x00
&gt; 00001c7b:               &lt;NULL&gt;
&gt; 00001c7c:             Store
&gt; 00001c7d:               &lt;NULL&gt;
&gt; 00001c81:               0xdb
&gt; 00001c83:             0xa4
&gt; 00001c85:             Local1
&gt; 00001c86:             If
&gt; 00001c88:               LLess
&gt; 00001c89:                 Local1
&gt; 00001c8a:                 0x8000
&gt; 00001c8d:               If
&gt; 00001c8f:                 Local1
&gt; 00001c90:                 Store
&gt; 00001c91:                   0xffffffff
&gt; 00001c96:                   Index
&gt; 00001c97:                     BATS (00001bdd)
&gt; 00001c9b:                     0x01
&gt; 00001c9d:                     &lt;NULL&gt;
&gt; 00001c9e:               Else
&gt; 00001ca0:                 Store
&gt; 00001ca1:                   ZeroOp
&gt; 00001ca2:                   Index
&gt; 00001ca3:                     BATS (00001bdd)
&gt; 00001ca7:                     0x01
&gt; 00001ca9:                     &lt;NULL&gt;
&gt; 00001caa:             Else
&gt; 00001cac:               XOr
&gt; 00001cad:                 Local1
&gt; 00001cae:                 0xffff
&gt; 00001cb1:                 Local1
&gt; 00001cb2:               Increment
&gt; 00001cb3:                 Local1
&gt; 00001cb4:               Multiply
&gt; 00001cb5:                 Local1
&gt; 00001cb6:                 0x0a
&gt; 00001cb8:                 Index
&gt; 00001cb9:                   BATS (00001bdd)
&gt; 00001cbd:                   0x01
&gt; 00001cbf:                   &lt;NULL&gt;
&gt; 00001cc0:             Multiply
&gt; 00001cc1:               &lt;NULL&gt;
&gt; 00001cc5:               0xdb
&gt; 00001cc7:               0xa2
&gt; 00001cc9:             0x0a
&gt; 00001ccb:             Index
&gt; 00001ccc:               BATS (00001bdd)
&gt; 00001cd0:               0x02
&gt; 00001cd2:               &lt;NULL&gt;
&gt; 00001cd3:             Store
&gt; 00001cd4:               &lt;NULL&gt;
&gt; 00001cd8:               0xdb
&gt; 00001cda:             0xa6
&gt; 00001cdc:             Index
&gt; 00001cdd:               BATS (00001bdd)
&gt; 00001ce1:               0x03
&gt; 00001ce3:               &lt;NULL&gt;
&gt; 00001ce4:             Return
&gt; 00001ce5:               BATS (00001bdd)
&gt; 
&gt; 
&gt;   1b80: 6f 69 6e 74 00 5b 31 86 5c 2e 5f 54 5a 5f 41 54  oint.[1.\._TZ_AT
&gt;   1b90: 46 30 0a 80 14 13 5f 51 36 30 00 86 5c 2e 5f 53  F0...._Q60..\._S
&gt;   1ba0: 42 5f 50 57 52 42 0a 80 5b 82 43 16 42 41 54 31  B_PWRB..[.C.BAT1
&gt;   1bb0: 08 5f 48 49 44 0c 41 d0 0c 0a 08 5f 55 49 44 0a  ._HID.A...._UID.
&gt;   1bc0: 01 08 5f 50 43 4c 12 07 01 5c 5f 53 42 5f 08 42  .._PCL...\_SB_.B
&gt;   1bd0: 41 54 49 12 2d 0d 0a 00 0b 50 96 0b 50 96 0a 00  ATI.-....P..P...
&gt;   1be0: 0b d0 39 0a 00 0a 78 0a 00 0a 0a 0d 00 0d 00 0d  ..9...x.........
&gt;   1bf0: 4c 49 4f 4e 00 0d 53 6f 6e 79 20 43 6f 72 70 2e  LION..Sony Corp.
&gt;   1c00: 00 08 42 41 54 53 12 0f 04 0a 02 0c ff ff ff ff  ..BATS..........
&gt;   1c10: 0b 7a 0d 0b 40 38 14 22 5f 53 54 41 00 7b 50 48  .z..@8."_STA.{PH
&gt;   1c20: 53 44 0a db 0a 80 0b 00 01 61 a0 06 61 70 0a 1f  SD.......a..ap..
&gt;   1c30: 60 a1 05 70 0a 0f 60 a4 60 14 49 04 5f 42 49 46  `..p..`.`.I._BIF
&gt;   1c40: 00 70 50 48 53 44 0a db 0a b0 61 77 61 0a 0a 88  .pPHSD....awa...
&gt;   1c50: 42 41 54 49 0a 01 00 70 50 48 53 44 0a db 0a b2  BATI...pPHSD....
&gt;   1c60: 61 77 61 0a 0a 88 42 41 54 49 0a 02 00 70 50 48  awa...BATI...pPH
&gt;   1c70: 53 44 0a db 0a b6 88 42 41 54 49 0a 04 00 a4 42  SD.....BATI....B
&gt;   1c80: 41 54 49 14 49 08 5f 42 53 54 00 70 7b 50 48 53  ATI.I._BST.p{PHS
&gt;   1c90: 44 0a db 0a 84 0a ff 60 88 42 41 54 53 0a 00 00  D......`.BATS...
&gt;   1ca0: 70 50 48 53 44 0a db 0a a4 61 a0 23 95 61 0b 00  pPHSD....a.#.a..
&gt;   1cb0: 80 a0 10 61 70 0c ff ff ff ff 88 42 41 54 53 0a  ...ap......BATS.
&gt;   1cc0: 01 00 a1 0b 70 00 88 42 41 54 53 0a 01 00 a1 15  ....p..BATS.....
&gt;   1cd0: 7f 61 0b ff ff 61 75 61 77 61 0a 0a 88 42 41 54  .a...auawa...BAT
&gt;   1ce0: 53 0a 01 00 77 50 48 53 44 0a db 0a a2 0a 0a 88  S...wPHSD.......
&gt;   1cf0: 42 41 54 53 0a 02 00 70 50 48 53 44 0a db 0a a6  BATS...pPHSD....
&gt;   1d00: 88 42 41 54 53 0a 03 00 a4 42 41 54 53 5b 82 49  .BATS....BATS[.I
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fs.tum.de
&gt; http://phobos.fs.tum.de/mailman/listinfo/acpi
&gt; 

</body></email><email><emailId>20001227140624</emailId><senderName>Jens Taprogge</senderName><senderEmail>taprogge@idg.rwth-aachen.de</senderEmail><timestampReceived>2000-12-27 14:06:24-0400</timestampReceived><subject>[Acpi] Re: test13-pre4-ac2 -- The cardbus/pcmcia sockets no longer work with two devices present at</subject><body>

This seems to be a problem that was introduced with the big ACPI update
as pointed out earlier by Andrew Morton.  Try disabling ACPI (since your
BIOS does not seem to have ACPI support anyway it should not be a
disadvantage) and see if PCMCIA support works again on bootup.

Jens

On Wed, Dec 27, 2000 at 12:42:14AM -0800, Miles Lane wrote:
&gt; When I boot with the following inserted:
&gt; 
&gt; Socket 0:
&gt;    product info: "3Com Corporation", "3CCFE575BT", "LAN Cardbus Card", "001"
&gt;    manfid: 0x0101, 0x5157
&gt;    function: 6 (network)
&gt; Socket 1:
&gt;    product info: "PCMCIA  ", "56K V.90 Fax Modem (LK)  ", "FM560LK  "
&gt;    manfid: 0x0175, 0x0000
&gt;    function: 2 (serial)
&gt; 
&gt; both sockets fail to set up properly and work.
&gt; 
&gt; Linux PCMCIA Card Services 3.1.22
&gt;    options:  [pci] [cardbus] [pm]
&gt; PCI: Enabling device 00:04.0 (0000 -&gt; 0002)
&gt; PCI: Assigned IRQ 11 for device 00:04.0
&gt; PCI: Enabling device 00:04.1 (0000 -&gt; 0002)
&gt; PCI: Assigned IRQ 11 for device 00:04.1
&gt; Intel PCIC probe: not found.
&gt; Yenta IRQ list 0698, PCI irq11
&gt; Socket status: 30000020
&gt; Yenta IRQ list 0698, PCI irq11
&gt; Socket status: 30000010
&gt; ACPI: System description tables not found
&gt; cs: socket c118b000 timed out during reset.  Try increasing setup_delay.
&gt; cs: socket c118b800 timed out during reset.  Try increasing setup_delay.
&gt; 
&gt; If I then run "cardctl eject" and then eject and reinsert the two
&gt; cards, the cards get set up correctly.
&gt; 
&gt; Note that I am not using the PCMCIA drivers.  I am using Yenta
&gt; and its native development kernel friends. I am using modutils
&gt; 2.3.22.
-- 
Jens Taprogge

</body></email><email><emailId>20001229091905</emailId><senderName>Jerritt Collord</senderName><senderEmail>collord@collord.net</senderEmail><timestampReceived>2000-12-29 09:19:05-0400</timestampReceived><subject>RE: [Acpi] Intel ACPI compile bug?</subject><body>

What is the "implicit return" problem, and is there a workaround?  I found
no reference to it in the archives.

TIA,

Jerritt


On Mon, 18 Dec 2000, Grover, Andrew wrote:

&gt; 
&gt; Can you post your DSDT? The PMTools utility acpidmp should work for this.
&gt; 
&gt; (I think your system has the "implicit return" problem, but I can't say for
&gt; sure without the DSDT)


 

</body></email><email><emailId>20001231014611</emailId><senderName>Manfred</senderName><senderEmail>manfred@colorfullife.com</senderEmail><timestampReceived>2000-12-31 01:46:11-0400</timestampReceived><subject>[Acpi] oops with 2.4.0-test13-pre7 in acpi_ns_get_next_object</subject><body>

As I wrote in the subject line I get an oops with 2.4.0-test13-pre7.

Board: Gigabyte BXD with newest BIOS, Dual processor

Previous kernels ( &lt;=-test12) just printed

ACPI: support found
ACPI: PBLK 0 @ 0x0000:0
ACPI: PBLK 1 @ 0x0000:0
	-0196: *** Error: Sleep State package elements are not both of type
number

Now I get the attached oops.
I've tracked it back into acpi_ns_get_next_object: that function is
called with both child_node and parent_node == NULL, and then the line

	if (parent_node-&gt;child)

oopses.

If you need further infos, please ask.

--
	Manfred
["new.txt" (text/plain)]

ACPI: System description tables found
ACPI: System description tables loaded
Unable to handle kernel NULL pointer dereference at virtual address 00000010
 printing eip:
c01d7583
*pde = 00000000
Oops: 0000
CPU:    0
EIP:    0010:[acpi_ns_get_next_object+19/76]
EFLAGS: 00010246
eax: 00000000   ebx: 00000000   ecx: 54594247   edx: 00000000
esi: 00000000   edi: 0000008d   ebp: 00000000   esp: cbf33f34
ds: 0018   es: 0018   ss: 0018
Process kacpid (pid: 7, stackpage=cbf33000)
Stack: 00000000 c01d75fb 00000000 00000000 00000000 c01ce2f4 ffffffff cbf32331 
       cbf32000 08010646 c01d7d16 00000008 cbf3afc0 ffffffff 00000001 c01ce2f4 
       00000000 00000000 00000008 00000000 c0269e55 c01ce39c 00000008 cbf3afc0 
Call Trace: [acpi_ns_walk_namespace+63/260] [acpi_ev_save_method_info+0/120] \
[acpi_walk_namespace+70/92] [acpi_ev_save_method_info+0/120] \
[_acpi_ctype+12949/25696] [acpi_ev_init_gpe_control_methods+48/56] \
[acpi_ev_save_method_info+0/120]   [acpi_ev_initialize+74/100] \
[acpi_enable_subsystem+62/104] [acpi_thread+163/540] [empty_bad_page+0/4096] \
[empty_bad_page+0/4096] [startup_32+24/203] [kernel_thread+26/48] \
                [kernel_thread+35/48] 
Code: 8b 40 10 85 c0 74 11 89 c2 eb 0d 89 f6 50 e8 be ff ff ff 89 

Disassembly:
(gdb) x/30i acpi_ns_get_next_object
0xc01d7570 &lt;acpi_ns_get_next_object&gt;:	push   %ebx
0xc01d7571 &lt;acpi_ns_get_next_object+1&gt;:	xor    %edx,%edx
0xc01d7573 &lt;acpi_ns_get_next_object+3&gt;:	mov    0x10(%esp,1),%eax
0xc01d7577 &lt;acpi_ns_get_next_object+7&gt;:	mov    0x8(%esp,1),%bl
0xc01d757b &lt;acpi_ns_get_next_object+11&gt;:	test   %eax,%eax
0xc01d757d &lt;acpi_ns_get_next_object+13&gt;:	jne    0xc01d7590 \
&lt;acpi_ns_get_next_object+32&gt; 0xc01d757f &lt;acpi_ns_get_next_object+15&gt;:	mov    \
0xc(%esp,1),%eax 0xc01d7583 &lt;acpi_ns_get_next_object+19&gt;:	mov    0x10(%eax),%eax
0xc01d7586 &lt;acpi_ns_get_next_object+22&gt;:	test   %eax,%eax
0xc01d7588 &lt;acpi_ns_get_next_object+24&gt;:	je     0xc01d759b \
&lt;acpi_ns_get_next_object+43&gt; 0xc01d758a &lt;acpi_ns_get_next_object+26&gt;:	mov    \
%eax,%edx 0xc01d758c &lt;acpi_ns_get_next_object+28&gt;:	jmp    0xc01d759b \
&lt;acpi_ns_get_next_object+43&gt; 0xc01d758e &lt;acpi_ns_get_next_object+30&gt;:	mov    \
%esi,%esi 0xc01d7590 &lt;acpi_ns_get_next_object+32&gt;:	push   %eax
0xc01d7591 &lt;acpi_ns_get_next_object+33&gt;:	call   0xc01d7554 \
&lt;acpi_ns_get_next_valid_object&gt; 0xc01d7596 &lt;acpi_ns_get_next_object+38&gt;:	mov    \
%eax,%edx 0xc01d7598 &lt;acpi_ns_get_next_object+40&gt;:	add    $0x4,%esp
0xc01d759b &lt;acpi_ns_get_next_object+43&gt;:	test   %bl,%bl
0xc01d759d &lt;acpi_ns_get_next_object+45&gt;:	jne    0xc01d75b3 \
&lt;acpi_ns_get_next_object+67&gt; 0xc01d759f &lt;acpi_ns_get_next_object+47&gt;:	mov    \
%edx,%eax 0xc01d75a1 &lt;acpi_ns_get_next_object+49&gt;:	jmp    0xc01d75b9 \
&lt;acpi_ns_get_next_object+73&gt; 0xc01d75a3 &lt;acpi_ns_get_next_object+51&gt;:	cmp    \
%bl,0x1(%edx) 0xc01d75a6 &lt;acpi_ns_get_next_object+54&gt;:	je     0xc01d759f \
&lt;acpi_ns_get_next_object+47&gt; 0xc01d75a8 &lt;acpi_ns_get_next_object+56&gt;:	push   %edx
0xc01d75a9 &lt;acpi_ns_get_next_object+57&gt;:	call   0xc01d7554 \
&lt;acpi_ns_get_next_valid_object&gt; 0xc01d75ae &lt;acpi_ns_get_next_object+62&gt;:	mov    \
%eax,%edx 0xc01d75b0 &lt;acpi_ns_get_next_object+64&gt;:	add    $0x4,%esp
0xc01d75b3 &lt;acpi_ns_get_next_object+67&gt;:	test   %edx,%edx
0xc01d75b5 &lt;acpi_ns_get_next_object+69&gt;:	jne    0xc01d75a3 \
&lt;acpi_ns_get_next_object+51&gt; 0xc01d75b7 &lt;acpi_ns_get_next_object+71&gt;:	xor    \
%eax,%eax (gdb) quit



</body></email><email><emailId>20001231135208</emailId><senderName>"Adam J. Richter"</senderName><senderEmail>adam@yggdrasil.com</senderEmail><timestampReceived>2000-12-31 13:52:08-0400</timestampReceived><subject>[Acpi] test13-pre[567]: acpi infinite loop on Sony PictureBook (Transmeta version)</subject><body>

	At least when I build acpi as a module under 2.4.0-test13-pre5
(which requires tweaking the Makefiles and a config.in, but no 
modifications to .c or .h files), acpi gets into an infinite loop
when it is loaded as a module on a Transmeta-based Sony PictureBook.
The same kernel+module loads fine on a desktop machine that I tried,
and doing the same on 2.4.0-test13-pre3 works fine on both computers.
The problem is still in test13-pre7.

	From a day of reboots and printk's, I know that the infinite
loop includes at the following call hierarchy:

		acpi_resolve_to_value
		acpi_resolve_node_to_value
		acpi_aml_access_named_field
		acpi_aml_read_field
		acpi_aml_read_field_data

	I also know that, elsewhere in the inifinite loop,
acpi_release_parse_tree is called, as are acpi_cm_{acquire,release}_mutex.

	I know that the following calls are made shortly before
the infinite loop starts:

		acpi_aml_exec_store
		acpi_aml_store_object_to_node
		acpi_aml_access_named_field
		acpi_aml_write_field
		acpi_aml_write_field_data

	I will explore this more tomorrow, but I have been exploring
this problem on and off for three days, so I thought I ought to
mention it on linux-kernel.

Adam J. Richter     __     ______________   4880 Stevens Creek Blvd, Suite 104
adam@yggdrasil.com     \ /                  San Jose, California 95129-1034
+1 408 261-6630         | g g d r a s i l   United States of America
fax +1 408 261-6631      "Free Software For The Rest Of Us."

</body></email><email><emailId>20001102050349</emailId><senderName>brendan burns</senderName><senderEmail>bburns@wso.williams.edu</senderEmail><timestampReceived>2000-11-02 05:03:49-0400</timestampReceived><subject>[Acpi] ACPI issues</subject><body>

Folks,

thanks for your help, i changed the 0 to SA_SHIRQ in ad1848.c and that
appears to make ACPI and my sound card co-exist happily...

but i've run into a couple of other issues:

1)
On startup i get the messages:
psparse-0681: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0, ignoring
breakpoint: Fatal error encountered

repeated about 15 times in my kernel log.  I understand that the first
message indicates that my ACPI is probably buggy and contains an invalid
opcode (0x13=19)  But I'm not sure why the fatal error is being generated.

2)
everyother time i startup (startups mod 2 ==1) my display goes to sleep
(eg doesn't display) but the computer starts up fine the keyboard is still
active etc, but the display won't wake up (I've pressed the power button,
hit keys, the mouse etc)

on the other times (startups mod 2 ==0) the display blinks into sleep and
then restores itself.

Anyone have any pointers for debugging?



On the good news side i have begun development work on the battery
support.  I have most of the battery parsing code done (though it's not
quite presentable yet)  once i clean it up I'll release a patch.  and then
add a /proc/sys/acpi/batteryN (or something like that) file.


Thanks,
Brendan

</body></email><email><emailId>20001108205525</emailId><senderName>brendan burns</senderName><senderEmail>bburns@wso.williams.edu</senderEmail><timestampReceived>2000-11-08 20:55:25-0400</timestampReceived><subject>[Acpi] Battery</subject><body>

Hey folks,
attached is a patch which adds more battery support to the 10-29 code, it
adds some print outs to the kernel startup as well as adding
/proc/sys/acpi/battery which contains the u32 in _BIF-&gt;remaining_capacity.

I need to flesh out the code some more so that the info in the proc file
is better but unfortunatly the acpi on my HP appears to be quite buggy and
it returns 0xffffffff (unknown) for both the last full capacity value and
the remaining capacity value, though i'm pretty sure my code works, i
can't really test it too much so i would appreciate others testing this
out.

Thanks,

by the way this patch is for the 10-29 debug version available from intel.

brendan


["battery-patch" (TEXT/PLAIN)]

diff -r linux/drivers/acpi/cmbatt.c /usr/src/linux/drivers/acpi/cmbatt.c
39a40,56
&gt; struct cmbatt_info
&gt; {
&gt;   u32  power_unit;
&gt;   u32  design_capacity;
&gt;   u32  last_full_capacity;
&gt;   u32  battery_technology;
&gt;   u32  design_voltage;
&gt;   u32  design_capacity_warning;
&gt;   u32  design_capacity_low;
&gt;   u32  battery_capacity_granularity_1;
&gt;   u32  battery_capacity_granularity_2;
&gt;   char *model_number;
&gt;   char *serial_number;
&gt;   char *battery_type;
&gt;   char *oem_info;
&gt; };
&gt; 
58a76,170
&gt; static ACPI_STATUS
&gt; acpi_get_battery_status(ACPI_HANDLE handle, struct cmbatt_status *result) {
&gt;   ACPI_OBJECT       *obj;
&gt;   ACPI_OBJECT       *objs;
&gt;   ACPI_BUFFER       buf;
&gt;   
&gt;   buf.length = 0;
&gt;   buf.pointer = NULL;		
&gt;   
&gt;   /* determine buffer length needed */
&gt;   if (acpi_evaluate_object(handle, "_BST", NULL, &amp;buf) != AE_BUFFER_OVERFLOW)
&gt;     return AE_NOT_FOUND;
&gt;   
&gt;   buf.pointer = kmalloc(buf.length, GFP_KERNEL);
&gt;   if (!buf.pointer)
&gt;     return AE_NO_MEMORY;
&gt;   
&gt;   /* get the data */
&gt;   if (!ACPI_SUCCESS(acpi_evaluate_object(handle, "_BST", NULL, &amp;buf))) {
&gt;     printk(KERN_ERR "Could not get battery status\n");
&gt;     kfree (buf.pointer);
&gt;     return AE_NOT_FOUND;
&gt;   }
&gt;   obj = (ACPI_OBJECT *)buf.pointer;
&gt;   objs = obj-&gt;package.elements;
&gt;   
&gt;   result-&gt;state = objs[0].number.value;
&gt;   result-&gt;present_rate = objs[1].number.value;
&gt;   result-&gt;remaining_capacity = objs[2].number.value;
&gt;   result-&gt;present_voltage = objs[3].number.value;
&gt;   
&gt;   kfree(buf.pointer);
&gt;   
&gt;   return AE_OK;
&gt; }
&gt; 
&gt; u32
&gt; acpi_read_battery_charge(int index) {
&gt;   struct cmbatt_status status;
&gt;   
&gt;   if (acpi_get_battery_status(batt_list[index].handle, &amp;status)==AE_OK)
&gt;     return status.remaining_capacity;
&gt;   
&gt;   return 0xffffffff;
&gt; }
&gt; 
&gt; static ACPI_STATUS
&gt; acpi_get_battery_info(ACPI_HANDLE handle, struct cmbatt_info *result) {
&gt;   ACPI_OBJECT       *obj;
&gt;   ACPI_OBJECT       *objs;
&gt;   ACPI_BUFFER       buf;
&gt; 
&gt;   buf.length = 0;
&gt;   buf.pointer = NULL;
&gt; 
&gt;   if (acpi_evaluate_object(handle, "_BIF", NULL, &amp;buf) == AE_BUFFER_OVERFLOW)
&gt;     {
&gt;       
&gt;       buf.pointer = kmalloc(buf.length, GFP_KERNEL);
&gt;       
&gt;       if (!buf.pointer)
&gt; 	return AE_NO_MEMORY;
&gt;       
&gt;       /* get the data */
&gt;       if (!ACPI_SUCCESS(acpi_evaluate_object(handle, "_BIF", NULL, &amp;buf))) {
&gt; 	printk(KERN_ERR "Could not get battery info\n");
&gt; 	return AE_NOT_FOUND;
&gt;       }
&gt;       else {
&gt; 	obj = (ACPI_OBJECT *) buf.pointer;
&gt; 	objs = obj-&gt;package.elements;
&gt; 	
&gt; 	result-&gt;power_unit=objs[0].number.value;
&gt; 	result-&gt;design_capacity=objs[1].number.value;
&gt; 	result-&gt;last_full_capacity=objs[2].number.value;
&gt; 	result-&gt;battery_technology=objs[3].number.value;
&gt; 	result-&gt;design_voltage=objs[4].number.value;
&gt; 	result-&gt;design_capacity_warning=objs[5].number.value;
&gt; 	result-&gt;design_capacity_low=objs[6].number.value;
&gt; 	result-&gt;battery_capacity_granularity_1=objs[7].number.value;
&gt; 	result-&gt;battery_capacity_granularity_2=objs[8].number.value;
&gt; 	result-&gt;model_number=objs[9].string.pointer;
&gt; 	result-&gt;serial_number=objs[10].string.pointer;
&gt; 	result-&gt;battery_type=objs[11].string.pointer;
&gt; 	result-&gt;oem_info=objs[12].string.pointer;
&gt; 
&gt; 		
&gt; 	kfree(buf.pointer);
&gt;       }
&gt; 
&gt;       return AE_OK;
&gt;     }
&gt;   return AE_NOT_FOUND;
&gt; }
&gt; 
66c178,183
&lt; 	
---
&gt; 	struct cmbatt_status status;
&gt; 	struct cmbatt_info batt_info;
&gt; 	u32 last_capacity = 0xFFFFFFFF;
&gt; 	const char* units = "Unknown";
&gt; 	float charge = 0;
&gt; 
78c195
&lt; 
---
&gt; 	printk("Unique ID %s", info.unique_id);
82,94c199,244
&lt; 		ACPI_BUFFER buf;
&lt; 
&lt; 		printk("ACPI: Found a present battery\n");
&lt; 		batt_list[batt_count].is_present = TRUE;
&lt; 
&lt; 		buf.length = 0;
&lt; 		buf.pointer = NULL;
&lt; 
&lt; 		/* determine buffer length needed */
&lt; 		if (acpi_evaluate_object(handle, "_BST", NULL, &amp;buf) != AE_BUFFER_OVERFLOW)
&lt; 			return AE_OK;
&lt; 
&lt; 		buf.pointer = kmalloc(buf.length, GFP_KERNEL);
---
&gt; 	  printk("ACPI: Found a present battery\n");
&gt; 	  batt_list[batt_count].is_present = TRUE;
&gt; 	  
&gt; 	  if (acpi_get_battery_info(handle, &amp;batt_info)==AE_OK) {
&gt; 	    if (batt_info.power_unit)
&gt; 	      units = "mWatts";
&gt; 	    else
&gt; 	      units = "mAmps";
&gt; 	    
&gt; 	    if (batt_info.last_full_capacity==0xffffffff)
&gt; 	      printk("Unknown last full capacity\n");
&gt; 	    else
&gt; 	      printk("Last Full Capacity %x %s /hr\n", 
&gt; 		     batt_info.last_full_capacity, units);
&gt; 	    last_capacity = batt_info.last_full_capacity;
&gt; 	    if (batt_info.design_capacity==0xffffffff)
&gt; 	      printk("Unknown Design Capacity\n");
&gt; 	    else
&gt; 	      printk("Design Capacity %x %s /hr\n", 
&gt; 		     batt_info.design_capacity, units);
&gt; 	    
&gt; 	    if (batt_info.battery_technology)
&gt; 	      printk("Secondary Battery Technology\n");
&gt; 	    else
&gt; 	      printk("Primary Battery Technology\n");
&gt; 	    
&gt; 	    if (batt_info.design_voltage==0xffffffff)
&gt; 	      printk("Unknown Design Voltage\n");
&gt; 	    else
&gt; 	      printk("Design Voltage %x volts\n", 
&gt; 		     batt_info.design_voltage);
&gt; 	    
&gt; 	    printk("Design Capacity Warning %d\n",
&gt; 		   batt_info.design_capacity_warning);
&gt; 	    printk("Designb Capacity Low %d\n",
&gt; 		   batt_info.design_capacity_low);
&gt; 	    printk("Battery Capacity Granularity 1 %d\n",
&gt; 		   batt_info.battery_capacity_granularity_1);
&gt; 	    printk("Battery Capacity Granularity 2 %d\n",
&gt; 		   batt_info.battery_capacity_granularity_2);
&gt; 	    printk("%s %s %s %s\n",
&gt; 		   batt_info.model_number,batt_info.serial_number,
&gt; 		   batt_info.battery_type,batt_info.oem_info);
&gt; 	    
&gt; 	  }
&gt; 	  
96,108c246,280
&lt; 		if (!buf.pointer)
&lt; 			return AE_NO_MEMORY;
&lt; 
&lt; 		/* get the data */
&lt; 		if (!ACPI_SUCCESS(acpi_evaluate_object(handle, "_BST", NULL, &amp;buf))) {
&lt; 			printk(KERN_ERR "Could not get battery status\n");
&lt; 			kfree (buf.pointer);
&lt; 			return AE_OK;
&lt; 		}
&lt; 
&lt; 		printk("Got battery status!!\n");
&lt; 
&lt; 		kfree(buf.pointer);
---
&gt; 	  if (acpi_get_battery_status(handle, &amp;status)==AE_OK) {
&gt; 	    charge = 100*status.remaining_capacity;
&gt; 	    charge /= last_capacity;
&gt; 	    printk("Got battery status!! (%#x) %d %% charged\n", 
&gt; 		   status.state,
&gt; 		   (int)charge);
&gt; 	
&gt; 	    if (status.state &amp; 0x1)
&gt; 	      printk("Battery is discharging\n");
&gt; 	    if (status.state &amp; 0x2)
&gt; 	      printk("Battery is charging\n");
&gt; 	    if (status.state &amp; 0x4)
&gt; 	      printk("Battery is really low\n");
&gt; 	    
&gt; 	    if (status.present_rate == 0xffffffff)
&gt; 	      printk("Battery rate is unknown\n");
&gt; 	    else
&gt; 	      printk("Battery rate is %x %s\n",
&gt; 		     status.present_rate, units);
&gt; 	
&gt; 	    if (status.remaining_capacity == 0xFFFFFFFF)
&gt; 	      printk("Battery capacity is unknown\n");
&gt; 	    else
&gt; 	      printk("Battery capacity is %x %s\n",
&gt; 		     status.remaining_capacity, units);
&gt; 	    
&gt; 	    if (status.present_voltage == 0xFFFFFFFF)
&gt; 	      printk("Battery voltage is unknown\n");
&gt; 	    else
&gt; 	      printk("Battery voltage is %x volts\n",
&gt; 		     status.present_voltage);
&gt; 	  }
&gt; 	} 
&gt; 	/* TODO: parse the battery data */
&gt; 	/* TODO: add proc interface */
110,112d281
&lt; 		/* TODO: parse the battery data */
&lt; 		/* TODO: add proc interface */
&lt; 	}
diff -r linux/drivers/acpi/driver.c /usr/src/linux/drivers/acpi/driver.c
109a110,139
&gt; acpi_do_battery(ctl_table * ctl,
&gt; 	      int write,
&gt; 	      struct file *file,
&gt; 	      void *buffer,
&gt; 	      size_t * len)
&gt; {
&gt;   char str[12];
&gt;   u32  charge;
&gt;   int size;
&gt;   
&gt;   if (file-&gt;f_pos) {
&gt;     *len=0;
&gt;     return 0;
&gt;   }
&gt; 
&gt;   charge = acpi_read_battery_charge(0);
&gt;   size = sprintf(str, "%#x\n", charge);
&gt;   if (*len &gt;= size) {
&gt;     copy_to_user(buffer, str, size);
&gt;     *len=size;
&gt;   }
&gt;   else
&gt;     *len=0;
&gt;   
&gt;   file-&gt;f_pos += *len;
&gt; 
&gt;   return 0;
&gt; }
&gt; 
&gt; static int 
391c421,423
&lt; 	
---
&gt; 
&gt; 	{ACPI_BATTERY, "battery", NULL, 0, 0444, NULL, &amp;acpi_do_battery},
&gt; 
diff -r linux/drivers/acpi/driver.h /usr/src/linux/drivers/acpi/driver.h
34a35,39
&gt;  * cmbatt.c
&gt;  */
&gt; u32 acpi_read_battery_charge(int index);
&gt; 
&gt; /*


</body></email><email><emailId>20001114131430</emailId><senderName>Stephen Rothwell</senderName><senderEmail>sfr@linuxcare.com.au</senderEmail><timestampReceived>2000-11-14 13:14:30-0400</timestampReceived><subject>[Acpi] [MINI PATCH] sysctl values for ACPI and APM</subject><body>

Hi Linus,

Since ACPI is now in the kernel, I figure that its top level
sysctl tag should be in sysctl.h. Also, this patch claims an
tag for APM as I want to add some sysctl's for APM soon.

By the way, is there a "correct" way to claim sysctl tags?

Cheers,
Stephen
-- 
Stephen Rothwell, Open Source Researcher, Linuxcare, Inc.
+61-2-62628990 tel, +61-2-62628991 fax 
sfr@linuxcare.com, http://www.linuxcare.com/ 
Linuxcare. Support for the revolution.

diff -ruN 2.4.0-test11pre4/Documentation/sysctl/README 2.4.0-test11pre4-APM.2/Documentation/sysctl/README
--- 2.4.0-test11pre4/Documentation/sysctl/README	Tue Jul  6 13:04:47 1999
+++ 2.4.0-test11pre4-APM.2/Documentation/sysctl/README	Tue Nov 14 23:36:16 2000
@@ -55,6 +55,8 @@
 by piece basis, or just some 'thematic frobbing'.
 
 The subdirs are about:
+acpi/		Advanced Configuration and Power Interface
+		information and control
 debug/		&lt;empty&gt;
 dev/		device specific information (eg dev/cdrom/info)
 fs/		specific filesystems
diff -ruN 2.4.0-test11pre4/include/linux/acpi.h 2.4.0-test11pre4-APM.2/include/linux/acpi.h
--- 2.4.0-test11pre4/include/linux/acpi.h	Wed Oct  4 10:36:16 2000
+++ 2.4.0-test11pre4-APM.2/include/linux/acpi.h	Tue Nov 14 23:27:10 2000
@@ -208,11 +208,6 @@
 
 enum
 {
-	CTL_ACPI = 10
-};
-
-enum
-{
 	ACPI_FACP = 1,
 	ACPI_DSDT,
 	ACPI_PM1_ENABLE,
diff -ruN 2.4.0-test11pre4/include/linux/sysctl.h 2.4.0-test11pre4-APM.2/include/linux/sysctl.h
--- 2.4.0-test11pre4/include/linux/sysctl.h	Tue Nov 14 23:25:43 2000
+++ 2.4.0-test11pre4-APM.2/include/linux/sysctl.h	Tue Nov 14 23:57:10 2000
@@ -57,7 +57,9 @@
 	CTL_FS=5,		/* Filesystems */
 	CTL_DEBUG=6,		/* Debugging */
 	CTL_DEV=7,		/* Devices */
-	CTL_BUS=8		/* Buses */
+	CTL_BUS=8,		/* Buses */
+	CTL_APM=9,		/* Advanced Power Management */
+	CTL_ACPI=10,		/* Advanced Configuration and Power Interface */
 };
 
 /* CTL_BUS names: */

</body></email><email><emailId>20001115182408</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-11-15 18:24:08-0400</timestampReceived><subject>[Acpi] status update</subject><body>

Just so you all know, we're prepping the next drop, and it should be any day
now. We've been doing some major surgery, and while things look good on
IA32, we still need to validate things work on IA64 before we release it.

Things that will have changed:
- Power-off should work on more systems.
- ACPI 2.0 table support.
- User-mode ACPI support has been removed.
- ACPI chipset support has been removed.
- Interpreter fixes.
- Better boot messages.
- OS memory interfaces expanded to 64 bits.

ACPI 2.0 table support was the big change, and broke a couple of features
that we had been hanging on to, but not really working on. The
simplification and decreased maintenance burden brought about by their
removal made taking them out a pretty easy call.

Anyway, once this is released, we can get back to what we REALLY want to do
-- add features. ;-)

I'll post another message when we actually release it.

Regards -- Andy


----------------------------
Andrew Grover
Intel/TRL/MAL
andrew.grover@intel.com

</body></email><email><emailId>20001116212943</emailId><senderName>"Garst R. Reese"</senderName><senderEmail>reese@isn.net</senderEmail><timestampReceived>2000-11-16 21:29:43-0400</timestampReceived><subject>[Acpi] restoring clock</subject><body>

I'm sure this has been asked, but I could not find it in the achives.
acpi seems to be working fine on a ThinkPad A20, but unlike apmd, it
does not restore the system time when it comes out of suspend. Is there
a way to make it do this?
I do not have the interpreter enabled.

Pls cc me.
Garst

</body></email><email><emailId>20001117050114</emailId><senderName>brendan burns</senderName><senderEmail>bburns@wso.williams.edu</senderEmail><timestampReceived>2000-11-17 05:01:14-0400</timestampReceived><subject>[Acpi] Error on startup</subject><body>

So I've updated the BIOS on my HP hoping that it would enable ACPI a
little better (and looking at the DSDT it does...) but now ACPI fails on
boot.  The kernel messages are as follows:

ACPI Subsystem version [Nov 11 2000]
 tbxface-0083: ACPI Tables successfully loaded
Parsing
Methods:.............................................................................. \
...................................................................................... \
........................................................................................................
 268 Control Methods found and parsed (893 nodes total)
ACPI Namespace successfully loaded at root 0xc0306b90
ACPI: support found
 amfldio-0127: Aml_read_field_data: **** Unknown Op_region Space_iD 2
breakpoint: Fatal error encountered
ACPI: enable failed

Anobody have any clue why?  It seems like there are a lot more debug
statements that could be turned on, is there a switch in the code/headers
to do this?

Thanks

Brendan


</body></email><email><emailId>20001120045131</emailId><senderName>brendan burns</senderName><senderEmail>bburns@wso.williams.edu</senderEmail><timestampReceived>2000-11-20 04:51:31-0400</timestampReceived><subject>[Acpi] Re: acpi digest, Vol 1 #282 - 1 msg</subject><body>

I too got this problem with the new source, however digging into the old
source I noticed that the rsdp_phys variable was obtained through a call
to acpi_find_root_pointer().

I substituted:
acpi_find_root_pointer(&amp;rsdp_phys);
for
rsdp_phys=acpi_get_rsdp_ptr();

It compiles and links fine now.

Brendan

</body></email><email><emailId>20001120171448</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-11-20 17:14:48-0400</timestampReceived><subject>RE: [Acpi] Source Release updated (11-15-2000)</subject><body>

Yeah, I checked the website this weekend, and it hadn't updated. It looks
like it's updated now, though. My hunch is that the update got caught in the
Pentium 4 undertow. ;-)

Anyway, the patch fixed this. find_rsdp_ptr is an arch-specific call (the
only one, in fact) so it goes in arch/i386/kernel. Some other makefile/build
stuff is changed by the patch as well.

Regards -- Andy

&gt; -----Original Message-----
&gt; From: Jurgen Botz [mailto:jurgen@botz.org]
&gt; Sent: Saturday, November 18, 2000 2:47 PM
&gt; To: Grover, Andrew
&gt; Cc: Acpi-linux (E-mail)
&gt; Subject: Re: [Acpi] Source Release updated (11-15-2000) 
&gt; 
&gt; 
&gt; "Grover, Andrew" wrote:
&gt; &gt; This will be posted tonight 6pm PST at
&gt; &gt; http://developer.intel.com/technology/iapc/acpi/downloads.htm
&gt; 
&gt; It hasn't appeared on the page yet, but I got file:
&gt; 
&gt;   acpica-linux-debug-20001115.tar.gz
&gt; 
&gt; from the ftp directory the page points to.  However,
&gt; it doesn't work for me... the kernel fails to links with:
&gt; 
&gt;   drivers/acpi/acpi.o(.text+0x28ad1): undefined reference to 
&gt; `acpi_get_rsdp_ptr'
&gt; 
&gt; grepping through the source I don't find any definition of
&gt; this, just a call in driver.c.
&gt; 
&gt; - Jurgen
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; 

</body></email><email><emailId>20001122015023</emailId><senderName>Robert Vollmert</senderName><senderEmail>rvollmert@gmx.net</senderEmail><timestampReceived>2000-11-22 01:50:23-0400</timestampReceived><subject>Re: [Acpi] Initialization fails because of PCI</subject><body>

&gt; This should fix problem #1. Against 11_15 DEBUG version.
&gt; 
&gt; Removes now-redundant PCI root bridge initialization.

Seems to work. Instead of

38 Devices found: 38 _STA, 0 _INI, 21 _HID, 1 PCIRoot

(unpatched, ACPI_NO_PCI_INIT), it now prints

38 Devices found: 38 _STA, 0 _INI, 0 _HID, 0 PCIRoot

Hope that's ok :)

-- 
Robert Vollmert                                      rvollmert@gmx.net

</body></email><email><emailId>20001122042112</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-11-22 04:21:12-0400</timestampReceived><subject>[Acpi] acpi_power_off() doesn't.</subject><body>

Thanks Robert.

Try this patch. All the special-case stuff in hwregs.c around line 700
apparently isn't being called. Thus, there are redundant writes happening,
AND SLP_EN is being set with interrupts enabled.

Kinda surprised it worked on my machine. ;-)

Anyways, give it a go. I'm not sure this will fix it but this was definitely
a bug.

-- Andy

&gt; From: Robert Vollmert [mailto:rvollmert@gmx.net]
&gt; value  reg-&gt;register_bit_width  reg-&gt;address
&gt; 
&gt; 32768  32                       58368
&gt; 32768  32                       0
&gt; (here, the slp type debug statement is executed) 
&gt;  7169  16                       58372
&gt;  7169  16                       0
&gt;  7169  16                       58372
&gt;  7169  16                       0
&gt; 15361  16                       58372
&gt; 15361  16                       0



["hwregs.diff" (application/octet-stream)]

--- linux-old/drivers/acpi/hardware/hwregs.c	Tue Nov 21 20:14:13 2000
+++ linux/drivers/acpi/hardware/hwregs.c	Tue Nov 21 20:16:15 2000
@@ -419,7 +419,7 @@
 			 */
 
 			acpi_hw_register_write (ACPI_MTX_DO_NOT_LOCK,
-				PM1_CONTROL, (u16) register_value);
+				register_id, (u16) register_value);
 		}
 		break;
 


</body></email><email><emailId>20001122223203</emailId><senderName>Robert Vollmert</senderName><senderEmail>rvollmert@gmx.net</senderEmail><timestampReceived>2000-11-22 22:32:03-0400</timestampReceived><subject>Re: [Acpi] Re: acpi_power_off() doesn't.</subject><body>

&gt; Try this. Redundant writes are gone, but offset should be 0.
&gt; 
&gt; Against 11_15 DEBUG.

&gt; &gt; value	offset	register_bit_width	address
&gt; &gt; 32768	0	32			58368
&gt; &gt; 32768	0	32			0
&gt; &gt; 7169	4	16			58372
&gt; &gt; 7169	5	16			0
&gt; &gt; 8193	6	16			58372
&gt; &gt; 8193	6	16			0

Offset is 0, and the 8193s are now 15361s. Apart from that, the values
stayed the same. It doesn't power off.

Regards,
Robert

-- 
Robert Vollmert                                      rvollmert@gmx.net

</body></email><email><emailId>20001127164655</emailId><senderName>"Therien, Guy"</senderName><senderEmail>guy.therien@intel.com</senderEmail><timestampReceived>2000-11-27 16:46:55-0400</timestampReceived><subject>RE: [Acpi] ACPI S3 mode</subject><body>

The current plan is to support all ACPI S-states. Our goal is to have APM
replacement functionality working on select mobile platforms by about mid
2001. This includes S3 and perhaps S4. We are working on a device power
management framework that will enable this as all drivers must participate
in power management. We will distribute the PM framework design for review
within the next month or so.
Guy

-----Original Message-----
From: LOISON,FRANCOIS (HP-France,ex1) [mailto:francois_loison@hp.com]
Sent: Friday, November 24, 2000 4:11 AM
To: 'acpi@phobos.fachschaften.tu-muenchen.de'
Subject: [Acpi] ACPI S3 mode


Hello,

I saw in HOWTO that current implementation does S1 and that further modes
are studied.
Do you plan to implement S3 (Suspend to RAM)?
S3 is very attractive.

Salutations,
Francois Loison 


_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20001127165826</emailId><senderName>"Therien, Guy"</senderName><senderEmail>guy.therien@intel.com</senderEmail><timestampReceived>2000-11-27 16:58:26-0400</timestampReceived><subject>RE: [Acpi] ACPICA 20001115 report</subject><body>

Jeff,
Toshiba's BIOS has a problem where they do not have a RETURN statement in
their _STA method. We have asked them to change it.  Microsoft's AML
interpreter's design by chance takes the result of the previous return in
this case. Andy will get back to you on the others.
Guy

-----Original Message-----
From: Jeff Garzik [mailto:jgarzik@mandrakesoft.com]
Sent: Friday, November 24, 2000 10:31 PM
To: acpi@phobos.fachschaften.tu-muenchen.de
Subject: [Acpi] ACPICA 20001115 report


This message is four reports of 2.4.0-test11 kernel with the 20001115
ACPICA debug version, and Andrew Grover's "nsinit" and "hwinit" patches
that I saw float across my mailbox.

Where possible, ACPI tables were captured, and provided as a tarball. 
That is the URL that precedes each 'dmesg' output.

---------------------------------------------------------
num: Toshiba Satellite laptop, Pentium III 650, 128MB RAM
---------------------------------------------------------
Summary: ACPI fails
ACPI tables: /proc/sys/acpi not available

ACPI Subsystem version [Nov 21 2000]
ACPI: System description tables found
 tbxface-0089: ACPI Tables successfully loaded
Parsing
Methods:....................................................................
............................................................................
...........
155 Control Methods found and parsed (500 nodes total)
ACPI Namespace successfully loaded at root 0xc03274f8
ACPI: System description tables loaded
evxfevnt-0082: Transition to ACPI mode successful
Executing device _INI methods:.  cmeval-0351: No object was returned
from _STA
  nsinit-0136: Ns_initialize_devices: Walk_namespace failed! 8

1 Devices found: 0 _STA, 0 _INI, 0 _HID, 0 PCIRoot
ACPI: Subsystem enable failed


---------------------------------------------------------
rum: ASUS P2B-D SMP, Dual Pentium II 400, 128MB RAM
---------------------------------------------------------
Summary: ACPI works, no 'C' states, with warnings
ACPI tables: http://gtf.org/garzik/acpi/rum-acpi-20001125.tar.gz

ACPI Subsystem version [Nov 23 2000]
ACPI: System description tables found
 tbxface-0089: ACPI Tables successfully loaded
Parsing
Methods:.............................................................
61 Control Methods found and parsed (201 nodes total)
ACPI Namespace successfully loaded at root 0xc03173d8
ACPI: System description tables loaded
evxfevnt-0082: Transition to ACPI mode successful
Executing device _INI methods:..........................
26 Devices found: 26 _STA, 0 _INI, 0 _HID, 0 PCIRoot
Completing Region and Field initialization:..... ammonad-0284:
Exec_monadic2_r/Not: bad operand(s) (0x3005)

  nsinit-0209: AE_AML_OPERAND_TYPE while getting region arguments [DEBG]
..
7/9 Regions, 0/0 Fields initialized (201 nodes total)
ACPI: Subsystem enabled
ACPI: System firmware supports: S0 S1 S5



---------------------------------------------------------
hum: Unknown PIIX4, Pentium III 500, 96MB RAM
---------------------------------------------------------
Summary: ACPI works, with warnings
ACPI tables: http://gtf.org/garzik/acpi/hum-acpi-20001125.tar.gz

ACPI Subsystem version [Nov 23 2000]
ACPI: System description tables found
 tbxface-0089: ACPI Tables successfully loaded
Parsing
Methods:....................................................................
.....................................
105 Control Methods found and parsed (287 nodes total)
ACPI Namespace successfully loaded at root 0xc031a9f8
ACPI: System description tables loaded
evxfevnt-0082: Transition to ACPI mode successful
Executing device _INI methods:.........................
25 Devices found: 25 _STA, 1 _INI, 0 _HID, 0 PCIRoot
Completing Region and Field initialization:...
  nsinit-0209: AE_AML_OPERAND_TYPE while getting region arguments [SMRG]
............
14/17 Regions, 1/1 Fields initialized (287 nodes total)
ACPI: Subsystem enabled
ACPI: System firmware supports: C2 C3
ACPI: System firmware supports: S0 S1 S4 S5



---------------------------------------------------------
gum: Azza i810, Celeron 566, 128MB RAM
---------------------------------------------------------
Summary: ACPI works, with warnings
ACPI tables: http://gtf.org/garzik/acpi/gum-acpi-20001125.tar.gz

ACPI Subsystem version [Nov 23 2000]
ACPI: System description tables found
 tbxface-0089: ACPI Tables successfully loaded
Parsing
Methods:....................................................................
..................................
102 Control Methods found and parsed (434 nodes total)
ACPI Namespace successfully loaded at root 0xc03069d8
ACPI: System description tables loaded
evxfevnt-0082: Transition to ACPI mode successful
Executing device _INI methods:...............................
31 Devices found: 31 _STA, 2 _INI, 0 _HID, 0 PCIRoot
Completing Region and Field initialization:.............. ammonad-0284:
Exec_monadic2_r/Not: bad operand(s) (0x3005)

  nsinit-0209: AE_AML_OPERAND_TYPE while getting region arguments [DEBG]
.. ammonad-0284: Exec_monadic2_r/Not: bad operand(s) (0x3005)

  nsinit-0209: AE_AML_OPERAND_TYPE while getting region arguments [SMIC]
. ammonad-0284: Exec_monadic2_r/Not: bad operand(s) (0x3005)

  nsinit-0209: AE_AML_OPERAND_TYPE while getting region arguments [PM1S]
. ammonad-0284: Exec_monadic2_r/Not: bad operand(s) (0x3005)

  nsinit-0209: AE_AML_OPERAND_TYPE while getting region arguments [SPEN]
. ammonad-0284: Exec_monadic2_r/Not: bad operand(s) (0x3005)

  nsinit-0209: AE_AML_OPERAND_TYPE while getting region arguments [GPI_]
. ammonad-0284: Exec_monadic2_r/Not: bad operand(s) (0x3005)

  nsinit-0209: AE_AML_OPERAND_TYPE while getting region arguments [GBLE]
. ammonad-0284: Exec_monadic2_r/Not: bad operand(s) (0x3005)

  nsinit-0209: AE_AML_OPERAND_TYPE while getting region arguments [TRP1]
... ammonad-0284: Exec_monadic2_r/Not: bad operand(s) (0x3005)

  nsinit-0209: AE_AML_OPERAND_TYPE while getting region arguments [GPO_]
.. ammonad-0284: Exec_monadic2_r/Not: bad operand(s) (0x3005)

  nsinit-0209: AE_AML_OPERAND_TYPE while getting region arguments [GRAM]
............ psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML
offset 0x0, ignoring
 psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
. psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
 psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
. psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
 psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
. psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
 psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
. psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
 psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
. psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
 psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
. psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
 psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
. psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
 psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
.......
29/33 Regions, 23/25 Fields initialized (434 nodes total)
ACPI: Subsystem enabled
ACPI: System firmware supports: C2
ACPI: System firmware supports: S0 S1 S4 S5



-- 
Jeff Garzik             |
Building 1024           | The chief enemy of creativity is "good" sense
MandrakeSoft            |          -- Picasso


_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20001127180550</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-11-27 18:05:50-0400</timestampReceived><subject>RE: [Acpi] Patches</subject><body>

Yeah, that patch was against test11-pre5, and there was a slight change that
made it not apply cleanly against test11-final. Oh well.

Expect another release pretty soon, to fix this, and the other stuff that's
been fixed.

-- Andy

&gt; -----Original Message-----
&gt; From: Mahmoud Mohamed [mailto:demos70@hotmail.com]
&gt; Sent: Wednesday, November 22, 2000 11:59 PM
&gt; To: acpi@phobos.fachschaften.tu-muenchen.de
&gt; Subject: [Acpi] Patches
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; Hi all,
&gt; 
&gt; Sorry to interrupt the intresting Robert/Andy thread..but I just got
&gt; the acpi-linux-debug-20001115.tar.gz and the patch. The patch 
&gt; fails with 
&gt; linux-2.4.0-test11 here's what I get:
&gt; 
&gt; patching file linux/arch/i386/kernel/acpi.c
&gt; Hunk #3 FAILED at 26.
&gt; 1 out of 3 hunks FAILED -- saving rejects to file 
&gt; linux/arch/i386/kernel/acpi.c.rej
&gt; 
&gt; Is this normal should I go on with compiling the kernel?
&gt; Also should I apply the hwregs.diff, hwregs2.diff, 
&gt; nsinit.diff posted here 
&gt; afterwards or are these specific to Robert's Asus mobo ?
&gt; 
&gt; Thanks,
&gt; Mahmood
&gt; ______________________________________________________________
&gt; _______________________
&gt; Get more from the Web.  FREE MSN Explorer download : 
http://explorer.msn.com



_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20001128012931</emailId><senderName>Jeff Garzik</senderName><senderEmail>jgarzik@mandrakesoft.com</senderEmail><timestampReceived>2000-11-28 01:29:31-0400</timestampReceived><subject>Re: [Acpi] Fixing broken ACPI tables?</subject><body>

"Therien, Guy" wrote:
&gt; 
&gt; -Typically, so far, the problems are mostly related to "it works with
&gt; -Windows"-syndrome, which is why I tend to argue for bug-compatibility
&gt; -rather than a painful mechanical workaround process.
&gt; 
&gt; We will not implement bug for bug compatibility with Microsoft's ACPI
&gt; implementation. One of the reasons for a second ACPI implementation is to
&gt; verify implementation to be in accordance with the ACPI specification. It
&gt; undermines the spec to allow a dominant OSV to establish a defacto standard.
&gt; In some cases, it may be necessary to mimic OS behavior that is not clearly
&gt; specified or if ambiguous in the ACPI spec. Of course, the difficulty of
&gt; being bug for bug compatible also plays a role here. If it was easy then it
&gt; may seem reasonable to have a switch that would enable certain non spec
&gt; system behaviors. The _STA issue (no return), is not something we can easily
&gt; accommodate.

Implementing bug-for-bug compatibility in ACPICA is definitely a bad
idea...  It's much more flexible to snag the bad ACPI tables, fix them
up offline, and then reboot with the patched tables.  No kernel bloat
necessary...

	Jeff


-- 
Check out the scene, We're stuck in a tractor beam With the r-2 unit And
the whole skinnie team From the moons of endor To the land of lando We
take the whole damn posse To wherever the van goes The chase is on And
we're close to capture Imperial forces don't really know what they're
after

</body></email><email><emailId>20001129230205</emailId><senderName>"Garst R. Reese"</senderName><senderEmail>reese@isn.net</senderEmail><timestampReceived>2000-11-29 23:02:05-0400</timestampReceived><subject>[Acpi] linux-test12-pre3 fails to compile in acpi.c</subject><body>

I would guess this a problem with missed patches during Linus's
paternity leave.
test11 did fine and acpi sorta works. (ThinkPad A20)
Garst

</body></email><email><emailId>20001120213655</emailId><senderName>Robert Vollmert</senderName><senderEmail>rvollmert@gmx.net</senderEmail><timestampReceived>2000-11-20 21:36:55-0400</timestampReceived><subject>[Acpi] Initialization fails because of PCI</subject><body>

Hello,

on my system, the new ACPI-version fails to initialize. This is
because the call to acpi_install_address_space_handler in nsinit.c
fails with AE_EXIST. Relevant output of dmesg is


ACPI Subsystem version [Nov 20 2000]
ACPI: System description tables found
 tbxface-0089: ACPI Tables successfully loaded
Parsing Methods:...................................................................................................
 99 Control Methods found and parsed (326 nodes total)
ACPI Namespace successfully loaded at root 0xc027f318
ACPI: System description tables loaded
evxfevnt-0082: Transition to ACPI mode successful
Executing device _INI methods:.......  nsinit-0136: Ns_initialize_devices: \
                Walk_namespace failed! 7
breakpoint: Fatal error encountered

7 Devices found: 7 _STA, 0 _INI, 7 _HID, 1 PCIRoot
ACPI: Subsystem enable failed


If I disable the PCI initialization (by passing ACPI_NO_PCI_INIT to
acpi_enable_subsystem in driver.c), ACPI is enabled, although I still
get an error.

The same message (Exec_monadic2_r/Not: bad operand(s) (0x3005))
is printed when the system is halted (together with "ACPI: S5
failed").

The output of dmesg when PCI is disabled is:


ACPI Subsystem version [Nov 20 2000]
ACPI: System description tables found
 tbxface-0089: ACPI Tables successfully loaded
Parsing Methods:...................................................................................................
 99 Control Methods found and parsed (326 nodes total)
ACPI Namespace successfully loaded at root 0xc027f318
ACPI: System description tables loaded
evxfevnt-0082: Transition to ACPI mode successful
Executing device _INI methods:......................................
38 Devices found: 38 _STA, 0 _INI, 21 _HID, 1 PCIRoot
Completing Region and Field initialization:............ ammonad-0284: \
                Exec_monadic2_r/Not: bad operand(s) (0x3005)
breakpoint: Fatal error encountered
.... ammonad-0284: Exec_monadic2_r/Not: bad operand(s) (0x3005)
breakpoint: Fatal error encountered
.
12/20 Regions, 5/5 Fields initialized (326 nodes total)
ACPI: Subsystem enabled
ACPI: System firmware supports: C2
ACPI: System firmware supports: S0 S1 S4 S5


My motherboard is an Asus A7V with the VIA Apollo KT133 chipset. 

-- 
Robert Vollmert                                      rvollmert@gmx.net


</body></email><email><emailId>20001122103120</emailId><senderName>Robert Vollmert</senderName><senderEmail>rvollmert@gmx.net</senderEmail><timestampReceived>2000-11-22 10:31:20-0400</timestampReceived><subject>[Acpi] Re: acpi_power_off() doesn't.</subject><body>

&gt; Anyways, give it a go. I'm not sure this will fix it but this was
&gt; definitely a bug.

Thanks for the patch, but it still doesn't shut down. Now, the offset
also varied, so I'll include that in the table.

width = 16, address_space_id = 1, register_bit_offset = 0, reserved = 0

value	offset	register_bit_width	address
32768	0	32			58368
32768	0	32			0
7169	4	16			58372
7169	5	16			0
8193	6	16			58372
8193	6	16			0

Thanks, Robert

-- 
Robert Vollmert                                      rvollmert@gmx.net

</body></email><email><emailId>20001124121050</emailId><senderName>"LOISON,FRANCOIS (HP-France,ex1)"</senderName><senderEmail>francois_loison@hp.com</senderEmail><timestampReceived>2000-11-24 12:10:50-0400</timestampReceived><subject>[Acpi] ACPI S3 mode</subject><body>

Hello,

I saw in HOWTO that current implementation does S1 and that further modes
are studied.
Do you plan to implement S3 (Suspend to RAM)?
S3 is very attractive.

Salutations,
Francois Loison 

</body></email><email><emailId>20001125063114</emailId><senderName>Jeff Garzik</senderName><senderEmail>jgarzik@mandrakesoft.com</senderEmail><timestampReceived>2000-11-25 06:31:14-0400</timestampReceived><subject>[Acpi] ACPICA 20001115 report</subject><body>

This message is four reports of 2.4.0-test11 kernel with the 20001115
ACPICA debug version, and Andrew Grover's "nsinit" and "hwinit" patches
that I saw float across my mailbox.

Where possible, ACPI tables were captured, and provided as a tarball. 
That is the URL that precedes each 'dmesg' output.

---------------------------------------------------------
num: Toshiba Satellite laptop, Pentium III 650, 128MB RAM
---------------------------------------------------------
Summary: ACPI fails
ACPI tables: /proc/sys/acpi not available

ACPI Subsystem version [Nov 21 2000]
ACPI: System description tables found
 tbxface-0089: ACPI Tables successfully loaded
Parsing
Methods:...........................................................................................................................................................
 155 Control Methods found and parsed (500 nodes total)
ACPI Namespace successfully loaded at root 0xc03274f8
ACPI: System description tables loaded
evxfevnt-0082: Transition to ACPI mode successful
Executing device _INI methods:.  cmeval-0351: No object was returned
from _STA
  nsinit-0136: Ns_initialize_devices: Walk_namespace failed! 8

1 Devices found: 0 _STA, 0 _INI, 0 _HID, 0 PCIRoot
ACPI: Subsystem enable failed


---------------------------------------------------------
rum: ASUS P2B-D SMP, Dual Pentium II 400, 128MB RAM
---------------------------------------------------------
Summary: ACPI works, no 'C' states, with warnings
ACPI tables: http://gtf.org/garzik/acpi/rum-acpi-20001125.tar.gz

ACPI Subsystem version [Nov 23 2000]
ACPI: System description tables found
 tbxface-0089: ACPI Tables successfully loaded
Parsing
Methods:.............................................................
61 Control Methods found and parsed (201 nodes total)
ACPI Namespace successfully loaded at root 0xc03173d8
ACPI: System description tables loaded
evxfevnt-0082: Transition to ACPI mode successful
Executing device _INI methods:..........................
26 Devices found: 26 _STA, 0 _INI, 0 _HID, 0 PCIRoot
Completing Region and Field initialization:..... ammonad-0284:
Exec_monadic2_r/Not: bad operand(s) (0x3005)

  nsinit-0209: AE_AML_OPERAND_TYPE while getting region arguments [DEBG]
..
7/9 Regions, 0/0 Fields initialized (201 nodes total)
ACPI: Subsystem enabled
ACPI: System firmware supports: S0 S1 S5



---------------------------------------------------------
hum: Unknown PIIX4, Pentium III 500, 96MB RAM
---------------------------------------------------------
Summary: ACPI works, with warnings
ACPI tables: http://gtf.org/garzik/acpi/hum-acpi-20001125.tar.gz

ACPI Subsystem version [Nov 23 2000]
ACPI: System description tables found
 tbxface-0089: ACPI Tables successfully loaded
Parsing
Methods:.........................................................................................................
 105 Control Methods found and parsed (287 nodes total)
ACPI Namespace successfully loaded at root 0xc031a9f8
ACPI: System description tables loaded
evxfevnt-0082: Transition to ACPI mode successful
Executing device _INI methods:.........................
25 Devices found: 25 _STA, 1 _INI, 0 _HID, 0 PCIRoot
Completing Region and Field initialization:...
  nsinit-0209: AE_AML_OPERAND_TYPE while getting region arguments [SMRG]
............
14/17 Regions, 1/1 Fields initialized (287 nodes total)
ACPI: Subsystem enabled
ACPI: System firmware supports: C2 C3
ACPI: System firmware supports: S0 S1 S4 S5



---------------------------------------------------------
gum: Azza i810, Celeron 566, 128MB RAM
---------------------------------------------------------
Summary: ACPI works, with warnings
ACPI tables: http://gtf.org/garzik/acpi/gum-acpi-20001125.tar.gz

ACPI Subsystem version [Nov 23 2000]
ACPI: System description tables found
 tbxface-0089: ACPI Tables successfully loaded
Parsing
Methods:......................................................................................................
 102 Control Methods found and parsed (434 nodes total)
ACPI Namespace successfully loaded at root 0xc03069d8
ACPI: System description tables loaded
evxfevnt-0082: Transition to ACPI mode successful
Executing device _INI methods:...............................
31 Devices found: 31 _STA, 2 _INI, 0 _HID, 0 PCIRoot
Completing Region and Field initialization:.............. ammonad-0284:
Exec_monadic2_r/Not: bad operand(s) (0x3005)

  nsinit-0209: AE_AML_OPERAND_TYPE while getting region arguments [DEBG]
.. ammonad-0284: Exec_monadic2_r/Not: bad operand(s) (0x3005)

  nsinit-0209: AE_AML_OPERAND_TYPE while getting region arguments [SMIC]
. ammonad-0284: Exec_monadic2_r/Not: bad operand(s) (0x3005)

  nsinit-0209: AE_AML_OPERAND_TYPE while getting region arguments [PM1S]
. ammonad-0284: Exec_monadic2_r/Not: bad operand(s) (0x3005)

  nsinit-0209: AE_AML_OPERAND_TYPE while getting region arguments [SPEN]
. ammonad-0284: Exec_monadic2_r/Not: bad operand(s) (0x3005)

  nsinit-0209: AE_AML_OPERAND_TYPE while getting region arguments [GPI_]
. ammonad-0284: Exec_monadic2_r/Not: bad operand(s) (0x3005)

  nsinit-0209: AE_AML_OPERAND_TYPE while getting region arguments [GBLE]
. ammonad-0284: Exec_monadic2_r/Not: bad operand(s) (0x3005)

  nsinit-0209: AE_AML_OPERAND_TYPE while getting region arguments [TRP1]
... ammonad-0284: Exec_monadic2_r/Not: bad operand(s) (0x3005)

  nsinit-0209: AE_AML_OPERAND_TYPE while getting region arguments [GPO_]
.. ammonad-0284: Exec_monadic2_r/Not: bad operand(s) (0x3005)

  nsinit-0209: AE_AML_OPERAND_TYPE while getting region arguments [GRAM]
............ psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML
offset 0x0, ignoring
 psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
. psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
 psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
. psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
 psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
. psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
 psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
. psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
 psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
. psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
 psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
. psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
 psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
. psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
 psparse-0596: Parse_loop: Found unknown opcode 0x13 at AML offset 0x0,
ignoring
.......
29/33 Regions, 23/25 Fields initialized (434 nodes total)
ACPI: Subsystem enabled
ACPI: System firmware supports: C2
ACPI: System firmware supports: S0 S1 S4 S5



-- 
Jeff Garzik             |
Building 1024           | The chief enemy of creativity is "good" sense
MandrakeSoft            |          -- Picasso


</body></email><email><emailId>20001122174723</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-11-22 17:47:23-0400</timestampReceived><subject>RE: [Acpi] Re: acpi_power_off() doesn't.</subject><body>

Try this. Redundant writes are gone, but offset should be 0.

Against 11_15 DEBUG.

Thanks -- Regards -- Andy

&gt; From: Robert Vollmert [mailto:rvollmert@gmx.net]
&gt; &gt; Anyways, give it a go. I'm not sure this will fix it but this was
&gt; &gt; definitely a bug.
&gt; 
&gt; Thanks for the patch, but it still doesn't shut down. Now, the offset
&gt; also varied, so I'll include that in the table.
&gt; 
&gt; width = 16, address_space_id = 1, register_bit_offset = 0, 
&gt; reserved = 0
&gt; 
&gt; value	offset	register_bit_width	address
&gt; 32768	0	32			58368
&gt; 32768	0	32			0
&gt; 7169	4	16			58372
&gt; 7169	5	16			0
&gt; 8193	6	16			58372
&gt; 8193	6	16			0
&gt; 
&gt; Thanks, Robert
&gt; 
&gt; -- 
&gt; Robert Vollmert                                      rvollmert@gmx.net
&gt; 
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; 


["hwregs2.diff" (application/octet-stream)]

--- linux-old-debug/drivers/acpi/hardware/hwregs.c	Wed Nov 15 16:25:28 2000
+++ linux/drivers/acpi/hardware/hwregs.c	Wed Nov 22 09:32:07 2000
@@ -3,7 +3,7 @@
  *
  * Module Name: hwregs - Read/write access functions for the various ACPI
  *                       control and status registers.
- *              $Revision: 81 $
+ *              $Revision: 83 $
  *
  ******************************************************************************/
 
@@ -426,7 +426,7 @@
 		 */
 		register_value = acpi_hw_register_read (ACPI_MTX_DO_NOT_LOCK, PM1_CONTROL);
 
-		DEBUG_PRINT (TRACE_IO, ("PM1 control: Read 0x%X\n", register_value));
+		DEBUG_PRINT (TRACE_IO, ("PM1 control: Read %X\n", register_value));
 
 		if (read_write == ACPI_WRITE) {
 			register_value &amp;= ~mask;
@@ -439,10 +439,13 @@
 			 * than any other control Registers with
 			 * respect to A and B Registers.  The value
 			 * for A may be different than the value for B
+			 *
+			 * Therefore, pass the Register_id, not just generic PM1_CONTROL,
+			 * because we need to do different things. Yuck.
 			 */
 
 			acpi_hw_register_write (ACPI_MTX_DO_NOT_LOCK,
-				PM1_CONTROL, (u16) register_value);
+				register_id, (u16) register_value);
 		}
 		break;
 
@@ -462,7 +465,7 @@
 
 		register_value = acpi_hw_register_read (ACPI_MTX_DO_NOT_LOCK, PM2_CONTROL);
 
-		DEBUG_PRINT (TRACE_IO, ("PM2 control: Read 0x%X from 0x%X\n",
+		DEBUG_PRINT (TRACE_IO, ("PM2 control: Read %X from %p\n",
 				  register_value, acpi_gbl_FADT-&gt;Xpm2_cnt_blk.address));
 
 		if (read_write == ACPI_WRITE) {
@@ -472,7 +475,7 @@
 			register_value |= value;
 
 			DEBUG_PRINT (TRACE_IO,
-				("About to write %04X to %04X\n", register_value,
+				("About to write %04X to %p\n", register_value,
 				acpi_gbl_FADT-&gt;Xpm2_cnt_blk.address));
 
 			acpi_hw_register_write (ACPI_MTX_DO_NOT_LOCK,
@@ -486,7 +489,7 @@
 		mask = TMR_VAL_MASK;
 		register_value = acpi_hw_register_read (ACPI_MTX_DO_NOT_LOCK,
 				 PM_TIMER);
-		DEBUG_PRINT (TRACE_IO, ("PM_TIMER: Read 0x%X from 0x%X\n",
+		DEBUG_PRINT (TRACE_IO, ("PM_TIMER: Read %X from %p\n",
 				  register_value, acpi_gbl_FADT-&gt;Xpm_tmr_blk.address));
 
 		break;
@@ -528,7 +531,7 @@
 		/* Now get the current Enable Bits in the selected Reg */
 
 		register_value = acpi_hw_register_read (ACPI_MTX_DO_NOT_LOCK, register_id);
-		DEBUG_PRINT (TRACE_IO, ("GPE Enable bits: Read 0x%X from 0x%X\n",
+		DEBUG_PRINT (TRACE_IO, ("GPE Enable bits: Read %X from %X\n",
 				 register_value, register_id));
 
 		if (read_write == ACPI_WRITE) {
@@ -566,7 +569,7 @@
 	register_value &amp;= mask;
 	register_value &gt;&gt;= acpi_hw_get_bit_shift (mask);
 
-	DEBUG_PRINT (TRACE_IO, ("Register I/O: returning 0x%X\n", register_value));
+	DEBUG_PRINT (TRACE_IO, ("Register I/O: returning %X\n", register_value));
 	return_VALUE (register_value);
 }
 
@@ -591,7 +594,6 @@
 	u32                     register_id)
 {
 	u32                     value       = 0;
-	u32                     offset      = REGISTER_OFFSET (register_id);
 	u32                     bank_offset;
 
 	FUNCTION_TRACE ("Acpi_hw_register_read");
@@ -605,16 +607,16 @@
 	{
 	case PM1_STS: /* 16-bit access */
 
-		value =  acpi_hw_low_level_read (16, &amp;acpi_gbl_FADT-&gt;Xpm1a_evt_blk, offset);
-		value |= acpi_hw_low_level_read (16, &amp;acpi_gbl_FADT-&gt;Xpm1b_evt_blk, offset);
+		value =  acpi_hw_low_level_read (16, &amp;acpi_gbl_FADT-&gt;Xpm1a_evt_blk, 0);
+		value |= acpi_hw_low_level_read (16, &amp;acpi_gbl_FADT-&gt;Xpm1b_evt_blk, 0);
 		break;
 
 
 	case PM1_EN: /* 16-bit access*/
 
 		bank_offset = DIV_2 (acpi_gbl_FADT-&gt;pm1_evt_len);
-		value =  acpi_hw_low_level_read (16, &amp;acpi_gbl_FADT-&gt;Xpm1a_evt_blk, bank_offset + offset);
-		value |= acpi_hw_low_level_read (16, &amp;acpi_gbl_FADT-&gt;Xpm1b_evt_blk, bank_offset + offset);
+		value =  acpi_hw_low_level_read (16, &amp;acpi_gbl_FADT-&gt;Xpm1a_evt_blk, bank_offset);
+		value |= acpi_hw_low_level_read (16, &amp;acpi_gbl_FADT-&gt;Xpm1b_evt_blk, bank_offset);
 		break;
 
 
@@ -632,39 +634,39 @@
 
 	case PM2_CONTROL: /* 8-bit access */
 
-		value =  acpi_hw_low_level_read (8, &amp;acpi_gbl_FADT-&gt;Xpm2_cnt_blk, offset);
+		value =  acpi_hw_low_level_read (8, &amp;acpi_gbl_FADT-&gt;Xpm2_cnt_blk, 0);
 		break;
 
 
 	case PM_TIMER: /* 32-bit access */
 
-		value =  acpi_hw_low_level_read (32, &amp;acpi_gbl_FADT-&gt;Xpm_tmr_blk, offset);
+		value =  acpi_hw_low_level_read (32, &amp;acpi_gbl_FADT-&gt;Xpm_tmr_blk, 0);
 		break;
 
 
 	case GPE0_STS_BLOCK: /* 8-bit access */
 
-		value =  acpi_hw_low_level_read (8, &amp;acpi_gbl_FADT-&gt;Xgpe0blk, offset);
+		value =  acpi_hw_low_level_read (8, &amp;acpi_gbl_FADT-&gt;Xgpe0blk, 0);
 		break;
 
 
 	case GPE0_EN_BLOCK: /* 8-bit access */
 
 		bank_offset = DIV_2 (acpi_gbl_FADT-&gt;gpe0blk_len);
-		value =  acpi_hw_low_level_read (8, &amp;acpi_gbl_FADT-&gt;Xgpe0blk, bank_offset + offset);
+		value =  acpi_hw_low_level_read (8, &amp;acpi_gbl_FADT-&gt;Xgpe0blk, bank_offset);
 		break;
 
 
 	case GPE1_STS_BLOCK: /* 8-bit access */
 
-		value =  acpi_hw_low_level_read (8, &amp;acpi_gbl_FADT-&gt;Xgpe1_blk, offset);
+		value =  acpi_hw_low_level_read (8, &amp;acpi_gbl_FADT-&gt;Xgpe1_blk, 0);
 		break;
 
 
 	case GPE1_EN_BLOCK: /* 8-bit access */
 
 		bank_offset = DIV_2 (acpi_gbl_FADT-&gt;gpe1_blk_len);
-		value =  acpi_hw_low_level_read (8, &amp;acpi_gbl_FADT-&gt;Xgpe1_blk, bank_offset + offset);
+		value =  acpi_hw_low_level_read (8, &amp;acpi_gbl_FADT-&gt;Xgpe1_blk, bank_offset);
 		break;
 
 
@@ -723,16 +725,16 @@
 	{
 	case PM1_STS: /* 16-bit access */
 
-		acpi_hw_low_level_write (16, value, &amp;acpi_gbl_FADT-&gt;Xpm1a_evt_blk, offset);
-		acpi_hw_low_level_write (16, value, &amp;acpi_gbl_FADT-&gt;Xpm1b_evt_blk, offset);
+		acpi_hw_low_level_write (16, value, &amp;acpi_gbl_FADT-&gt;Xpm1a_evt_blk, 0);
+		acpi_hw_low_level_write (16, value, &amp;acpi_gbl_FADT-&gt;Xpm1b_evt_blk, 0);
 		break;
 
 
 	case PM1_EN: /* 16-bit access*/
 
 		bank_offset = DIV_2 (acpi_gbl_FADT-&gt;pm1_evt_len);
-		acpi_hw_low_level_write (16, value, &amp;acpi_gbl_FADT-&gt;Xpm1a_evt_blk, bank_offset + offset);
-		acpi_hw_low_level_write (16, value, &amp;acpi_gbl_FADT-&gt;Xpm1b_evt_blk, bank_offset + offset);
+		acpi_hw_low_level_write (16, value, &amp;acpi_gbl_FADT-&gt;Xpm1a_evt_blk, bank_offset);
+		acpi_hw_low_level_write (16, value, &amp;acpi_gbl_FADT-&gt;Xpm1b_evt_blk, bank_offset);
 		break;
 
 
@@ -743,10 +745,10 @@
 		 * Otherwise, write to both.
 		 */
 		if (register_id == SLP_TYPE_A) {
-			acpi_hw_low_level_write (16, value, &amp;acpi_gbl_FADT-&gt;Xpm1a_cnt_blk, offset);
+			acpi_hw_low_level_write (16, value, &amp;acpi_gbl_FADT-&gt;Xpm1a_cnt_blk, 0);
 		}
 		else if (register_id == SLP_TYPE_B) {
-			acpi_hw_low_level_write (16, value, &amp;acpi_gbl_FADT-&gt;Xpm1b_cnt_blk, offset);
+			acpi_hw_low_level_write (16, value, &amp;acpi_gbl_FADT-&gt;Xpm1b_cnt_blk, 0);
 		}
 		else {
 			/* disable/re-enable interrupts if sleeping */
@@ -754,8 +756,8 @@
 				disable();
 			}
 
-			acpi_hw_low_level_write (16, value, &amp;acpi_gbl_FADT-&gt;Xpm1a_cnt_blk, offset);
-			acpi_hw_low_level_write (16, value, &amp;acpi_gbl_FADT-&gt;Xpm1b_cnt_blk, offset);
+			acpi_hw_low_level_write (16, value, &amp;acpi_gbl_FADT-&gt;Xpm1a_cnt_blk, 0);
+			acpi_hw_low_level_write (16, value, &amp;acpi_gbl_FADT-&gt;Xpm1b_cnt_blk, 0);
 
 			if (register_id == SLP_EN) {
 				enable();
@@ -767,39 +769,39 @@
 
 	case PM2_CONTROL: /* 8-bit access */
 
-		acpi_hw_low_level_write (8, value, &amp;acpi_gbl_FADT-&gt;Xpm2_cnt_blk, offset);
+		acpi_hw_low_level_write (8, value, &amp;acpi_gbl_FADT-&gt;Xpm2_cnt_blk, 0);
 		break;
 
 
 	case PM_TIMER: /* 32-bit access */
 
-		acpi_hw_low_level_write (32, value, &amp;acpi_gbl_FADT-&gt;Xpm_tmr_blk, offset);
+		acpi_hw_low_level_write (32, value, &amp;acpi_gbl_FADT-&gt;Xpm_tmr_blk, 0);
 		break;
 
 
 	case GPE0_STS_BLOCK: /* 8-bit access */
 
-		acpi_hw_low_level_write (8, value, &amp;acpi_gbl_FADT-&gt;Xgpe0blk, offset);
+		acpi_hw_low_level_write (8, value, &amp;acpi_gbl_FADT-&gt;Xgpe0blk, 0);
 		break;
 
 
 	case GPE0_EN_BLOCK: /* 8-bit access */
 
 		bank_offset = DIV_2 (acpi_gbl_FADT-&gt;gpe0blk_len);
-		acpi_hw_low_level_write (8, value, &amp;acpi_gbl_FADT-&gt;Xgpe0blk, bank_offset + offset);
+		acpi_hw_low_level_write (8, value, &amp;acpi_gbl_FADT-&gt;Xgpe0blk, bank_offset);
 		break;
 
 
 	case GPE1_STS_BLOCK: /* 8-bit access */
 
-		acpi_hw_low_level_write (8, value, &amp;acpi_gbl_FADT-&gt;Xgpe1_blk, offset);
+		acpi_hw_low_level_write (8, value, &amp;acpi_gbl_FADT-&gt;Xgpe1_blk, 0);
 		break;
 
 
 	case GPE1_EN_BLOCK: /* 8-bit access */
 
 		bank_offset = DIV_2 (acpi_gbl_FADT-&gt;gpe1_blk_len);
-		acpi_hw_low_level_write (8, value, &amp;acpi_gbl_FADT-&gt;Xgpe1_blk, bank_offset + offset);
+		acpi_hw_low_level_write (8, value, &amp;acpi_gbl_FADT-&gt;Xgpe1_blk, bank_offset);
 		break;
 
 
@@ -1038,5 +1040,3 @@
 		break;
 	}
 }
-
-


</body></email><email><emailId>20001120222448</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-11-20 22:24:48-0400</timestampReceived><subject>RE: [Acpi] Initialization fails because of PCI</subject><body>

Interesting!

2 issues, huh?

&gt; From: Robert Vollmert [mailto:rvollmert@gmx.net]
&gt; on my system, the new ACPI-version fails to initialize. This is
&gt; because the call to acpi_install_address_space_handler in nsinit.c
&gt; fails with AE_EXIST. Relevant output of dmesg is

Number 1 - Address space handler init

Can you send me your DSDT? 'cat /proc/sys/acpi/dsdt &gt;~/dsdt.dat'

We install a default PCI address space handler at the root of the namespace,
and then additional handlers for each PCI bridge. Could it be that a PCI
bridge is the root device? Don't know. It hopefully will be pretty easy to
figure out from looking at the DSDT.

&gt; Completing Region and Field initialization:............ 
&gt; ammonad-0284: Exec_monadic2_r/Not: bad operand(s) (0x3005)
&gt; breakpoint: Fatal error encountered
&gt; .... ammonad-0284: Exec_monadic2_r/Not: bad operand(s) (0x3005)
&gt; breakpoint: Fatal error encountered

Number 2 - Bad operand error

So on shutdown it's the call to eval _PTS that's causing this?

And, does the machine actually turn off?

Regards -- Andy

</body></email><email><emailId>20001123075906</emailId><senderName>"Mahmoud Mohamed"</senderName><senderEmail>demos70@hotmail.com</senderEmail><timestampReceived>2000-11-23 07:59:06-0400</timestampReceived><subject>[Acpi] Patches</subject><body>



Hi all,

Sorry to interrupt the intresting Robert/Andy thread..but I just got
the acpi-linux-debug-20001115.tar.gz and the patch. The patch fails with 
linux-2.4.0-test11 here's what I get:

patching file linux/arch/i386/kernel/acpi.c
Hunk #3 FAILED at 26.
1 out of 3 hunks FAILED -- saving rejects to file 
linux/arch/i386/kernel/acpi.c.rej

Is this normal should I go on with compiling the kernel?
Also should I apply the hwregs.diff, hwregs2.diff, nsinit.diff posted here 
afterwards or are these specific to Robert's Asus mobo ?

Thanks,
Mahmood
_____________________________________________________________________________________
Get more from the Web.  FREE MSN Explorer download : http://explorer.msn.com

</body></email><email><emailId>20001121123813</emailId><senderName>Jeff Garzik</senderName><senderEmail>jgarzik@mandrakesoft.com</senderEmail><timestampReceived>2000-11-21 12:38:13-0400</timestampReceived><subject>[Acpi] Fixing broken ACPI tables?</subject><body>

&gt;From what I understand, a great many Toshiba laptops and other BIOS's
have ACPI tables which do not perfectly conform to spec, or are in some
other way unusable.

I would -really- like to make sure that Linux users have a solution they
can turn to when this happens for them.

Can we upload better ACPI tables from userspace, after boot, and then
tell ACPICA to reinitialize?

Can we provide a set of common fixups, which are applied before
initialization, to repair commonly-found AML mistakes?  (for another
example of fixups in the Linux kernel, read arch/i386/kernel/pci-pc.c,
grep for 'pcibios_fixups')

Telling users "tell your vendor to fix their broken BIOS" is an
extremely poor option, especially when few vendors care enough about the
issue.  :(

	Jeff


-- 
Jeff Garzik             |
Building 1024           | The chief enemy of creativity is "good" sense
MandrakeSoft            |          -- Picasso

</body></email><email><emailId>20001121164940</emailId><senderName>"Therien, Guy"</senderName><senderEmail>guy.therien@intel.com</senderEmail><timestampReceived>2000-11-21 16:49:40-0400</timestampReceived><subject>RE: [Acpi] Fixing broken ACPI tables?</subject><body>

Jeff,
Of course this capability would be convenient for the developers and the
folks that have the ability to invoke it. Generally, I am very much against
fixing things that the OEM has not sanctioned because it is not supported by
the OEM. This would necessarily be the requirement if Linux were much more
mainstream i.e. found commonly as an optional pre-install OS. In the mean
time, it does make sense for both debugging purposes and for those who want
to take responsibility themselves to provide the ability to fix ACPI
firmware problems. The problem is that we need those changes during the
first pass through. The DSDT cannot be unloaded and reloaded. Unfortunately
file services are not available during early kernel initialization when ACPI
would need to read alternative tables. There are two potential solutions to
this problem. The easiest is to capture the table, convert to ASL, fix it,
convert back to AML and then compile it with the kernel - making the kernel
machine specific. This is what we do to get around problems before we have
BIOS updates. The second more preferable solution would be to change the
bootloader to load an AML file(s) along with the kernel and find a way for
ACPI CA to find out about them. If you would like to look into the last
one... that would be great as it it currently low on our priority list - as
we can do the former.

Guy

-----Original Message-----
From: Jeff Garzik [mailto:jgarzik@mandrakesoft.com]
Sent: Tuesday, November 21, 2000 4:38 AM
To: acpi@phobos.fachschaften.tu-muenchen.de
Subject: [Acpi] Fixing broken ACPI tables?


&gt;From what I understand, a great many Toshiba laptops and other BIOS's
have ACPI tables which do not perfectly conform to spec, or are in some
other way unusable.

I would -really- like to make sure that Linux users have a solution they
can turn to when this happens for them.

Can we upload better ACPI tables from userspace, after boot, and then
tell ACPICA to reinitialize?

Can we provide a set of common fixups, which are applied before
initialization, to repair commonly-found AML mistakes?  (for another
example of fixups in the Linux kernel, read arch/i386/kernel/pci-pc.c,
grep for 'pcibios_fixups')

Telling users "tell your vendor to fix their broken BIOS" is an
extremely poor option, especially when few vendors care enough about the
issue.  :(

	Jeff


-- 
Jeff Garzik             |
Building 1024           | The chief enemy of creativity is "good" sense
MandrakeSoft            |          -- Picasso


_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20001121170632</emailId><senderName>"Henroid, Andrew D"</senderName><senderEmail>andrew.d.henroid@intel.com</senderEmail><timestampReceived>2000-11-21 17:06:32-0400</timestampReceived><subject>RE: [Acpi] Fixing broken ACPI tables?</subject><body>

&gt; -----Original Message-----
&gt; From: Therien, Guy [mailto:guy.therien@intel.com]
&gt; Sent: Tuesday, November 21, 2000 8:50 AM
&gt; To: 'Jeff Garzik'; acpi@phobos.fachschaften.tu-muenchen.de
&gt; Subject: RE: [Acpi] Fixing broken ACPI tables?

&gt; first pass through. The DSDT cannot be unloaded and reloaded. 

Why is this, again?  This premise seems to complicate life
significantly.  It's unlikely that LILO is ever going to be
hacked to load an alternate DSDT.  Why not reload or, if
that is totally impossible, delay loading based on a kernel
command line option?

-Andy

</body></email><email><emailId>20001121171540</emailId><senderName>"Therien, Guy"</senderName><senderEmail>guy.therien@intel.com</senderEmail><timestampReceived>2000-11-21 17:15:40-0400</timestampReceived><subject>RE: [Acpi] Fixing broken ACPI tables?</subject><body>

ACPI prohibits unloading the DSDT. The init sequence requires _PRT before
the PCI driver and the PCI driver may be needed before the disk can be up.
Guy

-----Original Message-----
From: Henroid, Andrew D 
Sent: Tuesday, November 21, 2000 9:07 AM
To: Therien, Guy
Cc: 'Jeff Garzik'; Grover, Andrew;
'acpi@phobos.fachschaften.tu-muenchen.de'
Subject: RE: [Acpi] Fixing broken ACPI tables?


&gt; -----Original Message-----
&gt; From: Therien, Guy [mailto:guy.therien@intel.com]
&gt; Sent: Tuesday, November 21, 2000 8:50 AM
&gt; To: 'Jeff Garzik'; acpi@phobos.fachschaften.tu-muenchen.de
&gt; Subject: RE: [Acpi] Fixing broken ACPI tables?

&gt; first pass through. The DSDT cannot be unloaded and reloaded. 

Why is this, again?  This premise seems to complicate life
significantly.  It's unlikely that LILO is ever going to be
hacked to load an alternate DSDT.  Why not reload or, if
that is totally impossible, delay loading based on a kernel
command line option?

-Andy

</body></email><email><emailId>20001125051129</emailId><senderName>Jeff Garzik</senderName><senderEmail>jgarzik@mandrakesoft.com</senderEmail><timestampReceived>2000-11-25 05:11:29-0400</timestampReceived><subject>Re: [Acpi] Fixing broken ACPI tables?</subject><body>

"Therien, Guy" wrote:
&gt; Of course this capability would be convenient for the developers and the
&gt; folks that have the ability to invoke it. Generally, I am very much against
&gt; fixing things that the OEM has not sanctioned because it is not supported by
&gt; the OEM. This would necessarily be the requirement if Linux were much more
&gt; mainstream i.e. found commonly as an optional pre-install OS. In the mean
&gt; time, it does make sense for both debugging purposes and for those who want
&gt; to take responsibility themselves to provide the ability to fix ACPI
&gt; firmware problems. The problem is that we need those changes during the
&gt; first pass through. The DSDT cannot be unloaded and reloaded. Unfortunately
&gt; file services are not available during early kernel initialization when ACPI
&gt; would need to read alternative tables.

The preferred way to load firmware into hardware, under Linux, is for
the Linux device driver to provide an ioctl which uploads a sequence of
bytes into firmware.  I would prefer a scenario like

	Kernel boots
	Bad ACPI tables, ACPI initialization fails
	Filesystem and everything initialized
	Userspace program uploads better ACPI tables
	ACPICA is signalled to re-initialize, ACPI init succeeds


&gt; There are two potential solutions to
&gt; this problem. The easiest is to capture the table, convert to ASL, fix it,
&gt; convert back to AML and then compile it with the kernel - making the kernel
&gt; machine specific. This is what we do to get around problems before we have
&gt; BIOS updates. The second more preferable solution would be to change the
&gt; bootloader to load an AML file(s) along with the kernel and find a way for
&gt; ACPI CA to find out about them. If you would like to look into the last
&gt; one... that would be great as it it currently low on our priority list - as
&gt; we can do the former.

This semi-coincides with linuxbios' need to be able to provide a memory
map to the kernel, when the E820/E801 (and other) BIOS calls are not
available.

I would still prefer the former (as given the above example) -- such a
solution works just fine from an initial ramdisk ("initrd"), and
requires no modification of the low-level boot/setup code, nor
modification of boot loaders.  And since initrd data is loaded when the
kernel image is loaded, its data is present when ACPICA needs it to be.

Regards,

	Jeff


-- 
Jeff Garzik             |
Building 1024           | The chief enemy of creativity is "good" sense
MandrakeSoft            |          -- Picasso

</body></email><email><emailId>20001125104308</emailId><senderName>Mike Smith</senderName><senderEmail>msmith@freebsd.org</senderEmail><timestampReceived>2000-11-25 10:43:08-0400</timestampReceived><subject>Re: [Acpi] Fixing broken ACPI tables?</subject><body>

&gt; The preferred way to load firmware into hardware, under Linux, is for
&gt; the Linux device driver to provide an ioctl which uploads a sequence of
&gt; bytes into firmware.  I would prefer a scenario like
&gt; 
&gt; 	Kernel boots
&gt; 	Bad ACPI tables, ACPI initialization fails
&gt; 	Filesystem and everything initialized
&gt; 	Userspace program uploads better ACPI tables
&gt; 	ACPICA is signalled to re-initialize, ACPI init succeeds

This doesn't work for several reasons:

 - If ACPI "fails", there's a good chance it will take your machine out
   with it.
 - One of the key uses for ACPI is hardware discovery; this includes
   locating and configuring root busses, motherboard devices, etc.  You
   need to do this before you get anywhere near having a filesystem
   or userspace programs (unless you're loading from a ramdisk, which is 
   functional but ugly).

In reality, the whole "fix AML for the vendor" situation has lots of 
parallels with the "Milo/PALcode for non-SRM" Alpha problem.  Only the 
scope of the challenge is much more loosely defined.

-- 
... every activity meets with opposition, everyone who acts has his
rivals and unfortunately opponents also.  But not because people want
to be opponents, rather because the tasks and relationships force
people to take different points of view.  [Dr. Fritz Todt]
           V I C T O R Y   N O T   V E N G E A N C E

</body></email><email><emailId>20001125223452</emailId><senderName>Santiago Garcia Mantinan</senderName><senderEmail>manty@i.am</senderEmail><timestampReceived>2000-11-25 22:34:52-0400</timestampReceived><subject>Re: [Acpi] Fixing broken ACPI tables?</subject><body>

&gt; This doesn't work for several reasons:
&gt; 
&gt;  - If ACPI "fails", there's a good chance it will take your machine out
&gt;    with it.
&gt;  - One of the key uses for ACPI is hardware discovery; this includes
&gt;    locating and configuring root busses, motherboard devices, etc.  You
&gt;    need to do this before you get anywhere near having a filesystem
&gt;    or userspace programs (unless you're loading from a ramdisk, which is 
&gt;    functional but ugly).

:-??? for me this looks like PNP, and I see no reason why things wouldn't
work the way jeff says, I'm not saying that current implementation could do
it, but I think that the idea is ok, in fact I'd very much like to see it
implemented, and helping this to get done if I can.

Regards...
-- 
Manty/BestiaTester -&gt; http://manty.net

</body></email><email><emailId>20001125231400</emailId><senderName>Jeff Garzik</senderName><senderEmail>jgarzik@mandrakesoft.com</senderEmail><timestampReceived>2000-11-25 23:14:00-0400</timestampReceived><subject>Re: [Acpi] Fixing broken ACPI tables?</subject><body>

Mike Smith wrote:
&gt; 
&gt; &gt; The preferred way to load firmware into hardware, under Linux, is for
&gt; &gt; the Linux device driver to provide an ioctl which uploads a sequence of
&gt; &gt; bytes into firmware.  I would prefer a scenario like
&gt; &gt;
&gt; &gt;       Kernel boots
&gt; &gt;       Bad ACPI tables, ACPI initialization fails
&gt; &gt;       Filesystem and everything initialized
&gt; &gt;       Userspace program uploads better ACPI tables
&gt; &gt;       ACPICA is signalled to re-initialize, ACPI init succeeds
&gt; 
&gt; This doesn't work for several reasons:
&gt; 
&gt;  - If ACPI "fails", there's a good chance it will take your machine out
&gt;    with it.

When I say "ACPI initialization fails", I mean ACPICA subsystem
initialization fails due to bad ACPI tables.  This is a known case which
exists, and DOES NOT take your machine out.


&gt;  - One of the key uses for ACPI is hardware discovery; this includes
&gt;    locating and configuring root busses, motherboard devices, etc.  You
&gt;    need to do this before you get anywhere near having a filesystem
&gt;    or userspace programs (unless you're loading from a ramdisk, which is
&gt;    functional but ugly).

On IA-32, ACPICA initializes after most of the system is setup. 
Further, if ACPICA fails but the machine boots, you DO have a filesystem
from which you can load other ACPI tables.

What you describe is an issue on IA64, which NEEDS good ACPI tables.  It
is not an issue on IA32, which clearly does not need good ACPI tables to
function.


&gt; In reality, the whole "fix AML for the vendor" situation has lots of
&gt; parallels with the "Milo/PALcode for non-SRM" Alpha problem.  Only the
&gt; scope of the challenge is much more loosely defined.

The situation is similar, true.   But.  In most cases the solution is
far EASIER than the milo/palcode problem you describe.  (and I know,
having hacked around with palcode for my AS200, UDB, and UP1000)

	Jeff


-- 
Jeff Garzik             |
Building 1024           | The chief enemy of creativity is "good" sense
MandrakeSoft            |          -- Picasso

</body></email><email><emailId>20001126002521</emailId><senderName>Mike Smith</senderName><senderEmail>msmith@freebsd.org</senderEmail><timestampReceived>2000-11-26 00:25:21-0400</timestampReceived><subject>Re: [Acpi] Fixing broken ACPI tables?</subject><body>

&gt; Mike Smith wrote:
&gt; &gt; 
&gt; &gt; &gt; The preferred way to load firmware into hardware, under Linux, is for
&gt; &gt; &gt; the Linux device driver to provide an ioctl which uploads a sequence of
&gt; &gt; &gt; bytes into firmware.  I would prefer a scenario like
&gt; &gt; &gt;
&gt; &gt; &gt;       Kernel boots
&gt; &gt; &gt;       Bad ACPI tables, ACPI initialization fails
&gt; &gt; &gt;       Filesystem and everything initialized
&gt; &gt; &gt;       Userspace program uploads better ACPI tables
&gt; &gt; &gt;       ACPICA is signalled to re-initialize, ACPI init succeeds
&gt; &gt; 
&gt; &gt; This doesn't work for several reasons:
&gt; &gt; 
&gt; &gt;  - If ACPI "fails", there's a good chance it will take your machine out
&gt; &gt;    with it.
&gt; 
&gt; When I say "ACPI initialization fails", I mean ACPICA subsystem
&gt; initialization fails due to bad ACPI tables.  This is a known case which
&gt; exists, and DOES NOT take your machine out.

Actually, it's a miniscule subset of a much larger problem.  I can name a 
lot of machines right now that the current ACPICA code just takes right 
out.  If you hand over to the interpreter, you're gone.  Finis.  This is 
the problem that you should be trying to address here, if you're going to 
make the attempt at all.

&gt; &gt;  - One of the key uses for ACPI is hardware discovery; this includes
&gt; &gt;    locating and configuring root busses, motherboard devices, etc.  You
&gt; &gt;    need to do this before you get anywhere near having a filesystem
&gt; &gt;    or userspace programs (unless you're loading from a ramdisk, which is
&gt; &gt;    functional but ugly).
&gt; 
&gt; On IA-32, ACPICA initializes after most of the system is setup. 

This is just a bug in the current Linux implementaton, and is going to 
have to change at some point.

&gt; Further, if ACPICA fails but the machine boots, you DO have a filesystem
&gt; from which you can load other ACPI tables.

... assuming you survive ACPICA "failing". See above.

&gt; What you describe is an issue on IA64, which NEEDS good ACPI tables.  It
&gt; is not an issue on IA32, which clearly does not need good ACPI tables to
&gt; function.

This is not really a valid assertion anymore.  Legacy IA32 may get by 
without ACPI to some degree; modern IA32 mandates functional ACPI.

&gt; &gt; In reality, the whole "fix AML for the vendor" situation has lots of
&gt; &gt; parallels with the "Milo/PALcode for non-SRM" Alpha problem.  Only the
&gt; &gt; scope of the challenge is much more loosely defined.
&gt; 
&gt; The situation is similar, true.   But.  In most cases the solution is
&gt; far EASIER than the milo/palcode problem you describe.  (and I know,
&gt; having hacked around with palcode for my AS200, UDB, and UP1000)

Amusingly, all of those systems have functional SRM. 8)  However, the 
solution is, if anything, less easy, due to the fundamental nature of 
ACPI to platform autoconfiguration, and the massively diverse set of 
platforms out there.  There are only a handful of machines that need 
Milo; I fear we would be looking at literally thousands that might need 
ACPI fixes.

-- 
... every activity meets with opposition, everyone who acts has his
rivals and unfortunately opponents also.  But not because people want
to be opponents, rather because the tasks and relationships force
people to take different points of view.  [Dr. Fritz Todt]
           V I C T O R Y   N O T   V E N G E A N C E

</body></email><email><emailId>20001126034422</emailId><senderName>Jeff Garzik</senderName><senderEmail>jgarzik@mandrakesoft.com</senderEmail><timestampReceived>2000-11-26 03:44:22-0400</timestampReceived><subject>Re: [Acpi] Fixing broken ACPI tables?</subject><body>

Mike Smith wrote:
&gt; 
&gt; &gt; Mike Smith wrote:
&gt; &gt; &gt;
&gt; &gt; &gt; &gt; The preferred way to load firmware into hardware, under Linux, is for
&gt; &gt; &gt; &gt; the Linux device driver to provide an ioctl which uploads a sequence of
&gt; &gt; &gt; &gt; bytes into firmware.  I would prefer a scenario like
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;       Kernel boots
&gt; &gt; &gt; &gt;       Bad ACPI tables, ACPI initialization fails
&gt; &gt; &gt; &gt;       Filesystem and everything initialized
&gt; &gt; &gt; &gt;       Userspace program uploads better ACPI tables
&gt; &gt; &gt; &gt;       ACPICA is signalled to re-initialize, ACPI init succeeds
&gt; &gt; &gt;
&gt; &gt; &gt; This doesn't work for several reasons:
&gt; &gt; &gt;
&gt; &gt; &gt;  - If ACPI "fails", there's a good chance it will take your machine out
&gt; &gt; &gt;    with it.
&gt; &gt;
&gt; &gt; When I say "ACPI initialization fails", I mean ACPICA subsystem
&gt; &gt; initialization fails due to bad ACPI tables.  This is a known case which
&gt; &gt; exists, and DOES NOT take your machine out.
&gt; 
&gt; Actually, it's a miniscule subset of a much larger problem.  I can name a
&gt; lot of machines right now that the current ACPICA code just takes right
&gt; out.  If you hand over to the interpreter, you're gone.  Finis.  This is
&gt; the problem that you should be trying to address here, if you're going to
&gt; make the attempt at all.

Send me a machine :)

I iterate through development (or in this case feedback and testing)
until I can say my hardware works 100% for me under Linux.


&gt; &gt; Further, if ACPICA fails but the machine boots, you DO have a filesystem
&gt; &gt; from which you can load other ACPI tables.
&gt; 
&gt; ... assuming you survive ACPICA "failing". See above.
&gt; 
&gt; &gt; What you describe is an issue on IA64, which NEEDS good ACPI tables.  It
&gt; &gt; is not an issue on IA32, which clearly does not need good ACPI tables to
&gt; &gt; function.
&gt; 
&gt; This is not really a valid assertion anymore.  Legacy IA32 may get by
&gt; without ACPI to some degree; modern IA32 mandates functional ACPI.

I've only heard of a few Dell laptops which -require- ACPI to be
functional.  Do you know otherwise?  There have been few if any such bug
reports on linux-kernel I've seen; I only know about the Dell laptop
requirement from a Dell engineer's posts.

Modern IA32 may "mandate" functional ACPI, but in the meantime
motherboard manufacturers are churning out new mobos which work just
fine on ACPI-less Linux 2.2.x.  Requiring ACPI means you cannot use a
lot of operating systems.  Or you must upgrade your system software [to
get ACPI support] from something well-known, well-tested and stable, to
something unknown and potentially unstable.  Locked out operating
systems and nervous IT managers combined mean that ACPI won't be a
requirement for a while...

Hell, just imagine trying to get mobo makers to mass produce something
that cannot run DOS and Win3.1 ;-)


&gt; &gt; &gt; In reality, the whole "fix AML for the vendor" situation has lots of
&gt; &gt; &gt; parallels with the "Milo/PALcode for non-SRM" Alpha problem.  Only the
&gt; &gt; &gt; scope of the challenge is much more loosely defined.
&gt; &gt;
&gt; &gt; The situation is similar, true.   But.  In most cases the solution is
&gt; &gt; far EASIER than the milo/palcode problem you describe.  (and I know,
&gt; &gt; having hacked around with palcode for my AS200, UDB, and UP1000)
&gt; 
&gt; Amusingly, all of those systems have functional SRM. 8)

Thanks for reminding me to ditch AlphaBIOS on my UP1000 :)


&gt; However, the
&gt; solution is, if anything, less easy, due to the fundamental nature of
&gt; ACPI to platform autoconfiguration, and the massively diverse set of
&gt; platforms out there.  There are only a handful of machines that need
&gt; Milo; I fear we would be looking at literally thousands that might need
&gt; ACPI fixes.

The number of machines with buggy ACPI tables is totally irrelevant. 
It's the diversity and number of problems which affects the tables. 
Consider 100,000 Toshiba laptops fail to return objects from the _STA
methods, thus killing ACPICA -- fixing that one problem will probably
fix 100,000 laptops in a single stroke.

BIOS engineers don't purposefully create ACPI tables which kill your
machine.  But sometimes they make common I'm-new-to-ACPI mistakes.  Or
their ASL compiler is buggy.  These sorts of things can be detected and
corrected with hueristics.

I'm not saying that bitching at OEMs shouldn't be the first option.  It
should.  But when a machine is too old, or a vendor too slow or
nonresponsive, fixing ACPI tables yourself should not be a big deal.

I agree that, if possible, the replacement ACPI tables should be
provided to the kernel from the bootloader.

However....   -if- a machine boots and sets up correctly, there is no
reason why you cannot load ACPI tables from userspace.  Maybe you must
avoid CPU or PCI bus type initializations.  So be it...  But that is not
100% of ACPI.  Uploading tables after boot has value for users desiring
poweroff and other S-states... and also it would be handy for developers
who are debugging power management code too.

Regards,

	Jeff


-- 
Jeff Garzik             |
Building 1024           | The chief enemy of creativity is "good" sense
MandrakeSoft            |          -- Picasso

</body></email><email><emailId>20001127171636</emailId><senderName>"Therien, Guy"</senderName><senderEmail>guy.therien@intel.com</senderEmail><timestampReceived>2000-11-27 17:16:36-0400</timestampReceived><subject>RE: [Acpi] Fixing broken ACPI tables?</subject><body>

Jeff,
Once the system is up and running it is difficult to re-initialize in ACPI
mode. Linux32 has a PNPBIOS legacy that it can rely on but ACPI only systems
do not. The _PRT must be parsed to get the PCI IRQ routing (file system).
During ACPI init, _INI methods are run and power resources are manipulated.
MP systems read and apply the Multiple APIC description table etc. All of
this cannot be done on a system that is already initialized without a TON of
coordination. The tables must be available EARLY. We can replace system
tables currently by combining them with the kernel otherwise an OEM BIOS
upgrade will fix problems.
Regards,
Guy

-----Original Message-----
From: Jeff Garzik [mailto:jgarzik@mandrakesoft.com]
Sent: Friday, November 24, 2000 9:11 PM
To: Therien, Guy
Cc: acpi@phobos.fachschaften.tu-muenchen.de
Subject: Re: [Acpi] Fixing broken ACPI tables?


"Therien, Guy" wrote:
&gt; Of course this capability would be convenient for the developers and the
&gt; folks that have the ability to invoke it. Generally, I am very much
against
&gt; fixing things that the OEM has not sanctioned because it is not supported
by
&gt; the OEM. This would necessarily be the requirement if Linux were much more
&gt; mainstream i.e. found commonly as an optional pre-install OS. In the mean
&gt; time, it does make sense for both debugging purposes and for those who
want
&gt; to take responsibility themselves to provide the ability to fix ACPI
&gt; firmware problems. The problem is that we need those changes during the
&gt; first pass through. The DSDT cannot be unloaded and reloaded.
Unfortunately
&gt; file services are not available during early kernel initialization when
ACPI
&gt; would need to read alternative tables.

The preferred way to load firmware into hardware, under Linux, is for
the Linux device driver to provide an ioctl which uploads a sequence of
bytes into firmware.  I would prefer a scenario like

	Kernel boots
	Bad ACPI tables, ACPI initialization fails
	Filesystem and everything initialized
	Userspace program uploads better ACPI tables
	ACPICA is signalled to re-initialize, ACPI init succeeds


&gt; There are two potential solutions to
&gt; this problem. The easiest is to capture the table, convert to ASL, fix it,
&gt; convert back to AML and then compile it with the kernel - making the
kernel
&gt; machine specific. This is what we do to get around problems before we have
&gt; BIOS updates. The second more preferable solution would be to change the
&gt; bootloader to load an AML file(s) along with the kernel and find a way for
&gt; ACPI CA to find out about them. If you would like to look into the last
&gt; one... that would be great as it it currently low on our priority list -
as
&gt; we can do the former.

This semi-coincides with linuxbios' need to be able to provide a memory
map to the kernel, when the E820/E801 (and other) BIOS calls are not
available.

I would still prefer the former (as given the above example) -- such a
solution works just fine from an initial ramdisk ("initrd"), and
requires no modification of the low-level boot/setup code, nor
modification of boot loaders.  And since initrd data is loaded when the
kernel image is loaded, its data is present when ACPICA needs it to be.

Regards,

	Jeff


-- 
Jeff Garzik             |
Building 1024           | The chief enemy of creativity is "good" sense
MandrakeSoft            |          -- Picasso

</body></email><email><emailId>20001127185026</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-11-27 18:50:26-0400</timestampReceived><subject>RE: [Acpi] Fixing broken ACPI tables?</subject><body>

&gt; From: Jeff Garzik [mailto:jgarzik@mandrakesoft.com]
&gt; Mike Smith wrote:
&gt; &gt; 
&gt; &gt; Actually, it's a miniscule subset of a much larger problem. 
&gt;  I can name a
&gt; &gt; lot of machines right now that the current ACPICA code just 
&gt; takes right
&gt; &gt; out.  If you hand over to the interpreter, you're gone.  
&gt; Finis.  This is
&gt; &gt; the problem that you should be trying to address here, if 
&gt; you're going to
&gt; &gt; make the attempt at all.
&gt; 
&gt; Send me a machine :)
&gt; 
&gt; I iterate through development (or in this case feedback and testing)
&gt; until I can say my hardware works 100% for me under Linux.

Well yeah, we still have bugs.

Eventually, ACPI should either 1) work or 2) fail gracefully. If we cannot
fail gracefully (and we can't right now on Toshiba laptops) then we can fail
gracefully by using a bad BIOS list. This is what MS does, BTW, and I don't
see a way around us doing the same thing. There are just too many buggy
BIOSs.

&gt; However....   -if- a machine boots and sets up correctly, there is no
&gt; reason why you cannot load ACPI tables from userspace.  Maybe you must
&gt; avoid CPU or PCI bus type initializations.  So be it...  But 
&gt; that is not
&gt; 100% of ACPI.  Uploading tables after boot has value for 
&gt; users desiring
&gt; poweroff and other S-states... and also it would be handy for 
&gt; developers
&gt; who are debugging power management code too.
&gt; 	Jeff

Yes, it would be handy. We're currently making some assumptions that we
probably couldn't make anymore, though.

&lt;thinking out loud&gt;
MS can load new tables at init from disk. We could do the same thing,
couldn't we, if only the root filesystem were mounted.

So, why is the root mounted when it is, as opposed to earlier? I'm sure
there's a reason, but I don't know it.

OR, modify lilo to take an alternate DSDT, and overwrite the bad one with
the new one before we see it? This would require no other changes, but this
sounds like a nontrivial lilo change.
&lt;/thinking&gt;

-- Andy

</body></email><email><emailId>20001127190525</emailId><senderName>Mike Smith</senderName><senderEmail>msmith@freebsd.org</senderEmail><timestampReceived>2000-11-27 19:05:25-0400</timestampReceived><subject>Re: [Acpi] Fixing broken ACPI tables?</subject><body>

&gt; gracefully by using a bad BIOS list. This is what MS does, BTW, and I don't
&gt; see a way around us doing the same thing. There are just too many buggy
&gt; BIOSs.

Agreed.

&gt; &lt;thinking out loud&gt;
&gt; MS can load new tables at init from disk. We could do the same thing,
&gt; couldn't we, if only the root filesystem were mounted.

You can't do it once the (Linux) kernel is up and running, due to the 
chicken-and-egg problem I've already mentioned.

&gt; OR, modify lilo to take an alternate DSDT, and overwrite the bad one with
&gt; the new one before we see it? This would require no other changes, but this
&gt; sounds like a nontrivial lilo change.

This is more or less the approach we'll be taking with FreeBSD.  Our 
bootloader is a lot more sophisticated though, so it's trivial to deal 
with (and not really relevant to this list).  But loading before you 
start the kernel is really the only way that makes any sense if you're 
going to use ACPI properly.

-- 
... every activity meets with opposition, everyone who acts has his
rivals and unfortunately opponents also.  But not because people want
to be opponents, rather because the tasks and relationships force
people to take different points of view.  [Dr. Fritz Todt]
           V I C T O R Y   N O T   V E N G E A N C E

</body></email><email><emailId>20001127193450</emailId><senderName>Mike Smith</senderName><senderEmail>msmith@freebsd.org</senderEmail><timestampReceived>2000-11-27 19:34:50-0400</timestampReceived><subject>Re: [Acpi] Fixing broken ACPI tables?</subject><body>

&gt; &gt; Actually, it's a miniscule subset of a much larger problem.  I can name a
&gt; &gt; lot of machines right now that the current ACPICA code just takes right
&gt; &gt; out.  If you hand over to the interpreter, you're gone.  Finis.  This is
&gt; &gt; the problem that you should be trying to address here, if you're going to
&gt; &gt; make the attempt at all.
&gt; 
&gt; Send me a machine :)

Dell Inspiron (5000, 7500 series at least).  Sony F-series Vaio, just to 
name two that are giving me a headache.  The Inspiron is currently 
failing due to bugs in the ACPI CA interpreter (we think).  There's 
another failure mode that's hard to debug because the AML turns off the 
Super-IO chip (and thus you lose serial I/O) before ending up in a tight 
loop.  You can't even get a keyboard interrupt in (because the keyboard 
controller is gone too...).

&gt; Hell, just imagine trying to get mobo makers to mass produce something
&gt; that cannot run DOS and Win3.1 ;-)

Look for labels that say "legacy-free".  Some still work, some don't.

&gt; &gt; However, the
&gt; &gt; solution is, if anything, less easy, due to the fundamental nature of
&gt; &gt; ACPI to platform autoconfiguration, and the massively diverse set of
&gt; &gt; platforms out there.  There are only a handful of machines that need
&gt; &gt; Milo; I fear we would be looking at literally thousands that might need
&gt; &gt; ACPI fixes.
&gt; 
&gt; The number of machines with buggy ACPI tables is totally irrelevant. 
&gt; It's the diversity and number of problems which affects the tables. 

Yes, I realise this, sorry if I wasn't clear about it.  I meant 
"literally thousands of different models of system".

&gt; Consider 100,000 Toshiba laptops fail to return objects from the _STA
&gt; methods, thus killing ACPICA -- fixing that one problem will probably
&gt; fix 100,000 laptops in a single stroke.

Sure.  But that's one Toshiba laptop. They probably have a good ten 
different models using the same buggy ASL, multiplied by (say) five or so 
BIOS releases per model over the lifetime of the model, and that's fifty 
different sets of AML you need already.

&gt; BIOS engineers don't purposefully create ACPI tables which kill your
&gt; machine.  But sometimes they make common I'm-new-to-ACPI mistakes.  Or
&gt; their ASL compiler is buggy.  These sorts of things can be detected and
&gt; corrected with hueristics.

Typically, so far, the problems are mostly related to "it works with 
Windows"-syndrome, which is why I tend to argue for bug-compatibility 
rather than a painful mechanical workaround process.

&gt; However....   -if- a machine boots and sets up correctly, there is no
&gt; reason why you cannot load ACPI tables from userspace.  Maybe you must
&gt; avoid CPU or PCI bus type initializations.  So be it...  But that is not
&gt; 100% of ACPI.  Uploading tables after boot has value for users desiring
&gt; poweroff and other S-states... and also it would be handy for developers
&gt; who are debugging power management code too.

Agreed.  It's just not a "correct" solution, hence it bugging me. 8)

-- 
... every activity meets with opposition, everyone who acts has his
rivals and unfortunately opponents also.  But not because people want
to be opponents, rather because the tasks and relationships force
people to take different points of view.  [Dr. Fritz Todt]
           V I C T O R Y   N O T   V E N G E A N C E

</body></email><email><emailId>20001127212221</emailId><senderName>"Therien, Guy"</senderName><senderEmail>guy.therien@intel.com</senderEmail><timestampReceived>2000-11-27 21:22:21-0400</timestampReceived><subject>RE: [Acpi] Fixing broken ACPI tables?</subject><body>

-Typically, so far, the problems are mostly related to "it works with 
-Windows"-syndrome, which is why I tend to argue for bug-compatibility 
-rather than a painful mechanical workaround process.

We will not implement bug for bug compatibility with Microsoft's ACPI
implementation. One of the reasons for a second ACPI implementation is to
verify implementation to be in accordance with the ACPI specification. It
undermines the spec to allow a dominant OSV to establish a defacto standard.
In some cases, it may be necessary to mimic OS behavior that is not clearly
specified or if ambiguous in the ACPI spec. Of course, the difficulty of
being bug for bug compatible also plays a role here. If it was easy then it
may seem reasonable to have a switch that would enable certain non spec
system behaviors. The _STA issue (no return), is not something we can easily
accommodate.

Regards,
Guy

</body></email><email><emailId>20001128000005</emailId><senderName>Santiago Garcia Mantinan</senderName><senderEmail>manty@i.am</senderEmail><timestampReceived>2000-11-28 00:00:05-0400</timestampReceived><subject>Re: [Acpi] Fixing broken ACPI tables?</subject><body>

&gt; OR, modify lilo to take an alternate DSDT, and overwrite the bad one with
&gt; the new one before we see it? This would require no other changes, but this
&gt; sounds like a nontrivial lilo change.
&gt; &lt;/thinking&gt;

Well, this could even be done before lilo in a mbr (remembering of a mbr i
did to correct the year of a BIOS working only from 1995 to 1999).

But this kind of stuff is needed only on the new ACPI only hard, old
hardware could use Jeffs method, couldn't it? I mean, I still think that for
a lot of systems Jeff solution makes more sense and is implementable.

Regards...
-- 
Manty/BestiaTester -&gt; http://manty.net

</body></email><email><emailId>20001124172622</emailId><senderName>Jurgen Botz</senderName><senderEmail>jurgen@botz.org</senderEmail><timestampReceived>2000-11-24 17:26:22-0400</timestampReceived><subject>Re: [Acpi] Patches</subject><body>

This is a multipart MIME message.


"Mahmoud Mohamed" wrote:
&gt; patching file linux/arch/i386/kernel/acpi.c
&gt; Hunk #3 FAILED at 26.
&gt; 1 out of 3 hunks FAILED -- saving rejects to file 
&gt; linux/arch/i386/kernel/acpi.c.rej

I couldn't figure out exactly why this patch failed, but I was
able to hand-apply it, so here is the resulting
'linux/arch/i386/kernel/acpi.c'.  Yes, it's really supposed to
be that small... the patch takes out most of the code that was
there before.  You can just drop this into the right place and
things should compile.

- Jurgen



["acpi.c" (text/plain)]

/*
 *  acpi.c - Linux ACPI arch-specific functions
 *
 *  Copyright (C) 1999-2000 Andrew Henroid
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program; if not, write to the Free Software
 *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */

/*
 * Changes:
 * Arnaldo Carvalho de Melo &lt;acme@conectiva.com.br&gt; - 2000/08/31
 * - check copy*user return
 * - get rid of check_region
 * - get rid of verify_area
 * Arnaldo Carvalho de Melo &lt;acme@conectiva.com.br&gt; - 2000/09/28
 * - do proper release on failure in acpi_claim_ioports and acpi_init
 * Andrew Grover &lt;andrew.grover@intel.com&gt; - 2000/11/13
 * - Took out support for user-level interpreter. ACPI 2.0 changes preclude
 *   its maintenance.
 */

#include &lt;linux/config.h&gt;
#include &lt;linux/module.h&gt;
#include &lt;linux/init.h&gt;
#include &lt;linux/pm.h&gt;

#define _LINUX
#include &lt;linux/acpi.h&gt;
/* Is there a better way to include this? */
#include &lt;../drivers/acpi/include/acpi.h&gt;
  
ACPI_PHYSICAL_ADDRESS
acpi_get_rsdp_ptr()
{
      ACPI_PHYSICAL_ADDRESS rsdp_phys;

      if(ACPI_SUCCESS(acpi_find_root_pointer(&amp;rsdp_phys)))
              return rsdp_phys;
      else
              return 0;
}


</body></email><email><emailId>20001120225650</emailId><senderName>Robert Vollmert</senderName><senderEmail>rvollmert@gmx.net</senderEmail><timestampReceived>2000-11-20 22:56:50-0400</timestampReceived><subject>Re: [Acpi] Initialization fails because of PCI</subject><body>


Grover, Andrew wrote:
&gt; Can you send me your DSDT? 'cat /proc/sys/acpi/dsdt &gt;~/dsdt.dat'

Attached.

&gt; Number 2 - Bad operand error
&gt; 
&gt; So on shutdown it's the call to eval _PTS that's causing this?

Possibly. How would I check?

&gt; And, does the machine actually turn off?

No.

Regards,
Robert

-- 
Robert Vollmert                                      rvollmert@gmx.net

["dsdt.dat" (application/octet-stream)]

</body></email><email><emailId>20001121021217</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-11-21 02:12:17-0400</timestampReceived><subject>RE: [Acpi] Initialization fails because of PCI</subject><body>

Robert,

Please try this patch for issue #2?

Thanks -- Andy

&gt; -----Original Message-----
&gt; From: Robert Vollmert [mailto:rvollmert@gmx.net]
&gt; Sent: Monday, November 20, 2000 2:57 PM
&gt; To: Grover, Andrew
&gt; Cc: acpi@phobos.fachschaften.tu-muenchen.de
&gt; Subject: Re: [Acpi] Initialization fails because of PCI
&gt; 
&gt; 
&gt; Grover, Andrew wrote:
&gt; &gt; Can you send me your DSDT? 'cat /proc/sys/acpi/dsdt &gt;~/dsdt.dat'
&gt; 
&gt; Attached.
&gt; 
&gt; &gt; Number 2 - Bad operand error
&gt; &gt; 
&gt; &gt; So on shutdown it's the call to eval _PTS that's causing this?
&gt; 
&gt; Possibly. How would I check?
&gt; 
&gt; &gt; And, does the machine actually turn off?
&gt; 
&gt; No.
&gt; 
&gt; Regards,
&gt; Robert
&gt; 
&gt; -- 
&gt; Robert Vollmert                                      rvollmert@gmx.net
&gt; 


["parse.diff" (application/octet-stream)]

--- linux-with-acpica/drivers/acpi/parser/psparse.c	Mon Nov 20 17:34:55 2000
+++ linux/drivers/acpi/parser/psparse.c	Mon Nov 20 18:02:08 2000
@@ -1,7 +1,7 @@
 /******************************************************************************
  *
  * Module Name: psparse - Parser top level AML parse routines
- *              $Revision: 65 $
+ *              $Revision: 67 $
  *
  *****************************************************************************/
 
@@ -496,6 +496,7 @@
 	u16                     opcode;
 	ACPI_PARSE_OBJECT       pre_op;
 	ACPI_PARSE_STATE        *parser_state;
+	u8                      *aml_op_start;
 
 
 	FUNCTION_TRACE_PTR ("Ps_parse_loop", walk_state);
@@ -555,8 +556,9 @@
 		if (!op) {
 			/* Get the next opcode from the AML stream */
 
+			aml_op_start = parser_state-&gt;aml;
 			aml_offset = parser_state-&gt;aml - parser_state-&gt;aml_start;
-			opcode    = acpi_ps_peek_opcode (parser_state);
+			opcode     = acpi_ps_peek_opcode (parser_state);
 
 			/*
 			 * First cut to determine what we have found:
@@ -592,7 +594,7 @@
 				/* The opcode is unrecognized.  Just skip unknown opcodes */
 
 				DEBUG_PRINT (ACPI_ERROR,
-					("Parse_loop: Found unknown opcode 0x%lX at AML offset 0x%X, ignoring\n",
+					("Parse_loop: Found unknown opcode %lX at AML offset %X, ignoring\n",
 					opcode, aml_offset));
 
 				DUMP_BUFFER (parser_state-&gt;aml, 128);
@@ -655,13 +657,10 @@
 						 * because we don't have enough info in the first pass
 						 * to parse them correctly.
 						 *
-						 * Backup to beginning of Op_region declaration (2 for
-						 * Opcode, 4 for name)
-						 *
 						 * Body_length is unknown until we parse the body
 						 */
 
-						deferred_op-&gt;data   = parser_state-&gt;aml - 6;
+						deferred_op-&gt;data   = aml_op_start;
 						deferred_op-&gt;length = 0;
 					}
 				}
@@ -684,14 +683,12 @@
 					(op-&gt;opcode == AML_DWORD_FIELD_OP))
 				 {
 					/*
-					 * Backup to beginning of Create_xXXfield declaration (1 for
-					 * Opcode)
-					 *
+					 * Backup to beginning of Create_xXXfield declaration
 					 * Body_length is unknown until we parse the body
 					 */
 					deferred_op = (ACPI_PARSE2_OBJECT *) op;
 
-					deferred_op-&gt;data   = parser_state-&gt;aml -1;
+					deferred_op-&gt;data   = aml_op_start;
 					deferred_op-&gt;length = 0;
 				}
 


</body></email><email><emailId>20001121085306</emailId><senderName>Robert Vollmert</senderName><senderEmail>rvollmert@gmx.net</senderEmail><timestampReceived>2000-11-21 08:53:06-0400</timestampReceived><subject>Re: [Acpi] Initialization fails because of PCI</subject><body>

&gt; Please try this patch for issue #2?

It fixes the error message, although the system still doesn't shut
off. So probably, these are not actually related?

Regards, Robert

-- 
Robert Vollmert                                      rvollmert@gmx.net

</body></email><email><emailId>20001122002955</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-11-22 00:29:55-0400</timestampReceived><subject>RE: [Acpi] Initialization fails because of PCI</subject><body>

&gt; From: Robert Vollmert [mailto:rvollmert@gmx.net]
&gt; It fixes the error message, although the system still doesn't shut
&gt; off. So probably, these are not actually related?

Yeah, I agree.

So, outstanding issues are:

1) AE_EXIST error on PCI init (you're not the only one seeing this)

I just figured out what the problem here is. Probably be tomorrow before I
have a fix, though.

2) acpi_power_down() doesn't.

We need to know if the right values are being written to the sleep type
registers, etc.

In sys.c, could you add this line right before the three calls to
hw_register_bit_access():

	printk("slp type a = %x slp type b = %x\n", 
		ACPI_SLP_TYPA(acpi_slptyp[ctx-&gt;state]),
		ACPI_SLP_TYPB(acpi_slptyp[ctx-&gt;state]));

According to your DSDT, both of these should be 7.

The other thing to try would be putting a DEBUG_PRINT in hardware/hwregs.c
in acpi_hw_low_level_write() to verify where/what we're writing. This works
for me so I'm going to need your help on this one. ;-)

Regards -- Andy

</body></email><email><emailId>20001122012142</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-11-22 01:21:42-0400</timestampReceived><subject>RE: [Acpi] Initialization fails because of PCI</subject><body>

This should fix problem #1. Against 11_15 DEBUG version.

Removes now-redundant PCI root bridge initialization.

Regards -- Andy


&gt; -----Original Message-----
&gt; From: Grover, Andrew [mailto:andrew.grover@intel.com]
&gt; Sent: Tuesday, November 21, 2000 4:30 PM
&gt; To: 'Robert Vollmert'
&gt; Cc: acpi@phobos.fachschaften.tu-muenchen.de
&gt; Subject: RE: [Acpi] Initialization fails because of PCI
&gt; 
&gt; 
&gt; &gt; From: Robert Vollmert [mailto:rvollmert@gmx.net]
&gt; &gt; It fixes the error message, although the system still doesn't shut
&gt; &gt; off. So probably, these are not actually related?
&gt; 
&gt; Yeah, I agree.
&gt; 
&gt; So, outstanding issues are:
&gt; 
&gt; 1) AE_EXIST error on PCI init (you're not the only one seeing this)
&gt; 
&gt; I just figured out what the problem here is. Probably be 
&gt; tomorrow before I
&gt; have a fix, though.
&gt; 
&gt; 2) acpi_power_down() doesn't.
&gt; 
&gt; We need to know if the right values are being written to the 
&gt; sleep type
&gt; registers, etc.
&gt; 
&gt; In sys.c, could you add this line right before the three calls to
&gt; hw_register_bit_access():
&gt; 
&gt; 	printk("slp type a = %x slp type b = %x\n", 
&gt; 		ACPI_SLP_TYPA(acpi_slptyp[ctx-&gt;state]),
&gt; 		ACPI_SLP_TYPB(acpi_slptyp[ctx-&gt;state]));
&gt; 
&gt; According to your DSDT, both of these should be 7.
&gt; 
&gt; The other thing to try would be putting a DEBUG_PRINT in 
&gt; hardware/hwregs.c
&gt; in acpi_hw_low_level_write() to verify where/what we're 
&gt; writing. This works
&gt; for me so I'm going to need your help on this one. ;-)
&gt; 
&gt; Regards -- Andy
&gt; 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; 


["nsinit.diff" (application/octet-stream)]

--- linux-orig/drivers/acpi/namespace/nsinit.c	Wed Nov 15 16:25:28 2000
+++ linux/drivers/acpi/namespace/nsinit.c	Tue Nov 21 17:12:27 2000
@@ -1,7 +1,7 @@
 /******************************************************************************
  *
  * Module Name: nsinit - namespace initialization
- *              $Revision: 5 $
+ *              $Revision: 6 $
  *
  *****************************************************************************/
 
@@ -203,6 +203,12 @@
 
 		info-&gt;op_region_init++;
 		status = acpi_ds_get_region_arguments (obj_desc);
+		if (ACPI_FAILURE (status)) {
+			DEBUG_PRINT_RAW (ACPI_ERROR, ("\n"));
+			DEBUG_PRINT (ACPI_ERROR, ("%s while getting region arguments [%4.4s]\n",
+					  acpi_cm_format_exception (status), &amp;node-&gt;name));
+		}
+
 		DEBUG_PRINT_RAW (ACPI_OK, ("."));
 		break;
 
@@ -216,6 +222,11 @@
 
 		info-&gt;field_init++;
 		status = acpi_ds_get_field_unit_arguments (obj_desc);
+		if (ACPI_FAILURE (status)) {
+			DEBUG_PRINT_RAW (ACPI_ERROR, ("\n"));
+			DEBUG_PRINT (ACPI_ERROR, ("%s while getting field arguments [%4.4s]\n",
+					  acpi_cm_format_exception (status), &amp;node-&gt;name));
+		}
 		DEBUG_PRINT_RAW (ACPI_OK, ("."));
 
 		break;
@@ -254,7 +265,6 @@
 	void                    **return_value)
 {
 	ACPI_STATUS             status;
-	ACPI_OPERAND_OBJECT    *ret_obj = NULL;
 	ACPI_NAMESPACE_NODE    *node;
 	u32                     flags;
 	ACPI_DEVICE_WALK_INFO  *info = (ACPI_DEVICE_WALK_INFO *) context;
@@ -298,7 +308,8 @@
 
 	status = acpi_ns_evaluate_relative (obj_handle, "_INI", NULL, NULL);
 	if (AE_NOT_FOUND == status) {
-		 /* No _INI means device requires no initialization */
+		/* No _INI means device requires no initialization */
+		status = AE_OK;
 	}
 
 	else if (ACPI_FAILURE (status)) {
@@ -317,87 +328,5 @@
 		info-&gt;num_INI++;
 	}
 
-
-	/*
-	 * Examine the HID of the device.  _HID can be an executable
-	 * control method -- it simply has to return a string or number
-	 * containing the HID.
-	 */
-
-	if (ret_obj) {
-		acpi_cm_remove_reference (ret_obj);
-	}
-
-	ret_obj = NULL;
-	status = acpi_ns_evaluate_relative (obj_handle, "_HID", NULL, &amp;ret_obj);
-	if (AE_NOT_FOUND == status) {
-		/* No _HID --&gt; Can't be a PCI root bridge */
-		return_ACPI_STATUS (AE_OK);
-	}
-
-	if (ACPI_FAILURE (status)) {
-		return_ACPI_STATUS (status);
-	}
-
-	info-&gt;num_HID++;
-
-
-	/*
-	 * Found an _HID object.
-	 * Check for a PCI Root Bridge.  We need to install the PCI_CONFIG space
-	 * handler on all PCI Root Bridges found within the namespace
-	 *
-	 * A PCI Root Bridge has an HID with the value EISAID("PNP0A03")
-	 * The HID can be either a number or a string.
-	 */
-
-	switch (ret_obj-&gt;common.type)
-	{
-	case ACPI_TYPE_NUMBER:
-
-		if (ret_obj-&gt;number.value != PCI_ROOT_HID_VALUE) {
-			goto cleanup;
-		}
-
-		break;
-
-	case ACPI_TYPE_STRING:
-
-		if (STRNCMP (ret_obj-&gt;string.pointer, PCI_ROOT_HID_STRING,
-				  sizeof (PCI_ROOT_HID_STRING)))
-		{
-			goto cleanup;
-		}
-
-		break;
-
-	default:
-
-		goto cleanup;
-	}
-
-
-	/*
-	 * We found a valid PCI_ROOT_HID.
-	 * The parent of the HID entry is the PCI device;  Install the default PCI
-	 * handler for this PCI device.
-	 */
-
-	info-&gt;num_PCI++;
-
-	if (!(info-&gt;flags &amp; ACPI_NO_PCI_INIT)) {
-		status = acpi_install_address_space_handler (obj_handle,
-				   ADDRESS_SPACE_PCI_CONFIG,
-				   ACPI_DEFAULT_HANDLER, NULL, NULL);
-	}
-
-cleanup:
-
-	if (ret_obj) {
-		acpi_cm_remove_reference (ret_obj);
-	}
-
 	return_ACPI_STATUS (status);
 }
-
-


</body></email><email><emailId>20001122013802</emailId><senderName>Robert Vollmert</senderName><senderEmail>rvollmert@gmx.net</senderEmail><timestampReceived>2000-11-22 01:38:02-0400</timestampReceived><subject>Re: [Acpi] Initialization fails because of PCI</subject><body>

On Tue, Nov 21, 2000 at 04:29:55PM -0800, Grover, Andrew wrote:
&gt; 2) acpi_power_down() doesn't.
&gt; 
&gt; We need to know if the right values are being written to the sleep type
&gt; registers, etc.
&gt; 
&gt; In sys.c, could you add this line right before the three calls to
&gt; hw_register_bit_access():
&gt; 
&gt;       printk("slp type a = %x slp type b = %x\n", 
&gt;               ACPI_SLP_TYPA(acpi_slptyp[ctx-&gt;state]),
&gt;               ACPI_SLP_TYPB(acpi_slptyp[ctx-&gt;state]));
&gt; 
&gt; According to your DSDT, both of these should be 7.

They are.

&gt; The other thing to try would be putting a DEBUG_PRINT in hardware/hwregs.c
&gt; in acpi_hw_low_level_write() to verify where/what we're writing. This works
&gt; for me so I'm going to need your help on this one. ;-)

Ok. When shutting off, there are several calls to
acpi_hw_low_level_write(). A few arguments are always the same:
  width                      = 16
  offset                     = 0
  reg-&gt;address_space_id      = 1
  reg-&gt;register_bit_offset   = 0
  reg-&gt;reservered            = 0

The others are as follows:

value  reg-&gt;register_bit_width  reg-&gt;address

32768  32                       58368
32768  32                       0
(here, the slp type debug statement is executed) 
 7169  16                       58372
 7169  16                       0
 7169  16                       58372
 7169  16                       0
15361  16                       58372
15361  16                       0

Thanks, Robert

-- 
Robert Vollmert                                      rvollmert@gmx.net

</body></email><email><emailId>20001129234505</emailId><senderName>Erich Schubert</senderName><senderEmail>erich.schubert@mucl.de</senderEmail><timestampReceived>2000-11-29 23:45:05-0400</timestampReceived><subject>[Acpi] ACPI on Compaq Presario 1400: experiences</subject><body>

Just for your Information, this is no bug report ,)

I got a compaq presario 1400 some days ago.
- this laptop does not have APM.
- the laptop has a VIA Chipset
- Running Kernel 2.4.0-test11

Current ACPI works ok:
- ACPI is detected and enabled on startup:
&gt; System firmware supports: C2
&gt; System firmware supports: S0 S1 S4 S5
&gt; ACPI: Found a battery

entering sleep mode works sometimes.
I noticed the following behaviour:
- Sleep mode worked after bootup (battery full, on-line).
- After pulling the power plug sleep mode no longer worked (wakes up
immedeately)
- When i turn on power supply it does not work again
- even when the battery is fully charged again sleep does not work any
more.

What i miss most is suspend-to-disk.
When i had let my bios handle this alone, i could just press the power
button and the bios handles suspend-to-disk itself.
The only drawbacks: after wakeup the system-clock is not correct.

So i was wondering: is there a way to let the bios handle this itself
again?
Or should i just wait for a forthcoming release?

Thanks for all your great work into ACPI on Linux, sorry i cannot help
much except helping testing ACPI and perhaps writing some user-tools (like
a battery monitor).

--
Gruss, Erich

</body></email><email><emailId>20001130152327</emailId><senderName>Christopher J Mason</senderName><senderEmail>cmason@cmu.edu</senderEmail><timestampReceived>2000-11-30 15:23:27-0400</timestampReceived><subject>[Acpi] Vaio Z505LS</subject><body>


Howdy.

This is just a report of the results of playing around with the current
ACPI tools on my laptop.  I appologize if this isn't helpful or useful.
I'm not really reporting a "bug" persay, it just seems like some of this
behavior is weird.  Maybe this helps with the development.

I'm playing with ACPI because APM currently crashes my laptop on resume.
(I've played with various kernel options; strangely APM resume works on
2.2.14; even more strangely, it works occasionally under later kernels, but
the system ends up dying a slow death, things begin to segfault, etc...  I
suspect this is a device driver not playing well with PM, but I haven't had
time to test that theory.)  I'd really like to get my laptop to suspend and
resume.  I'm pretty much guessing that ACPI on linux is a bit immature to
have this actually happen.

I have a Sony Vaio Z505LS.  It's a pretty new model.  It's based around an
Intel 440BX/PIIX4.

I've turned on the ACPI options in the kernel (2.4.0-test11), including the
interpreter.  I've enabled ACPI support in the BIOS.  (Which I believe is
by Phoenix.)

Booting with ACPI in the kernel works when the machine is cold booted (ie
waiting a while after shuting down, at least 5 min).  It hangs after "ACPI:
support found" when warm booting.

Various things seem much slower when ACPI is enabled.  I don't know how
else to describe this.  The whole system seems sluggish.  I suspect some
kind of interrupt problems (everything in this laptop is on IRQ 9, the cat,
the kitchen sink, and your mother are all on IRQ nine, see below for
details).  Video in particular is very slow.

echo "1" &gt; /proc/sys/acpi/sleep

hangs the system hard.

pmtest reports:
root@smoke:/usr/local/src/pmtools# pmtest/pmtest
  VGA (D0)
  PCMCIA (D0)
  PCI 0x3a (D0)
  keyboard (D0)
  PCI 0x0 (D0)

cat /proc/sys/acpi/event
while pressing various buttons (including the power button) produces no
output what so ever.  There's a whole bunch of function key buttons on this
laptop; none of them do anything while under linux, nor under windows 2k.
They did do stuff under the version of windows ME that came with the
laptop, which I, of course, quickly erased in favor of linux.  (They were
completely functional on the previous model of this laptop (the Z505SX)
which doesn't support ACPI.  One of these keys controls the switch between
external and internal display, which I'd really like to have work).

I suspect that these function keys are now under ACPI control, but simply
haven't been enabled.  (I haven't tried the non-ALM-interpreter version to
see if I can enable them. If this would be useful, I'll try it.)

I've included the information requested in the ACPI readme below.

Thanks for your work so far, and good luck.

-c

(If you respond to this message, please CC me.  I'm not on the ACPI list.)

&gt;  1) Any system information you have available (motherboard, chipset,
&gt;  BIOS,  system vendor)

root@smoke:/proc# cat interrupts
           CPU0
  0:     386933          XT-PIC  timer
  1:      12010          XT-PIC  keyboard
  2:          0          XT-PIC  cascade
  3:     135041          XT-PIC  wvlan_cs
  8:          1          XT-PIC  rtc
  9:         34          XT-PIC  acpi, YMF744, usb-uhci, i82365
 12:      57584          XT-PIC  PS/2 Mouse
 14:      18669          XT-PIC  ide0
NMI:          0
ERR:          0

root@smoke:/proc# cat pci
PCI devices found:
  Bus  0, device   0, function  0:
    Host bridge: Intel Corporation 440BX/ZX - 82443BX/ZX Host bridge (rev
3).
      Master Capable.  Latency=64.
      Prefetchable 32 bit memory at 0x40000000 [0x40ffffff].
  Bus  0, device   1, function  0:
    PCI bridge: Intel Corporation 440BX/ZX - 82443BX/ZX AGP bridge (rev 3).
      Master Capable.  Latency=128.  Min Gnt=140.
  Bus  0, device   7, function  0:
    ISA bridge: Intel Corporation 82371AB PIIX4 ISA (rev 2).
  Bus  0, device   7, function  1:
    IDE interface: Intel Corporation 82371AB PIIX4 IDE (rev 1).
      Master Capable.  Latency=64.
      I/O at 0xfc90 [0xfc9f].
  Bus  0, device   7, function  2:
    USB Controller: Intel Corporation 82371AB PIIX4 USB (rev 1).
      IRQ 9.
      Master Capable.  Latency=64.
      I/O at 0xfca0 [0xfcbf].
  Bus  0, device   7, function  3:
    Bridge: Intel Corporation 82371AB PIIX4 ACPI (rev 3).
  Bus  0, device   8, function  0:
    FireWire (IEEE 1394): Sony Corporation CXD3222 i.LINK Controller (rev
2).
      IRQ 9.
      Master Capable.  Latency=64.  Min Gnt=4.Max Lat=4.
      Non-prefetchable 32 bit memory at 0xfedf7000 [0xfedf77ff].
      Non-prefetchable 32 bit memory at 0xfedf7c00 [0xfedf7dff].
  Bus  0, device   9, function  0:
    Multimedia audio controller: Yamaha Corporation YMF-744B [DS-1S Audio
Controller] (rev 2).
      IRQ 9.
      Master Capable.  Latency=64.  Min Gnt=5.Max Lat=25.
      Non-prefetchable 32 bit memory at 0xfedf8000 [0xfedfffff].
      I/O at 0xfcc0 [0xfcff].
      I/O at 0xfc8c [0xfc8f].
  Bus  0, device  10, function  0:
    Communication controller: PCI device 14f1:2443 (CONEXANT) (rev 1).
      IRQ 9.
      Master Capable.  Latency=64.
      Non-prefetchable 32 bit memory at 0xfede0000 [0xfedeffff].
      I/O at 0xfc38 [0xfc3f].
  Bus  0, device  11, function  0:
    Ethernet controller: Intel Corporation 82557 [Ethernet Pro 100] (rev 8).
      IRQ 9.
      Master Capable.  Latency=66.  Min Gnt=8.Max Lat=56.
      Non-prefetchable 32 bit memory at 0xfedf6000 [0xfedf6fff].
      I/O at 0xfc40 [0xfc7f].
      Non-prefetchable 32 bit memory at 0xfec00000 [0xfecfffff].
  Bus  0, device  12, function  0:
    CardBus bridge: Ricoh Co Ltd RL5c475 (rev 128).
      IRQ 9.
      Master Capable.  Latency=168.  Min Gnt=128.Max Lat=7.
      Non-prefetchable 32 bit memory at 0x10000000 [0x10000fff].
  Bus  1, device   0, function  0:
    VGA compatible controller: ATI Technologies Inc 3D Rage P/M Mobility
AGP 2x (rev 100).
      IRQ 9.
      Master Capable.  Latency=66.  Min Gnt=8.
      Non-prefetchable 32 bit memory at 0xfd000000 [0xfdffffff].
      I/O at 0xe800 [0xe8ff].
      Non-prefetchable 32 bit memory at 0xfebff000 [0xfebfffff].



&gt;     2) Any relevant information from the kernel log: do
&gt;        dmesg | grep -iE 'version|acpi|apm|e820' &gt; kernel.log
&gt;        to get the relevant lines

4&gt;Linux version 2.4.0-test11 (root@smoke.rem.cmu.edu) (gcc version
egcs-2.91.66
19990314/Linux (egcs-1.1.2 release)) #17 Wed Nov 29 11:42:29 EST 2000
 BIOS-e820: 000000000009f800 @ 0000000000000000 (usable)
 BIOS-e820: 0000000000000800 @ 000000000009f800 (reserved)
 BIOS-e820: 0000000000017c00 @ 00000000000e8400 (reserved)
 BIOS-e820: 0000000007ef0000 @ 0000000000100000 (usable)
 BIOS-e820: 000000000000f800 @ 0000000007ff0000 (ACPI data)
 BIOS-e820: 0000000000000800 @ 0000000007fff800 (ACPI NVS)
 BIOS-e820: 0000000000080000 @ 00000000fff80000 (reserved)
ACPI: support found
ACPI: PBLK 0 @ 0x8010:0
ACPI: S1 supported
ACPI: S5 supported

&gt;     3) Actual description of the problem you are experiencing and if
&gt;     possible  how to reproduce it

(see above)

&gt;     4) Output of acpidmp: get this by
&gt;        acpidmp &gt; acpidmp.log
&gt;        Acpidmp is part of the pmtools package described in section 2.3.

http://ash.rem.cmu.edu/acpidump.gz

[I'd suggest that the HOWTO maintainer add a bit about wanting people to 
make dump output available for download rather than sending to list.  I 
didn't realize that this output was potentially copyrighted.]


[Christopher Mason        &lt;cmason@cmu.edu&gt;      http://ash.rem.cmu.edu/ ]
["Don't you see?! We're actors--we're the opposite of people!" -Stoppard]

</body></email><email><emailId>20001004162335</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-10-04 16:23:35-0400</timestampReceived><subject>RE: [Acpi] Omnibook 2100</subject><body>

That's because we haven't implemented it yet. ;-) Under APM the OS just has
to read battery information from the BIOS. With OS power management (OSPM)
the OS requires more functionality. It's coming soon.

Regards -- Andy

&gt; -----Original Message-----
&gt; From: brendan burns [mailto:bburns@wso.williams.edu]
&gt; Sent: Wednesday, October 04, 2000 8:02 AM
&gt; To: acpi@phobos.fachschaften.tu-muenchen.de
&gt; Subject: [Acpi] Omnibook 2100
&gt; 
&gt; 
&gt; Folks,
&gt; I've got an HP Omnibook 2100 with 2.4.0-test9-pre7 running on 
&gt; it.  ACPI
&gt; works fine for sleeping/restarting the computer but it doesn't see my
&gt; battery at all.  I have a great deal of programing experience but I've
&gt; never really dealt with ACIPI before can someone give me some 
&gt; pointers to
&gt; where I might start debugging this problem?  (the battery is 
&gt; recognized by
&gt; apmd.)
&gt; 
&gt; Thanks
&gt; Brendan
&gt; 
&gt; 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; 

</body></email><email><emailId>20001004220607</emailId><senderName>"James Mastros"</senderName><senderEmail>james@rtweb.net</senderEmail><timestampReceived>2000-10-04 22:06:07-0400</timestampReceived><subject>Re: [Acpi] List of good/bad BIOSes</subject><body>

From: "Simon Richter" &lt;Simon.Richter@phobos.fachschaften.tu-muenchen.de&gt;
Sent: Wednesday, August 9, 2000 3:44 PM
Subject: [Acpi] List of good/bad BIOSes
&gt; as some people have noticed, the list of BIOSes on
&gt; http://phobos.fs.tum.de/acpi/bios.sql is a bit outdated. I'd like to
&gt; change that, but before we start to gather information, I'd like to have
&gt; an your opinion what we should collect.
It'd probably be useful to be able to submit acpidmp's output whole.
That way, the a script could get out of it whatever it wants, and we'd
grow a base of code to test our parsing off of.

Just put fields for dmesg stuff (optional), mobo vendor/name/rev,
BIOS ver, what works/doesn't work, other comments, and a 
&lt;input type="file"&gt; box to upload acpidmp's output.

Then the script can acpitbl it, and get the rest of these data.
Morover, if somthing else becomes relevant, we can get more
data out of the acpidmp that we didn't think of before.

(For example, can we link known bugs to compiler versions,
and cope.)

    -=- James Mastros

</body></email><email><emailId>20001008040114</emailId><senderName>Mike Smith</senderName><senderEmail>msmith@freebsd.org</senderEmail><timestampReceived>2000-10-08 04:01:14-0400</timestampReceived><subject>[Acpi] ACPICA AML interpreter, possible bug, code examples</subject><body>

This issue came up a while back when mkr@redhat was trying to get the
ACPICA code up and running against a Dell Inspiron 7500.  I didn't find
any solutions mentioned in the list archive, and I've hit the same problem
with the same machine.  In my case, I'm running the A11 firmware and the
ACPICA-20000927 code is running under FreeBSD, but the symptoms are the
same (don't you love code reuse? 8).

While we're scanning the namespace in the process of attaching drivers to 
devices that have been enumerated, we come across the first battery.
In order to obtain the HID, we call AcpiGetObjectInfo.  This evaluates 
(in order) _INI, _HID, _STA and _ADR.  During the evaluation of _STA, we 
attempt to make an access to an address space of type 3 (Embedded 
Controller space).  At this point, there's been no Embedded Controller 
driver attached, and so everything stops.

Here is the ASL for the relevant parts of the battery code:

    Device(BAT0) {
        Name(_HID, 0x0a0cd041)
        Method(_STA) {
            If(\_SB_.PCI0.PX40.ECOK) {
                If(\_SB_.PCI0.PX40.EC0_.BAT0) {
                    Return(0x1f)
                }
                Else {
                    Return(0xf)
                }
            }
            Else {
                Return(0x1f)
            }
        }                                                                       

You see that it (correctly) invokes a method outside of the Embedded
Controller's scope (ECOK) to determine whether the Embedded Controller has
been activated.  Test code placed inside AcpiGetObjectInfo immediately
prior to evaluating the _STA method indicates that at this time, the ECOK
method returns 0.  Nevertheless, the interpreter continues and attempts to
evaluate EC0_.BAT0, which is inside the EC's address space and causing the
above failure.

Studying a verbose trace of the execution of the above code suggests that 
the method correctly returns 0 and that the interpreter thinks that it's 
correctly skipping the next block, however it obviously doesn't. 8)

I can provide a verbose dump of execution if desired (please specify 
which options you'd like), or more ASL, or a binary dump of the DSDT, 
etc. if it might help in diagnosing this.

Note that attempting to sort the namespace to eg. attach the EC before 
attaching the battery are problematic, since we would have to fetch the 
_HID manually, and this doesn't really work around the basic problem 
which is that the code above isn't being executed correctly.

Any suggestions would be welcome.

Regards,
Mike

-- 
... every activity meets with opposition, everyone who acts has his
rivals and unfortunately opponents also.  But not because people want
to be opponents, rather because the tasks and relationships force
people to take different points of view.  [Dr. Fritz Todt]
           V I C T O R Y   N O T   V E N G E A N C E

</body></email><email><emailId>20001009195901</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-10-09 19:59:01-0400</timestampReceived><subject>RE: [Acpi] MSI 6167 and acpi interpreter</subject><body>

Please see David Woodhouse's patch, which addresses this, I think.

The next source release will also include a fix for this, but another
release will not be immediately forthcoming.

Regards -- Andy

&gt; -----Original Message-----
&gt; From: Nicolas Mailhot [mailto:Nicolas.Mailhot@email.enst.fr]
&gt; Sent: Monday, October 09, 2000 12:07 PM
&gt; To: acpi@phobos.fachschaften.tu-muenchen.de
&gt; Subject: [Acpi] MSI 6167 and acpi interpreter
&gt; 
&gt; 
&gt; Hello all,
&gt; 
&gt;  I've been using happily kernel 2.3 and 2.4.0-test with
&gt; mandrake's devel acpid rpm for some time. I've never thought
&gt; of switching back to 2.2 after discovering acpi:). So thanks
&gt; a lot to all the developpers here.
&gt; 
&gt;  Now some time ago acpid started requiring the acpi
&gt; interpreter and my experience became a bit less enjoyable
&gt; (silly me, didn't thought of backing up the old acpid rpm:(.
&gt; 
&gt; Now the kernel will spit out some rude words at boot, and
&gt; worst of all, will hang up at shut down (after displaying
&gt; "power down"-- how nice of it). The old acpid didn't have
&gt; any problems.
&gt; 
&gt; Here is the relevant section of dmesg (vanilla 2.4.0-test-9
&gt; + vm patch) :
&gt; 
&gt; ACPI: support found
&gt; ACPI: PBLK 1 @ 0x5010:0
&gt;         -0196: *** Error: Sleep State package elements are
&gt; not both of type Number
&gt;         -0196: *** Error: Sleep State package elements are
&gt; not both of type Number
&gt; ACPI: S1 supported
&gt; 
&gt; And here comes /proc/sys/acpi contents :
&gt; 
&gt; c2_enter_latency : 0x00003210
&gt; c2_exit_latency : 0x00000142
&gt; c3_enter_latency : 0x00003eee
&gt; c3_exit_latency : 0x00000c96
&gt; 
&gt; I'd really love to put an end to this regression. What
&gt; should I do ?
&gt; 
&gt; -- 
&gt; Nicolas
&gt; 
&gt; 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; 

</body></email><email><emailId>20001012213023</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-10-12 21:30:23-0400</timestampReceived><subject>RE: [Acpi] Problem enabling ACPI on Compaq Presario 1920</subject><body>

Hi John,

Not finding the RSDP is bad. Does this machine support ACPI under Windows?
How to find the RSDP is described in the ACPI spec, so if we're not working,
they shouldn't be working either...;-)

The big debugging info switches are in include/acoutput.h. I've been meaning
to add this to our FAQ but haven't yet. Basically, the subsystem can spit
out a LOT of information if you ask it. However, your best bet might be
looking at tables/tbxfroot.c acpi_tb_find_rsdp(), and sticking some
diagnostic prints in.

That said, we're supposed to "fake it" on PIIX4 systems, but in that case
there would've been something in the boog log like "tables not found, using
chipset support". Was there?

Regards -- Andy

&gt; -----Original Message-----
&gt; From: John Pierce [mailto:hawkfan@pyrotechnics.com]
&gt; Sent: Thursday, October 12, 2000 1:53 PM
&gt; To: acpi@phobos.fachschaften.tu-muenchen.de
&gt; Subject: [Acpi] Problem enabling ACPI on Compaq Presario 1920
&gt; 
&gt; 
&gt; 
&gt; I get the following error message at boot:
&gt; ACPI Subsystem version [Oct 12 2000]
&gt; tbxfroot-0063: *** Warning: RSDP structure not found
&gt; 
&gt; The machine is a Compaq Presario 1920, PII-300mobile, 440BX w/PIIX4.
&gt; All the Compaq supplied BIOS/Firmware updates have been applied.
&gt; 
&gt; dmesg info:
&gt; Linux version 2.4.0-test9 (john@ranger.afterthought.int) (gcc version
&gt; egcs-2.91.66 19990314/Linux (egcs-1.1.2 release)) #7 Thu Oct 
&gt; 12 15:05:12
&gt; CDT 2000
&gt;  BIOS-e820: 000000000009f800 @ 0000000000000000 (usable)
&gt;  BIOS-e820: 0000000000000800 @ 000000000009f800 (reserved)
&gt;  BIOS-e820: 0000000000014800 @ 00000000000eb800 (reserved)
&gt;  BIOS-e820: 0000000003f00000 @ 0000000000100000 (usable)
&gt;  BIOS-e820: 0000000000014800 @ 00000000fffeb800 (reserved)
&gt; ACPI Subsystem version [Oct 12 2000]
&gt; tbxfroot-0063: *** Warning: RSDP structure not found
&gt; 
&gt; This is using the acpica-linux-debug-20000929 driver with
&gt; CONFIG_ACPI_INTERPRETER=y
&gt; 
&gt; Without the interpreter enabled it enables ACPI but acpid 
&gt; complains about
&gt; not finding the dsdt.
&gt; 
&gt; /proc/ioports says:
&gt; 1000-103f : Intel Corporation 82371AB PIIX4 ACPI
&gt; 1040-105f : Intel Corporation 82371AB PIIX4 ACPI
&gt; 
&gt; I took a quick look through the code but I can't figure out 
&gt; how to get it
&gt; to spit out more debugging info.  Once I get my head wrapped 
&gt; around the
&gt; code (and the ACPI spec) more I might be able to find out more...
&gt; 
&gt; Anyway, any help getting ACPI support on this laptop working would be
&gt; greatly appreciated.
&gt; 
&gt; John..
&gt; 
&gt; 
&gt; -- 
&gt; John Pierce              | Finger for PGP/GnuPG keys or see:
&gt; hawkfan@pyrotechnics.com | http://www.pyrotechnics.com/~hawkfan/
&gt; RSA: 5F FC 0A 2D D6 FD B9 3E  57 34 E5 96 AB FC 9D 13
&gt; DH:  0BE5 672B F30F 095E 9BDD  0447 1613 DACA 60F6 4A64
&gt; 
&gt; 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; 

</body></email><email><emailId>20001012231909</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-10-12 23:19:09-0400</timestampReceived><subject>RE: [Acpi] Source release updated (9-29-2000)</subject><body>

Hi JMC,

Any test kernel should work.

Does this happen using a release version of your X server? Yhis may be an X
server issue. If ACPI is at fault, I think you'd either see a complete
system hang, or some output on the console, at least.

If you can definitively say it's ACPI, please include the output from dmesg,
and we'll examine further.

Regards -- Andy

&gt; -----Original Message-----
&gt; From: John-Marc Chandonia [mailto:jmc@cmpharm.ucsf.edu]
&gt; Sent: Thursday, October 12, 2000 3:54 PM
&gt; To: acpi@phobos.fachschaften.tu-muenchen.de
&gt; Subject: Re: [Acpi] Source release updated (9-29-2000)
&gt; 
&gt; 
&gt; Which test kernel is recommended for use with this release?  I'm
&gt; running 2.4.0-test9, and also the Woodhouse patch to the acpi
&gt; debug sources.
&gt; 
&gt; After a few minutes of use, my X server (dri cvs version, mga card)
&gt; locks up completely; upon killing and restarting it, the mouse
&gt; (ps/2) doesn't move.
&gt; 
&gt; Unless there's any more testing I could do that will help, I'm backing
&gt; out to the original acpi directory and sticking to beta testing one
&gt; thing at a time!
&gt; 
&gt; JMC

</body></email><email><emailId>20001016140525</emailId><senderName>Alex Deucher</senderName><senderEmail>agd5f@yahoo.com</senderEmail><timestampReceived>2000-10-16 14:05:25-0400</timestampReceived><subject>[Acpi] General acpi setup</subject><body>

I'm fairly new to acpi.  I have it compiled into my
kernel, and it seems to setup fine upon boot.  I have
the appropriate entries in /proc/sys.  I compiled and
installed acpid,etc.  and all of that seemed to go
fine.  Now I guess my question is how do I use it? 
How do I set the power management options?  How do I
set it up to turn off my pc when I shut down?  Perhaps
these options aren't available as of yet. I can't seem
to find this info anywhere, and the acpi FAQ seems to
more detail the technical aspects rather than
using/seting up the features. Any help would be much
appreciated.
Please reply to me directly when you reply as I am not
on the acpi list.

Thanks,

Alex


__________________________________________________
Do You Yahoo!?
Yahoo! Messenger - Talk while you surf!  It's FREE.
http://im.yahoo.com/

</body></email><email><emailId>20001019044311</emailId><senderName>Stephen Rothwell</senderName><senderEmail>sfr@linuxcare.com.au</senderEmail><timestampReceived>2000-10-19 04:43:11-0400</timestampReceived><subject>Re: [Acpi] acpi boot problems</subject><body>

Hi,

"Mahmoud Mohamed" &lt;demos70@hotmail.com&gt; writes:
&gt; 
&gt; I just want the box to auto shutdown the power supply, APM did this only it 
&gt; doesn't work with dual processors according to the linux source files APM 
&gt; should be disabled when using smp...so I guess ACPI is the only hope.

If you look a little further, you will find that the only thing that APM
will do for an SMP box is the power off.  I hacked it so that MAY work.
To give it a try, you need to build APM into the kernel (i.e. don't
configure it as a module) and then boot with "apm=power-off" on the
kernel command line.

At boot time apm should print

apm: disabled - APM is not SMP safe (power off active).

I know this is tha ACPI mailing list, but I though I would stamp on
the not quite correct statement above.

Cheers,
Stephen
-- 
Stephen Rothwell, Open Source Researcher, Linuxcare, Inc.
+61-2-62628990 tel, +61-2-62628991 fax 
sfr@linuxcare.com, http://www.linuxcare.com/ 
Linuxcare. Support for the revolution.

</body></email><email><emailId>20001019234909</emailId><senderName>"Michael Jarrett"</senderName><senderEmail>judgebeavis@hotmail.com</senderEmail><timestampReceived>2000-10-19 23:49:09-0400</timestampReceived><subject>[Acpi] Heat management</subject><body>

&gt;From what I understand, most of the linux ACPI code is dealing with the 
power-down/sleep states.

Has any work been done on some of the other features of ACPI, most 
specifically heat management? (ACPI does this, right?)

Specifically, I have a Toshiba Satellite 2540XCDT, and wish it to manage 
heat better in Linux: in Windows, it runs smooth, but in dos or linux it'll 
slow down in 30 second bursts if you overheat the processor, which doesn't 
take much.

... I'm happy to help out if anyone is working on this aspect of the spec.

Michael
_________________________________________________________________________
Get Your Private, Free E-mail from MSN Hotmail at http://www.hotmail.com.

Share information about yourself, create your own public profile at 
http://profiles.msn.com.

</body></email><email><emailId>20001024005559</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-10-24 00:55:59-0400</timestampReceived><subject>RE: [Acpi] Source Release updated (10-20-2000)</subject><body>

&gt; From: Dieter NÃ¼tzel [mailto:Dieter.Nuetzel@hamburg.de]
&gt; please file the link to the download page next time without 
&gt; the trailing \dot.

oops, sorry.

&gt; Do this release include David Woodhouse's patch plus the one 
&gt; liner you 
&gt; suggested to me (AMD Irongate/MS-6167)?

Not that exact patch, but should fix that issue, yes.

As for the one-liner removing acpi_idle as the system idle handler, no it
does not include it. We used to have a cmdline option to turn this off, I'll
see if I can find it tomorrow..

Regards -- Andy

</body></email><email><emailId>20001025013404</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-10-25 01:34:04-0400</timestampReceived><subject>RE: [Acpi] Re: Bug report</subject><body>

Sorry about the ambiguous error message. The first one means that ACPI BIOS
support is not present. I think the other one is as we're exiting, and is of
no consequence.

I've corrected these to be more understandable (and labeled them "ACPI", so
no more confusion.)

Stephane, you should not include ACPI in your kernels. No BIOS support
renders it useless, although you may want to see if there are BIOS updates
for your motherboard, and try again. If so, you will want to get the latest
version of the ACPI code at
http://developer.intel.com/technology/iapc/acpi/downloads.htm .

Regards -- Andy



&gt; -----Original Message-----
&gt; From: Jens Axboe [mailto:axboe@suse.de]
&gt; Sent: Tuesday, October 24, 2000 5:03 PM
&gt; To: stephane.raimbault@deesse.univ-lemans.fr
&gt; Cc: andy_henroid@yahoo.com; acpi@phobos.fachschaften.tu-muenchen.de
&gt; Subject: [Acpi] Re: Bug report
&gt; 
&gt; 
&gt; 
&gt; This looks like it's coming out of the ACPI code -- maintainer
&gt; cc'ed.
&gt; 
&gt; On Tue, Oct 24 2000, Stephane RAIMBAULT  (IUP MIME - 96002440) wrote:
&gt; &gt; [1.] One line summary of the problem: 
&gt; &gt; Error message during boot time since kernel 2.4-test9, this warning
&gt; &gt; isn't in kernel 2.4-test8. This warning still the same with another
&gt; &gt; SCSI card.
&gt; &gt; 
&gt; &gt; [2.] Full description of the problem/report:
&gt; &gt; Detected scsi CDROM sr0 at scsi0, channel 0, id 3, lun 0
&gt; &gt; sr0: scsi3-mmc drive: 24x/24x writer cd/rw xa/form2 cdda tray
&gt; &gt;         -0060: *** Warning: RSDP structure not found
&gt; &gt;         -0358: *** Warning: Ns_get_attached_object: Null handle 
&gt; &gt; 
&gt; &gt; [3.] Keywords (i.e., modules, networking, kernel):
&gt; &gt; cdrom - scsi
&gt; &gt; 
&gt; &gt; [4.] Kernel version (from /proc/version):
&gt; &gt; Linux version 2.4.0-test9 (root@trax.org) (gcc version 
&gt; 2.95.3 19991030 (prerelease)) #7 lun oct 23 11:41:53 CEST 2000
&gt; &gt; 
&gt; &gt; [5.] Output of Oops.. message (if applicable) with symbolic 
&gt; information 
&gt; &gt;      resolved (see Documentation/oops-tracing.txt)
&gt; &gt; [6.] A small shell script or example program which triggers the
&gt; &gt;      problem (if possible)
&gt; &gt; [7.] Environment
&gt; &gt; [7.1.] Software (add the output of the ver_linux script here)
&gt; &gt; [7.2.] Processor information (from /proc/cpuinfo):
&gt; &gt; processor	: 0
&gt; &gt; vendor_id	: AuthenticAMD
&gt; &gt; cpu family	: 5
&gt; &gt; model		: 8
&gt; &gt; model name	: AMD-K6(tm) 3D processor
&gt; &gt; stepping	: 12
&gt; &gt; cpu MHz		: 400.000899
&gt; &gt; cache size	: 64 KB
&gt; &gt; fdiv_bug	: no
&gt; &gt; hlt_bug		: no
&gt; &gt; sep_bug		: no
&gt; &gt; f00f_bug	: no
&gt; &gt; coma_bug	: no
&gt; &gt; fpu		: yes
&gt; &gt; fpu_exception	: yes
&gt; &gt; cpuid level	: 1
&gt; &gt; wp		: yes
&gt; &gt; flags		: fpu vme de pse tsc msr mce cx8 sep 
&gt; mtrr pge mmx 3dnow
&gt; &gt; bogomips	: 799.54
&gt; &gt; 
&gt; &gt; [7.3.] Module information (from /proc/modules):
&gt; &gt; [7.4.] Loaded driver and hardware information 
&gt; (/proc/ioports, /proc/iomem)
&gt; &gt; 
&gt; &gt; [7.5.] PCI information ('lspci -vvv' as root)
&gt; &gt; cer Laboratories Inc. [ALi]|M1541 (unknown unknown)
&gt; &gt; Acer Laboratories Inc. [ALi]|M5243 (unknown unknown)
&gt; &gt; Acer Laboratories Inc. [ALi]|M5237 (USB) (SERIAL_USB usb-ohci)
&gt; &gt; Acer Laboratories Inc. [ALi]|M7101 PMU (unknown unknown)
&gt; &gt; Acer Laboratories Inc. [ALi]|M1533 PCI to ISA Bridge 
&gt; [Aladdin IV] (unknown unknown)
&gt; &gt; Symbios|53c875 (STORAGE_SCSI ncr53c8xx)
&gt; &gt; Ensoniq|CT5880 (MULTIMEDIA_AUDIO es1371)
&gt; &gt; Acer Laboratories Inc. [ALi]|M5229 IDE (STORAGE_IDE unknown)
&gt; &gt; nVidia Corporation|Riva TNT2 (DISPLAY_VGA Card:RIVA TNT2)
&gt; &gt; 
&gt; &gt; [7.6.] SCSI information (from /proc/scsi/scsi)
&gt; &gt; Attached devices: 
&gt; &gt; Host: scsi0 Channel: 00 Id: 01 Lun: 00
&gt; &gt;   Vendor: IBM      Model: DCAS-34330       Rev: S65A
&gt; &gt;   Type:   Direct-Access                    ANSI SCSI revision: 02
&gt; &gt; Host: scsi0 Channel: 00 Id: 03 Lun: 00
&gt; &gt;   Vendor: TEAC     Model: CD-R56S          Rev: 1.0P
&gt; &gt;   Type:   CD-ROM                           ANSI SCSI revision: 02
&gt; &gt; [7.7.] Other information that might be relevant to the problem
&gt; &gt;        (please look in /proc and include all information that you
&gt; &gt;        think to be relevant):
&gt; &gt; [X.] Other notes, patches, fixes, workarounds:
&gt; &gt; 
&gt; &gt; Bye
&gt; &gt; 
&gt; &gt; Stephane Raimbault
&gt; &gt; 
&gt; &gt; 
&gt; 
&gt; -- 
&gt; * Jens Axboe &lt;axboe@suse.de&gt;
&gt; * SuSE Labs
&gt; 
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; 

</body></email><email><emailId>20001009190703</emailId><senderName>Nicolas Mailhot</senderName><senderEmail>nicolas.mailhot@email.enst.fr</senderEmail><timestampReceived>2000-10-09 19:07:03-0400</timestampReceived><subject>[Acpi] MSI 6167 and acpi interpreter</subject><body>

Hello all,

 I've been using happily kernel 2.3 and 2.4.0-test with
mandrake's devel acpid rpm for some time. I've never thought
of switching back to 2.2 after discovering acpi:). So thanks
a lot to all the developpers here.

 Now some time ago acpid started requiring the acpi
interpreter and my experience became a bit less enjoyable
(silly me, didn't thought of backing up the old acpid rpm:(.

Now the kernel will spit out some rude words at boot, and
worst of all, will hang up at shut down (after displaying
"power down"-- how nice of it). The old acpid didn't have
any problems.

Here is the relevant section of dmesg (vanilla 2.4.0-test-9
+ vm patch) :

ACPI: support found
ACPI: PBLK 1 @ 0x5010:0
        -0196: *** Error: Sleep State package elements are
not both of type Number
        -0196: *** Error: Sleep State package elements are
not both of type Number
ACPI: S1 supported

And here comes /proc/sys/acpi contents :

c2_enter_latency : 0x00003210
c2_exit_latency : 0x00000142
c3_enter_latency : 0x00003eee
c3_exit_latency : 0x00000c96

I'd really love to put an end to this regression. What
should I do ?

-- 
Nicolas

</body></email><email><emailId>20001012205328</emailId><senderName>John Pierce</senderName><senderEmail>hawkfan@pyrotechnics.com</senderEmail><timestampReceived>2000-10-12 20:53:28-0400</timestampReceived><subject>[Acpi] Problem enabling ACPI on Compaq Presario 1920</subject><body>

I get the following error message at boot:
ACPI Subsystem version [Oct 12 2000]
tbxfroot-0063: *** Warning: RSDP structure not found

The machine is a Compaq Presario 1920, PII-300mobile, 440BX w/PIIX4.
All the Compaq supplied BIOS/Firmware updates have been applied.

dmesg info:
Linux version 2.4.0-test9 (john@ranger.afterthought.int) (gcc version
egcs-2.91.66 19990314/Linux (egcs-1.1.2 release)) #7 Thu Oct 12 15:05:12
CDT 2000
 BIOS-e820: 000000000009f800 @ 0000000000000000 (usable)
 BIOS-e820: 0000000000000800 @ 000000000009f800 (reserved)
 BIOS-e820: 0000000000014800 @ 00000000000eb800 (reserved)
 BIOS-e820: 0000000003f00000 @ 0000000000100000 (usable)
 BIOS-e820: 0000000000014800 @ 00000000fffeb800 (reserved)
ACPI Subsystem version [Oct 12 2000]
tbxfroot-0063: *** Warning: RSDP structure not found

This is using the acpica-linux-debug-20000929 driver with
CONFIG_ACPI_INTERPRETER=y

Without the interpreter enabled it enables ACPI but acpid complains about
not finding the dsdt.

/proc/ioports says:
1000-103f : Intel Corporation 82371AB PIIX4 ACPI
1040-105f : Intel Corporation 82371AB PIIX4 ACPI

I took a quick look through the code but I can't figure out how to get it
to spit out more debugging info.  Once I get my head wrapped around the
code (and the ACPI spec) more I might be able to find out more...

Anyway, any help getting ACPI support on this laptop working would be
greatly appreciated.

John..


-- 
John Pierce              | Finger for PGP/GnuPG keys or see:
hawkfan@pyrotechnics.com | http://www.pyrotechnics.com/~hawkfan/
RSA: 5F FC 0A 2D D6 FD B9 3E  57 34 E5 96 AB FC 9D 13
DH:  0BE5 672B F30F 095E 9BDD  0447 1613 DACA 60F6 4A64

</body></email><email><emailId>20001002223617</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-10-02 22:36:17-0400</timestampReceived><subject>[Acpi] Source release updated (9-29-2000)</subject><body>

This will be posted tonight at
http://developer.intel.com/technology/iapc/acpi/downloads.htm.
(Please note that the Programmer Reference will be updated soon to reflect
these API changes)

-- Andy

Summary of changes for this label: 9_29_00

New table initialization interfaces:
AcpiInitializeSubsystem no longer has any parameters
AcpiFindRootPointer - Find the RSDP (if necessary)
AcpiLoadTables (RSDP) - load all tables found at RSDP-&gt;RSDT
Obsolete Interfaces
AcpiLoadFirmwareTables - replaced by AcpiLoadTables

Note: These interface changes require changes to all existing OSDs

The PCI_Config default address space handler is always installed at the root
namespace object.

Linux-specific:
Export more tables and PM timer through proc/sys/acpi
Better handle PM timer rollover, and both widths


----------------------------
Andrew Grover
Intel/TRL/MAL
andrew.grover@intel.com

</body></email><email><emailId>20001018190213</emailId><senderName>"Mahmoud Mohamed"</senderName><senderEmail>demos70@hotmail.com</senderEmail><timestampReceived>2000-10-18 19:02:13-0400</timestampReceived><subject>[Acpi] acpi boot problems</subject><body>

After compiling the 2.4.0-test9 kernel with ACPI enabled, and enabling the 
Interpreter and saying 'y' to CONFIG_ACPI_S1_SLEEP, and compiling the latest 
acpid..my system shuts down while booting and the power supply is turned 
off.
One out of 5 boots is succesful so I managed to get the dmesg:

SCSI device sda: 35879135 512-byte hdwr sectors (18370 MB)
Partition check:
/dev/scsi/host0/bus0/target0/lun0: p1 p2 &lt; p5 p6 p7 p8 p9 p10 p11 p12 p13 
p14 &gt;
devfs: v0.102 (20000622) Richard Gooch (rgooch@atnf.csiro.au)
devfs: devfs_debug: 0x0
devfs: boot_options: 0x0   &lt;-- at this stage the system shuts down
ACPI: support found
ACPI: PBLK 0 @ 0x0000:0
VFS: Mounted root (ext2 filesystem) readonly.
ACPI: PBLK 1 @ 0x0000:0
        -0196: *** Error: Sleep State package elements are not both of type 
Number
ACPI: S1 supported
Mounted devfs on /dev

The system is a Dual PIII550, Gigabyte GA-6BXD with the latest bios (version 
F3), 512Mb ram, adaptec 3950U2 SCSI and an IBM 18Gb U2 HD.

Out of the few times the sytem finished booting, when I run
shutdown -g0 or halt -p the system runs the rc.0 shutdown scripts, prints 
the message 'Power Down' but the power supply is still runnin and I have to 
manually switch it off.

What does that PBLK Error Sleep State mean ?
According to the acpi_linux_howto I have all the required entries in 
/proc/sys/acpi, and runnin acpictl -p showed that acpid was running.
Any tips would be appretiated.




_________________________________________________________________________
Get Your Private, Free E-mail from MSN Hotmail at http://www.hotmail.com.

Share information about yourself, create your own public profile at 
http://profiles.msn.com.

</body></email><email><emailId>20001023214154</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-10-23 21:41:54-0400</timestampReceived><subject>[Acpi] Source Release updated (10-20-2000)</subject><body>

This will be posted tonight at
http://developer.intel.com/technology/iapc/acpi/downloads.htm.

------------------------------------------
Summary of changes for this label: 10_20_00

Linux:
Embedded Controller driver now registers for EC OpRegion
The beginnings of battery support (we detect them on boot, that's all)

Core:
Fix for CBN_._STA issue.  This fix will allow correct access to CBN_
OpRegions
when the _STA returns 0x8.  This code will most likely change as we gain
further
understanding of Microsoft's position on this issue. 

Support to convert ACPI constants (Ones, Zeros, One) to actual values before
a package object is returned

Fix for method call as predicate to if/while construct causing incorrect
if/while behavior

Fix for Else block package lengths sometimes calculated wrong (if block &gt; 63
bytes)

Fix for Processor object length field, was always zero

Table load abort if FACP sanity check fails

Fix for problem with Scope(name) if name already exists

Warning emitted if a named object referenced cannot be found (resolved)
during method execution.
------------------------------------------


Regards -- Andy

----------------------------
Andrew Grover
Intel/TRL/MAL
andrew.grover@intel.com

</body></email><email><emailId>20001025000311</emailId><senderName>Jens Axboe</senderName><senderEmail>axboe@suse.de</senderEmail><timestampReceived>2000-10-25 00:03:11-0400</timestampReceived><subject>[Acpi] Re: Bug report</subject><body>

This looks like it's coming out of the ACPI code -- maintainer
cc'ed.

On Tue, Oct 24 2000, Stephane RAIMBAULT  (IUP MIME - 96002440) wrote:
&gt; [1.] One line summary of the problem: 
&gt; Error message during boot time since kernel 2.4-test9, this warning
&gt; isn't in kernel 2.4-test8. This warning still the same with another
&gt; SCSI card.
&gt; 
&gt; [2.] Full description of the problem/report:
&gt; Detected scsi CDROM sr0 at scsi0, channel 0, id 3, lun 0
&gt; sr0: scsi3-mmc drive: 24x/24x writer cd/rw xa/form2 cdda tray
&gt; -0060: *** Warning: RSDP structure not found
&gt; -0358: *** Warning: Ns_get_attached_object: Null handle 
&gt; 
&gt; [3.] Keywords (i.e., modules, networking, kernel):
&gt; cdrom - scsi
&gt; 
&gt; [4.] Kernel version (from /proc/version):
&gt; Linux version 2.4.0-test9 (root@trax.org) (gcc version 2.95.3 19991030 \
&gt; (prerelease)) #7 lun oct 23 11:41:53 CEST 2000 
&gt; [5.] Output of Oops.. message (if applicable) with symbolic information 
&gt; resolved (see Documentation/oops-tracing.txt)
&gt; [6.] A small shell script or example program which triggers the
&gt; problem (if possible)
&gt; [7.] Environment
&gt; [7.1.] Software (add the output of the ver_linux script here)
&gt; [7.2.] Processor information (from /proc/cpuinfo):
&gt; processor	: 0
&gt; vendor_id	: AuthenticAMD
&gt; cpu family	: 5
&gt; model		: 8
&gt; model name	: AMD-K6(tm) 3D processor
&gt; stepping	: 12
&gt; cpu MHz		: 400.000899
&gt; cache size	: 64 KB
&gt; fdiv_bug	: no
&gt; hlt_bug		: no
&gt; sep_bug		: no
&gt; f00f_bug	: no
&gt; coma_bug	: no
&gt; fpu		: yes
&gt; fpu_exception	: yes
&gt; cpuid level	: 1
&gt; wp		: yes
&gt; flags		: fpu vme de pse tsc msr mce cx8 sep mtrr pge mmx 3dnow
&gt; bogomips	: 799.54
&gt; 
&gt; [7.3.] Module information (from /proc/modules):
&gt; [7.4.] Loaded driver and hardware information (/proc/ioports, /proc/iomem)
&gt; 
&gt; [7.5.] PCI information ('lspci -vvv' as root)
&gt; cer Laboratories Inc. [ALi]|M1541 (unknown unknown)
&gt; Acer Laboratories Inc. [ALi]|M5243 (unknown unknown)
&gt; Acer Laboratories Inc. [ALi]|M5237 (USB) (SERIAL_USB usb-ohci)
&gt; Acer Laboratories Inc. [ALi]|M7101 PMU (unknown unknown)
&gt; Acer Laboratories Inc. [ALi]|M1533 PCI to ISA Bridge [Aladdin IV] (unknown unknown)
&gt; Symbios|53c875 (STORAGE_SCSI ncr53c8xx)
&gt; Ensoniq|CT5880 (MULTIMEDIA_AUDIO es1371)
&gt; Acer Laboratories Inc. [ALi]|M5229 IDE (STORAGE_IDE unknown)
&gt; nVidia Corporation|Riva TNT2 (DISPLAY_VGA Card:RIVA TNT2)
&gt; 
&gt; [7.6.] SCSI information (from /proc/scsi/scsi)
&gt; Attached devices: 
&gt; Host: scsi0 Channel: 00 Id: 01 Lun: 00
&gt; Vendor: IBM      Model: DCAS-34330       Rev: S65A
&gt; Type:   Direct-Access                    ANSI SCSI revision: 02
&gt; Host: scsi0 Channel: 00 Id: 03 Lun: 00
&gt; Vendor: TEAC     Model: CD-R56S          Rev: 1.0P
&gt; Type:   CD-ROM                           ANSI SCSI revision: 02
&gt; [7.7.] Other information that might be relevant to the problem
&gt; (please look in /proc and include all information that you
&gt; think to be relevant):
&gt; [X.] Other notes, patches, fixes, workarounds:
&gt; 
&gt; Bye
&gt; 
&gt; Stephane Raimbault
&gt; 
&gt; 

-- 
* Jens Axboe &lt;axboe@suse.de&gt;
* SuSE Labs


</body></email><email><emailId>20001025033519</emailId><senderName>brendan burns</senderName><senderEmail>bburns@wso.williams.edu</senderEmail><timestampReceived>2000-10-25 03:35:19-0400</timestampReceived><subject>[Acpi] Irq problems + Battery</subject><body>

Hello,
I've got ACPI working on my HP Omnibook 2100 but I'm having a problem
getting my sound card to cooperate with it.  With ACPI enabled the ad1848
portion of the Crystal Sound card seems to want irq 11 which acpi is also
sitting on.  Is there anyway to debug why this is happening, or to switch
acpi to a different irq?

Also I wrote a while ago about battery support via ACPI.  I've had some
free time and i read up on the spec and I think i understand how battery
information should be gathered.  I would be interested in writing the code
to do it but i've never really done any kernel development before (I've
done a lot of other development...) if anyone has any pointers to
resources to get me started I wouldn't mind working on it.

Thanks,
Brendan

</body></email><email><emailId>20001026061341</emailId><senderName>"Mahmoud Mohamed"</senderName><senderEmail>demos70@hotmail.com</senderEmail><timestampReceived>2000-10-26 06:13:41-0400</timestampReceived><subject>[Acpi] Enable Failed</subject><body>


Hi all,

I got the new acpi driver, recompiled the kernel with ACPI Interpreter, and 
the S1_Sleep ..same old problems the machine shuts down during boot.
I recompiled the kernel using David WoodHouse's hwreg.c patch, it didn't 
give any error messages like it did with the old acpi drivers (the default 
ones that came with the 2.4.0-test kernel gave a hunk #3 error)...and chose 
S1_Sleep, the machine booted fine but I got this:

ACPI: support found
ACPI: enable failed

I tried to manually run acpid and got 'acpi support not found'.

I then recompiled the kernel using the the released driver without applying 
David's patch and without choosing S1_Sleep it gave me the same ACPI enable 
failed message.

I tried disabling PowerManagement in the BIOS I thought maybe it was 
interfering with ACPI and disabled other items in the Power Management 
section of my bios ..still nothing.
The mobo is a GA-6BXD runnin bios V.F3 (latest), this bios supports Acpi 
even though there are no entries/options in the Bios that mention ACPI.

Is it my hardware or my luck or somethin I'm missin ?

Thanks,
Mahmood
_________________________________________________________________________
Get Your Private, Free E-mail from MSN Hotmail at http://www.hotmail.com.

Share information about yourself, create your own public profile at 
http://profiles.msn.com.

</body></email><email><emailId>20001026100503</emailId><senderName>Art Boulatov</senderName><senderEmail>art@ksu.ru</senderEmail><timestampReceived>2000-10-26 10:05:03-0400</timestampReceived><subject>Re: [Acpi] Enable Failed</subject><body>

Mahmoud Mohamed wrote:
&gt;fine but I got this:
&gt; 
&gt; ACPI: support found
&gt; ACPI: enable failed
&gt; 

Same thing on ASUS CUSL2-M (i815E)

Art.

</body></email><email><emailId>20001026130340</emailId><senderName>Harold Oga</senderName><senderEmail>ogah@cadvision.com</senderEmail><timestampReceived>2000-10-26 13:03:40-0400</timestampReceived><subject>Re: [Acpi] Enable Failed</subject><body>

On Thu, Oct 26, 2000 at 02:05:03PM +0400, Art Boulatov wrote:
&gt;Mahmoud Mohamed wrote:
&gt;&gt;fine but I got this:
&gt;&gt; 
&gt;&gt; ACPI: support found
&gt;&gt; ACPI: enable failed
&gt;&gt; 
&gt;
&gt;Same thing on ASUS CUSL2-M (i815E)
&gt;
&gt;Art.
Hi,
   Interesting.  It works fine on my ASUS CUSL2 and 2.4.0-test10-pre5.
The kernel spits out:

ACPI: support found
ACPI: PBLK 1 @ 0xe410:0
ACPI: S1 supported
ACPI: S5 supported

I have the kernel configured with the following:

CONFIG_PM=y
CONFIG_ACPI=y
CONFIG_ACPI_INTERPRETER=y
CONFIG_ACPI_S1_SLEEP=y
# CONFIG_APM is not set

-Harold  
-- 
"Life sucks, deal with it!"

</body></email><email><emailId>20001027171216</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-10-27 17:12:16-0400</timestampReceived><subject>RE: [Acpi] Enable Failed</subject><body>

Mahmoud (et al.),

Please make sure you are running the latest stuff off the website (10/20)
and make sure you are using the debug version. Its more verbose error
reporting would really come in handy here.

That said, the boot messages you're referring to are a little unclear, so
they will be more readable in the next release.

Regards -- Andy

&gt; From: Mahmoud Mohamed [mailto:demos70@hotmail.com]
&gt; ACPI: support found
&gt; ACPI: enable failed

</body></email><email><emailId>20001024003301</emailId><senderName>Dieter =?iso-8859-1?q?N=FCtzel?=</senderName><senderEmail>dieter.nuetzel@hamburg.de</senderEmail><timestampReceived>2000-10-24 00:33:01-0400</timestampReceived><subject>Re: [Acpi] Source Release updated (10-20-2000)</subject><body>

Hello Andi,

please file the link to the download page next time without the trailing \dot.
Do this release include David Woodhouse's patch plus the one liner you 
suggested to me (AMD Irongate/MS-6167)?

Thanks,
	Dieter

BTW Send to you by KMail (KDE2 RC2) :-)
-- 
Dieter NÃ¼tzel
Graduate Student, Computer Science

University of Hamburg
Department of Computer Science
Cognitive Systems Group
Vogt-KÃ¶lln-StraÃe 30
D-22527 Hamburg, Germany

email: nuetzel@kogs.informatik.uni-hamburg.de
@home: Dieter.Nuetzel@hamburg.de

</body></email><email><emailId>20001018203709</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-10-18 20:37:09-0400</timestampReceived><subject>RE: [Acpi] acpi boot problems</subject><body>

Hello Mahmoud,

A fix for that issue will be in the next source release, hopefully to happen
soon. Until then, there is a patch by David Woodhouse, which, if you look in
the list archives, you should be able to locate.

I'm a little concerned because the usual symptoms of that problem are not as
severe as the ones you are describing, but try that patch to start.

Does this still happen if you don't say 'y' to S1_SLEEP?

Regards -- Andy

&gt; -----Original Message-----
&gt; From: Mahmoud Mohamed [mailto:demos70@hotmail.com]
&gt; Sent: Wednesday, October 18, 2000 12:02 PM
&gt; To: acpi@phobos.fachschaften.tu-muenchen.de
&gt; Subject: [Acpi] acpi boot problems
&gt; 
&gt; 
&gt; After compiling the 2.4.0-test9 kernel with ACPI enabled, and 
&gt; enabling the 
&gt; Interpreter and saying 'y' to CONFIG_ACPI_S1_SLEEP, and 
&gt; compiling the latest 
&gt; acpid..my system shuts down while booting and the power 
&gt; supply is turned 
&gt; off.
&gt; One out of 5 boots is succesful so I managed to get the dmesg:
&gt; 
&gt; SCSI device sda: 35879135 512-byte hdwr sectors (18370 MB)
&gt; Partition check:
&gt; /dev/scsi/host0/bus0/target0/lun0: p1 p2 &lt; p5 p6 p7 p8 p9 p10 
&gt; p11 p12 p13 
&gt; p14 &gt;
&gt; devfs: v0.102 (20000622) Richard Gooch (rgooch@atnf.csiro.au)
&gt; devfs: devfs_debug: 0x0
&gt; devfs: boot_options: 0x0   &lt;-- at this stage the system shuts down
&gt; ACPI: support found
&gt; ACPI: PBLK 0 @ 0x0000:0
&gt; VFS: Mounted root (ext2 filesystem) readonly.
&gt; ACPI: PBLK 1 @ 0x0000:0
&gt;         -0196: *** Error: Sleep State package elements are 
&gt; not both of type 
&gt; Number
&gt; ACPI: S1 supported
&gt; Mounted devfs on /dev
&gt; 
&gt; The system is a Dual PIII550, Gigabyte GA-6BXD with the 
&gt; latest bios (version 
&gt; F3), 512Mb ram, adaptec 3950U2 SCSI and an IBM 18Gb U2 HD.
&gt; 
&gt; Out of the few times the sytem finished booting, when I run
&gt; shutdown -g0 or halt -p the system runs the rc.0 shutdown 
&gt; scripts, prints 
&gt; the message 'Power Down' but the power supply is still runnin 
&gt; and I have to 
&gt; manually switch it off.
&gt; 
&gt; What does that PBLK Error Sleep State mean ?
&gt; According to the acpi_linux_howto I have all the required entries in 
&gt; /proc/sys/acpi, and runnin acpictl -p showed that acpid was running.
&gt; Any tips would be appretiated.

</body></email><email><emailId>20001019034542</emailId><senderName>"Mahmoud Mohamed"</senderName><senderEmail>demos70@hotmail.com</senderEmail><timestampReceived>2000-10-19 03:45:42-0400</timestampReceived><subject>RE: [Acpi] acpi boot problems</subject><body>



Hi Andy,

Thanks for your fast reply.
I did try your suggestion - not saying 'y' to S1_Sleep - and the problem 
still exists.
When the S1_Sleep was on I managed to boot the kernel successfully _only if_ 
I first booted an old 2.2.16 kernel then type 'reboot'
(not shutdown) and choose to reboot the new 2.4.0-test9 with ACPI support.

Also I said before that acpid was running this was due to the fact that I 
had turned on acpid twice in my rc.d/rc.* files, however after removing the 
second acpid and rebooting and running 'acpictl -p' I got no pid, maybe that 
-0196 error is causing the daemon to crash?

I tried applying David's S5 patch but it rejected the third hunk, I think it 
needs some number tweaking between them @'s only I lack the knowledge/skill 
:)

I just want the box to auto shutdown the power supply, APM did this only it 
doesn't work with dual processors according to the linux source files APM 
should be disabled when using smp...so I guess ACPI is the only hope.
The 6BXD is the first mobo mentioned under compatable bios Gigabyte section 
in the Acpi4Linux page, I hope it ain't somethin related to my gear ..has 
anybody out there managed to run acpi with a 6bxd, dual processor, aic7xxx 
driver ?


_________________________________________________________________________
Get Your Private, Free E-mail from MSN Hotmail at http://www.hotmail.com.

Share information about yourself, create your own public profile at 
http://profiles.msn.com.

</body></email><email><emailId>20001007213711</emailId><senderName>David Woodhouse</senderName><senderEmail>dwmw2@infradead.org</senderEmail><timestampReceived>2000-10-07 21:37:11-0400</timestampReceived><subject>Re: [Acpi] Source release updated (9-29-2000)</subject><body>

This release no longer fails to load the ACPI namespace on my BP6.
Unfortunately, it doesn't actually manage to enable S5, which is the only
thing I really care about ATM.

It appears not to like the ZeroOp elements in the S5 package:

0000005c: Name _S5_ (\_S5_)
00000062:   Package
00000064:     0x04
00000065:     ZeroOp
00000066:     ZeroOp
00000067:     ZeroOp
00000068:     ZeroOp

This patch fixes it:

--- linux/drivers/acpi/hardware/hwregs.c.buggered	Sat Sep 30 01:49:30 2000
+++ linux/drivers/acpi/hardware/hwregs.c	Sat Oct  7 21:51:22 2000
@@ -29,6 +29,7 @@
 #include "acpi.h"
 #include "achware.h"
 #include "acnamesp.h"
+#include "amlcode.h"
 
 #define _COMPONENT          HARDWARE
 	 MODULE_NAME         ("hwregs")
@@ -133,6 +134,45 @@
  ******************************************************************************/
 
 ACPI_STATUS
+acpi_hw_obtain_sleep_type_register_datum (
+	ACPI_OPERAND_OBJECT     *obj_desc,
+	u8                      *slp_typ)
+{
+	ACPI_STATUS             status = AE_OK;
+
+	switch (obj_desc-&gt;common.type) {
+	case ACPI_TYPE_NUMBER:
+		*slp_typ = obj_desc-&gt;number.value;
+		break;
+
+	case INTERNAL_TYPE_REFERENCE:
+		switch(obj_desc-&gt;reference.op_code) {
+		case AML_ZERO_OP:
+			*slp_typ = 0;
+			break;
+
+		case AML_ONE_OP:
+			*slp_typ = 1;
+			break;
+
+		case AML_ONES_OP:
+			*slp_typ = 0xff;
+			break;
+
+		default:
+			status = AE_ERROR;
+		}
+		break;
+		
+	default:
+		status = AE_ERROR;
+	}
+
+	return status;
+}
+
+
+ACPI_STATUS
 acpi_hw_obtain_sleep_type_register_data (
 	u8                      sleep_state,
 	u8                      *slp_typ_a,
@@ -185,28 +225,14 @@
 		REPORT_ERROR (("Sleep State package does not have at least two elements\n"));
 		status = AE_ERROR;
 	}
-
-	else if (((obj_desc-&gt;package.elements[0])-&gt;common.type !=
-			 ACPI_TYPE_NUMBER) ||
-			 ((obj_desc-&gt;package.elements[1])-&gt;common.type !=
-				ACPI_TYPE_NUMBER))
-	{
-		/* Must have two  */
-
-		REPORT_ERROR (("Sleep State package elements are not both of type Number\n"));
-		status = AE_ERROR;
-	}
-
-	else {
-		/*
-		 *  Valid _Sx_ package size, type, and value
-		 */
-		*slp_typ_a = (u8) (obj_desc-&gt;package.elements[0])-&gt;number.value;
-
-		*slp_typ_b = (u8) (obj_desc-&gt;package.elements[1])-&gt;number.value;
+	else if (ACPI_FAILURE ( (status = acpi_hw_obtain_sleep_type_register_datum \
(obj_desc-&gt;package.elements[0], +										    slp_typ_a)) )) {
+		REPORT_ERROR (("First S%d Sleep State package element is not of numerical type\n", \
sleep_state)); +	}
+	else if (ACPI_FAILURE ( (status = acpi_hw_obtain_sleep_type_register_datum \
(obj_desc-&gt;package.elements[1], +										    slp_typ_b)) )) {
+		REPORT_ERROR (("Second S%d Sleep State package element is not of numerical \
type\n", sleep_state));  }
-
-
 
 	acpi_cm_remove_reference (obj_desc);
 


-- 
dwmw2


</body></email><email><emailId>20001009002021</emailId><senderName>Dieter =?iso-8859-1?Q?N=FCtzel?=</senderName><senderEmail>dieter.nuetzel@hamburg.de</senderEmail><timestampReceived>2000-10-09 00:20:21-0400</timestampReceived><subject>Re: [Acpi] Source release updated (9-29-2000)</subject><body>

Hello Andy,

this 'new' source release plus David Woodhouse's S5 patch fixes my AMD
Irongate system!
All the cool interpreter stuff haven't worked before...

Two problems persists:

If I press the power button --&gt; sleep (4 sec delay to power down) my
system goes immediately
down :-(

My ppp connection speed (both directions) goes down below 1 KB/sec?

My system:

AMD Athlon 550
MSI MS-6167 Rev. 1.0B (AMD Irongate C4)
latest BIOS 1.6 (for Slot A T-Bird)

Linux-2.4.0-test9 (final) + Rik van Riel latest fixes

SunWave1&gt;less ~root/acpi.log
Linux version 2.4.0-test9 (root@SunWave1) (gcc version 2.95.2 19991024
(release)) #1 Mon Oct 9 00:38:14 CEST 2000
 BIOS-e820: 000000000009fc00 @ 0000000000000000 (usable)
 BIOS-e820: 0000000000000400 @ 000000000009fc00 (reserved)
 BIOS-e820: 0000000000010000 @ 00000000000f0000 (reserved)
 BIOS-e820: 0000000000010000 @ 00000000ffff0000 (reserved)
 BIOS-e820: 000000000fef0000 @ 0000000000100000 (usable)
 BIOS-e820: 000000000000d000 @ 000000000fff3000 (ACPI data)
 BIOS-e820: 0000000000003000 @ 000000000fff0000 (ACPI NVS)
ACPI: support found
ACPI: PBLK 1 @ 0x5010:6
ACPI: C2 supported
ACPI: 1 throttling states
ACPI: PM Timer width: 24 bits
ACPI: S1 supported
ACPI: S5 supported
ACPI C2 works

SunWave1&gt;cat /proc/sys/acpi/
apic              c3_enter_latency  event             pm_timer
c2_enter_latency  c3_exit_latency   facp              rsdt
c2_exit_latency   dsdt              facs              sleep

Thanks!
    Dieter

--
!!! Attention - New Email Address !!!

Dieter N=FCtzel
Graduate Student, Computer Science

University of Hamburg
Department of Computer Science
Cognitive Systems Group
Vogt-K=F6lln-Stra=DFe 30
D-22527 Hamburg, Germany

email: nuetzel@kogs.informatik.uni-hamburg.de
@home: Dieter.Nuetzel@hamburg.de

</body></email><email><emailId>20001009182637</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-10-09 18:26:37-0400</timestampReceived><subject>RE: [Acpi] Source release updated (9-29-2000)</subject><body>

(different Andy, but...;-)

The 4 sec delay is a feature, not a bug. This is a failsafe so that the
user, independent of the OS, can still turn off the system. If the power
button is working, you should see a message on /proc/sys/acpi/events way
before 4 sec.

I don't have an answer for the PPP problem. Could you try commenting out the
pm_idle = acpi_idle at the very bottom of cpu.c and see if it persists?

Thanks -- Regards -- Andy

&gt; -----Original Message-----
&gt; From: Dieter NÃ¼tzel [mailto:Dieter.Nuetzel@hamburg.de]
&gt; Sent: Sunday, October 08, 2000 5:20 PM
&gt; To: Andy Henroid
&gt; Cc: acpi@phobos.fachschaften.tu-muenchen.de
&gt; Subject: Re: [Acpi] Source release updated (9-29-2000)
&gt; 
&gt; 
&gt; Hello Andy,
&gt; 
&gt; this 'new' source release plus David Woodhouse's S5 patch fixes my AMD
&gt; Irongate system!
&gt; All the cool interpreter stuff haven't worked before...
&gt; 
&gt; Two problems persists:
&gt; 
&gt; If I press the power button --&gt; sleep (4 sec delay to power down) my
&gt; system goes immediately
&gt; down :-(
&gt; 
&gt; My ppp connection speed (both directions) goes down below 1 KB/sec?
&gt; 
&gt; My system:
&gt; 
&gt; AMD Athlon 550
&gt; MSI MS-6167 Rev. 1.0B (AMD Irongate C4)
&gt; latest BIOS 1.6 (for Slot A T-Bird)
&gt; 
&gt; Linux-2.4.0-test9 (final) + Rik van Riel latest fixes
&gt; 
&gt; SunWave1&gt;less ~root/acpi.log
&gt; Linux version 2.4.0-test9 (root@SunWave1) (gcc version 2.95.2 19991024
&gt; (release)) #1 Mon Oct 9 00:38:14 CEST 2000
&gt;  BIOS-e820: 000000000009fc00 @ 0000000000000000 (usable)
&gt;  BIOS-e820: 0000000000000400 @ 000000000009fc00 (reserved)
&gt;  BIOS-e820: 0000000000010000 @ 00000000000f0000 (reserved)
&gt;  BIOS-e820: 0000000000010000 @ 00000000ffff0000 (reserved)
&gt;  BIOS-e820: 000000000fef0000 @ 0000000000100000 (usable)
&gt;  BIOS-e820: 000000000000d000 @ 000000000fff3000 (ACPI data)
&gt;  BIOS-e820: 0000000000003000 @ 000000000fff0000 (ACPI NVS)
&gt; ACPI: support found
&gt; ACPI: PBLK 1 @ 0x5010:6
&gt; ACPI: C2 supported
&gt; ACPI: 1 throttling states
&gt; ACPI: PM Timer width: 24 bits
&gt; ACPI: S1 supported
&gt; ACPI: S5 supported
&gt; ACPI C2 works
&gt; 
&gt; SunWave1&gt;cat /proc/sys/acpi/
&gt; apic              c3_enter_latency  event             pm_timer
&gt; c2_enter_latency  c3_exit_latency   facp              rsdt
&gt; c2_exit_latency   dsdt              facs              sleep
&gt; 
&gt; Thanks!
&gt;     Dieter
&gt; 
&gt; --
&gt; !!! Attention - New Email Address !!!
&gt; 
&gt; Dieter NÃ¼tzel
&gt; Graduate Student, Computer Science
&gt; 
&gt; University of Hamburg
&gt; Department of Computer Science
&gt; Cognitive Systems Group
&gt; Vogt-KÃ¶lln-StraÃe 30
&gt; D-22527 Hamburg, Germany
&gt; 
&gt; email: nuetzel@kogs.informatik.uni-hamburg.de
&gt; @home: Dieter.Nuetzel@hamburg.de
&gt; 
&gt; 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; 

</body></email><email><emailId>20001009183313</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-10-09 18:33:13-0400</timestampReceived><subject>RE: [Acpi] Source release updated (9-29-2000)</subject><body>

Glad to hear we're getting farther! ;-)

Hmm, yeah, that AML should not fail. Thanks.

-- Andy

&gt; -----Original Message-----
&gt; From: David Woodhouse [mailto:dwmw2@infradead.org]
&gt; Sent: Saturday, October 07, 2000 2:37 PM
&gt; To: Grover, Andrew
&gt; Cc: Acpi-linux (E-mail)
&gt; Subject: Re: [Acpi] Source release updated (9-29-2000)
&gt; 
&gt; 
&gt; 
&gt; This release no longer fails to load the ACPI namespace on my BP6.
&gt; Unfortunately, it doesn't actually manage to enable S5, which 
&gt; is the only
&gt; thing I really care about ATM.
&gt; 
&gt; It appears not to like the ZeroOp elements in the S5 package:
&gt; 
&gt; 0000005c: Name _S5_ (\_S5_)
&gt; 00000062:   Package
&gt; 00000064:     0x04
&gt; 00000065:     ZeroOp
&gt; 00000066:     ZeroOp
&gt; 00000067:     ZeroOp
&gt; 00000068:     ZeroOp
&gt; 
&gt; This patch fixes it:
&gt; 
&gt; --- linux/drivers/acpi/hardware/hwregs.c.buggered	Sat Sep 
&gt; 30 01:49:30 2000
&gt; +++ linux/drivers/acpi/hardware/hwregs.c	Sat Oct  7 21:51:22 2000
&gt; @@ -29,6 +29,7 @@
&gt;  #include "acpi.h"
&gt;  #include "achware.h"
&gt;  #include "acnamesp.h"
&gt; +#include "amlcode.h"
&gt;  
&gt;  #define _COMPONENT          HARDWARE
&gt;  	 MODULE_NAME         ("hwregs")
&gt; @@ -133,6 +134,45 @@
&gt;   
&gt; **************************************************************
&gt; ****************/
&gt;  
&gt;  ACPI_STATUS
&gt; +acpi_hw_obtain_sleep_type_register_datum (
&gt; +	ACPI_OPERAND_OBJECT     *obj_desc,
&gt; +	u8                      *slp_typ)
&gt; +{
&gt; +	ACPI_STATUS             status = AE_OK;
&gt; +
&gt; +	switch (obj_desc-&gt;common.type) {
&gt; +	case ACPI_TYPE_NUMBER:
&gt; +		*slp_typ = obj_desc-&gt;number.value;
&gt; +		break;
&gt; +
&gt; +	case INTERNAL_TYPE_REFERENCE:
&gt; +		switch(obj_desc-&gt;reference.op_code) {
&gt; +		case AML_ZERO_OP:
&gt; +			*slp_typ = 0;
&gt; +			break;
&gt; +
&gt; +		case AML_ONE_OP:
&gt; +			*slp_typ = 1;
&gt; +			break;
&gt; +
&gt; +		case AML_ONES_OP:
&gt; +			*slp_typ = 0xff;
&gt; +			break;
&gt; +
&gt; +		default:
&gt; +			status = AE_ERROR;
&gt; +		}
&gt; +		break;
&gt; +		
&gt; +	default:
&gt; +		status = AE_ERROR;
&gt; +	}
&gt; +
&gt; +	return status;
&gt; +}
&gt; +
&gt; +
&gt; +ACPI_STATUS
&gt;  acpi_hw_obtain_sleep_type_register_data (
&gt;  	u8                      sleep_state,
&gt;  	u8                      *slp_typ_a,
&gt; @@ -185,28 +225,14 @@
&gt;  		REPORT_ERROR (("Sleep State package does not 
&gt; have at least two elements\n"));
&gt;  		status = AE_ERROR;
&gt;  	}
&gt; -
&gt; -	else if (((obj_desc-&gt;package.elements[0])-&gt;common.type !=
&gt; -			 ACPI_TYPE_NUMBER) ||
&gt; -			 
&gt; ((obj_desc-&gt;package.elements[1])-&gt;common.type !=
&gt; -				ACPI_TYPE_NUMBER))
&gt; -	{
&gt; -		/* Must have two  */
&gt; -
&gt; -		REPORT_ERROR (("Sleep State package elements 
&gt; are not both of type Number\n"));
&gt; -		status = AE_ERROR;
&gt; -	}
&gt; -
&gt; -	else {
&gt; -		/*
&gt; -		 *  Valid _Sx_ package size, type, and value
&gt; -		 */
&gt; -		*slp_typ_a = (u8) 
&gt; (obj_desc-&gt;package.elements[0])-&gt;number.value;
&gt; -
&gt; -		*slp_typ_b = (u8) 
&gt; (obj_desc-&gt;package.elements[1])-&gt;number.value;
&gt; +	else if (ACPI_FAILURE ( (status = 
&gt; acpi_hw_obtain_sleep_type_register_datum 
&gt; (obj_desc-&gt;package.elements[0],
&gt; +								
&gt; 		    slp_typ_a)) )) {
&gt; +		REPORT_ERROR (("First S%d Sleep State package 
&gt; element is not of numerical type\n", sleep_state));
&gt; +	}
&gt; +	else if (ACPI_FAILURE ( (status = 
&gt; acpi_hw_obtain_sleep_type_register_datum 
&gt; (obj_desc-&gt;package.elements[1],
&gt; +								
&gt; 		    slp_typ_b)) )) {
&gt; +		REPORT_ERROR (("Second S%d Sleep State package 
&gt; element is not of numerical type\n", sleep_state));
&gt;  	}
&gt; -
&gt; -
&gt;  
&gt;  	acpi_cm_remove_reference (obj_desc);
&gt;  
&gt; 
&gt; 
&gt; -- 
&gt; dwmw2
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; _______________________________________________
&gt; acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt; http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi
&gt; 

</body></email><email><emailId>20001010152907</emailId><senderName>Dieter =?iso-8859-1?Q?N=FCtzel?=</senderName><senderEmail>dieter.nuetzel@hamburg.de</senderEmail><timestampReceived>2000-10-10 15:29:07-0400</timestampReceived><subject>Re: [Acpi] Source release updated (9-29-2000)</subject><body>

"Grover, Andrew" wrote:

&gt; (different Andy, but...;-)

Hello Intel Andy :-)

Do you know that we are an 'Intel' town, now?
Your company has acquired a chip design firm here in the south of Hamburg,
Germany.

&gt; The 4 sec delay is a feature, not a bug. This is a failsafe so that the
&gt; user, independent of the OS, can still turn off the system.

I know, but it shouldn't shutdown my system immediately.

&gt; If the power button is working, you should see a message on
&gt; /proc/sys/acpi/events way
&gt; before 4 sec.
&gt;
&gt; I don't have an answer for the PPP problem. Could you try commenting out the
&gt; pm_idle = acpi_idle at the very bottom of cpu.c and see if it persists?

It helps. I am currently running with ACPI and PPP!!!

ACPI: support found
ACPI: PBLK 1 @ 0x5010:6
ACPI: C2 supported
ACPI: 1 throttling states
ACPI: PM Timer width: 24 bits
ACPI: S1 supported
ACPI: S5 supported

Serial driver version 5.02 (2000-08-09) with MANY_PORTS SHARE_IRQ SERIAL_PCI
enabled
ttyS00 at 0x03f8 (irq = 4) is a 16550A
ttyS01 at 0x02f8 (irq = 3) is a 16550A
CSLIP: code copyright 1989 Regents of the University of California
PPP generic driver version 2.4.1
PPP BSD Compression module registered
PPP Deflate Compression module registered

But I have much fewer entries in '/proc/sys/acpi' with the interpreter than
without it?

With ACPI interpreter:

SunWave1&gt;cat /proc/sys/acpi/
apic              c3_enter_latency  event             pm_timer
c2_enter_latency  c3_exit_latency   facp              rsdt
c2_exit_latency   dsdt              facs              sleep

Without ACPI it:

SunWave1&gt;cat /proc/sys/acpi/
c1_time         dsdt            event           gpe_level       p_lvl3_lat
s1_slp_typ
c2_time         enter_lvl2_lat  facp            p_blk           pm1_enable
s5_slp_typ
c3_time         enter_lvl3_lat  gpe_enable      p_lvl2_lat      s0_slp_typ
sleep

Thank you very much,
            Dieter

&gt; &gt; My system:
&gt; &gt;
&gt; &gt; AMD Athlon 550
&gt; &gt; MSI MS-6167 Rev. 1.0B (AMD Irongate C4)
&gt; &gt; latest BIOS 1.6 (for Slot A T-Bird)
&gt; &gt;
&gt; &gt; Linux-2.4.0-test9 (final) + Rik van Riel latest fixes

--
!!! Attention - New Email Address !!!

Dieter NÃ¼tzel
Graduate Student, Computer Science

University of Hamburg
Department of Computer Science
Cognitive Systems Group
Vogt-KÃ¶lln-StraÃe 30
D-22527 Hamburg, Germany

email: nuetzel@kogs.informatik.uni-hamburg.de
@home: Dieter.Nuetzel@hamburg.de

</body></email><email><emailId>20001010195604</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-10-10 19:56:04-0400</timestampReceived><subject>RE: [Acpi] Source release updated (9-29-2000)</subject><body>

&gt; -----Original Message-----
&gt; From: Dieter NÃ¼tzel [mailto:Dieter.Nuetzel@hamburg.de]
&gt; &gt; The 4 sec delay is a feature, not a bug. This is a failsafe 
&gt; so that the
&gt; &gt; user, independent of the OS, can still turn off the system.
&gt; 
&gt; I know, but it shouldn't shutdown my system immediately.

Well, it's impossible for the hardware by itself to do an orderly OS
shutdown, obviously. Remember the 4 sec thing is a hardware failsafe only.

&gt; But I have much fewer entries in '/proc/sys/acpi' with the 
&gt; interpreter than
&gt; without it?

This is normal. The "without" case needs more entries because that is how
the out-of-kernel interpreter (in acpid) gets its information.

With the in-kernel interpreter, the interpreter already has the data it
needs, and in this case most of the proc entries are just there as a
convenience for developers to examine or dump the tables the interpreter is
already using, to get the status of events, or tweak parameters.

Regards -- Andy G.

</body></email><email><emailId>20001012225412</emailId><senderName>John-Marc Chandonia</senderName><senderEmail>jmc@cmpharm.ucsf.edu</senderEmail><timestampReceived>2000-10-12 22:54:12-0400</timestampReceived><subject>Re: [Acpi] Source release updated (9-29-2000)</subject><body>

Which test kernel is recommended for use with this release?  I'm
running 2.4.0-test9, and also the Woodhouse patch to the acpi
debug sources.

After a few minutes of use, my X server (dri cvs version, mga card)
locks up completely; upon killing and restarting it, the mouse
(ps/2) doesn't move.

Unless there's any more testing I could do that will help, I'm backing
out to the original acpi directory and sticking to beta testing one
thing at a time!

JMC
-- 
John-Marc Chandonia (jmc@cmpharm.ucsf.edu)              We're everywhere...
Cohen Lab, University of California San Francisco       for your convenience.
http://yuri.harvard.edu/~jmc                                -- Psi Corps &lt;*&gt;

</body></email><email><emailId>20001025210910</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-10-25 21:09:10-0400</timestampReceived><subject>RE: [Acpi] Irq problems + Battery</subject><body>

&gt; From: brendan burns [mailto:bburns@wso.williams.edu]
&gt; Hello,
&gt; I've got ACPI working on my HP Omnibook 2100 but I'm having a problem
&gt; getting my sound card to cooperate with it.  With ACPI 
&gt; enabled the ad1848
&gt; portion of the Crystal Sound card seems to want irq 11 which 
&gt; acpi is also
&gt; sitting on.  Is there anyway to debug why this is happening, 
&gt; or to switch
&gt; acpi to a different irq?

ACPI can't switch to a different irq. However, it can share it. However, irq
sharing only works in linux if all the requesting devices say they can
share, by setting the SA_SHIRQ flag when they do their request_irq.

&lt;looking at ad1848 code&gt;

Nope, it's not setting the shareable flag. (ad1848.c line 1936)

Maybe talk to that driver's maintainer, or just try replacing that '0' with
SA_SHIRQ and see if it locks up ;-)

&gt; Also I wrote a while ago about battery support via ACPI.  
&gt; I've had some
&gt; free time and i read up on the spec and I think i understand 
&gt; how battery
&gt; information should be gathered.  I would be interested in 
&gt; writing the code
&gt; to do it but i've never really done any kernel development 
&gt; before (I've
&gt; done a lot of other development...) if anyone has any pointers to
&gt; resources to get me started I wouldn't mind working on it.

So you've read chapter 11 from the ACPI 2.0 spec? Cool. As you can see, it's
not really that hard -- the CM battery driver just calls a control method
and parses the result. However, the spec also defines Smart Batteries. What
this means is that it probably makes sense to write a battery subsystem
driver, that handles the /proc interface support, and then data from the
control method and smart battery drivers is compiled by the subsystem
driver.

The only other resource I can think of would be the Smart Battery Forum's
site: http://www.sbs-forum.org/specs/index.html 

Regards -- Andy

</body></email><email><emailId>20001028063454</emailId><senderName>"Mahmoud Mohamed"</senderName><senderEmail>demos70@hotmail.com</senderEmail><timestampReceived>2000-10-28 06:34:54-0400</timestampReceived><subject>RE: [Acpi] Enable Failed</subject><body>

Hi,

&gt;
&gt;Please make sure you are running the latest stuff off the website (10/20)

I was.

&gt;and make sure you are using the debug version. Its more verbose error
&gt;reporting would really come in handy here.

I am now this is what I got:

Freeing unused kernel memory: 232k freed
Parsing 
Methods:..............................................................................
78 Control Methods found and parsed (341 nodes total)
ACPI Namespace successfully loaded at root 0xc0392c10
ACPI: support found
evxfevnt-0082: Transition to ACPI mode successful
Executing device _INI methods:........................ ammonad-0284: 
Exec_monadic2_r/Not: bad operand(s) (0x3005)
breakpoint: Fatal error encountered
amdyadic-0207: Exec_dyadic2_r/And: bad operand(s) (0x3005)
breakpoint: Fatal error encountered
  cmeval-0344: _STA on PS2M failed with status AE_AML_OPERAND_TYPE
breakpoint: Fatal error encountered
  nsinit-0136: Ns_initialize_devices: Walk_namespace failed! 3005
breakpoint: Fatal error encountered

24 Devices found: 23 _STA, 0 _INI, 18 _HID, 1 PCIRoot
ACPI: enable failed

So ..wat's goin on here? It'd be nice if anybody can shed up some light here 
I feel so blind.

thanks,
Mahmood




_________________________________________________________________________
Get Your Private, Free E-mail from MSN Hotmail at http://www.hotmail.com.

Share information about yourself, create your own public profile at 
http://profiles.msn.com.

</body></email><email><emailId>20000906061949</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-09-06 06:19:49-0400</timestampReceived><subject>Re: [Acpi] QDI Titanium I is it posible?</subject><body>

On Mon, 4 Sep 2000, Santiago Garcia Mantinan wrote:

&gt; ACPI:         -0061: &lt;7&gt;ACPI: *** Warning: RSDP structure not found
&gt; ACPI: found "Intel Corporation 82371AB PIIX4 ACPI" at 0x4f00
&gt; ACPI: enable failed
&gt; ACPI:         -0550: &lt;7&gt;ACPI: *** Success: Entire namespace and objects deleted

It looks to me as if the ACPI support in the BIOS is broken. Is there a
BIOS update available?

   Simon

-- 
PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

</body></email><email><emailId>20000906115917</emailId><senderName>Guido Trentalancia</senderName><senderEmail>guido.trentalancia@tin.it</senderEmail><timestampReceived>2000-09-06 11:59:17-0400</timestampReceived><subject>[Acpi] ACPI &amp; I4L irq confilct: bug reporting on kernel 2.4.0-test8-pre4</subject><body>

Hi !
This is a bug reporting, included are the output of various /proc file on
my system:
Motherboard: ASUS P2B-F with the latest bios bx2f113.awd (microcode update)
ISDN: Winbond based card (Hisax type=36)
Distribution: based on updated SuSE 6.4

The problem is that if I compile the kernel (2.4.0-test8 pre1,pre2,pre3,pre4)
with both ACPI support and ISDN support there is a conflict in irq 9.
I think ACPI first get irq 9 and then Hisax can't get it. Consequentially
Hisax doesn't work if ACPI support is enabled.
With ACPI turned off, everything works fine as with previous kernel test6
and test5 and ....
Many thanx.
--
bye,
Guido Trentalancia

["kernelbug" (text/plain)]

           CPU0       
  0:     140258          XT-PIC  timer
  1:       4460          XT-PIC  keyboard
  2:          0          XT-PIC  cascade
  5:     425229          XT-PIC  es1371
  9:       9840          XT-PIC  HiSax
 10:      16940          XT-PIC  aic7xxx
 12:      53956          XT-PIC  PS/2 Mouse
 13:          1          XT-PIC  fpu
NMI:          0 
ERR:          0
Character devices:
  1 mem
  2 pty
  3 ttyp
  4 ttyS
  5 cua
  7 vcs
 10 misc
 14 sound
 43 ttyI
 44 cui
 45 isdn
128 ptm
136 pts
162 raw

Block devices:
  8 sd
 65 sd
 66 sd
0000-001f : dma1
0020-003f : pic1
0040-005f : timer
0060-006f : keyboard
0080-008f : dma page reg
00a0-00bf : pic2
00c0-00df : dma2
00f0-00ff : fpu
02f8-02ff : serial(auto)
03c0-03df : vga+
03f8-03ff : serial(auto)
0cf8-0cff : PCI conf1
b000-b01f : Realtek Semiconductor Co., Ltd. RTL-8029(AS)
  b000-b01f : ne2k-pci
b400-b4ff : Adaptec AHA-2940U2/W
  b400-b4fe : aic7xxx
b800-b83f : Ensoniq ES1371 [AudioPCI-97]
  b800-b83f : es1371
d000-d0ff : Dynalink IS64PH ISDN Adapter
  d000-d0ff : TA XXX
d400-d41f : Intel Corporation 82371AB PIIX4 USB
d800-d80f : Intel Corporation 82371AB PIIX4 IDE
e400-e43f : Intel Corporation 82371AB PIIX4 ACPI
e800-e81f : Intel Corporation 82371AB PIIX4 ACPI
Linux version 2.4.0-test8 (root@kleopatra) (gcc version 2.95.2 19991024 (release)) #1 \
Wed Sep 6 13:11:45 CEST 2000 processor	: 0
vendor_id	: GenuineIntel
cpu family	: 6
model		: 8
model name	: Pentium III (Coppermine)
stepping	: 3
cpu MHz		: 701.599904
cache size	: 256 KB
fdiv_bug	: no
hlt_bug		: no
sep_bug		: no
f00f_bug	: no
coma_bug	: no
fpu		: yes
fpu_exception	: yes
cpuid level	: 2
wp		: yes
flags		: fpu vme de pse tsc msr pae mce cx8 sep mtrr pge mca cmov pat pse36 mmx fxsr \
xmm bogomips	: 1399.19

Attached devices: 
Host: scsi0 Channel: 00 Id: 00 Lun: 00
  Vendor: IBM      Model: DNES-309170W     Rev: SA30
  Type:   Direct-Access                    ANSI SCSI revision: 03
Host: scsi0 Channel: 00 Id: 01 Lun: 00
  Vendor: PLEXTOR  Model: CD-ROM PX-32TS   Rev: 1.02
  Type:   CD-ROM                           ANSI SCSI revision: 02
Host: scsi0 Channel: 00 Id: 02 Lun: 00
  Vendor: YAMAHA   Model: CRW8424S         Rev: 1.0j
  Type:   CD-ROM                           ANSI SCSI revision: 02
Host: scsi0 Channel: 00 Id: 03 Lun: 00
  Vendor:          Model: Scanner 636A4    Rev: 1.10
  Type:   Scanner                          ANSI SCSI revision: 02



</body></email><email><emailId>20000906133659</emailId><senderName>Guido Trentalancia</senderName><senderEmail>guido.trentalancia@tin.it</senderEmail><timestampReceived>2000-09-06 13:36:59-0400</timestampReceived><subject>[Acpi] Fwd: ACPI &amp; I4L irq confilct: bug reporting on kernel 2.4.0-test8-pre4</subject><body>

&gt;Hi !
&gt;This is a bug reporting, included are the output of various /proc file on
&gt;my system:
&gt;Motherboard: ASUS P2B-F with the latest bios bx2f113.awd (microcode update)
&gt;ISDN: Winbond based card (Hisax type=36)
&gt;Distribution: based on updated SuSE 6.4

&gt;The problem is that if I compile the kernel (2.4.0-test8 pre1,pre2,pre3,pre4)
&gt;with both ACPI support and ISDN support there is a conflict in irq 9.
&gt;I think ACPI first get irq 9 and then Hisax can't get it. Consequentially
&gt;Hisax doesn't work if ACPI support is enabled.
&gt;With ACPI turned off, everything works fine as with previous kernel test6
&gt;and test5 and ....
&gt;Many thanx.

after further testing the problem seems to be in IRQ SHARING.
in fact, with acpi disabled, once the hisax has got irq 9 (it is not possible 
for card type 36 to change the irq), i can load the ethernet modules
8390 and ne2k-pci for my ethernet PCI NE2000 card, but the ne2k-pci
driver also set its irq=9, so everytime i try to do:

ifconfig eth0 up

i get:

SIOCSIFFLAGS: resource temporarily unavailable

why don't add the irq parameter to the hisax winbond driver and to the
ne2k-pci driver ?

p.s.
my motherboard has pci slot 4 and slot 5 condivided and the isdn card is
on slot 4 while ethernet on slot 5.... so one may say "change your 
motherboard", but everything worked fine with previous kernels (ACPI, Hisax,
ethernet)....

Please help me.
Many thanx.
Please answer only via email: guido.trentalancia@tin.it
--
bye,
Guido Trentalancia
["kernelbug" (text/plain)]

           CPU0       
  0:     140258          XT-PIC  timer
  1:       4460          XT-PIC  keyboard
  2:          0          XT-PIC  cascade
  5:     425229          XT-PIC  es1371
  9:       9840          XT-PIC  HiSax
 10:      16940          XT-PIC  aic7xxx
 12:      53956          XT-PIC  PS/2 Mouse
 13:          1          XT-PIC  fpu
NMI:          0 
ERR:          0
Character devices:
  1 mem
  2 pty
  3 ttyp
  4 ttyS
  5 cua
  7 vcs
 10 misc
 14 sound
 43 ttyI
 44 cui
 45 isdn
128 ptm
136 pts
162 raw

Block devices:
  8 sd
 65 sd
 66 sd
0000-001f : dma1
0020-003f : pic1
0040-005f : timer
0060-006f : keyboard
0080-008f : dma page reg
00a0-00bf : pic2
00c0-00df : dma2
00f0-00ff : fpu
02f8-02ff : serial(auto)
03c0-03df : vga+
03f8-03ff : serial(auto)
0cf8-0cff : PCI conf1
b000-b01f : Realtek Semiconductor Co., Ltd. RTL-8029(AS)
  b000-b01f : ne2k-pci
b400-b4ff : Adaptec AHA-2940U2/W
  b400-b4fe : aic7xxx
b800-b83f : Ensoniq ES1371 [AudioPCI-97]
  b800-b83f : es1371
d000-d0ff : Dynalink IS64PH ISDN Adapter
  d000-d0ff : TA XXX
d400-d41f : Intel Corporation 82371AB PIIX4 USB
d800-d80f : Intel Corporation 82371AB PIIX4 IDE
e400-e43f : Intel Corporation 82371AB PIIX4 ACPI
e800-e81f : Intel Corporation 82371AB PIIX4 ACPI
Linux version 2.4.0-test8 (root@kleopatra) (gcc version 2.95.2 19991024 (release)) #1 \
Wed Sep 6 13:11:45 CEST 2000 processor	: 0
vendor_id	: GenuineIntel
cpu family	: 6
model		: 8
model name	: Pentium III (Coppermine)
stepping	: 3
cpu MHz		: 701.599904
cache size	: 256 KB
fdiv_bug	: no
hlt_bug		: no
sep_bug		: no
f00f_bug	: no
coma_bug	: no
fpu		: yes
fpu_exception	: yes
cpuid level	: 2
wp		: yes
flags		: fpu vme de pse tsc msr pae mce cx8 sep mtrr pge mca cmov pat pse36 mmx fxsr \
xmm bogomips	: 1399.19

Attached devices: 
Host: scsi0 Channel: 00 Id: 00 Lun: 00
  Vendor: IBM      Model: DNES-309170W     Rev: SA30
  Type:   Direct-Access                    ANSI SCSI revision: 03
Host: scsi0 Channel: 00 Id: 01 Lun: 00
  Vendor: PLEXTOR  Model: CD-ROM PX-32TS   Rev: 1.02
  Type:   CD-ROM                           ANSI SCSI revision: 02
Host: scsi0 Channel: 00 Id: 02 Lun: 00
  Vendor: YAMAHA   Model: CRW8424S         Rev: 1.0j
  Type:   CD-ROM                           ANSI SCSI revision: 02
Host: scsi0 Channel: 00 Id: 03 Lun: 00
  Vendor:          Model: Scanner 636A4    Rev: 1.10
  Type:   Scanner                          ANSI SCSI revision: 02



</body></email><email><emailId>20000906142643</emailId><senderName>Werner Cornelius</senderName><senderEmail>cornelius@isdn-development.de</senderEmail><timestampReceived>2000-09-06 14:26:43-0400</timestampReceived><subject>[Acpi] Re: Fwd: ACPI &amp; I4L irq confilct: bug reporting on kernel 2.4.0-test8-pre4</subject><body>


Guido Trentalancia schrieb:

Hello Guido,

&gt; 
&gt; &gt;Hi !
&gt; &gt;This is a bug reporting, included are the output of various /proc file on
&gt; &gt;my system:
&gt; &gt;Motherboard: ASUS P2B-F with the latest bios bx2f113.awd (microcode update)
&gt; &gt;ISDN: Winbond based card (Hisax type=36)
&gt; &gt;Distribution: based on updated SuSE 6.4
&gt; 
&gt; &gt;The problem is that if I compile the kernel (2.4.0-test8 pre1,pre2,pre3,pre4)
&gt; &gt;with both ACPI support and ISDN support there is a conflict in irq 9.
&gt; &gt;I think ACPI first get irq 9 and then Hisax can't get it. Consequentially
&gt; &gt;Hisax doesn't work if ACPI support is enabled.
&gt; &gt;With ACPI turned off, everything works fine as with previous kernel test6
&gt; &gt;and test5 and ....
&gt; &gt;Many thanx.
&gt; 
&gt; after further testing the problem seems to be in IRQ SHARING.
&gt; in fact, with acpi disabled, once the hisax has got irq 9 (it is not possible
&gt; for card type 36 to change the irq), i can load the ethernet modules
&gt; 8390 and ne2k-pci for my ethernet PCI NE2000 card, but the ne2k-pci
&gt; driver also set its irq=9, so everytime i try to do:
&gt; 
&gt; ifconfig eth0 up
&gt; 
&gt; i get:
&gt; 
&gt; SIOCSIFFLAGS: resource temporarily unavailable
&gt; 
&gt; why don't add the irq parameter to the hisax winbond driver and to the
&gt; ne2k-pci driver ?


there is no need or even sense to add such parameter, as irqs are
assigned by the bios or OS for PCI type cards. The driver is supplied
with the selected irq which is normally assigned during boot by the
systems bios.
You should change the bios PCI/Pnp setup to reflect your needs.
I don't know if the Winbond driver supports IRQ-sharing, but other i4l
drivers like the HFC-PCI which I maintain allow irq sharing without any
problems even if 3 cards share it.
So please setup your bios correctly and everything will work fine.

&gt; 
&gt; p.s.
&gt; my motherboard has pci slot 4 and slot 5 condivided and the isdn card is
&gt; on slot 4 while ethernet on slot 5.... so one may say "change your
&gt; motherboard", but everything worked fine with previous kernels (ACPI, Hisax,
&gt; ethernet)....
&gt; 
&gt; Please help me.
&gt; Many thanx.
&gt; Please answer only via email: guido.trentalancia@tin.it
&gt; --
&gt; bye,
&gt; Guido Trentalancia
&gt; 

Werner

</body></email><email><emailId>20000908185537</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-09-08 18:55:37-0400</timestampReceived><subject>[Acpi] ACPI for Linux</subject><body>

Hello all,

The ACPI Component Architecture has continued to evolve - undergoing
extensive changes and enhancements since its first inclusion in the
2.4.0.test3 kernel. There are too many changes to list them here (please see
the changelog). The focus of our efforts in recent months has been on
completion, robustness, and performance. We have also been working on
motherboard device configuration related development (initialization) rather
than on power management policy implementation, which we will be returning
to within the next few months. We are now periodically posting the latest
ACPI CA Linux targeted release packages on Intel's developer website at
http://developer.intel.com/technology/iapc/acpi. The Linux packages include
ACPI CA debug versions and tools that will aid in development. We anticipate
releasing a package containing an updated initialization sequence soon. 

Regards -- Andy

----------------------------
Andrew Grover
Intel/TRL/MAL
andrew.grover@intel.com

</body></email><email><emailId>20000910221235</emailId><senderName>Sean Furey</senderName><senderEmail>sean@furey.freeserve.co.uk</senderEmail><timestampReceived>2000-09-10 22:12:35-0400</timestampReceived><subject>[Acpi] Power-off with Chaintech CT-5AGM2 Motherboard</subject><body>

Hi Everyone!

I've just recently decided to have a look at 2.4.0-test7/8 and was
fairly impressed that when I hit my power button it now begins to shut
down. (small things like that make me happy :)

The one thing it doesn't do however is to power it down at the end.
In the past I powered down with APM, but I know that my machine can be
powered off by ACPI because I tried it a long time ago with 2.2.x
(maybe you remember my 2.2.14 patch).

At a guess I think that there must be a problem with my ACPI tables in
the BIOS, as the 2.2.x version didn't have an interpreter and so (I
believe) pretty much ignored these.  Also, when I boot up it says
"ACPI: S1 supported", but not "ACPI: S5 supported".

Is there any kludge I can use to make it ignore the fact that the
tables are messed up?  I don't think it should really go into the
"real" kernel source, but I'd appreciate it if someone told me so that
I could do it to my own sources.

Oh, my board is a Chaintech CT-5AGM2 with a fairly up to date bios.

thanks
-- 
Sean Furey, a happy and satisfied Debian user.
sean@furey.freeserve.co.uk

</body></email><email><emailId>20000910225556</emailId><senderName>Qing Liu</senderName><senderEmail>liu@math.u-bordeaux.fr</senderEmail><timestampReceived>2000-09-10 22:55:56-0400</timestampReceived><subject>[Acpi] subscrib</subject><body>

 

</body></email><email><emailId>20000911160011</emailId><senderName>Dieter =?iso-8859-1?Q?N=FCtzel?=</senderName><senderEmail>dieter.nuetzel@hamburg.de</senderEmail><timestampReceived>2000-09-11 16:00:11-0400</timestampReceived><subject>[Acpi] test8 &amp; interpreter on Irongate C4 (MS-6167 Rev. 1.0B)</subject><body>

Hello,

I think the 'new' interpreter code (Linux 2.4.0-test8) do not work for
my MSI MS-6167 Rev. 1.0B AMD Athlon/Irongate C4 mobo.

Linux version 2.4.0-test8 (root@SunWave1) (gcc version 2.95.2 19991024
(release)) #1 Sat Sep 9 05:12:13 CEST 2000
BIOS-provided physical RAM map:
 BIOS-e820: 000000000009fc00 @ 0000000000000000 (usable)
 BIOS-e820: 0000000000000400 @ 000000000009fc00 (reserved)
 BIOS-e820: 0000000000010000 @ 00000000000f0000 (reserved)
 BIOS-e820: 0000000000010000 @ 00000000ffff0000 (reserved)
 BIOS-e820: 000000000fef0000 @ 0000000000100000 (usable)
 BIOS-e820: 000000000000d000 @ 000000000fff3000 (ACPI data)
 BIOS-e820: 0000000000003000 @ 000000000fff0000 (ACPI NVS)
Scan SMP from c0000000 for 1024 bytes.
Scan SMP from c009fc00 for 1024 bytes.
Scan SMP from c00f0000 for 65536 bytes.
Scan SMP from c009f800 for 4096 bytes.
On node 0 totalpages: 65520
zone(0): 4096 pages.
zone(1): 61424 pages.
zone(2): 0 pages.
mapped APIC to ffffe000 (01404000)

[snip]

ACPI: support found
ACPI: PBLK 1 @ 0x5010:6
ACPI: C2 supported
ACPI: 1 throttling states
ACPI:         -0176: &lt;7&gt;ACPI: *** Error: Object type returned from
interpreter differs from expected value
ACPI:         -0176: &lt;7&gt;ACPI: *** Error: Object type returned from
interpreter differs from expected value
ACPI: S1 supported
ACPI C2 works

SunWave1&gt;cat /proc/sys/acpi/
c2_enter_latency  c3_enter_latency  event
c2_exit_latency   c3_exit_latency   sleep
SunWave1&gt;cat /proc/sys/acpi/*
0x00003210
0x0000005a
0x00003eee
0x00000c96

Only one throttling state???


Without the interpreter I get the following and most ACPI (power button
sleep, halt with power off, etc...) works.

SunWave1&gt;cat /proc/sys/acpi/
c1_time         enter_lvl2_lat  gpe_enable      p_lvl3_lat
s5_slp_typ
c2_time         enter_lvl3_lat  gpe_level       pm1_enable      sleep
c3_time         event           p_blk           s0_slp_typ
dsdt            facp            p_lvl2_lat      s1_slp_typ

SunWave1&gt;cat /proc/sys/acpi/s5_slp_typ
0x00000001


Under Win98 SE all (???) ACPI works inclusive SUSPEND to disk...
Latest BIOS 1.6 beta 7 installed.

Thanks,
    Dieter

--
!!! Attention - New Email Address !!!

Dieter N=FCtzel
Graduate Student, Computer Science

University of Hamburg
Department of Computer Science
Cognitive Systems Group
Vogt-K=F6lln-Stra=DFe 30
D-22527 Hamburg, Germany

email: nuetzel@kogs.informatik.uni-hamburg.de
@home: Dieter.Nuetzel@hamburg.de

</body></email><email><emailId>20000911234644</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-09-11 23:46:44-0400</timestampReceived><subject>RE: [Acpi] what can ACPI do for me?</subject><body>

On Mon, 11 Sep 2000, Grover, Andrew wrote:

&gt; A bad/good BIOS list would also be cool, similar to SCSI and IDE
&gt; modules.

Well, the current BIOS list already comes from a database, although the
code used to generate the HTML is write-only code (so it has to be rebuilt
from the ground up). What would be needed:

 - A tool that can be run by an unexperienced user to check his system,
    with a "Submit" button
 - Some handler to accept the submitted data
 - A cgi to display this data on the web pages

Number one is something for the experts: Most users will want to run this
on their current system to check whether they should upgrade. The good
thing: On many 2.2 systems, ACPI reclaim memory is never reclaimed, so it
should be possible to find the tables in memory. TODO:
 - Search the memory for the tables
    Problem: The memory is not available to userspace. You will have to
    insert a kernel module that briefly adds the memory to the list of
    accessible pages, does the search and removes the memory again.
 - Send the data to userspace
 - Do a set of validity checks
 - Offer to send subsets of the data back here for inclusion in the
   database
    Question: What subsets? Is there a possible problem (read: privacy or
     copyright) if we send too much data?

There is some code from Max's early experiments which does the first part,
however for older 2.2 and 2.0 kernels which didn't have e820 support and
thus mapped the tables like normal memory AFAIK.

Numbers two and three are easy if you've ever used perl and DBI. :-)

   Simon

-- 
PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

</body></email><email><emailId>20000913170027</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-09-13 17:00:27-0400</timestampReceived><subject>[Acpi] [PATCH] ACPI interpreter makefile fix (fwd)</subject><body>


&gt;From the lkml.

---------- Forwarded message ----------
Date: Wed, 13 Sep 2000 16:58:33 +0400 (MSD)
From: Andrey Panin &lt;pazke@orbita1.ru&gt;
Subject: [PATCH] ACPI interpreter makefile fix


Hi all,

I recently returned from Sea Launch homeport and already made a new patch :))

This patch fixes bothering problem with ACPI interpreter Makefile.

Without this patch ACPI interpreter will unconditionaly recompiled 
every kernel build.

Hope it will be usefull.

Best wishes,
		Andrey

["patch-acpimake-2.4.0-test8.gz" (APPLICATION/OCTET-STREAM)]

</body></email><email><emailId>20000913172142</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-09-13 17:21:42-0400</timestampReceived><subject>[Acpi] RE: [PATCH] ACPI interpreter makefile fix</subject><body>

Hi Andrey,

It's cool to see this getting some attention.

Just so you know, it looks like you may have accidentally also included some
other code changes in the patch.

Regards -- Andy

-----Original Message-----
From: Andrey Panin [mailto:pazke@orbita1.ru]
Sent: Wednesday, September 13, 2000 5:59 AM
To: linux-kernel@vger.kernel.org
Subject: [PATCH] ACPI interpreter makefile fix



Hi all,

I recently returned from Sea Launch homeport and already made a new patch
:))

This patch fixes bothering problem with ACPI interpreter Makefile.

Without this patch ACPI interpreter will unconditionaly recompiled 
every kernel build.

Hope it will be usefull.

Best wishes,
		Andrey

</body></email><email><emailId>20000916001347</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-09-16 00:13:47-0400</timestampReceived><subject>RE: [Acpi] shutting off power supply?</subject><body>

APM and ACPI can not coexist.

Currently Linux ACPI has experimental support for S1 (the lightest sleeping
state), which, at least on my machine, leaves the PS on. S3 support does
turn the PS off, but most desktop mobos don't support this, and neither does
the code yet, and both these things have to happen for S3 support.

Regards -- Andy


-----Original Message-----
From: Krzys Majewski [mailto:majewski@cs.ubc.ca]
Sent: Friday, September 15, 2000 3:46 PM
To: acpi@phobos.fachschaften.tu-muenchen.de
Subject: [Acpi] shutting off power supply?


Anybody know if  the latest acpi code supports  shutting down the power
supply (or putting it some kind of "low power" mode) on suspend?
So far I've got  APM to do everything I wanted in  the way of suspend,
except the power supply fan is still on and it's pretty annoying. 
Jamming  the P/S  fan with a  pen works (the  machine becomes
completely silent!) but the P/S gets pretty hot after a while..
My motherboard manufacturer tells me APM will not power down the P/S on
suspend, so I guess I really need ACPI. Another question: if the linux
ACPI drivers  _do_ support  this feature, can  I install  them without
sacrificing all the gains I've  made with APM? In otherwords, can ACPI
and APM coexist?  
Thanks,
chris



_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000916161414</emailId><senderName>"Tomasz Torcz, BG"</senderName><senderEmail>zdzichu@irc.pl</senderEmail><timestampReceived>2000-09-16 16:14:14-0400</timestampReceived><subject>[Acpi] how to help?</subject><body>

acpi-admin@phobos.fachschaften.tu-muenchen.de wrote:
Hi,

I'm interested in helping development of ACPI4Linux. I'm not a coder and
can't
send my motherboard as a donation, but I will run any software for
dumping tables
or gaining more info/testing. 
As far as I understand the FAQ,
&lt;-0176&gt;: &lt;7&gt;ACPI: Error...
means that mobo isn't known to acpi. I have Matsonic MS7132A (VIA Apollo
Pro133).
How could I provide details to make it supported?
-- 
Tomasz Torcz
zdzichu@irc.pl
"God, root, what's the difference..."

</body></email><email><emailId>20000918152938</emailId><senderName>Rene Goerlich</senderName><senderEmail>goerlich@tfh-berlin.de</senderEmail><timestampReceived>2000-09-18 15:29:38-0400</timestampReceived><subject>[Acpi] Power available?</subject><body>

Dear ACPI experts,

I'm having problems with the sound IC of my IPC Topnote G notebook.
This notebook consequently uses ACPI, the I/O superchip's power is
switched off until initialization: I had to flash an old BIOS to
get access to the ports.

In principal, my sound chip is working, with ALSA as well as with
the kernel sound driver. All devices, mixer and tools are working.
I can hear something - but very faint, and only with earphones.

So my question is: could someone please interpret the following
status, does the D0 state indicate that the audio AC part has power?

# lspci -vv -d1102:*
00:04.0 Multimedia audio controller: Creative Labs: Unknown device 8938
        Subsystem: Creative Labs: Unknown device 8938
        Control: I/O+ Mem- BusMaster+ SpecCycle- MemWINV- VGASnoop- 
                ParErr- Stepping- SERR- FastB2B-
        Status: Cap+ 66Mhz- UDF- FastB2B- ParErr- DEVSEL=slow &gt;TAbort- 
                &lt;TAbort- &lt;MAbort- &gt;SERR- &lt;PERR-
        Latency: 12 min, 128 max, 96 set
        Interrupt: pin A routed to IRQ 5
        Region 0: I/O ports at fcc0 [size=64]
        Region 1: I/O ports at fca0 [size=32]
        Capabilities: [dc] Power Management version 1
                Flags: PMEClk- AuxPwr+ DSI+ D1+ D2+ PME+
                Status: D0 PME-Enable- DSel=0 DScale=0 PME+

If not, what could I do to switch the power line on?

TIA,
Rene'

</body></email><email><emailId>20000918194203</emailId><senderName>David Fries</senderName><senderEmail>dfries@umr.edu</senderEmail><timestampReceived>2000-09-18 19:42:03-0400</timestampReceived><subject>[Acpi] turning on and off the display</subject><body>

I have a Toshiba Portege 3015CT laptop and the screen turns off after
30 minutes of not typing or moving the built in mouse.  (The USB
mouse doesn't count).

Is acpi up to being able to tell the display not to shut off?  That
and it would be nice for me to tell it to shut off now, but being able
to tell it not to shut off would be good enough for me for now.

The screen has the backlit display and the actual updating the lcd
screen elements that can be turn off.

-- 
		+---------------------------------+
		|      David Fries                |
		|      dfries@umr.edu             |
		+---------------------------------+

</body></email><email><emailId>20000920163603</emailId><senderName>Simon Richter</senderName><senderEmail>simon.richter@phobos.fs.tum.de</senderEmail><timestampReceived>2000-09-20 16:36:03-0400</timestampReceived><subject>[Acpi] More phobos downtime</subject><body>

Hi,

We're having some trouble with the new network card currently, which led
to some downtime today. ATM everything seems to be running (with the old
board), but I still want to get the new card to work, so I may have to
reboot a few more times. The plan is to use a different kernel version
than 2.2.17 now.

Also, there will be another power shutdown in the uni on October 1st,
we've been told (but no exact time or list of affected buildings for now).

I hope the system will be stable again after that. I'm keeping four
backups of everything and we have two backup MXes (which will AFAIK be
generator powered on October 1st), so no data gets lost and mail will
still be accepted.

   Simon

-- 
PGP public key available from http://phobos.fs.tum.de/pgp/Simon.Richter.asc
 Fingerprint: 10 62 F6 F5 C0 5D 9E D8  47 05 1B 8A 22 E5 4E C1
Hi! I'm a .signature virus! Copy me into your ~/.signature to help me spread!

</body></email><email><emailId>20000927184811</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-09-27 18:48:11-0400</timestampReceived><subject>[Acpi] RE: [KBUILD] kbuild changes coming in 2.5.x?</subject><body>

(CC-ing acpi-linux)

I think acpi's use of module_init etc. was based on APM's similar use of it,
but I'm not sure. Andy H?

Right now, nothing can be modularized. It's broken into separate directories
simply because it is big. We will have drivers (EC, battery, others) that
use the interpreter that will be modularizable, but those aren't fleshed out
yet.

I prefer having directories, but would eliminating them solve its current
linking and dependency issues? Or could mkdep.c be enhanced to handle this?
(Just brainstorming here ;-)

Regards -- Andy


-----Original Message-----
From: Peter Samuelson [mailto:peter@cadcamlab.org]

[Andrew Grover &lt;andrew.grover@intel.com&gt;]
&gt; I'm specifically interested in the acpi driver. There's a fix in
&gt; test9-preX so that it doesn't compile all the time, but it still
&gt; *links* all the time, and that was as good as I could get it.

I'm confused here.  Can acpi be modularized?  I ask because according
to arch/i386/config.in it cannot -- yet you have module_init()
functions in arch/i386/kernel/acpi.c and drivers/acpi/driver.c.

Can you post a coherent description of which files/directories can be
built into which modules and what must actually go in the kernel?  Can
it *all* be modularized?  Can just the interpreter?  What?

&gt; do you all think there's a solution under the current build system,
&gt; or will there be, or what? ;-)

We'll see.  I imagine it won't be too tough, but then that's what I
always say.

Peter

</body></email><email><emailId>20000909201928</emailId><senderName>Krzys Majewski</senderName><senderEmail>krzys@cs.mcgill.ca</senderEmail><timestampReceived>2000-09-09 20:19:28-0400</timestampReceived><subject>[Acpi] what can ACPI do for me?</subject><body>

I have  a desktop machine running  linux in my  apartment. 
I'm looking into ACPI with the goal of eventually making this machine
suspend-to-RAM or suspend-to-disk. I realize that some or all of this
functionality  may  not  be   available  in  the  current  linux  ACPI
implementation.  How  long  should   I  expect  to  wait  before  this
functionality is available?  In the meantime, what can  ACPI do for me
today? In particular, what can ACPI do that APM can't? -chris

</body></email><email><emailId>20000915224539</emailId><senderName>Krzys Majewski</senderName><senderEmail>majewski@cs.ubc.ca</senderEmail><timestampReceived>2000-09-15 22:45:39-0400</timestampReceived><subject>[Acpi] shutting off power supply?</subject><body>

Anybody know if  the latest acpi code supports  shutting down the power
supply (or putting it some kind of "low power" mode) on suspend?
So far I've got  APM to do everything I wanted in  the way of suspend,
except the power supply fan is still on and it's pretty annoying. 
Jamming  the P/S  fan with a  pen works (the  machine becomes
completely silent!) but the P/S gets pretty hot after a while..
My motherboard manufacturer tells me APM will not power down the P/S on
suspend, so I guess I really need ACPI. Another question: if the linux
ACPI drivers  _do_ support  this feature, can  I install  them without
sacrificing all the gains I've  made with APM? In otherwords, can ACPI
and APM coexist?  
Thanks,
chris

</body></email><email><emailId>20000909230635</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-09-09 23:06:35-0400</timestampReceived><subject>RE: [Acpi] what can ACPI do for me?</subject><body>

Chris,

Well, those features are on the top of everyone's want list, but we're still
working on infrastructure. The ACPI interpreter is complex. It replaces not
only APM, but also PNPBIOS and the MPS (multiprocessor spec). Also, all the
drivers may need to be modified to save information on suspend. 

As for the eventual benefits of ACPI over APM - lower battery consumption
due to smarter power management policies, more reliability and
configurability. The commonly used example on Windows for OS power
management is that presentation apps can specify that the screen not blank.
This was impossible under APM. My personal favorite is being able to
configure the lid and power buttons to do different things.

That's what we're working towards...;-)

-- Andy


-----Original Message-----
From: Krzys Majewski [mailto:krzys@cs.mcgill.ca]
Sent: Saturday, September 09, 2000 1:19 PM
To: acpi@phobos.fachschaften.tu-muenchen.de
Subject: [Acpi] what can ACPI do for me?


I have  a desktop machine running  linux in my  apartment. 
I'm looking into ACPI with the goal of eventually making this machine
suspend-to-RAM or suspend-to-disk. I realize that some or all of this
functionality  may  not  be   available  in  the  current  linux  ACPI
implementation.  How  long  should   I  expect  to  wait  before  this
functionality is available?  In the meantime, what can  ACPI do for me
today? In particular, what can ACPI do that APM can't? -chris





_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000910000850</emailId><senderName>Ceache</senderName><senderEmail>ceache@club-internet.fr</senderEmail><timestampReceived>2000-09-10 00:08:50-0400</timestampReceived><subject>RE: [Acpi] what can ACPI do for me?</subject><body>

I was just interested in ACPI because of my laptop. But the more I look at 
it, the more I get interested... ;)
Is there any kind of TODO list ? What is the state of developement of 
ACPI4Linux and where can I find informations about how to contribute ?

Ceache

  16:06 09/09/2000 -0700, you wrote:
&gt;Chris,
&gt;
&gt;Well, those features are on the top of everyone's want list, but we're still
&gt;working on infrastructure. The ACPI interpreter is complex. It replaces not
&gt;only APM, but also PNPBIOS and the MPS (multiprocessor spec). Also, all the
&gt;drivers may need to be modified to save information on suspend.
&gt;
&gt;As for the eventual benefits of ACPI over APM - lower battery consumption
&gt;due to smarter power management policies, more reliability and
&gt;configurability. The commonly used example on Windows for OS power
&gt;management is that presentation apps can specify that the screen not blank.
&gt;This was impossible under APM. My personal favorite is being able to
&gt;configure the lid and power buttons to do different things.
&gt;
&gt;That's what we're working towards...;-)
&gt;
&gt;-- Andy
&gt;
&gt;
&gt;-----Original Message-----
&gt;From: Krzys Majewski [mailto:krzys@cs.mcgill.ca]
&gt;Sent: Saturday, September 09, 2000 1:19 PM
&gt;To: acpi@phobos.fachschaften.tu-muenchen.de
&gt;Subject: [Acpi] what can ACPI do for me?
&gt;
&gt;
&gt;I have  a desktop machine running  linux in my  apartment.
&gt;I'm looking into ACPI with the goal of eventually making this machine
&gt;suspend-to-RAM or suspend-to-disk. I realize that some or all of this
&gt;functionality  may  not  be   available  in  the  current  linux  ACPI
&gt;implementation.  How  long  should   I  expect  to  wait  before  this
&gt;functionality is available?  In the meantime, what can  ACPI do for me
&gt;today? In particular, what can ACPI do that APM can't? -chris
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;_______________________________________________
&gt;acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt;http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000911204042</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-09-11 20:40:42-0400</timestampReceived><subject>RE: [Acpi] what can ACPI do for me?</subject><body>

Ceache,

Glad to hear you're interested! ;-)

Like I said, a lot of functionality is waiting for the interpreter to
stabilize. So, any testing of it on various machines helps that. Also, there
are a things not dependent on this that would be great for you (or anyone
else) to help with. The big one is adding power management support to all
the drivers. Some of them have had this added (e100b, keyb, mouse, more?)
but suspend support requires ALL of them have it added. I think there's a
doc in the kernel source that talks about how to do this. A bad/good BIOS
list would also be cool, similar to SCSI and IDE modules.

Check out http://phobos.fs.tum.de/acpi/ and
http://developer.intel.com/technology/iapc/acpi, if you haven't already.

Regards -- Andy


-----Original Message-----
From: Ceache [mailto:ceache@club-internet.fr]
Sent: Saturday, September 09, 2000 5:09 PM
To: acpi@phobos.fachschaften.tu-muenchen.de
Subject: RE: [Acpi] what can ACPI do for me?


I was just interested in ACPI because of my laptop. But the more I look at 
it, the more I get interested... ;)
Is there any kind of TODO list ? What is the state of developement of 
ACPI4Linux and where can I find informations about how to contribute ?

Ceache

  16:06 09/09/2000 -0700, you wrote:
&gt;Chris,
&gt;
&gt;Well, those features are on the top of everyone's want list, but we're
still
&gt;working on infrastructure. The ACPI interpreter is complex. It replaces not
&gt;only APM, but also PNPBIOS and the MPS (multiprocessor spec). Also, all the
&gt;drivers may need to be modified to save information on suspend.
&gt;
&gt;As for the eventual benefits of ACPI over APM - lower battery consumption
&gt;due to smarter power management policies, more reliability and
&gt;configurability. The commonly used example on Windows for OS power
&gt;management is that presentation apps can specify that the screen not blank.
&gt;This was impossible under APM. My personal favorite is being able to
&gt;configure the lid and power buttons to do different things.
&gt;
&gt;That's what we're working towards...;-)
&gt;
&gt;-- Andy
&gt;
&gt;
&gt;-----Original Message-----
&gt;From: Krzys Majewski [mailto:krzys@cs.mcgill.ca]
&gt;Sent: Saturday, September 09, 2000 1:19 PM
&gt;To: acpi@phobos.fachschaften.tu-muenchen.de
&gt;Subject: [Acpi] what can ACPI do for me?
&gt;
&gt;
&gt;I have  a desktop machine running  linux in my  apartment.
&gt;I'm looking into ACPI with the goal of eventually making this machine
&gt;suspend-to-RAM or suspend-to-disk. I realize that some or all of this
&gt;functionality  may  not  be   available  in  the  current  linux  ACPI
&gt;implementation.  How  long  should   I  expect  to  wait  before  this
&gt;functionality is available?  In the meantime, what can  ACPI do for me
&gt;today? In particular, what can ACPI do that APM can't? -chris
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;_______________________________________________
&gt;acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
&gt;http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi



_______________________________________________
acpi maillist  -  acpi@phobos.fachschaften.tu-muenchen.de
http://phobos.fachschaften.tu-muenchen.de/mailman/listinfo/acpi

</body></email><email><emailId>20000928154459</emailId><senderName>Peter Samuelson</senderName><senderEmail>peter@cadcamlab.org</senderEmail><timestampReceived>2000-09-28 15:44:59-0400</timestampReceived><subject>[Acpi] RE: kbuild changes coming in 2.5.x?</subject><body>

[Andrew Grover &lt;andrew.grover@intel.com&gt;]
&gt; I think acpi's use of module_init etc. was based on APM's similar use
&gt; of it, but I'm not sure. Andy H?

&gt; Right now, nothing can be modularized.

OK, that's what I needed to know.  #include &lt;linux/module.h&gt; and so
forth is what was confusing me, but I realize these things are quite
valid for in-kernel-only code.

&gt; I prefer having directories, but would eliminating them solve its
&gt; current linking and dependency issues? Or could mkdep.c be enhanced
&gt; to handle this?  (Just brainstorming here ;-)

Separate directories shouldn't be a problem.  I'm currently thinking
about this issue.  One problem I think I've found is in
drivers/Makefile:

  ifeq ($(CONFIG_ACPI),y)
  SUB_DIRS += acpi
  MOD_SUB_DIRS += acpi
  endif

(1) This should be $(CONFIG_ACPI_INTERPRETER) not $(CONFIG_ACPI).
(2) The MOD_SUB_DIRS is not needed (but mostly harmless and makes it
    easier to modularize parts later).

I'm still looking at drivers/acpi/* for other make issues (haven't had
too much time lately).

Peter

</body></email><email><emailId>20000929010751</emailId><senderName>"Grover, Andrew"</senderName><senderEmail>andrew.grover@intel.com</senderEmail><timestampReceived>2000-09-29 01:07:51-0400</timestampReceived><subject>RE: [Acpi] Shut down problem</subject><body>

Jack,
 
I'm thinking that msg is coming from this code, at drivers/acpi/sys.c line
90:
 
if (ctx-&gt;state != ACPI_S1) {
  printk(KERN_ERR "ACPI: S%d failed\n", ctx-&gt;state);
  goto out;
 }
 
This code appears to always print that message when not going into S1. This
is obviously wrong, and not a BIOS problem on your end. I'd bet this code
gets fixed soon ;-)
 
Regards -- Andy
 
 
-----Original Message-----
From: Chen, Jack-TAO [mailto:Chen.Jack-Tao@inventec.com]
Sent: Wednesday, September 27, 2000 5:52 AM
To: 'Grover, Andrew'
Subject: RE: [Acpi] Shut down problem


Dear Andy:
I would like to know what case will cause this fail. Or you can provide the
source to me.
 
 
Regards--------Jack

-----Original Message-----
From: Grover, Andrew 
Sent: Thursday, September 21, 2000 1:02 AM
To: 'Chen, Jack-TAO (???)'; 'acpi@phobos.fs.tum.de'
Subject: RE: [Acpi] Shut down problem


Hi Jack,
 
This is an issue with the code, not your BIOS. That line appears to be
extraneous, and we can probably just remove it. ;-)
 
Regards -- Andy
 
-----Original Message-----
From: Chen.Jack-Tao@inventec.com [mailto:Chen.Jack-Tao@inventec.com]
Sent: Wednesday, September 20, 2000 3:39 AM
To: 'acpi@phobos.fs.tum.de'
Subject: [Acpi] Shut down problem




 Dear sir: 
 I use kernel 2.4.0, and it can find my ACPI table. 
 It says support S1,..S5. 
 When I want to shutdown my system. 
 I use the command  "init 0" 
 It will shutdown all drivers. Final it display "ACPI: S5 fail". 
 But it still can power off the system. 
 I would like to know what situation the kernel will display "S5 fail". 
 Then I can modify my BIOS code to fix this error. 

                                                               thanks 


[Attachment #3 (text/html)]

&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"&gt;
&lt;HTML&gt;&lt;HEAD&gt;
&lt;META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1"&gt;
&lt;TITLE&gt;Shut down problem&lt;/TITLE&gt;

&lt;META content="MSHTML 5.00.3103.1000" name=GENERATOR&gt;&lt;/HEAD&gt;
&lt;BODY&gt;
&lt;DIV&gt;&lt;FONT color=#0000ff face=Arial size=2&gt;&lt;SPAN 
class=847170001-29092000&gt;Jack,&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT color=#0000ff face=Arial size=2&gt;&lt;SPAN 
class=847170001-29092000&gt;&lt;/SPAN&gt;&lt;/FONT&gt;Â &lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT color=#0000ff face=Arial size=2&gt;&lt;SPAN class=847170001-29092000&gt;I'm 
thinking that msg is coming from this code, at drivers/acpi/sys.c line 
90:&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT color=#0000ff face=Arial size=2&gt;&lt;SPAN 
class=847170001-29092000&gt;&lt;/SPAN&gt;&lt;/FONT&gt;Â &lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT color=#0000ff face="Courier New" size=2&gt;&lt;SPAN 
class=847170001-29092000&gt;if (ctx-&gt;state != ACPI_S1) 
{&lt;BR&gt;Â Â printk(KERN_ERR "ACPI: S%d failed\n", 
ctx-&gt;state);&lt;BR&gt;Â Â goto out;&lt;BR&gt;Â }&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT color=#0000ff face="Courier New" size=2&gt;&lt;SPAN 
class=847170001-29092000&gt;&lt;/SPAN&gt;&lt;/FONT&gt;Â &lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT color=#0000ff face="Courier New" size=2&gt;&lt;SPAN 
class=847170001-29092000&gt;This code appears to always print that message when not 
going into S1. This is obviously wrong, and not a BIOS problem on your end. I'd 
bet this code gets fixed soon ;-)&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT color=#0000ff face="Courier New" size=2&gt;&lt;SPAN 
class=847170001-29092000&gt;&lt;/SPAN&gt;&lt;/FONT&gt;Â &lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT color=#0000ff face="Courier New" size=2&gt;&lt;SPAN 
class=847170001-29092000&gt;Regards -- Andy&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT color=#0000ff face=Arial size=2&gt;&lt;SPAN 
class=847170001-29092000&gt;&lt;/SPAN&gt;&lt;/FONT&gt;Â &lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT color=#0000ff face=Arial size=2&gt;&lt;SPAN 
class=847170001-29092000&gt;&lt;/SPAN&gt;&lt;/FONT&gt;Â &lt;/DIV&gt;
&lt;DIV align=left class=OutlookMessageHeader dir=ltr&gt;&lt;FONT face=Tahoma 
size=2&gt;-----Original Message-----&lt;BR&gt;&lt;B&gt;From:&lt;/B&gt; Chen, Jack-TAO 
[mailto:Chen.Jack-Tao@inventec.com]&lt;BR&gt;&lt;B&gt;Sent:&lt;/B&gt; Wednesday, September 27, 
2000 5:52 AM&lt;BR&gt;&lt;B&gt;To:&lt;/B&gt; 'Grover, Andrew'&lt;BR&gt;&lt;B&gt;Subject:&lt;/B&gt; RE: [Acpi] Shut 
down problem&lt;BR&gt;&lt;BR&gt;&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT color=#0000ff face=æ°ç´°æé« size=2&gt;&lt;SPAN \
class=790055112-27092000&gt;Dear  Andy:&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT color=#0000ff face=æ°ç´°æé« size=2&gt;&lt;SPAN \
class=790055112-27092000&gt;I would  like to know what case will cause this fail. Or you \
can provide the source to  me.&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT color=#0000ff face=æ°ç´°æé« size=2&gt;&lt;SPAN 
class=790055112-27092000&gt;&lt;/SPAN&gt;&lt;/FONT&gt;Â &lt;/DIV&gt;
&lt;DIV&gt;&lt;FONT color=#0000ff face=æ°ç´°æé« size=2&gt;&lt;SPAN 
class=790055112-27092000&gt;Â Â Â Â Â Â Â Â Â Â &amp; \
nbsp;Â Â Â Â Â Â Â Â Â Â Â Â Â &amp;nb \
sp;Â Â Â Â Â Â Â Â Â Â Â Â Â Â  \
;Â Â Â Â Â Â Â Â Â Â Â Â Â Â &amp; \
nbsp;Â Â Â Â Â Â Â Â Â Â Â Â Â &amp;nb \
sp;Â Â Â Â Â Â Â Â Â Â Â Â Â Â  \
;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  \
 Regards--------Jack&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;
&lt;BLOCKQUOTE style="MARGIN-RIGHT: 0px"&gt;
  &lt;DIV class=OutlookMessageHeader&gt;&lt;FONT face="Times New Roman" 
  size=2&gt;-----Original Message-----&lt;BR&gt;&lt;B&gt;From:&lt;/B&gt; Grover, Andrew 
  &lt;BR&gt;&lt;B&gt;Sent:&lt;/B&gt; Thursday, September 21, 2000 1:02 AM&lt;BR&gt;&lt;B&gt;To:&lt;/B&gt; 'Chen, 
  Jack-TAO (???)'; 'acpi@phobos.fs.tum.de'&lt;BR&gt;&lt;B&gt;Subject:&lt;/B&gt; RE: [Acpi] Shut 
  down problem&lt;BR&gt;&lt;BR&gt;&lt;/DIV&gt;&lt;/FONT&gt;
  &lt;DIV&gt;&lt;FONT color=#0000ff face=Arial size=2&gt;&lt;SPAN class=750175816-20092000&gt;Hi 
  Jack,&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;
  &lt;DIV&gt;&lt;FONT color=#0000ff face=Arial size=2&gt;&lt;SPAN 
  class=750175816-20092000&gt;&lt;/SPAN&gt;&lt;/FONT&gt;Â &lt;/DIV&gt;
  &lt;DIV&gt;&lt;FONT color=#0000ff face=Arial size=2&gt;&lt;SPAN class=750175816-20092000&gt;This 
  is an issue with the code, not your BIOS. That line appears to be extraneous, 
  and we can probably just remove it. ;-)&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;
  &lt;DIV&gt;&lt;FONT color=#0000ff face=Arial size=2&gt;&lt;SPAN 
  class=750175816-20092000&gt;&lt;/SPAN&gt;&lt;/FONT&gt;Â &lt;/DIV&gt;
  &lt;DIV&gt;&lt;FONT color=#0000ff face=Arial size=2&gt;&lt;SPAN 
  class=750175816-20092000&gt;Regards -- Andy&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;
  &lt;DIV&gt;Â &lt;/DIV&gt;
  &lt;DIV align=left class=OutlookMessageHeader dir=ltr&gt;&lt;FONT face=Tahoma 
  size=2&gt;-----Original Message-----&lt;BR&gt;&lt;B&gt;From:&lt;/B&gt; Chen.Jack-Tao@inventec.com 
  [mailto:Chen.Jack-Tao@inventec.com]&lt;BR&gt;&lt;B&gt;Sent:&lt;/B&gt; Wednesday, September 20, 
  2000 3:39 AM&lt;BR&gt;&lt;B&gt;To:&lt;/B&gt; 'acpi@phobos.fs.tum.de'&lt;BR&gt;&lt;B&gt;Subject:&lt;/B&gt; [Acpi] 
  Shut down problem&lt;BR&gt;&lt;BR&gt;&lt;/FONT&gt;&lt;/DIV&gt;&lt;BR&gt;
  &lt;P&gt;&lt;FONT face="Courier New" size=2&gt;Â Dear sir:&lt;/FONT&gt; &lt;BR&gt;&lt;FONT 
  face="Courier New" size=2&gt;Â I use kernel 2.4.0, and it can find my ACPI 
  table.&lt;/FONT&gt; &lt;BR&gt;&lt;FONT face="Courier New" size=2&gt;Â It says support 
  S1,..S5.&lt;/FONT&gt; &lt;BR&gt;&lt;FONT face="Courier New" size=2&gt;Â When I want to 
  shutdown my system.&lt;/FONT&gt; &lt;BR&gt;&lt;FONT face="Courier New" size=2&gt;Â I use the 
  commandÂ  "init 0"&lt;/FONT&gt; &lt;BR&gt;&lt;FONT face="Courier New" size=2&gt;Â It 
  will shutdown all drivers. Final it display "&lt;/FONT&gt;&lt;FONT color=#0000ff 
  face="Courier New" size=2&gt;ACPI:&lt;/FONT&gt; &lt;FONT face="Courier New" size=2&gt;S5 
  fail".&lt;/FONT&gt; &lt;BR&gt;&lt;FONT face="Courier New" size=2&gt;Â But it still can power 
  off the system.&lt;/FONT&gt; &lt;BR&gt;&lt;FONT face="Courier New" size=2&gt;Â I would like 
  to know what situation the kernel will display "S5 fail".&lt;/FONT&gt; &lt;BR&gt;&lt;FONT 
  face="Courier New" size=2&gt;Â Then I can modify my BIOS code to fix this 
  error.&lt;/FONT&gt; &lt;/P&gt;
  &lt;P&gt;&lt;FONT face="Courier New" 
  size=2&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â  \
;Â Â Â Â Â Â Â Â Â Â Â Â Â Â &amp; \
nbsp;Â Â Â Â Â Â Â Â Â Â Â Â Â &amp;nb \
sp;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  \
  thanks&lt;/FONT&gt; &lt;/P&gt;&lt;/BLOCKQUOTE&gt;&lt;/BODY&gt;&lt;/HTML&gt;



</body></email><email><emailId>20000929135148</emailId><senderName>Robert Vollmert</senderName><senderEmail>rvollmert@gmx.net</senderEmail><timestampReceived>2000-09-29 13:51:48-0400</timestampReceived><subject>[Acpi] ACPI on ASUS A7V</subject><body>

----- Forwarded message -----

Date: Fri, 29 Sep 2000 15:49:33 +0200
To: andy_henroid@yahoo.com
Subject: ACPI on ASUS A7V
User-Agent: Mutt/1.2.5i

Hello,

I ran into a few problems trying to enable ACPI support on my
computer. The motherboard is an Asus A7V (for socket A processors)
using the VIA Apollo KT133 chipset. The kernel I used is 2.4.0-test8.

When ACPI interpreter support was enabled, the computer hung while
booting. I had disabled CONFIG_ACPI_S1_SLEEP. The last lines of output
were:

ACPI: support found
ACPI: PBLK 1 @ 0xe410:6
ACPI: C2 supported
ACPI: S1 supported
ACPI: S5 supported
VFS: Mounted root ...
Freeing unused kernel memory: 176k freed

Without the kernel ACPI interpreter, the machine booted fine. Relevant
output is:

Linux version 2.4.0-test8-acpi (root@krikkit) (gcc version 2.95.2 20000220 (Debian \
GNU/Linux)) #1 Fri Sep 29 12:48:11 CEST 2000  BIOS-e820: 000000000009fc00 @ \
0000000000000000 (usable)  BIOS-e820: 0000000000000400 @ 000000000009fc00 (reserved)
 BIOS-e820: 0000000000010000 @ 00000000000f0000 (reserved)
 BIOS-e820: 0000000007eec000 @ 0000000000100000 (usable)
 BIOS-e820: 0000000000003000 @ 0000000007fec000 (ACPI data)
 BIOS-e820: 0000000000010000 @ 0000000007fef000 (reserved)
 BIOS-e820: 0000000000001000 @ 0000000007fff000 (ACPI NVS)
 BIOS-e820: 0000000000010000 @ 00000000ffff0000 (reserved)
[snip]
ACPI: "ASUS" found at 0x000f6730

The output of acpidmp is attached. acpid (version 052200) then crashed
the computer. I couldn't get the output of acpid -dt because it wasn't
written to disk in time (is there a way to redirect output
unbuffered?). The output of acpid -d was:

# acpid -d
acpid: started
acpid: ACPI Subsystem version [Sep  6 2000]
acpid: FACP loaded from /proc/sys/acpi/
acpid: DSDT loaded from /proc/sys/acpi/
acpid: 99 Control Methods found and parsed
acpid: ACPI Namespace successfully loaded at root 0x0x809c19c
acpid: S0 SLP_TYP (0x0000)
acpid: S1 SLP_TYP (0x0303)
acpid: S2 not supported
acpid: S3 not supported
acpid: S4 SLP_TYP (0x0707)
acpid: S5 SLP_TYP (0x0707)
P_BLK 1 @ 0x3410:6
(debug) ACPI C2 works
ACPI C3 works

The lines "ACPI C{2,3} works" appear to come from the kernel.

If there is anything else to test, please tell me.

Robert

----- End forwarded message -----


</body></email></emails>